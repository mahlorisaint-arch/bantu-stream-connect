<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<title>Creator Dashboard - Bantu Stream Connect</title>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Supabase JS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
/* Color Theme - Same as content-detail.html and explore-screen.html */
:root {
--deep-black: #0A0E12;
--deep-navy: #0F172A;
--soft-white: #F8FAFC;
--slate-grey: #94A3B8;
--bantu-blue: #1D4ED8;
--warm-gold: #F59E0B;
--error-color: #EF4444;
--success-color: #10B981;
--glow-cycle-1: #00A3FF;
--glow-cycle-2: #0066FF;
--glow-cycle-3: #8B5CF6;
--glow-cycle-4: #EC4899;
--card-bg: rgba(15, 23, 42, 0.6);
--card-border: rgba(148, 163, 184, 0.2);
--hover-overlay: rgba(255, 255, 255, 0.05);
--active-overlay: rgba(245, 158, 11, 0.1);
--indigo: #4F46E5;
--gold-glow: rgba(245, 158, 11, 0.3);
--blue-glow: rgba(29, 78, 216, 0.3);
}
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: 'Inter', sans-serif;
background: var(--deep-black);
color: var(--soft-white);
min-height: 100vh;
overflow-x: hidden;
}
/* Loading Screen */
.loading-screen {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: var(--deep-black);
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
z-index: 1000;
}
.spinner {
width: 50px;
height: 50px;
border: 3px solid rgba(255, 255, 255, 0.1);
border-radius: 50%;
border-top-color: var(--bantu-blue);
animation: spin 1s linear infinite;
margin-bottom: 20px;
}
@keyframes spin {
to { transform: rotate(360deg); }
}
/* Animated Background - Same as content-detail.html */
.animated-bg {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: 1;
overflow: hidden;
}
.glow-cycle {
position: absolute;
border-radius: 50%;
filter: blur(60px);
opacity: 0.1;
animation: float 8s infinite ease-in-out;
}
.glow-1 {
width: 400px;
height: 400px;
background: var(--glow-cycle-1);
top: 10%;
left: 5%;
animation-delay: 0s;
}
.glow-2 {
width: 300px;
height: 300px;
background: var(--glow-cycle-2);
top: 60%;
right: 10%;
animation-delay: 2s;
}
.glow-3 {
width: 350px;
height: 350px;
background: var(--glow-cycle-3);
bottom: 10%;
left: 20%;
animation-delay: 4s;
}
.glow-4 {
width: 250px;
height: 250px;
background: var(--glow-cycle-4);
top: 20%;
right: 20%;
animation-delay: 6s;
}
@keyframes float {
0%, 100% { transform: translateY(0) scale(1); }
50% { transform: translateY(-20px) scale(1.05); }
}
/* Main Container */
.container {
max-width: 1200px;
margin: 0 auto;
padding: 24px;
position: relative;
z-index: 2;
padding-bottom: 100px;
}
/* Header - Updated to match explore-screen.html */
.header {
background: rgba(10, 14, 18, 0.9);
backdrop-filter: blur(20px);
padding: 16px 20px;
position: sticky;
top: 0;
z-index: 100;
border-bottom: 1px solid var(--card-border);
display: flex;
justify-content: space-between;
align-items: center;
}
.logo {
display: flex;
align-items: center;
gap: 12px;
cursor: pointer;
text-decoration: none;
}
.logo-icon {
width: 40px;
height: 40px;
border-radius: 10px;
display: flex;
align-items: center;
justify-content: center;
box-shadow: 0 0 32px rgba(29, 78, 216, 0.3);
background: transparent;
border: 1px solid rgba(255, 255, 255, 0.1);
}
.logo-text {
font-family: 'Orbitron', sans-serif;
font-weight: 700;
font-size: 18px;
background: linear-gradient(to right, var(--soft-white), var(--bantu-blue));
-webkit-background-clip: text;
background-clip: text;
color: transparent;
letter-spacing: 0.5px;
}
.header-actions {
display: flex;
gap: 10px;
align-items: center;
}
.icon-btn {
width: 40px;
height: 40px;
border-radius: 50%;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
color: var(--soft-white);
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s ease;
position: relative;
}
.icon-btn:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-2px);
}
.notification-badge {
position: absolute;
top: -5px;
right: -5px;
background: var(--error-color);
color: white;
font-size: 10px;
font-weight: bold;
width: 18px;
height: 18px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
border: 2px solid var(--deep-black);
}
.profile-btn {
width: 40px;
height: 40px;
border-radius: 50%;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
border: 2px solid rgba(255, 255, 255, 0.2);
cursor: pointer;
overflow: hidden;
transition: all 0.3s ease;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-weight: 600;
font-size: 14px;
}
.profile-btn:hover {
transform: translateY(-2px);
box-shadow: 0 8px 20px rgba(29, 78, 216, 0.3);
}
.profile-img {
width: 100%;
height: 100%;
object-fit: cover;
}
.profile-placeholder {
width: 100%;
height: 100%;
display: flex;
align-items: center;
justify-content: center;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
color: white;
font-size: 16px;
}
/* Creator Dashboard Specific Styles */
.dashboard-hero {
background: var(--card-bg);
border: 1px solid var(--card-border);
border-radius: 24px;
padding: 40px;
margin-bottom: 30px;
backdrop-filter: blur(10px);
box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
position: relative;
overflow: hidden;
}
.dashboard-hero::before {
content: '';
position: absolute;
top: -2px;
left: -2px;
right: -2px;
bottom: -2px;
background: linear-gradient(45deg, var(--bantu-blue), var(--warm-gold));
border-radius: 26px;
z-index: -1;
opacity: 0.1;
}
.creator-profile {
display: flex;
align-items: center;
gap: 25px;
margin-bottom: 20px;
}
.avatar-container {
position: relative;
}
.creator-avatar {
width: 100px;
height: 100px;
border-radius: 50%;
border: 3px solid var(--warm-gold);
object-fit: cover;
background: linear-gradient(135deg, var(--bantu-blue), var(--glow-cycle-3));
}
.founder-badge {
position: absolute;
bottom: 5px;
right: 5px;
width: 30px;
height: 30px;
background: var(--warm-gold);
border-radius: 50%;
border: 2px solid var(--soft-white);
display: flex;
align-items: center;
justify-content: center;
color: var(--deep-black);
font-size: 14px;
animation: pulse 2s infinite;
}
@keyframes pulse {
0%, 100% { transform: scale(1); }
50% { transform: scale(1.1); }
}
.creator-info {
flex: 1;
}
.welcome-text {
font-size: 16px;
color: var(--slate-grey);
margin-bottom: 5px;
}
.creator-name {
font-family: 'Orbitron', sans-serif;
font-size: 32px;
font-weight: 700;
background: linear-gradient(135deg, var(--soft-white), var(--warm-gold));
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
margin-bottom: 5px;
}
.connector-count {
font-size: 16px;
color: var(--warm-gold);
font-weight: 600;
}
/* Stats Row */
.stats-row {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
margin: 30px 0;
}
.stat-card {
background: var(--card-bg);
border: 1px solid var(--card-border);
border-radius: 20px;
padding: 25px;
text-align: center;
backdrop-filter: blur(10px);
transition: all 0.3s ease;
}
.stat-card:hover {
transform: translateY(-5px);
border-color: rgba(245, 158, 11, 0.3);
}
.stat-icon {
font-size: 32px;
color: var(--warm-gold);
margin-bottom: 15px;
}
.stat-value {
font-family: 'Orbitron', sans-serif;
font-size: 32px;
font-weight: 700;
color: var(--soft-white);
margin-bottom: 5px;
}
.stat-label {
font-size: 14px;
color: var(--slate-grey);
}
/* Sections */
.dashboard-section {
margin-bottom: 40px;
}
.section-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}
.section-title {
font-size: 24px;
font-weight: 700;
background: linear-gradient(135deg, var(--soft-white), var(--warm-gold));
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
}
.see-all-btn {
padding: 10px 20px;
background: rgba(255, 255, 255, 0.1);
border: 1px solid var(--card-border);
border-radius: 10px;
color: var(--warm-gold);
font-size: 14px;
font-weight: 500;
cursor: pointer;
transition: all 0.3s ease;
display: flex;
align-items: center;
gap: 8px;
}
.see-all-btn:hover {
background: rgba(255, 255, 255, 0.2);
border-color: var(--warm-gold);
}
/* My Uploads */
.uploads-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
gap: 20px;
}
.upload-card {
background: var(--card-bg);
border: 1px solid var(--card-border);
border-radius: 20px;
padding: 20px;
backdrop-filter: blur(10px);
transition: all 0.3s ease;
}
.upload-card:hover {
transform: translateY(-5px);
border-color: rgba(245, 158, 11, 0.3);
}
.upload-title {
font-size: 18px;
font-weight: 600;
color: var(--soft-white);
margin-bottom: 15px;
line-height: 1.4;
}
.upload-status {
display: inline-block;
padding: 8px 20px;
border-radius: 20px;
font-size: 12px;
font-weight: 600;
}
.status-published {
background: rgba(245, 158, 11, 0.2);
color: var(--warm-gold);
}
.status-draft {
background: rgba(148, 163, 184, 0.2);
color: var(--slate-grey);
}
/* Upload New Content */
.upload-promo {
background: var(--card-bg);
border: 1px solid var(--card-border);
border-radius: 24px;
padding: 40px;
text-align: center;
backdrop-filter: blur(10px);
}
.promo-title {
font-family: 'Orbitron', sans-serif;
font-size: 28px;
font-weight: 700;
background: linear-gradient(135deg, var(--soft-white), var(--bantu-blue));
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
margin-bottom: 15px;
}
.promo-text {
font-size: 16px;
color: rgba(248, 250, 252, 0.8);
margin-bottom: 25px;
line-height: 1.5;
}
.upload-btn {
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
color: var(--soft-white);
border: none;
padding: 15px 30px;
border-radius: 12px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
border: 1px solid rgba(255, 255, 255, 0.1);
display: inline-flex;
align-items: center;
gap: 12px;
}
.upload-btn:hover {
transform: translateY(-3px);
box-shadow: 0 10px 25px rgba(29, 78, 216, 0.4);
}
/* Quick Actions */
.quick-actions {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
}
.action-card {
background: var(--card-bg);
border: 1px solid var(--card-border);
border-radius: 20px;
padding: 25px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
backdrop-filter: blur(10px);
}
.action-card:hover {
transform: translateY(-5px);
border-color: rgba(245, 158, 11, 0.3);
}
.action-icon {
width: 60px;
height: 60px;
margin: 0 auto 15px;
border-radius: 50%;
background: rgba(77, 171, 247, 0.2);
display: flex;
align-items: center;
justify-content: center;
font-size: 24px;
color: var(--bantu-blue);
}
.action-title {
font-size: 16px;
font-weight: 600;
color: var(--soft-white);
}
/* Payout Action */
.payout-action {
grid-column: span 2;
max-width: 300px;
margin: 0 auto;
}
/* Messages Section */
.messages-section {
background: var(--card-bg);
border: 1px solid var(--card-border);
border-radius: 20px;
padding: 40px 30px;
text-align: center;
backdrop-filter: blur(10px);
}
.messages-icon {
font-size: 50px;
color: var(--slate-grey);
margin-bottom: 20px;
opacity: 0.5;
}
.messages-text {
font-size: 16px;
color: var(--slate-grey);
line-height: 1.5;
}
/* Empty State */
.empty-state {
text-align: center;
padding: 50px 20px;
color: var(--slate-grey);
background: var(--card-bg);
border: 1px solid var(--card-border);
border-radius: 16px;
backdrop-filter: blur(10px);
grid-column: 1 / -1;
}
.empty-icon {
font-size: 60px;
color: var(--slate-grey);
margin-bottom: 20px;
opacity: 0.5;
}
.empty-text {
font-size: 16px;
color: var(--slate-grey);
line-height: 1.5;
}
/* Error State */
.error-state {
text-align: center;
padding: 60px 20px;
max-width: 600px;
margin: 0 auto;
}
.error-icon {
font-size: 60px;
color: var(--error-color);
margin-bottom: 20px;
}
.error-title {
font-size: 24px;
font-weight: 600;
color: var(--soft-white);
margin-bottom: 10px;
}
.error-message {
color: var(--slate-grey);
margin-bottom: 30px;
line-height: 1.6;
}
.error-actions {
display: flex;
gap: 15px;
justify-content: center;
}
.action-btn {
padding: 12px 24px;
border-radius: 10px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
border: none;
display: flex;
align-items: center;
gap: 8px;
}
.retry-btn {
background: var(--bantu-blue);
color: white;
}
.retry-btn:hover {
background: #3b9ce6;
transform: translateY(-2px);
}
.login-btn {
background: rgba(255, 255, 255, 0.1);
color: white;
border: 1px solid rgba(255, 255, 255, 0.2);
}
.login-btn:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-2px);
}
/* Modal */
.modal-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
display: none;
align-items: center;
justify-content: center;
z-index: 1000;
padding: 20px;
}
.modal-content {
background: var(--card-bg);
backdrop-filter: blur(20px);
border-radius: 20px;
padding: 30px;
width: 100%;
max-width: 500px;
border: 1px solid var(--card-border);
}
.modal-header {
display: flex;
align-items: center;
gap: 15px;
margin-bottom: 20px;
}
.modal-icon {
font-size: 24px;
color: var(--warm-gold);
}
.modal-title {
font-family: 'Orbitron', sans-serif;
font-size: 20px;
font-weight: 700;
color: var(--soft-white);
flex: 1;
}
.modal-close {
background: transparent;
border: none;
color: rgba(255, 255, 255, 0.5);
font-size: 20px;
cursor: pointer;
width: 30px;
height: 30px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
}
.modal-close:hover {
background: rgba(255, 255, 255, 0.1);
}
.modal-body {
margin-bottom: 25px;
}
.payout-amount {
font-family: 'Orbitron', sans-serif;
font-size: 36px;
font-weight: 700;
color: var(--warm-gold);
text-align: center;
margin: 20px 0;
}
.modal-note {
font-size: 14px;
color: var(--slate-grey);
line-height: 1.5;
margin-top: 15px;
}
.modal-actions {
display: flex;
gap: 15px;
}
.modal-btn {
flex: 1;
padding: 15px;
border-radius: 12px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
border: none;
font-size: 16px;
}
.modal-btn.primary {
background: var(--warm-gold);
color: var(--deep-black);
}
.modal-btn.primary:hover {
background: #f97316;
transform: translateY(-2px);
}
.modal-btn.secondary {
background: rgba(255, 255, 255, 0.1);
color: white;
border: 1px solid rgba(255, 255, 255, 0.2);
}
.modal-btn.secondary:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-2px);
}
/* Toast - Same as explore-screen.html */
#toast-container {
position: fixed;
bottom: 20px;
right: 20px;
z-index: 9999;
display: flex;
flex-direction: column;
gap: 10px;
}
.toast {
padding: 15px 25px;
border-radius: 12px;
color: var(--soft-white);
font-weight: 500;
max-width: 300px;
backdrop-filter: blur(10px);
border: 1px solid var(--card-border);
display: flex;
align-items: center;
gap: 10px;
}
.toast.error {
background: rgba(239, 68, 68, 0.9);
}
.toast.success {
background: rgba(16, 185, 129, 0.9);
}
.toast.warning {
background: rgba(245, 158, 11, 0.9);
}
.toast.info {
background: var(--card-bg);
border: 1px solid var(--card-border);
}
@keyframes slideIn {
from {
transform: translateX(100%);
opacity: 0;
}
to {
transform: translateX(0);
opacity: 1;
}
}
/* Navigation */
.global-nav {
position: fixed;
bottom: 0;
left: 0;
width: 100%;
background: rgba(10, 14, 18, 0.95);
backdrop-filter: blur(20px);
display: flex;
justify-content: space-around;
padding: 15px 0;
z-index: 100;
border-top: 1px solid var(--card-border);
}
.nav-item {
display: flex;
flex-direction: column;
align-items: center;
color: var(--slate-grey);
text-decoration: none;
font-size: 12px;
transition: all 0.3s ease;
}
.nav-item i {
font-size: 18px;
margin-bottom: 5px;
}
.nav-item:hover {
color: var(--soft-white);
}
.nav-item.active {
color: var(--warm-gold);
}
/* Custom Scrollbar */
::-webkit-scrollbar {
width: 8px;
}
::-webkit-scrollbar-track {
background: var(--deep-navy);
}
::-webkit-scrollbar-thumb {
background: var(--bantu-blue);
border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
background: var(--warm-gold);
}
/* Responsive */
@media (max-width: 768px) {
.container {
padding: 16px;
max-width: 100%;
}
.dashboard-hero {
padding: 30px 20px;
}
.creator-profile {
flex-direction: column;
text-align: center;
gap: 15px;
}
.creator-name {
font-size: 24px;
}
.creator-avatar {
width: 80px;
height: 80px;
}
.stats-row {
grid-template-columns: repeat(2, 1fr);
}
.quick-actions {
grid-template-columns: 1fr;
}
.payout-action {
grid-column: span 1;
}
.modal-content {
padding: 20px;
}
.error-actions {
flex-direction: column;
}
.action-btn {
width: 100%;
justify-content: center;
}
}
@media (max-width: 480px) {
.stats-row {
grid-template-columns: 1fr;
}
.uploads-grid {
grid-template-columns: 1fr;
}
.modal-actions {
flex-direction: column;
}
.modal-btn {
width: 100%;
}
}
</style>
</head>
<body>
<!-- Loading Screen -->
<div id="loading" class="loading-screen">
<div class="spinner"></div>
<div id="loading-text">Loading Creator Dashboard...</div>
</div>
<!-- Animated Background -->
<div class="animated-bg">
<div class="glow-cycle glow-1"></div>
<div class="glow-cycle glow-2"></div>
<div class="glow-cycle glow-3"></div>
<div class="glow-cycle glow-4"></div>
</div>
<!-- Main App (hidden until loaded) -->
<div id="app" style="display: none;">
<!-- Header -->
<header class="header">
<div class="logo" onclick="window.location.href='index.html'">
<div class="logo-icon">
<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="40" height="40" rx="8" fill="#0F172A"/>
<path d="M8 20 L12 16 L16 22 L20 18 L24 24 L28 20 L32 26" stroke="url(#pulse-gradient)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
<circle cx="32" cy="26" r="3" fill="#F59E0B"/>
<defs>
<linearGradient id="pulse-gradient" x1="8" y1="20" x2="32" y2="26" gradientUnits="userSpaceOnUse">
<stop stop-color="#1D4ED8"/>
<stop offset="1" stop-color="#F59E0B"/>
</linearGradient>
</defs>
</svg>
</div>
<div class="logo-text">BANTU STREAM CONNECT</div>
</div>
<div class="header-actions">
<button id="search-btn" class="icon-btn search-btn" title="Search">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
</svg>
</button>
<button id="notifications-btn" class="icon-btn" title="Notifications">
<i class="fas fa-bell"></i>
<span class="notification-badge" id="notification-count" style="display: none;">0</span>
</button>
<button id="profile-btn" class="profile-btn" title="Profile">
<div class="profile-placeholder" id="userProfilePlaceholder">
<i class="fas fa-user"></i>
</div>
</button>
</div>
</header>
<!-- Main Content -->
<main class="container">
<!-- Welcome Header -->
<section class="dashboard-section">
<div class="dashboard-hero">
<div class="creator-profile">
<div class="avatar-container">
<img id="creatorAvatar" src="" alt="Creator Avatar" class="creator-avatar" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiByeD0iNDAiIGZpbGw9InVybCgjZ3JhZGllbnQwX3JhZGlhbF8xMzZfODQ0KSIvPgo8ZGVmcz4KPHJhZGlhbEdyYWRpZW50IGlkPSJncmFkaWVudDBfcmFkaWFsXzEzNl84NDQiIGN4PSIwIiBjeT0iMCIgcj0iMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDAgNDApIHNjYWxlKDUzLjE4NDIpIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzFFNERCOCIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM4QjVDNEY2Ii8+CjwvcmFkaWFsR3JhZGllbnQ+CjwvZGVmcz4KPC9zdmc+'">
<div id="founderBadge" class="founder-badge" style="display: none;">
<i class="fas fa-check"></i>
</div>
</div>
<div class="creator-info">
<div class="welcome-text">Welcome back, Creator</div>
<h1 id="creatorName" class="creator-name">Loading...</h1>
<div id="connectorCount" class="connector-count">0 Connectors</div>
</div>
</div>
</div>
</section>
<!-- Stats Row -->
<section class="dashboard-section">
<div class="stats-row">
<div class="stat-card">
<div class="stat-icon">
<i class="fas fa-cloud-upload-alt"></i>
</div>
<div id="totalUploads" class="stat-value">0</div>
<div class="stat-label">Uploads</div>
</div>
<div class="stat-card">
<div class="stat-icon">
<i class="fas fa-eye"></i>
</div>
<div id="totalViews" class="stat-value">0</div>
<div class="stat-label">Total Views</div>
</div>
<div class="stat-card">
<div class="stat-icon">
<i class="fas fa-money-bill-wave"></i>
</div>
<div id="totalEarnings" class="stat-value">R0.00</div>
<div class="stat-label">Earnings</div>
</div>
</div>
</section>
<!-- My Uploads Section -->
<section class="dashboard-section">
<div class="section-header">
<h2 class="section-title">My Uploads</h2>
<button id="seeAllUploads" class="see-all-btn">
See All
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M5 12h14M12 5l7 7-7 7"/>
</svg>
</button>
</div>
<div id="uploadsContent" class="uploads-grid">
<!-- Content will be loaded here -->
</div>
</section>
<!-- Upload New Content -->
<section class="dashboard-section">
<div class="upload-promo">
<h2 class="promo-title">Upload New Content</h2>
<p class="promo-text">Share your stories with the world and start earning</p>
<button id="uploadContentBtn" class="upload-btn">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M12 5v14M5 12h14"/>
</svg>
Upload Content
</button>
</div>
</section>
<!-- Quick Actions -->
<section class="dashboard-section">
<div class="section-header">
<h2 class="section-title">Quick Actions</h2>
</div>
<div class="quick-actions">
<div class="action-card" id="quickUpload">
<div class="action-icon">
<i class="fas fa-cloud-upload"></i>
</div>
<div class="action-title">Upload Content</div>
</div>
<div class="action-card" id="viewAnalytics">
<div class="action-icon">
<i class="fas fa-chart-line"></i>
</div>
<div class="action-title">View Analytics</div>
</div>
<div class="action-card payout-action" id="payoutRequest">
<div class="action-icon">
<i class="fas fa-wallet"></i>
</div>
<div class="action-title">Payout Request</div>
</div>
</div>
</section>
<!-- Messages & Notifications -->
<section class="dashboard-section">
<div class="section-header">
<h2 class="section-title">Messages & Notifications</h2>
</div>
<div class="messages-section">
<div class="messages-icon">
<i class="fas fa-envelope-open-text"></i>
</div>
<p class="messages-text">
No new messages. We'll notify you when fans interact with your content.
</p>
</div>
</section>
</main>
<!-- Global Navigation -->
<nav class="global-nav">
<a href="index.html" class="nav-item">
<i class="fas fa-home"></i>
Home
</a>
<a href="trending_screen.html" class="nav-item">
<i class="fas fa-fire"></i>
Trending
</a>
<a href="content-library.html" class="nav-item">
<i class="fas fa-th-large"></i>
Library
</a>
<a href="creator-dashboard.html" class="nav-item active">
<i class="fas fa-user"></i>
Creator
</a>
</nav>
</div>
<!-- Error State -->
<div id="errorState" class="error-state" style="display: none;">
<div class="error-icon">
<i class="fas fa-exclamation-triangle"></i>
</div>
<h2 class="error-title" id="errorTitle">Connection Error</h2>
<p class="error-message" id="errorMessage">Your account is ready, but we're having trouble loading your dashboard.</p>
<div class="error-actions">
<button id="retryBtn" class="action-btn retry-btn">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M23 4v6h-6M1 20v-6h6"/>
<path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
</svg>
Retry
</button>
<button id="reloginBtn" class="action-btn login-btn">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4M10 17l5-5-5-5M15 12H3"/>
</svg>
Re-Login
</button>
</div>
</div>
<!-- Payout Modal -->
<div id="payoutModal" class="modal-overlay">
<div class="modal-content">
<div class="modal-header">
<div class="modal-icon">
<i class="fas fa-wallet"></i>
</div>
<div class="modal-title">Payout Request</div>
<button class="modal-close" id="closePayoutModal">
<i class="fas fa-times"></i>
</button>
</div>
<div class="modal-body">
<div style="color: var(--slate-grey); font-size: 14px; margin-bottom: 10px;">
Available Balance:
</div>
<div id="payoutAmount" class="payout-amount">R0.00</div>
<div class="modal-note">
Minimum payout amount: R100.00<br><br>
Your earnings will be processed within 3-5 business days.
</div>
</div>
<div class="modal-actions">
<button class="modal-btn secondary" id="cancelPayout">
Cancel
</button>
<button class="modal-btn primary" id="requestPayout">
Request Payout
</button>
</div>
</div>
</div>
<!-- Search Modal (from explore-screen.html) -->
<div id="search-modal" class="modal-overlay">
<div style="width:90%;max-width:800px;background:var(--card-bg);border-radius:20px;padding:30px;backdrop-filter:blur(10px);">
<div class="search-modal-header">
<div class="search-input-container">
<i class="search-icon fas fa-search"></i>
<input type="text" id="search-input" class="search-input" placeholder="Search content, creators, or categories..." autocomplete="off">
</div>
<button id="close-search-btn" class="modal-close">
<i class="fas fa-times"></i>
</button>
</div>
<div class="search-filters">
<div class="filter-group">
<label class="filter-label">Category</label>
<select id="category-filter" class="filter-select">
<option value="">All Categories</option>
<option value="Music">Music</option>
<option value="STEM">STEM</option>
<option value="Culture">Culture</option>
<option value="News">News</option>
<option value="Sports">Sports</option>
<option value="Movies">Movies</option>
<option value="Documentaries">Documentaries</option>
<option value="Podcasts">Podcasts</option>
</select>
</div>
<div class="filter-group">
<label class="filter-label">Sort By</label>
<select id="sort-filter" class="filter-select">
<option value="newest">Newest First</option>
<option value="popular">Most Popular</option>
<option value="trending">Trending</option>
</select>
</div>
</div>
<div class="search-results">
<div id="search-results-grid" class="search-results-grid">
<!-- Results loaded here -->
</div>
</div>
</div>
</div>
<!-- Notifications Panel (from explore-screen.html) -->
<div id="notifications-panel" class="modal-overlay" style="display:none;justify-content:flex-end;">
<div style="width:400px;height:100%;background:var(--card-bg);border-left:1px solid var(--card-border);box-shadow:-5px 0 25px rgba(0,0,0,0.3);backdrop-filter:blur(10px);">
<div class="notifications-header" style="padding:20px;border-bottom:1px solid var(--card-border);display:flex;justify-content:space-between;align-items:center">
<h2 style="font-family:'Orbitron',sans-serif;font-size:20px;margin:0;color:var(--soft-white)">Notifications</h2>
<button id="close-notifications" class="modal-close">
<i class="fas fa-times"></i>
</button>
</div>
<div class="notifications-list" id="notifications-list" style="max-height:calc(100vh-150px);overflow-y:auto;padding:20px">
<!-- Notifications loaded here -->
</div>
<div class="notifications-footer" style="padding:20px;border-top:1px solid var(--card-border);display:flex;gap:15px">
<button id="mark-all-read" class="modal-btn secondary" style="flex:1">Mark all as read</button>
<button id="notification-settings" class="modal-btn secondary" style="flex:1">Settings</button>
</div>
</div>
</div>
<!-- Toast Container -->
<div id="toast-container"></div>
<!-- CRITICAL FIX: Initialize shared Supabase client BEFORE DOMContentLoaded -->
<script>
if (!window.supabaseClient) {
  window.supabaseClient = supabase.createClient(
    'https://ydnxqnbjoshvxteevemc.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U'
  );
  console.log('âœ… Global Supabase client initialized for creator dashboard');
}
</script>
<!-- Creator Dashboard JavaScript - FIXED SYNTAX ERROR -->
<script>
document.addEventListener('DOMContentLoaded', async () => {
  console.log('ðŸ‘‘ Creator Dashboard Initializing...');
  
  // DOM Elements
  const loadingScreen = document.getElementById('loading');
  const loadingText = document.getElementById('loading-text');
  const app = document.getElementById('app');
  const errorState = document.getElementById('errorState');
  const errorTitle = document.getElementById('errorTitle');
  const errorMessage = document.getElementById('errorMessage');
  const profileBtn = document.getElementById('profile-btn');
  const notificationsBtn = document.getElementById('notifications-btn');
  const searchBtn = document.getElementById('search-btn');
  
  // User Info Elements
  const creatorAvatar = document.getElementById('creatorAvatar');
  const creatorName = document.getElementById('creatorName');
  const connectorCount = document.getElementById('connectorCount');
  const founderBadge = document.getElementById('founderBadge');
  
  // Stats Elements
  const totalUploads = document.getElementById('totalUploads');
  const totalViews = document.getElementById('totalViews');
  const totalEarnings = document.getElementById('totalEarnings');
  
  // Uploads Elements
  const uploadsContent = document.getElementById('uploadsContent');
  
  // Buttons
  const seeAllUploads = document.getElementById('seeAllUploads');
  const uploadContentBtn = document.getElementById('uploadContentBtn');
  const quickUpload = document.getElementById('quickUpload');
  const viewAnalytics = document.getElementById('viewAnalytics');
  const payoutRequest = document.getElementById('payoutRequest');
  const retryBtn = document.getElementById('retryBtn');
  const reloginBtn = document.getElementById('reloginBtn');
  
  // Modal Elements
  const payoutModal = document.getElementById('payoutModal');
  const closePayoutModal = document.getElementById('closePayoutModal');
  const payoutAmount = document.getElementById('payoutAmount');
  const cancelPayout = document.getElementById('cancelPayout');
  const requestPayout = document.getElementById('requestPayout');
  
  // Search Modal Elements
  const searchModal = document.getElementById('search-modal');
  const closeSearchBtn = document.getElementById('close-search-btn');
  const searchInput = document.getElementById('search-input');
  
  // Notifications Panel Elements
  const notificationsPanel = document.getElementById('notifications-panel');
  const closeNotifications = document.getElementById('close-notifications');
  const markAllReadBtn = document.getElementById('mark-all-read');
  const notificationsList = document.getElementById('notifications-list');
  
  // State variables
  let currentUser = null;
  let dashboardData = null;
  let isLoading = true;
  let notifications = [];
  
  // âœ… SHOW/HIDE LOADING
  function setLoading(loading, text = '') {
    isLoading = loading;
    if (text) loadingText.textContent = text;
    if (loading) {
      loadingScreen.style.display = 'flex';
      app.style.display = 'none';
      errorState.style.display = 'none';
    } else {
      setTimeout(() => {
        loadingScreen.style.display = 'none';
        app.style.display = 'block';
      }, 500);
    }
  }
  
  // âœ… SHOW TOAST MESSAGE
  function showToast(message, type = 'error') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i> ${message}`;
    document.getElementById('toast-container').appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
  }
  
  // âœ… FORMAT CURRENCY (ZAR)
  function formatCurrency(amount) {
    return 'R' + parseFloat(amount).toFixed(2);
  }
  
  // âœ… FORMAT NUMBER
  function formatNumber(num) {
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
    return num.toString();
  }
  
  // âœ… CONVERT USD TO ZAR
  function convertToZAR(usdAmount) {
    const usdToZarRate = 18.5;
    return formatCurrency(usdAmount * usdToZarRate);
  }
  
  // âœ… GET INITIALS FROM EMAIL
  function getInitials(email) {
    if (!email) return 'U';
    const parts = email.split('@')[0];
    return parts.substring(0, 2).toUpperCase();
  }
  
  // âœ… GET INITIALS FROM FULL NAME
  function getInitialsFromName(fullName) {
    if (!fullName) return 'U';
    const names = fullName.split(' ');
    if (names.length >= 2) {
      return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();
    }
    return fullName.charAt(0).toUpperCase();
  }
  
  // ðŸ”‘ CRITICAL FIX: Load profile picture with SAFE PROPERTY ACCESS (NO DESTRUCTURING)
  async function loadUserProfilePicture(user) {
    try {
      if (!user || !profileBtn) return;
      
      const placeholder = document.getElementById('userProfilePlaceholder');
      if (!placeholder) return;
      
      // Clear existing content safely
      while (placeholder.firstChild) {
        placeholder.removeChild(placeholder.firstChild);
      }
      
      const userInitials = getInitials(user.email);
      
      // Fetch user profile from database - SAFE PROPERTY ACCESS
      const profileResponse = await window.supabaseClient
        .from('user_profiles')
        .select('*')
        .eq('id', user.id)
        .maybeSingle();
      
      const profile = profileResponse.data;
      const profileError = profileResponse.error;
      
      if (profileError) {
        console.log('Profile query error:', profileError);
        // Fallback to email initials
        const fallback = document.createElement('div');
        fallback.className = 'profile-placeholder';
        fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px';
        fallback.textContent = userInitials;
        placeholder.appendChild(fallback);
        return;
      }
      
      if (profile) {
        const displayName = profile.full_name || profile.username || user.email || 'User';
        const initial = getInitials(displayName);
        
        // If avatar URL exists, display it
        if (profile.avatar_url) {
          let avatarUrl = profile.avatar_url;
          
          // Construct full URL safely
          try {
            if (!avatarUrl.startsWith('http')) {
              if (avatarUrl.startsWith('avatars/')) {
                avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${avatarUrl}`;
              } else {
                avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/avatars/${avatarUrl}`;
              }
            }
            
            // Create image element with proper styling
            const img = document.createElement('img');
            img.className = 'profile-img';
            img.alt = displayName;
            img.style.cssText = 'width: 100%; height: 100%; border-radius: 50%; object-fit: cover;';
            img.src = avatarUrl;
            
            // Fallback to initials if image fails to load
            img.onerror = () => {
              console.log('Avatar image failed to load, falling back to initials');
              const fallbackInitials = profile.full_name ? getInitialsFromName(profile.full_name) : userInitials;
              const fallback = document.createElement('div');
              fallback.className = 'profile-placeholder';
              fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px';
              fallback.textContent = fallbackInitials;
              placeholder.innerHTML = '';
              placeholder.appendChild(fallback);
            };
            
            placeholder.appendChild(img);
          } catch (e) {
            console.error('Error constructing avatar URL:', e);
            // Fallback to initials
            const fallback = document.createElement('div');
            fallback.className = 'profile-placeholder';
            fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px';
            fallback.textContent = initial;
            placeholder.appendChild(fallback);
          }
        } else {
          // If no avatar but full name exists, use name initials
          const nameInitials = profile.full_name ? getInitialsFromName(profile.full_name) : userInitials;
          const fallback = document.createElement('div');
          fallback.className = 'profile-placeholder';
          fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px';
          fallback.textContent = nameInitials;
          placeholder.appendChild(fallback);
        }
      } else {
        // No profile found, use email initials
        const fallback = document.createElement('div');
        fallback.className = 'profile-placeholder';
        fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px';
        fallback.textContent = userInitials;
        placeholder.appendChild(fallback);
      }
    } catch (error) {
      console.error('Error loading user profile picture:', error);
      // Fallback to email initials
      const placeholder = document.getElementById('userProfilePlaceholder');
      if (placeholder) {
        const userInitials = getInitials(user.email);
        const fallback = document.createElement('div');
        fallback.className = 'profile-placeholder';
        fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px';
        fallback.textContent = userInitials;
        placeholder.innerHTML = '';
        placeholder.appendChild(fallback);
      }
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Check authentication with SAFE PROPERTY ACCESS (NO DESTRUCTURING)
  async function checkAuthentication() {
    try {
      setLoading(true, 'Checking authentication...');
      
      // SAFE PROPERTY ACCESS - NO DESTRUCTURING
      const sessionResponse = await window.supabaseClient.auth.getSession();
      const session = sessionResponse.data.session;
      const error = sessionResponse.error;
      
      if (error || !session?.user) {
        console.log('âš ï¸ User not authenticated');
        showToast('Please sign in to access Creator Dashboard', 'error');
        localStorage.setItem('redirectAfterLogin', 'creator-dashboard.html');
        window.location.href = 'login.html?redirect=creator-dashboard.html';
        return false;
      }
      
      currentUser = session.user;
      console.log('âœ… User authenticated:', currentUser.email);
      
      // Load user profile picture
      await loadUserProfilePicture(currentUser);
      
      return true;
    } catch (error) {
      console.error('âŒ Authentication error:', error);
      return false;
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Load notifications with SAFE PROPERTY ACCESS
  async function loadNotifications() {
    try {
      if (!currentUser) {
        updateNotificationBadge(0);
        return;
      }
      
      // SAFE PROPERTY ACCESS
      const notificationsResponse = await window.supabaseClient
        .from('notifications')
        .select('*')
        .eq('user_id', currentUser.id)
        .order('created_at', { ascending: false })
        .limit(20);
      
      const data = notificationsResponse.data;
      const error = notificationsResponse.error;
      
      if (error) throw error;
      
      notifications = data || [];
      const unreadCount = notifications.filter(n => !n.is_read).length;
      updateNotificationBadge(unreadCount);
      renderNotifications();
    } catch (error) {
      console.error('Error loading notifications:', error);
      updateNotificationBadge(0);
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Update notification badge
  function updateNotificationBadge(count = null) {
    if (count === null) {
      count = notifications.filter(n => !n.is_read).length;
    }
    
    const badge = document.getElementById('notification-count');
    if (badge) {
      badge.textContent = count > 99 ? '99+' : count;
      badge.style.display = count > 0 ? 'flex' : 'none';
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Render notifications
  function renderNotifications() {
    if (!notificationsList) return;
    
    if (!currentUser) {
      notificationsList.innerHTML = `
        <div style="text-align:center;padding:40px 20px;color:var(--slate-grey)">
          <i class="fas fa-bell-slash" style="font-size:48px;margin-bottom:15px;opacity:0.5"></i>
          <p>Sign in to see notifications</p>
        </div>
      `;
      return;
    }
    
    if (!notifications || notifications.length === 0) {
      notificationsList.innerHTML = `
        <div style="text-align:center;padding:40px 20px;color:var(--slate-grey)">
          <i class="fas fa-bell" style="font-size:48px;margin-bottom:15px;opacity:0.3"></i>
          <p>No notifications yet</p>
        </div>
      `;
      return;
    }
    
    notificationsList.innerHTML = notifications.map(notification => `
      <div class="notification-item ${notification.is_read ? 'read' : 'unread'}" data-id="${notification.id}" style="padding:15px;border-bottom:1px solid var(--card-border);display:flex;gap:12px;position:relative">
        <div style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--bantu-blue),var(--warm-gold));display:flex;align-items:center;justify-content:center;flex-shrink:0">
          <i class="${getNotificationIcon(notification.type)}" style="color:white"></i>
        </div>
        <div style="flex:1">
          <h4 style="font-weight:600;margin-bottom:5px;color:var(--soft-white)">${escapeHtml(notification.title)}</h4>
          <p style="font-size:14px;color:var(--slate-grey);margin-bottom:8px;line-height:1.4">${escapeHtml(notification.message)}</p>
          <span style="font-size:12px;color:var(--warm-gold)">${formatNotificationTime(notification.created_at)}</span>
        </div>
        ${!notification.is_read ? '<div style="width:10px;height:10px;border-radius:50%;background:var(--warm-gold);position:absolute;top:15px;right:15px"></div>' : ''}
      </div>
    `).join('');
    
    // Add click handlers
    notificationsList.querySelectorAll('.notification-item').forEach(item => {
      item.addEventListener('click', async () => {
        const id = item.dataset.id;
        await markNotificationAsRead(id);
        if (item.dataset.contentId) {
          window.location.href = `content-detail.html?id=${item.dataset.contentId}`;
        }
        notificationsPanel.style.display = 'none';
      });
    });
  }
  
  // ðŸ”‘ CRITICAL FIX: Get notification icon
  function getNotificationIcon(type) {
    switch(type) {
      case 'like': return 'fas fa-heart';
      case 'comment': return 'fas fa-comment';
      case 'follow': return 'fas fa-user-plus';
      case 'view_milestone': return 'fas fa-trophy';
      case 'system': return 'fas fa-bell';
      default: return 'fas fa-bell';
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Format notification time
  function formatNotificationTime(timestamp) {
    if (!timestamp) return 'Just now';
    const diffMs = Date.now() - new Date(timestamp).getTime();
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 1) return 'Just now';
    if (diffMins < 60) return `${diffMins}m ago`;
    if (diffHours < 24) return `${diffHours}h ago`;
    if (diffDays < 7) return `${diffDays}d ago`;
    return new Date(timestamp).toLocaleDateString();
  }
  
  // ðŸ”‘ CRITICAL FIX: Escape HTML
  function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
  
  // ðŸ”‘ CRITICAL FIX: Setup search modal (from explore-screen.html)
  function setupSearchModal() {
    if (!searchBtn || !searchModal || !closeSearchBtn) return;
    
    // Open search modal
    searchBtn.addEventListener('click', () => {
      searchModal.style.display = 'flex';
      setTimeout(() => searchInput?.focus(), 300);
    });
    
    // Close search modal
    closeSearchBtn.addEventListener('click', () => {
      searchModal.style.display = 'none';
      if (searchInput) searchInput.value = '';
      document.getElementById('search-results-grid').innerHTML = '';
    });
    
    // Close when clicking outside modal content
    searchModal.addEventListener('click', (e) => {
      if (e.target === searchModal) {
        searchModal.style.display = 'none';
        if (searchInput) searchInput.value = '';
        document.getElementById('search-results-grid').innerHTML = '';
      }
    });
    
    // Live search with debounce
    if (searchInput) {
      searchInput.addEventListener('input', debounce(async (e) => {
        const query = e.target.value.trim();
        const category = document.getElementById('category-filter')?.value;
        const sortBy = document.getElementById('sort-filter')?.value;
        const resultsGrid = document.getElementById('search-results-grid');
        
        if (!resultsGrid) return;
        
        if (query.length < 2) {
          resultsGrid.innerHTML = '<div style="text-align:center;padding:40px;color:var(--slate-grey)">Start typing to search...</div>';
          return;
        }
        
        resultsGrid.innerHTML = `
          <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;color:var(--slate-grey)">
            <div style="width:40px;height:40px;border:3px solid rgba(255,255,255,0.1);border-radius:50%;border-top-color:var(--warm-gold);animation:spin 1s linear infinite;margin-bottom:15px"></div>
            <div>Searching...</div>
          </div>
        `;
        
        const results = await searchContent(query, category, sortBy);
        renderSearchResults(results);
      }, 300));
    }
    
    // Filter change triggers search
    document.getElementById('category-filter')?.addEventListener('change', () => {
      if (searchInput.value.trim().length >= 2) {
        searchInput.dispatchEvent(new Event('input'));
      }
    });
    
    document.getElementById('sort-filter')?.addEventListener('change', () => {
      if (searchInput.value.trim().length >= 2) {
        searchInput.dispatchEvent(new Event('input'));
      }
    });
  }
  
  // ðŸ”‘ CRITICAL FIX: Debounce function
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }
  
  // ðŸ”‘ CRITICAL FIX: Search content (from explore-screen.html)
  async function searchContent(query, category = '', sortBy = 'newest') {
    try {
      let queryBuilder = window.supabaseClient
        .from('Content')
        .select('*, user_profiles!user_id(*)')
        .ilike('title', `%${query}%`)
        .eq('status', 'published');
      
      if (category) {
        queryBuilder = queryBuilder.eq('genre', category);
      }
      
      if (sortBy === 'newest') {
        queryBuilder = queryBuilder.order('created_at', { ascending: false });
      }
      
      const searchResponse = await queryBuilder.limit(50);
      const data = searchResponse.data;
      const error = searchResponse.error;
      
      if (error) throw error;
      
      // Enrich with real counts from source tables
      const enriched = await Promise.all(
        (data || []).map(async (item) => {
          const viewsResponse = await window.supabaseClient
            .from('content_views')
            .select('*', { count: 'exact', head: true })
            .eq('content_id', item.id);
          
          const viewsCount = viewsResponse.count || 0;
          
          return {
            ...item,
            real_views: viewsCount || 0
          };
        })
      );
      
      // Additional sorting for popularity/trending
      if (sortBy === 'popular') {
        enriched.sort((a, b) => (b.real_views || 0) - (a.real_views || 0));
      } else if (sortBy === 'trending') {
        enriched.sort((a, b) => {
          const aScore = (a.real_views || 0) + ((a.likes_count || 0) * 2);
          const bScore = (b.real_views || 0) + ((b.likes_count || 0) * 2);
          return bScore - aScore;
        });
      }
      
      return enriched;
    } catch (error) {
      console.error('Search error:', error);
      return [];
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Render search results (from explore-screen.html)
  function renderSearchResults(results) {
    const grid = document.getElementById('search-results-grid');
    if (!grid) return;
    
    if (!results || results.length === 0) {
      grid.innerHTML = '<div style="text-align:center;padding:40px;color:var(--slate-grey)">No results found. Try different keywords.</div>';
      return;
    }
    
    grid.innerHTML = results.map(item => {
      const creator = item.user_profiles?.full_name || 
                      item.user_profiles?.username || 
                      item.creator || 
                      'Creator';
      const creatorId = item.user_profiles?.id || item.user_id;
      const thumbnailUrl = item.thumbnail_url 
        ? `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${item.thumbnail_url.replace(/^\/+/, '')}`
        : 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=400&h=225&fit=crop';
      
      return `
        <div class="content-card" data-content-id="${item.id}" style="background:var(--card-bg);border:1px solid var(--card-border);border-radius:20px;overflow:hidden;transition:all 0.3s ease;cursor:pointer;text-decoration:none;color:inherit;backdrop-filter:blur(10px);position:relative">
          <div class="card-thumbnail" style="position:relative;height:140px;overflow:hidden">
            <img src="${thumbnailUrl}"
                 alt="${escapeHtml(item.title)}"
                 loading="lazy"
                 onerror="this.src='https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=400&h=225&fit=crop'"
                 style="width:100%;height:100%;object-fit:cover;transition:transform 0.3s ease">
            <div style="position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(to bottom,transparent 50%,rgba(0,0,0,0.5) 100%)"></div>
            <div style="position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.3s ease">
              <div style="width:50px;height:50px;background:rgba(245,158,11,0.9);border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--deep-black);font-size:1.5rem;transform:scale(0.8);transition:all 0.3s ease">
                <i class="fas fa-play"></i>
              </div>
            </div>
          </div>
          <div class="card-content" style="padding:15px">
            <h3 class="card-title" style="font-size:16px;font-weight:600;margin-bottom:10px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;min-height:40px;color:var(--soft-white);line-height:1.4">${truncateText(escapeHtml(item.title), 45)}</h3>
            <button class="creator-btn" style="background:linear-gradient(135deg,var(--bantu-blue),var(--warm-gold));color:var(--soft-white);border:none;padding:8px 15px;border-radius:10px;font-size:12px;font-weight:500;cursor:pointer;display:inline-flex;align-items:center;gap:5px;transition:all 0.3s ease;border:1px solid rgba(255,255,255,0.1);margin-top:8px"
                    onclick="event.stopPropagation(); window.location.href='creator-channel.html?id=${creatorId}&name=${encodeURIComponent(creator)}'">
              <i class="fas fa-user"></i>
              ${truncateText(escapeHtml(creator), 15)}
            </button>
            <div style="display:flex;gap:15px;margin-top:8px;font-size:12px;color:var(--slate-grey)">
              <div style="display:flex;align-items:center;gap:4px">
                <i class="fas fa-eye" style="color:var(--bantu-blue);font-size:12px"></i>
                ${formatNumber(item.real_views || item.views_count || 0)}
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('');
    
    // Add click handlers to cards
    grid.querySelectorAll('.content-card').forEach(card => {
      card.addEventListener('click', (e) => {
        if (e.target.closest('.creator-btn')) return;
        const id = card.dataset.contentId;
        if (id) window.location.href = `content-detail.html?id=${id}`;
      });
      
      // Hover effects
      card.addEventListener('mouseenter', () => {
        card.style.transform = 'translateY(-8px)';
        card.style.boxShadow = '0 20px 40px rgba(0,0,0,0.4)';
        card.style.borderColor = 'rgba(245,158,11,0.3)';
        card.querySelector('.card-thumbnail img').style.transform = 'scale(1.05)';
        card.querySelector('.card-thumbnail div:last-child').style.opacity = '1';
        card.querySelector('.card-thumbnail div:last-child div').style.transform = 'scale(1)';
      });
      
      card.addEventListener('mouseleave', () => {
        card.style.transform = 'translateY(0)';
        card.style.boxShadow = 'none';
        card.style.borderColor = 'var(--card-border)';
        card.querySelector('.card-thumbnail img').style.transform = 'scale(1)';
        card.querySelector('.card-thumbnail div:last-child').style.opacity = '0';
        card.querySelector('.card-thumbnail div:last-child div').style.transform = 'scale(0.8)';
      });
    });
  }
  
  // ðŸ”‘ CRITICAL FIX: Truncate text
  function truncateText(text, maxLength) {
    if (!text) return '';
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength) + '...';
  }
  
  // ðŸ”‘ CRITICAL FIX: Setup notifications panel (from explore-screen.html)
  function setupNotificationsPanel() {
    if (!notificationsBtn || !notificationsPanel || !closeNotifications) return;
    
    // Open notifications panel
    notificationsBtn.addEventListener('click', () => {
      notificationsPanel.style.display = 'flex';
      loadNotifications();
    });
    
    // Close notifications panel
    closeNotifications.addEventListener('click', () => {
      notificationsPanel.style.display = 'none';
    });
    
    // Close when clicking outside panel
    document.addEventListener('click', (e) => {
      if (notificationsPanel.style.display === 'flex' &&
          !notificationsPanel.contains(e.target) &&
          !notificationsBtn.contains(e.target)) {
        notificationsPanel.style.display = 'none';
      }
    });
    
    // Mark all as read
    if (markAllReadBtn) {
      markAllReadBtn.addEventListener('click', markAllNotificationsAsRead);
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Mark all notifications as read
  async function markAllNotificationsAsRead() {
    try {
      if (!currentUser) return;
      
      const updateResponse = await window.supabaseClient
        .from('notifications')
        .update({ is_read: true })
        .eq('user_id', currentUser.id)
        .eq('is_read', false);
      
      if (updateResponse.error) throw updateResponse.error;
      
      // Update UI
      document.querySelectorAll('.notification-item.unread').forEach(item => {
        item.classList.remove('unread');
        item.classList.add('read');
        const dot = item.querySelector('div[style*="background:var(--warm-gold)"]');
        if (dot) dot.remove();
      });
      
      updateNotificationBadge(0);
      showToast('All notifications marked as read', 'success');
    } catch (error) {
      console.error('Error marking all notifications as read:', error);
      showToast('Failed to mark notifications as read', 'error');
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Mark notification as read
  async function markNotificationAsRead(notificationId) {
    try {
      const updateResponse = await window.supabaseClient
        .from('notifications')
        .update({ is_read: true })
        .eq('id', notificationId);
      
      if (updateResponse.error) throw updateResponse.error;
      
      // Update UI
      const item = document.querySelector(`.notification-item[data-id="${notificationId}"]`);
      if (item) {
        item.classList.remove('unread');
        item.classList.add('read');
        const dot = item.querySelector('div[style*="background:var(--warm-gold)"]');
        if (dot) dot.remove();
      }
      
      await loadNotifications();
    } catch (error) {
      console.error('Error marking notification as read:', error);
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Load dashboard data
  async function loadDashboardData() {
    try {
      setLoading(true, 'Loading dashboard data...');
      
      // Get creator's content with REAL view counts
      const contentResponse = await window.supabaseClient
        .from('Content')
        .select('*, user_profiles!user_id(*)')
        .eq('user_id', currentUser.id)
        .eq('status', 'published')
        .order('created_at', { ascending: false })
        .limit(20);
      
      const content = contentResponse.data;
      const contentError = contentResponse.error;
      
      if (contentError) throw contentError;
      
      // Calculate analytics with REAL counts from source tables
      const analytics = {
        total_uploads: content.length || 0,
        total_views: 0,
        total_earnings: 0,
        total_connectors: 0
      };
      
      // Enrich content with real view counts
      const enrichedContent = await Promise.all(
        (content || []).map(async (item) => {
          const viewsResponse = await window.supabaseClient
            .from('content_views')
            .select('*', { count: 'exact', head: true })
            .eq('content_id', item.id);
          
          const viewsCount = viewsResponse.count || 0;
          analytics.total_views += viewsCount || 0;
          
          // Simple earnings calculation: R0.01 per view
          analytics.total_earnings += (viewsCount || 0) * 0.01;
          
          return {
            ...item,
            real_views: viewsCount || 0
          };
        })
      );
      
      // Get connector count (simulated - views divided by 100)
      analytics.total_connectors = Math.floor(analytics.total_views / 100);
      if (analytics.total_connectors < 10) analytics.total_connectors = 10;
      
      dashboardData = {
        user: {
          name: enrichedContent[0]?.user_profiles?.full_name || 
                enrichedContent[0]?.user_profiles?.username || 
                currentUser.email?.split('@')[0] || 
                'Creator',
          avatar_url: enrichedContent[0]?.user_profiles?.avatar_url,
          is_founder: false
        },
        analytics: analytics,
        content: enrichedContent.map(item => ({
          id: item.id,
          title: item.title || 'Untitled',
          description: item.description || '',
          thumbnail_url: item.thumbnail_url,
          status: item.status || 'draft',
          views: item.real_views || 0,
          created_at: item.created_at
        }))
      };
      
      console.log('âœ… Dashboard data loaded:', dashboardData);
      
      // Update UI
      updateUserInfo();
      updateStats();
      updateUploads();
      
      // Show the app
      setLoading(false);
    } catch (error) {
      console.error('âŒ Error loading dashboard data:', error);
      showError('Loading Error', 'Failed to load dashboard data. Please refresh the page.');
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Update user info
  function updateUserInfo() {
    if (!dashboardData) return;
    
    const user = dashboardData.user;
    
    // Set creator name
    const displayName = user.name || currentUser.email?.split('@')[0] || 'Creator';
    creatorName.textContent = displayName;
    
    // Set avatar
    if (user.avatar_url) {
      let avatarUrl = user.avatar_url;
      if (!avatarUrl.startsWith('http')) {
        if (avatarUrl.startsWith('avatars/')) {
          avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${avatarUrl}`;
        } else {
          avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/avatars/${avatarUrl}`;
        }
      }
      creatorAvatar.src = avatarUrl;
    }
    
    // Set connector count
    const connectors = dashboardData.analytics.total_connectors || 10;
    connectorCount.textContent = `${formatNumber(connectors)} Connector${connectors !== 1 ? 's' : ''}`;
    
    // Show founder badge if applicable
    const isFounder = user.is_founder || false;
    if (isFounder) {
      founderBadge.style.display = 'flex';
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Update stats
  function updateStats() {
    if (!dashboardData) return;
    
    const analytics = dashboardData.analytics;
    totalUploads.textContent = formatNumber(analytics.total_uploads);
    totalViews.textContent = formatNumber(analytics.total_views);
    totalEarnings.textContent = convertToZAR(analytics.total_earnings || 0);
  }
  
  // ðŸ”‘ CRITICAL FIX: Update uploads
  function updateUploads() {
    if (!dashboardData) return;
    
    const content = dashboardData.content;
    if (!content || content.length === 0) {
      uploadsContent.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-film"></i>
          </div>
          <p class="empty-text">
            You haven't uploaded yet.<br>
            Upload your first story today ðŸŽ¬
          </p>
        </div>
      `;
      return;
    }
    
    // Show only first 2 items
    const displayContent = content.slice(0, 2);
    uploadsContent.innerHTML = displayContent.map(item => {
      const statusClass = item.status === 'published' ? 'status-published' : 'status-draft';
      const statusText = item.status === 'published' ? 'Published' : 'Draft';
      return `
        <div class="upload-card">
          <h3 class="upload-title" title="${item.title}">
            ${item.title.length > 50 ? item.title.substring(0, 50) + '...' : item.title}
          </h3>
          <div class="${statusClass} upload-status">
            ${statusText}
          </div>
        </div>
      `;
    }).join('');
    
    // Add message about managing content
    if (content.length > 2) {
      uploadsContent.innerHTML += `
        <div class="empty-state">
          <p class="empty-text">
            Showing ${displayContent.length} of ${content.length} uploads.<br>
            Click "See All" to manage all your content.
          </p>
        </div>
      `;
    }
  }
  
  // ðŸ”‘ CRITICAL FIX: Setup event listeners
  function setupEventListeners() {
    // Search button
    if (searchBtn) {
      searchBtn.addEventListener('click', () => {
        // Search modal is handled in setupSearchModal
      });
    }
    
    // Profile button
    profileBtn.addEventListener('click', async () => {
      const sessionResponse = await window.supabaseClient.auth.getSession();
      const session = sessionResponse.data.session;
      if (session) {
        window.location.href = 'profile.html';
      } else {
        window.location.href = 'login.html?redirect=creator-dashboard.html';
      }
    });
    
    // See all uploads button
    seeAllUploads.addEventListener('click', () => {
      showToast('My Uploads page coming soon!', 'info');
    });
    
    // Upload content buttons
    uploadContentBtn.addEventListener('click', () => {
      window.location.href = 'creator-upload.html';
    });
    
    quickUpload.addEventListener('click', () => {
      window.location.href = 'creator-upload.html';
    });
    
    // View analytics button
    viewAnalytics.addEventListener('click', () => {
      showToast('Analytics dashboard coming soon!', 'info');
    });
    
    // Payout request button
    payoutRequest.addEventListener('click', () => {
      if (dashboardData && dashboardData.analytics) {
        const earnings = dashboardData.analytics.total_earnings || 0;
        payoutAmount.textContent = convertToZAR(earnings);
        payoutModal.style.display = 'flex';
      }
    });
    
    // Modal close buttons
    closePayoutModal.addEventListener('click', () => {
      payoutModal.style.display = 'none';
    });
    
    cancelPayout.addEventListener('click', () => {
      payoutModal.style.display = 'none';
    });
    
    // Request payout button
    requestPayout.addEventListener('click', () => {
      const earnings = dashboardData.analytics.total_earnings || 0;
      const zarAmount = earnings * 18.5;
      if (zarAmount < 100) {
        showToast(`Minimum payout amount is R100.00. Current balance: ${convertToZAR(earnings)}`, 'error');
        return;
      }
      showToast(`Payout request submitted for ${convertToZAR(earnings)}`, 'success');
      payoutModal.style.display = 'none';
    });
    
    // Error state buttons
    retryBtn.addEventListener('click', () => {
      errorState.style.display = 'none';
      initializeDashboard();
    });
    
    reloginBtn.addEventListener('click', () => {
      localStorage.setItem('redirectAfterLogin', 'creator-dashboard.html');
      window.location.href = 'login.html?redirect=creator-dashboard.html';
    });
    
    // Close modal when clicking outside
    payoutModal.addEventListener('click', (e) => {
      if (e.target === payoutModal) {
        payoutModal.style.display = 'none';
      }
    });
    
    // Navigation items
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', (e) => {
        if (item.classList.contains('active')) {
          e.preventDefault();
        }
      });
    });
  }
  
  // ðŸ”‘ CRITICAL FIX: Initialize dashboard
  async function initializeDashboard() {
    console.log('ðŸ‘‘ Initializing Creator Dashboard...');
    
    // Check authentication FIRST
    const isAuthenticated = await checkAuthentication();
    if (!isAuthenticated) {
      return;
    }
    
    // Load dashboard data
    await loadDashboardData();
    
    // Setup modals and panels
    setupSearchModal();
    setupNotificationsPanel();
    
    // Setup event listeners
    setupEventListeners();
    
    console.log('âœ… Creator Dashboard initialized successfully');
  }
  
  // Start initialization
  await initializeDashboard();
  
  // Auth state change listener
  window.supabaseClient.auth.onAuthStateChange((event, session) => {
    console.log('Auth state changed:', event);
    
    if (event === 'SIGNED_IN' && session?.user) {
      currentUser = session.user;
      loadUserProfilePicture(currentUser);
      loadNotifications();
      showToast('Welcome back!', 'success');
    } else if (event === 'SIGNED_OUT') {
      currentUser = null;
      document.getElementById('userProfilePlaceholder').innerHTML = `
        <div class="profile-placeholder">
          <i class="fas fa-user"></i>
        </div>
      `;
      updateNotificationBadge(0);
      showToast('Signed out successfully', 'info');
    }
  });
});
</script>
</body>
</html>
