<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bantu Stream Connect â€” Landing Page</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="assets/css/bantu-global.css" rel="stylesheet" />
  <style>
    body { background: black; color: white; font-family: 'Poppins', sans-serif; }
    .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInUp 1s forwards; }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    .gradient-text { background: linear-gradient(to right, #00aaff, #0077ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .success-msg { color: #00ff99; }
    .error-msg { color: #ff5555; }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center text-center bg-black text-white">

  <!-- Hero Section -->
  <section class="relative px-6 py-20 max-w-3xl mx-auto fade-in">
    <img src="assets/bsc-logo.png" alt="Bantu Stream Logo" class="h-16 mx-auto mb-6">
    <h1 class="text-4xl sm:text-5xl font-bold mb-4 gradient-text">Join the Movement</h1>
    <p class="text-lg sm:text-xl text-gray-300 mb-6">
      Be among the first to join <span class="font-semibold text-blue-400">Bantu Stream Connect</span>.
    </p>
  </section>

  <!-- Signup Form -->
  <section class="bg-gray-900 bg-opacity-70 backdrop-blur-md rounded-2xl shadow-xl p-8 mx-6 max-w-xl fade-in mt-4">
    <h2 class="text-2xl font-bold mb-4 text-blue-400">Sign Up Now</h2>
    <form id="signupForm" class="flex flex-col gap-3">
      <input type="text" name="name" placeholder="Full Name" required class="border p-2 rounded w-full" />
      <input type="email" name="email" placeholder="Email Address" required class="border p-2 rounded w-full" />
      <select name="user_type" required class="border p-2 rounded w-full">
        <option value="">Select Type</option>
        <option value="creator">Creator</option>
        <option value="user">User</option>
      </select>
      <input type="text" name="referred_by" placeholder="Referral Code (optional)" class="border p-2 rounded w-full" />
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 mt-2 rounded w-full hover:bg-blue-700 transition">
        Join Now
      </button>
    </form>
    <p id="signupMessage" class="mt-2 text-sm"></p>
  </section>

  <!-- Optional Referral Teaser -->
  <section class="mt-10 fade-in">
    <p class="text-gray-400">Have a referral code? Enter it during signup to earn rewards.</p>
  </section>

  <!-- Footer -->
  <footer class="mt-16 py-8 text-gray-500 text-sm">
    <p>Â© 2025 Bantu Stream Connect. Made with African pride.</p>
  </footer>

  <!-- ================= MODULE SCRIPTS ================= -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    // ---------- Supabase Setup ----------
    const SUPABASE_URL = "https://ydnxqnbjoshvxteevemc.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U";
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    // ---------- Helper: generate unique referral code ----------
    async function generateUniqueCode() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let code;
      let exists = true;
      while (exists) {
        code = Array.from({length:6}, () => chars[Math.floor(Math.random()*chars.length)]).join('');
        let { data, error } = await supabase.from('signups').select('id').eq('referral_code', code).limit(1);
        exists = data.length > 0;
      }
      return code;
    }

    // ---------- Handle Form ----------
    const form = document.getElementById('signupForm');
    const message = document.getElementById('signupMessage');

    form.addEventListener('submit', async e => {
      e.preventDefault();
      message.textContent = '';
      message.className = '';

      const formData = new FormData(form);
      const name = formData.get('name').trim();
      const email = formData.get('email').trim();
      const user_type = formData.get('user_type');
      const referred_by = formData.get('referred_by') || null;

      if (!name || !email || !user_type) {
        message.textContent = 'Please fill in all required fields.';
        message.className = 'error-msg';
        return;
      }

      try {
        // Check if email already exists
        let { data: existing, error: checkErr } = await supabase
          .from('signups')
          .select('id')
          .eq('email', email)
          .limit(1);

        if (checkErr) throw checkErr;
        if (existing.length > 0) {
          message.textContent = 'Email already registered.';
          message.className = 'error-msg';
          return;
        }

        // Generate unique referral code
        const referral_code = await generateUniqueCode();

        // Insert into Supabase
        let { data, error } = await supabase.from('signups').insert([{
          name, email, user_type, referral_code, referred_by
        }]);

        if (error) throw error;

        message.textContent = 'ðŸŽ‰ Signup successful! Your referral code: ' + referral_code;
        message.className = 'success-msg';
        form.reset();

      } catch(err) {
        console.error(err);
        message.textContent = 'There was an error submitting your sign-up. Please try again.';
        message.className = 'error-msg';
      }
    });
  </script>
</body>
</html>
