<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bantu Stream Connect</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 9999;
            font-size: 12px;
            max-width: 300px;
        }
        
        .debug-button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 5px;
        }
        
        .debug-button:hover {
            background: #ff4757;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-[#001F54] to-[#0A0E3F] min-h-screen text-white">
    <!-- Debug Panel -->
    <div id="debug-panel" class="debug-panel hidden">
        <div id="debug-status">üîç Initializing...</div>
        <button onclick="testSupabaseConnection()" class="debug-button">Test Connection</button>
        <button onclick="clearLocalStorage()" class="debug-button">Clear Cache</button>
        <button onclick="showDebugInfo()" class="debug-button">Show Debug Info</button>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 flex flex-col items-center justify-center z-50">
        <div class="w-12 h-12 border-4 border-blue-400 border-t-transparent rounded-full animate-spin mb-4"></div>
        <div id="loading-text" class="text-lg font-medium">Loading Bantu Stream Connect...</div>
        <div id="loading-details" class="text-sm text-gray-400 mt-2"></div>
    </div>

    <!-- Main Content -->
    <div id="main-content" class="hidden">
        <!-- Header -->
        <header class="sticky top-0 z-40 bg-gradient-to-b from-[#001F54] to-transparent backdrop-blur-sm border-b border-gray-800">
            <div class="container mx-auto px-4 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-play text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold">Bantu Stream Connect</h1>
                            <p class="text-xs text-gray-400">Watch amazing content</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <button onclick="handleSearch()" class="p-2 hover:bg-gray-800 rounded-full transition">
                            <i class="fas fa-search text-blue-400"></i>
                        </button>
                        <button onclick="handleProfile()" class="p-2 hover:bg-gray-800 rounded-full transition">
                            <i class="fas fa-user text-blue-400"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Category Tabs -->
        <div class="sticky top-16 z-30 bg-gradient-to-b from-[#0A1128] to-transparent py-3">
            <div class="container mx-auto px-4">
                <div class="overflow-x-auto">
                    <div id="category-tabs" class="flex space-x-2 min-w-max">
                        <!-- Categories will load here -->
                        <div class="px-4 py-2 rounded-full bg-gray-800 animate-pulse">Loading...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <main class="container mx-auto px-4 py-6">
            <!-- Hero Section -->
            <div class="bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-2xl p-6 mb-8 border border-gray-800">
                <h2 class="text-2xl font-bold mb-3">Welcome to Bantu Stream Connect</h2>
                <p class="text-gray-300 mb-6">Discover amazing content from creators across Africa</p>
                <button onclick="handleBrowseAll()" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg font-semibold hover:opacity-90 transition">
                    <i class="fas fa-compass mr-2"></i>Browse All Content
                </button>
            </div>

            <!-- Content Sections -->
            <div id="content-sections">
                <!-- Content will load here -->
                <div class="space-y-8">
                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">Latest Uploads</h3>
                            <div class="w-20 h-6 bg-gray-800 rounded animate-pulse"></div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                            <!-- Loading skeletons -->
                            <div class="bg-gray-800/50 rounded-lg h-48 animate-pulse"></div>
                            <div class="bg-gray-800/50 rounded-lg h-48 animate-pulse"></div>
                            <div class="bg-gray-800/50 rounded-lg h-48 animate-pulse"></div>
                            <div class="bg-gray-800/50 rounded-lg h-48 animate-pulse"></div>
                            <div class="bg-gray-800/50 rounded-lg h-48 animate-pulse"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Browse All CTA -->
            <div class="mt-12 text-center">
                <button onclick="handleBrowseAll()" class="px-8 py-4 bg-gradient-to-r from-blue-900/50 to-purple-900/50 rounded-xl font-semibold border border-gray-700 hover:border-gray-600 transition flex items-center justify-center mx-auto space-x-3">
                    <i class="fas fa-compass text-blue-400"></i>
                    <span>Browse All Content</span>
                    <i class="fas fa-arrow-right text-blue-400"></i>
                </button>
            </div>
        </main>

        <!-- Footer -->
        <footer class="border-t border-gray-800 mt-12 py-8">
            <div class="container mx-auto px-4 text-center">
                <p class="text-gray-400">¬© 2025 Bantu Stream Connect ‚Ä¢ Built in South Africa</p>
            </div>
        </footer>
    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 rounded-xl p-6 max-w-md w-full mx-4">
            <div class="flex items-center space-x-3 mb-4">
                <i class="fas fa-exclamation-triangle text-red-400 text-2xl"></i>
                <h3 class="text-xl font-bold">Connection Error</h3>
            </div>
            <p id="error-message" class="text-gray-300 mb-6"></p>
            <div class="flex justify-end space-x-3">
                <button onclick="closeErrorModal()" class="px-4 py-2 bg-gray-800 rounded-lg">Close</button>
                <button onclick="retryConnection()" class="px-4 py-2 bg-blue-600 rounded-lg">Retry</button>
            </div>
        </div>
    </div>

    <script>
        // Debug functions
        function toggleDebugPanel() {
            const panel = document.getElementById('debug-panel');
            panel.classList.toggle('hidden');
        }
        
        // Press Ctrl+Shift+D to toggle debug panel
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                toggleDebugPanel();
            }
        });
        
        // Initialize debug panel
        document.getElementById('debug-panel').classList.remove('hidden');
        
        // Show connection details
        async function testSupabaseConnection() {
            const status = document.getElementById('debug-status');
            status.innerHTML = 'üîÑ Testing Supabase connection...';
            
            try {
                // Try to fetch from a simple table to test connection
                const testUrl = 'https://ydnxqnbjoshvxteevemc.supabase.co/rest/v1/?apikey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U';
                const response = await fetch(testUrl);
                
                if (response.ok) {
                    status.innerHTML = '‚úÖ Connected to Supabase';
                } else {
                    status.innerHTML = '‚ùå Supabase connection failed';
                }
            } catch (error) {
                status.innerHTML = `‚ùå Connection error: ${error.message}`;
            }
        }
        
        function clearLocalStorage() {
            localStorage.clear();
            sessionStorage.clear();
            document.getElementById('debug-status').innerHTML = '‚úÖ Cache cleared';
            setTimeout(() => {
                location.reload();
            }, 1000);
        }
        
        function showDebugInfo() {
            const info = `
                URL: ${window.location.href}
                User Agent: ${navigator.userAgent}
                Online: ${navigator.onLine}
                Local Storage: ${localStorage.length} items
                Cookies Enabled: ${navigator.cookieEnabled}
            `;
            alert(info);
        }
        
        // Error modal functions
        function showErrorModal(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-modal').classList.remove('hidden');
        }
        
        function closeErrorModal() {
            document.getElementById('error-modal').classList.add('hidden');
        }
        
        function retryConnection() {
            closeErrorModal();
            initializeApp();
        }
        
        // Navigation handlers
        function handleSearch() {
            console.log('Search clicked');
            alert('Search functionality coming soon!');
        }
        
        function handleProfile() {
            console.log('Profile clicked');
            alert('Profile page coming soon!');
        }
        
        function handleBrowseAll() {
            console.log('Browse All clicked');
            alert('Content library coming soon!');
        }
        
        // Main initialization
        async function initializeApp() {
            const loadingText = document.getElementById('loading-text');
            const loadingDetails = document.getElementById('loading-details');
            const debugStatus = document.getElementById('debug-status');
            
            try {
                debugStatus.innerHTML = 'üîÑ Initializing...';
                loadingText.textContent = 'Connecting to Supabase...';
                
                // Import Supabase dynamically
                loadingDetails.textContent = 'Loading Supabase client...';
                
                // Dynamically import Supabase
                const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm');
                
                const SUPABASE_URL = 'https://ydnxqnbjoshvxteevemc.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U';
                
                window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                
                debugStatus.innerHTML = '‚úÖ Supabase client loaded';
                loadingDetails.textContent = 'Testing connection...';
                
                // Test the connection by fetching session
                const { data: { session }, error: sessionError } = await window.supabase.auth.getSession();
                
                if (sessionError) {
                    console.warn('Session error (may be normal):', sessionError.message);
                }
                
                debugStatus.innerHTML = '‚úÖ Connection successful';
                loadingDetails.textContent = 'Loading home feed...';
                
                // Now load the home feed content
                await loadHomeFeed();
                
            } catch (error) {
                console.error('Initialization error:', error);
                debugStatus.innerHTML = `‚ùå Error: ${error.message}`;
                loadingText.textContent = 'Failed to initialize app';
                loadingDetails.textContent = error.message;
                
                showErrorModal(`
                    Failed to connect to the server. Please check:
                    
                    1. Your internet connection
                    2. If Supabase is accessible
                    3. Try refreshing the page
                    
                    Error details: ${error.message}
                `);
            }
        }
        
        // Load home feed content
        async function loadHomeFeed() {
            const loadingText = document.getElementById('loading-text');
            const loadingDetails = document.getElementById('loading-details');
            const debugStatus = document.getElementById('debug-status');
            
            try {
                loadingText.textContent = 'Loading content...';
                loadingDetails.textContent = 'Fetching from Supabase...';
                
                // Try different table names - common issues
                const tableNames = ['Content', 'content', 'videos', 'posts', 'media'];
                let contentData = [];
                let successfulTable = null;
                
                for (const tableName of tableNames) {
                    try {
                        debugStatus.innerHTML = `üîÑ Trying table: ${tableName}`;
                        loadingDetails.textContent = `Checking ${tableName} table...`;
                        
                        const { data, error } = await window.supabase
                            .from(tableName)
                            .select('*')
                            .limit(10);
                        
                        if (error) {
                            console.warn(`Table ${tableName} error:`, error.message);
                            continue;
                        }
                        
                        if (data && data.length > 0) {
                            contentData = data;
                            successfulTable = tableName;
                            debugStatus.innerHTML = `‚úÖ Found ${data.length} items in ${tableName}`;
                            break;
                        }
                    } catch (tableError) {
                        console.warn(`Error with table ${tableName}:`, tableError);
                    }
                }
                
                if (contentData.length === 0) {
                    // Try a direct REST API call as fallback
                    loadingDetails.textContent = 'Trying alternative method...';
                    
                    const response = await fetch(
                        'https://ydnxqnbjoshvxteevemc.supabase.co/rest/v1/Content?select=*&limit=10',
                        {
                            headers: {
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U'
                            }
                        }
                    );
                    
                    if (response.ok) {
                        contentData = await response.json();
                        debugStatus.innerHTML = `‚úÖ API call successful: ${contentData.length} items`;
                    }
                }
                
                if (contentData.length > 0) {
                    // SUCCESS: We have content!
                    debugStatus.innerHTML = `‚úÖ Loaded ${contentData.length} content items`;
                    loadingText.textContent = 'Setting up interface...';
                    loadingDetails.textContent = 'Rendering content...';
                    
                    // Show the main content
                    document.getElementById('loading-screen').classList.add('hidden');
                    document.getElementById('main-content').classList.remove('hidden');
                    
                    // Render categories
                    renderCategories();
                    
                    // Render content
                    renderContent(contentData);
                    
                } else {
                    // NO CONTENT FOUND
                    debugStatus.innerHTML = '‚ö†Ô∏è No content found in any table';
                    loadingText.textContent = 'No content available';
                    loadingDetails.textContent = 'The database appears to be empty or inaccessible';
                    
                    // Show demo content instead
                    showDemoContent();
                }
                
            } catch (error) {
                console.error('Error loading home feed:', error);
                debugStatus.innerHTML = `‚ùå Feed error: ${error.message}`;
                loadingText.textContent = 'Error loading content';
                loadingDetails.textContent = 'Showing demo content instead';
                
                // Show demo content as fallback
                showDemoContent();
            }
        }
        
        // Render categories
        function renderCategories() {
            const categories = [
                'All', 'Movies', 'TV Shows', 'Documentaries', 'Kids',
                'Sports', 'News', 'Music', 'Videos', 'Podcasts',
                'Skits', 'Content', 'STEM'
            ];
            
            const container = document.getElementById('category-tabs');
            container.innerHTML = categories.map(category => `
                <button class="px-4 py-2 rounded-full bg-gray-800 hover:bg-gray-700 transition whitespace-nowrap">
                    ${category}
                </button>
            `).join('');
        }
        
        // Render content
        function renderContent(contentData) {
            const container = document.getElementById('content-sections');
            
            if (contentData.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-film text-4xl text-gray-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">No Content Available</h3>
                        <p class="text-gray-400">Check back later for new content!</p>
                    </div>
                `;
                return;
            }
            
            // Group by sections (simulating the mobile app layout)
            const sections = [
                { title: 'Latest Uploads', data: contentData.slice(0, 5) },
                { title: 'Most Viewed', data: contentData.slice(0, 5) }, // In real app, this would be sorted by views
                { title: 'Most Liked', data: contentData.slice(0, 5) }, // In real app, this would be sorted by likes
                { title: 'Trending Now', data: contentData.slice(0, 5) } // In real app, this would be trending algorithm
            ];
            
            container.innerHTML = sections.map(section => `
                <div class="mb-10">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">${section.title}</h3>
                        <button class="text-blue-400 hover:text-blue-300 text-sm font-medium">
                            See All
                        </button>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                        ${section.data.map(item => `
                            <div class="bg-gray-900/50 rounded-xl overflow-hidden hover:bg-gray-800/70 transition cursor-pointer border border-gray-800">
                                <div class="h-32 bg-gradient-to-br from-blue-900/50 to-purple-900/50 flex items-center justify-center">
                                    ${item.thumbnail_url ? 
                                        `<img src="${item.thumbnail_url}" alt="${item.title}" class="w-full h-full object-cover">` :
                                        `<i class="fas fa-play text-blue-400 text-3xl"></i>`
                                    }
                                </div>
                                <div class="p-3">
                                    <h4 class="font-semibold text-sm mb-2 line-clamp-2">${item.title || 'Untitled'}</h4>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-400">${item.creator || 'Creator'}</span>
                                        <span class="text-xs text-gray-500">${item.views || '0'} views</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        // Show demo content when real content fails
        function showDemoContent() {
            document.getElementById('loading-screen').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            
            const demoContent = [
                { title: 'African Music Mix', creator: 'DJ Afro', views: '1.2K' },
                { title: 'Tech Innovation in Africa', creator: 'Tech Talks', views: '3.4K' },
                { title: 'Traditional Dance', creator: 'Cultural Hub', views: '5.6K' },
                { title: 'African Cuisine Tutorial', creator: 'Food Network', views: '2.3K' },
                { title: 'Startup Stories', creator: 'Entrepreneur TV', views: '4.5K' }
            ];
            
            renderCategories();
            renderContent(demoContent);
            
            // Show warning
            const debugStatus = document.getElementById('debug-status');
            debugStatus.innerHTML = '‚ö†Ô∏è Showing demo content (connection issue)';
        }
        
        // Start the app
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });
    </script>
</body>
</html>
