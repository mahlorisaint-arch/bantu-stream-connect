<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bantu Stream Connect</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styles -->
    <style>
        /* Animated Gradient Background (from home_feed.dart) */
        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .animated-gradient {
            background: linear-gradient(-45deg, 
                #001F54, 
                #0A0E3F, 
                #000000, 
                #001845,
                #0A1128,
                #002855
            );
            background-size: 400% 400%;
            animation: gradientFlow 15s ease infinite;
            min-height: 100vh;
        }

        /* Loading Spinner */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid #4dabf7;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        /* Glassmorphism Effect */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Content Card Hover Effects */
        .content-card {
            transition: all 0.3s ease;
        }

        .content-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Creator Button Gradient */
        .creator-btn-gradient {
            background: linear-gradient(135deg, #4dabf7 0%, #748ffc 100%);
        }

        /* Share Button Glow */
        @keyframes glow {
            0%, 100% { opacity: 0.4; box-shadow: 0 0 5px rgba(255, 215, 0, 0.3); }
            50% { opacity: 1; box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }

        .glow-animation {
            animation: glow 3s ease-in-out infinite;
        }

        /* Scrollbar Styling */
        .scrollbar-thin::-webkit-scrollbar {
            height: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Category Tabs */
        .category-tab {
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .category-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .category-tab.active {
            background: linear-gradient(135deg, #4dabf7 0%, #748ffc 100%);
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(77, 171, 247, 0.4);
        }

        /* Thumbnail Overlay */
        .thumbnail-overlay {
            background: linear-gradient(to bottom, transparent 50%, rgba(0, 0, 0, 0.5) 100%);
        }

        /* Text Clamping */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-1 {
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Fade In Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body class="text-white animated-gradient">
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 flex flex-col items-center justify-center z-50 bg-gradient-to-br from-[#001F54] to-[#0A0E3F]">
        <div class="loading-spinner mb-4"></div>
        <p class="text-lg font-medium">Loading content...</p>
    </div>

    <!-- Main Container -->
    <div class="min-h-screen relative fade-in" id="main-content" style="display: none;">
        <!-- Header -->
        <header class="sticky top-0 z-40 glass">
            <div class="container mx-auto px-4 py-3">
                <div class="flex items-center justify-between">
                    <!-- Logo and App Name -->
                    <div class="flex items-center space-x-3">
                        <img src="assets/icon/bantu_stream_connect_icon.png" 
                             alt="Bantu Stream Connect" 
                             class="w-8 h-8">
                        <span class="text-lg font-semibold tracking-wide">Bantu Stream Connect</span>
                    </div>
                    
                    <!-- Search Button with Glow -->
                    <button id="search-btn" 
                            class="p-2 rounded-full glow-animation focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                        <i class="fas fa-search text-amber-400 text-lg"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Category Tabs -->
        <div id="category-tabs-container" class="sticky top-16 z-30 bg-gradient-to-b from-[#0A1128] to-transparent py-2">
            <div class="container mx-auto px-4">
                <div class="overflow-x-auto scrollbar-thin pb-2">
                    <div id="category-tabs" class="flex space-x-2 min-w-max">
                        <!-- Categories will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-6">
            <!-- Hero Banner Section -->
            <section id="hero-banner" class="mb-8">
                <div class="glass rounded-2xl p-8 text-center">
                    <h1 class="text-3xl md:text-4xl font-bold mb-4">Discover Amazing Content</h1>
                    <p class="text-gray-300 mb-6 max-w-2xl mx-auto">
                        Stream videos, music, podcasts, and more from talented creators across Africa
                    </p>
                    <button id="browse-all-btn" 
                            class="px-8 py-3 rounded-full font-semibold creator-btn-gradient hover:opacity-90 transition-opacity">
                        Browse All Content
                    </button>
                </div>
            </section>

            <!-- Content Sections -->
            <div id="content-sections">
                <!-- Sections will be loaded dynamically -->
            </div>
        </main>

        <!-- Browse All CTA -->
        <section class="container mx-auto px-4 py-8">
            <div class="glass rounded-2xl p-8 text-center">
                <button id="browse-all-cta" 
                        class="px-10 py-4 rounded-full font-semibold text-lg flex items-center justify-center space-x-3 mx-auto glass border border-gray-700 hover:border-gray-600 transition-all">
                    <i class="fas fa-compass text-blue-400"></i>
                    <span>Browse All Content</span>
                    <i class="fas fa-arrow-right text-blue-400"></i>
                </button>
            </div>
        </section>

        <!-- Footer -->
        <footer class="border-t border-gray-800 mt-12 py-8">
            <div class="container mx-auto px-4 text-center text-gray-400">
                <p>Bantu Stream Connect Â© 2025 â€¢ Built in South Africa</p>
                <div class="flex justify-center space-x-6 mt-4">
                    <a href="/creators" class="hover:text-white transition">For Creators</a>
                    <a href="/empowerment" class="hover:text-white transition">Empowerment</a>
                    <a href="/blog" class="hover:text-white transition">Blog</a>
                    <a href="/privacy" class="hover:text-white transition">Privacy</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- Import Supabase -->
    <script type="module">
        // Import Supabase
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

        // âœ… Use the same Supabase credentials from your mobile app
        const SUPABASE_URL = 'https://ydnxqnbjoshvxteevemc.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U'

        // Create Supabase client
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        // Make it globally available
        window.supabase = supabase

        // Check auth state
        supabase.auth.onAuthStateChange((event, session) => {
            console.log('Auth state changed:', event)
            if (event === 'SIGNED_IN') {
                console.log('User signed in:', session?.user?.email)
            } else if (event === 'SIGNED_OUT') {
                console.log('User signed out')
            }
        })
    </script>

    <!-- Home Feed JavaScript -->
    <script>
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ðŸš€ Bantu Stream Connect Home Feed Initializing...')
            
            // DOM Elements
            const loadingScreen = document.getElementById('loading-screen')
            const mainContent = document.getElementById('main-content')
            const categoryTabsContainer = document.getElementById('category-tabs')
            const contentSectionsContainer = document.getElementById('content-sections')
            
            // State variables (from home_feed.dart)
            let allContentData = []
            let filteredContentData = []
            let selectedCategoryIndex = 0
            let isLoading = true
            
            // Categories (exact same as mobile app)
            const categories = [
                'All',
                'Movies',
                'TV Shows',
                'Documentaries',
                'Kids',
                'Sports',
                'News',
                'Music',
                'Videos',
                'Podcasts',
                'Skits',
                'Content',
                'STEM'
            ]
            
            // âœ… SHOW/HIDE LOADING
            function setLoading(loading) {
                isLoading = loading
                if (loading) {
                    loadingScreen.style.display = 'flex'
                    mainContent.style.display = 'none'
                } else {
                    loadingScreen.style.display = 'none'
                    mainContent.style.display = 'block'
                }
            }
            
            // âœ… SHOW ERROR TOAST
            function showError(message) {
                const toast = document.createElement('div')
                toast.className = 'glass rounded-lg p-4 mb-2 flex items-center space-x-3 animate-fade-in'
                toast.innerHTML = `
                    <i class="fas fa-exclamation-circle text-red-400"></i>
                    <span>${message}</span>
                `
                document.getElementById('toast-container').appendChild(toast)
                
                setTimeout(() => {
                    toast.classList.add('opacity-0', 'transition-opacity', 'duration-300')
                    setTimeout(() => toast.remove(), 300)
                }, 5000)
            }
            
            // âœ… SHOW SUCCESS TOAST
            function showSuccess(message) {
                const toast = document.createElement('div')
                toast.className = 'glass rounded-lg p-4 mb-2 flex items-center space-x-3 animate-fade-in'
                toast.innerHTML = `
                    <i class="fas fa-check-circle text-green-400"></i>
                    <span>${message}</span>
                `
                document.getElementById('toast-container').appendChild(toast)
                
                setTimeout(() => {
                    toast.classList.add('opacity-0', 'transition-opacity', 'duration-300')
                    setTimeout(() => toast.remove(), 300)
                }, 3000)
            }
            
            // âœ… FETCH HOME FEED CONTENT (from getHomeFeedContent in Dart)
            async function getHomeFeedContent(limit = 100, category = null) {
                try {
                    console.log('ðŸ”„ Fetching home feed content...')
                    
                    let query = supabase
                        .from('Content')
                        .select(`
                            id,
                            title,
                            description,
                            thumbnail_url,
                            media_type,
                            file_url,
                            created_at,
                            user_id,
                            creator_id,
                            genre,
                            status,
                            views_count,
                            likes_count,
                            user_profiles!user_id(
                                full_name,
                                username,
                                avatar_url
                            )
                        `)
                        .eq('status', 'published')

                    if (category && category !== 'All') {
                        query = query.eq('genre', category)
                    }

                    const { data, error } = await query
                        .order('created_at', { ascending: false })
                        .limit(limit)

                    if (error) throw error

                    // Process data with creator names
                    const processedData = data.map(item => {
                        let creatorDisplayName = 'Content Creator'
                        
                        if (item.user_profiles) {
                            creatorDisplayName = item.user_profiles.full_name || 
                                               item.user_profiles.username || 
                                               'Content Creator'
                        }

                        return {
                            id: item.id,
                            title: item.title || 'Untitled',
                            description: item.description || '',
                            thumbnail_url: item.thumbnail_url,
                            file_url: item.file_url,
                            media_type: item.media_type || 'video',
                            genre: item.genre,
                            created_at: item.created_at,
                            creator: creatorDisplayName,
                            creator_display_name: creatorDisplayName,
                            creator_id: item.creator_id,
                            user_id: item.user_id,
                            views: item.views_count || 0,
                            likes: item.likes_count || 0
                        }
                    })

                    console.log('âœ… Home feed loaded:', processedData.length, 'items')
                    return processedData
                } catch (error) {
                    console.error('âŒ Error fetching home feed:', error)
                    showError('Failed to load content. Please try again.')
                    return []
                }
            }
            
            // âœ… GET MOST VIEWED CONTENT (from _getMostViewedContent in Dart)
            function getMostViewedContent(contentData = []) {
                if (contentData.length === 0) return []
                
                return [...contentData]
                    .sort((a, b) => (b.views || 0) - (a.views || 0))
                    .slice(0, 10)
            }
            
            // âœ… GET MOST LIKED CONTENT (from _getMostLikedContent in Dart)
            function getMostLikedContent(contentData = []) {
                if (contentData.length === 0) return []
                
                return [...contentData]
                    .sort((a, b) => (b.likes || 0) - (a.likes || 0))
                    .slice(0, 10)
            }
            
            // âœ… GET TRENDING CONTENT (from _getTrendingContent in Dart)
            function getTrendingContent(contentData = []) {
                if (contentData.length === 0) return []
                
                const oneWeekAgo = new Date()
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7)
                
                const recentContent = contentData.filter(item => {
                    try {
                        const createdAt = new Date(item.created_at)
                        return createdAt >= oneWeekAgo
                    } catch {
                        return false
                    }
                })
                
                return recentContent
                    .sort((a, b) => {
                        const aScore = (a.views || 0) + ((a.likes || 0) * 2)
                        const bScore = (b.views || 0) + ((b.likes || 0) * 2)
                        return bScore - aScore
                    })
                    .slice(0, 10)
            }
            
            // âœ… INITIALIZE HOME FEED (from _loadInitialContent in Dart)
            async function initializeHomeFeed() {
                try {
                    setLoading(true)
                    
                    // Load all content from Supabase
                    allContentData = await getHomeFeedContent(100)
                    filteredContentData = allContentData
                    
                    // Render UI components
                    renderCategoryTabs()
                    renderContentSections()
                    
                    // Setup event listeners
                    setupEventListeners()
                    
                    // Hide loading screen
                    setTimeout(() => {
                        setLoading(false)
                    }, 500)
                    
                } catch (error) {
                    console.error('âŒ Error initializing home feed:', error)
                    showError('Failed to load content. Please refresh the page.')
                    setLoading(false)
                }
            }
            
            // âœ… RENDER CATEGORY TABS (from CategoryTabsWidget in Dart)
            function renderCategoryTabs() {
                if (!categoryTabsContainer) return
                
                categoryTabsContainer.innerHTML = categories.map((category, index) => `
                    <button class="category-tab px-4 py-2 rounded-full border border-gray-700 text-sm font-medium transition-all ${
                        index === selectedCategoryIndex 
                            ? 'active text-white' 
                            : 'text-gray-300 hover:text-white'
                    }" 
                            data-index="${index}"
                            data-category="${category}">
                        ${category}
                    </button>
                `).join('')
                
                // Add click handlers
                document.querySelectorAll('.category-tab').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation()
                        const index = parseInt(button.dataset.index)
                        onCategoryChanged(index)
                    })
                })
            }
            
            // âœ… RENDER CONTENT SECTIONS (from _buildContent in Dart)
            function renderContentSections() {
                if (!contentSectionsContainer) return
                
                contentSectionsContainer.innerHTML = `
                    <!-- Latest Uploads -->
                    <section class="mb-10 fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Latest Uploads</h2>
                            <button class="see-all-btn text-blue-400 hover:text-blue-300 text-sm font-medium px-4 py-2 rounded-lg glass transition"
                                    data-action="browse-all">
                                See All
                            </button>
                        </div>
                        <div class="content-carousel overflow-x-auto scrollbar-thin pb-4">
                            <div class="flex space-x-4 min-w-max">
                                ${renderContentCards(filteredContentData.slice(0, 10))}
                            </div>
                        </div>
                    </section>
                    
                    <!-- Most Viewed -->
                    <section class="mb-10 fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Most Viewed</h2>
                            <button class="see-all-btn text-blue-400 hover:text-blue-300 text-sm font-medium px-4 py-2 rounded-lg glass transition"
                                    data-action="browse-all">
                                See All
                            </button>
                        </div>
                        <div class="content-carousel overflow-x-auto scrollbar-thin pb-4">
                            <div class="flex space-x-4 min-w-max">
                                ${renderContentCards(getMostViewedContent(filteredContentData))}
                            </div>
                        </div>
                    </section>
                    
                    <!-- Most Liked -->
                    <section class="mb-10 fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Most Liked</h2>
                            <button class="see-all-btn text-blue-400 hover:text-blue-300 text-sm font-medium px-4 py-2 rounded-lg glass transition"
                                    data-action="browse-all">
                                See All
                            </button>
                        </div>
                        <div class="content-carousel overflow-x-auto scrollbar-thin pb-4">
                            <div class="flex space-x-4 min-w-max">
                                ${renderContentCards(getMostLikedContent(filteredContentData))}
                            </div>
                        </div>
                    </section>
                    
                    <!-- Trending Now -->
                    <section class="mb-10 fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Trending Now</h2>
                            <button class="see-all-btn text-blue-400 hover:text-blue-300 text-sm font-medium px-4 py-2 rounded-lg glass transition"
                                    data-action="browse-all">
                                See All
                            </button>
                        </div>
                        <div class="content-carousel overflow-x-auto scrollbar-thin pb-4">
                            <div class="flex space-x-4 min-w-max">
                                ${renderContentCards(getTrendingContent(filteredContentData))}
                            </div>
                        </div>
                    </section>
                    
                    <!-- Category-specific content -->
                    ${selectedCategoryIndex !== 0 ? `
                        <section class="mb-10 fade-in">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">${categories[selectedCategoryIndex]}</h2>
                                <button class="see-all-btn text-blue-400 hover:text-blue-300 text-sm font-medium px-4 py-2 rounded-lg glass transition"
                                        data-action="browse-all">
                                    See All
                                </button>
                            </div>
                            <div class="content-carousel overflow-x-auto scrollbar-thin pb-4">
                                <div class="flex space-x-4 min-w-max">
                                    ${filteredContentData.length > 0 
                                        ? renderContentCards(filteredContentData.slice(0, 10))
                                        : renderEmptyCategoryState(categories[selectedCategoryIndex])
                                    }
                                </div>
                            </div>
                        </section>
                    ` : ''}
                `
                
                // Setup content card listeners
                setTimeout(() => {
                    setupContentCardListeners()
                }, 100)
            }
            
            // âœ… RENDER CONTENT CARDS (from _buildAnimatedContentCard in Dart)
            function renderContentCards(contentItems) {
                if (!contentItems || contentItems.length === 0) {
                    return renderEmptyState()
                }
                
                return contentItems.map(content => {
                    const creatorName = getActualCreatorName(content)
                    const creatorId = content.user_id || content.creator_id
                    
                    return `
                        <div class="content-card glass rounded-xl p-3 w-64 flex-shrink-0 cursor-pointer group"
                             data-content-id="${content.id}">
                            <div class="relative mb-3 overflow-hidden rounded-lg h-40">
                                <!-- Thumbnail -->
                                <img src="${content.thumbnail_url || 'assets/bsc-icon.png'}" 
                                     alt="${content.title}"
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                                     onerror="this.src='assets/bsc-icon.png'">
                                
                                <!-- Thumbnail Overlay -->
                                <div class="thumbnail-overlay absolute inset-0"></div>
                                
                                <!-- Share Button -->
                                <button class="share-btn absolute top-2 right-2 w-8 h-8 rounded-full glass flex items-center justify-center text-amber-400 hover:bg-black hover:bg-opacity-50 transition"
                                        data-content='${JSON.stringify(content).replace(/'/g, "&#39;")}'>
                                    <i class="fas fa-share text-sm"></i>
                                </button>
                            </div>
                            
                            <!-- Content Info -->
                            <div>
                                <h3 class="font-semibold mb-2 line-clamp-2 h-12" title="${content.title}">
                                    ${content.title.length > 50 ? content.title.substring(0, 50) + '...' : content.title}
                                </h3>
                                
                                <!-- Creator Button -->
                                ${creatorId ? `
                                    <button class="creator-btn creator-btn-gradient text-white px-3 py-1.5 rounded-lg text-xs font-medium flex items-center space-x-1 w-full justify-center hover:opacity-90 transition"
                                            data-creator-id="${creatorId}"
                                            data-creator-name="${creatorName}">
                                        <i class="fas fa-user-circle"></i>
                                        <span class="line-clamp-1">${creatorName}</span>
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `
                }).join('')
            }
            
            // âœ… RENDER EMPTY STATE (from _buildEmptyCategoryState in Dart)
            function renderEmptyState() {
                return `
                    <div class="glass rounded-xl p-8 text-center w-64 flex-shrink-0">
                        <i class="fas fa-film text-4xl text-gray-500 mb-4"></i>
                        <p class="text-gray-400">No content available</p>
                    </div>
                `
            }
            
            function renderEmptyCategoryState(category) {
                const icon = category === 'Kids' ? 'fas fa-child' : 'fas fa-compass'
                
                return `
                    <div class="glass rounded-xl p-8 text-center w-64 flex-shrink-0">
                        <i class="${icon} text-4xl text-gray-500 mb-4"></i>
                        <h3 class="font-semibold mb-2">No ${category} Content Yet</h3>
                        <p class="text-sm text-gray-400">Be the first to upload ${category.toLowerCase()} content!</p>
                    </div>
                `
            }
            
            // âœ… CATEGORY CHANGE HANDLER (from _onCategoryChanged in Dart)
            function onCategoryChanged(index) {
                selectedCategoryIndex = index
                const selectedCategory = categories[index]
                
                console.log(`ðŸŽ¯ Category changed to: ${selectedCategory}`)
                
                // Update active tab
                document.querySelectorAll('.category-tab').forEach((btn, i) => {
                    btn.classList.toggle('active', i === index)
                    btn.classList.toggle('text-white', i === index)
                    btn.classList.toggle('text-gray-300', i !== index)
                })
                
                // Filter content
                if (selectedCategory === 'All') {
                    filteredContentData = allContentData
                } else {
                    filteredContentData = allContentData.filter(item => {
                        const itemGenre = item.genre
                        if (!itemGenre) return false
                        
                        const normalizedItemGenre = itemGenre.toLowerCase().trim()
                        const normalizedSelectedCategory = selectedCategory.toLowerCase().trim()
                        
                        if (selectedCategory === 'Kids') {
                            return normalizedItemGenre === 'kids'
                        }
                        
                        return normalizedItemGenre === normalizedSelectedCategory
                    })
                }
                
                console.log(`ðŸ“Š Filtered content count: ${filteredContentData.length}`)
                
                // Re-render content sections
                renderContentSections()
            }
            
            // âœ… GET ACTUAL CREATOR NAME (from _getActualCreatorName in Dart)
            function getActualCreatorName(content) {
                // Use creator_display_name first
                if (content.creator_display_name && 
                    content.creator_display_name.toString().trim() !== '' &&
                    content.creator_display_name !== 'Content Creator') {
                    return content.creator_display_name.toString()
                }
                
                // Fallback to creator field
                if (content.creator && 
                    content.creator.toString().trim() !== '' &&
                    content.creator !== 'Content Creator') {
                    return content.creator.toString()
                }
                
                // Final fallback
                return 'Bantu Creator'
            }
            
            // âœ… SETUP EVENT LISTENERS
            function setupEventListeners() {
                // Search button
                const searchBtn = document.getElementById('search-btn')
                if (searchBtn) {
                    searchBtn.addEventListener('click', handleSearch)
                }
                
                // Browse all buttons
                const browseAllBtn = document.getElementById('browse-all-btn')
                const browseAllCta = document.getElementById('browse-all-cta')
                
                if (browseAllBtn) browseAllBtn.addEventListener('click', handleBrowseAll)
                if (browseAllCta) browseAllCta.addEventListener('click', handleBrowseAll)
                
                // See all buttons
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.see-all-btn')) {
                        handleBrowseAll()
                    }
                })
                
                // Profile button would be added when we have auth
            }
            
            // âœ… SETUP CONTENT CARD LISTENERS
            function setupContentCardListeners() {
                // Content card clicks
                document.querySelectorAll('.content-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        // Don't trigger if clicking on share or creator button
                        if (e.target.closest('.share-btn') || e.target.closest('.creator-btn')) {
                            return
                        }
                        
                        const contentId = card.dataset.contentId
                        const content = allContentData.find(c => c.id === parseInt(contentId))
                        if (content) {
                            navigateToVideoPlayer(content)
                        }
                    })
                })
                
                // Share buttons
                document.querySelectorAll('.share-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation()
                        const content = JSON.parse(btn.dataset.content.replace(/&#39;/g, "'"))
                        shareContent(content)
                    })
                })
                
                // Creator buttons
                document.querySelectorAll('.creator-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation()
                        const creatorId = btn.dataset.creatorId
                        const creatorName = btn.dataset.creatorName
                        navigateToCreatorChannel(creatorId, creatorName)
                    })
                })
            }
            
            // âœ… EVENT HANDLERS (from home_feed.dart)
            function handleSearch() {
                console.log('ðŸ” Search clicked')
                // Navigate to search page
                window.location.href = 'search.html'
            }
            
            function handleBrowseAll() {
                console.log('ðŸ“š Browse All clicked')
                window.location.href = 'content-library.html'
            }
            
            function navigateToCreatorChannel(creatorId, creatorName) {
                if (!creatorId) {
                    showError(`Cannot view ${creatorName}'s channel - missing creator information`)
                    return
                }
                
                console.log(`ðŸ”„ Navigating to creator channel: ${creatorId} (${creatorName})`)
                window.location.href = `creator-channel.html?creatorId=${creatorId}`
            }
            
            function navigateToVideoPlayer(content) {
                if (!content.id || !content.file_url) {
                    showError('Unable to play content: Missing required data')
                    return
                }
                
                const params = new URLSearchParams({
                    id: content.id,
                    title: content.title || 'Untitled',
                    description: content.description || '',
                    file_url: content.file_url,
                    thumbnail_url: content.thumbnail_url,
                    media_type: content.media_type || 'video',
                    creator: content.creator,
                    creator_id: content.creator_id,
                    user_id: content.user_id,
                    created_at: content.created_at,
                    views: content.views || 0,
                    likes: content.likes || 0
                })
                
                window.location.href = `video-player.html?${params.toString()}`
            }
            
            function shareContent(content) {
                const title = content.title || 'Amazing Content'
                const creatorName = getActualCreatorName(content)
                const contentId = content.id || 'unknown'
                
                const shareLink = `https://bantustreamconnect.com/content/${contentId}`
                const shareText = `Check out "${title}" by ${creatorName} on Bantu Stream Connect! ðŸš€\n\n${shareLink}\n\nDiscover amazing content and connect with creators from around the world.\n\n#BantuStreamConnect #ContentCreation`
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Amazing content on Bantu Stream Connect',
                        text: shareText,
                        url: shareLink
                    })
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(shareText).then(() => {
                        showSuccess('Link copied to clipboard!')
                    }).catch(() => {
                        // Fallback: show link
                        prompt('Copy this link to share:', shareLink)
                    })
                }
            }
            
            // Initialize the home feed
            await initializeHomeFeed()
        })
    </script>
</body>
</html>
