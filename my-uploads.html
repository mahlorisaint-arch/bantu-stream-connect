<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<title>My Uploads - Bantu Stream Connect</title>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Supabase JS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
/* Color Theme */
:root {
  --deep-black: #0A0E12;
  --deep-navy: #0F172A;
  --soft-white: #F8FAFC;
  --slate-grey: #94A3B8;
  --bantu-blue: #1D4ED8;
  --warm-gold: #F59E0B;
  --error-color: #EF4444;
  --success-color: #10B981;
  --glow-cycle-1: #00A3FF;
  --glow-cycle-2: #0066FF;
  --glow-cycle-3: #8B5CF6;
  --glow-cycle-4: #EC4899;
  --card-bg: rgba(15, 23, 42, 0.6);
  --card-border: rgba(148, 163, 184, 0.2);
  --hover-overlay: rgba(255, 255, 255, 0.05);
  --active-overlay: rgba(245, 158, 11, 0.1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--deep-black);
  color: var(--soft-white);
  min-height: 100vh;
  overflow-x: hidden;
}

/* Loading Screen */
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--deep-black);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 3px solid rgba(255, 255, 255, 0.1);
  border-radius: 50%;
  border-top-color: var(--bantu-blue);
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Animated Background */
.animated-bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
  overflow: hidden;
}

.glow-cycle {
  position: absolute;
  border-radius: 50%;
  filter: blur(60px);
  opacity: 0.1;
  animation: float 8s infinite ease-in-out;
}

.glow-1 {
  width: 400px;
  height: 400px;
  background: var(--glow-cycle-1);
  top: 10%;
  left: 5%;
  animation-delay: 0s;
}

.glow-2 {
  width: 300px;
  height: 300px;
  background: var(--glow-cycle-2);
  top: 60%;
  right: 10%;
  animation-delay: 2s;
}

.glow-3 {
  width: 350px;
  height: 350px;
  background: var(--glow-cycle-3);
  bottom: 10%;
  left: 20%;
  animation-delay: 4s;
}

.glow-4 {
  width: 250px;
  height: 250px;
  background: var(--glow-cycle-4);
  top: 20%;
  right: 20%;
  animation-delay: 6s;
}

@keyframes float {
  0%, 100% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-20px) scale(1.05); }
}

/* Main Container */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 24px;
  position: relative;
  z-index: 2;
  padding-bottom: 100px;
}

/* Header */
.header {
  background: rgba(10, 14, 18, 0.9);
  backdrop-filter: blur(20px);
  padding: 16px 20px;
  position: sticky;
  top: 0;
  z-index: 100;
  border-bottom: 1px solid var(--card-border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  text-decoration: none;
}

.logo-icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 32px rgba(29, 78, 216, 0.3);
  background: transparent;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.logo-text {
  font-family: 'Orbitron', sans-serif;
  font-weight: 700;
  font-size: 18px;
  background: linear-gradient(to right, var(--soft-white), var(--bantu-blue));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  letter-spacing: 0.5px;
}

.header-actions {
  display: flex;
  gap: 10px;
  align-items: center;
}

.icon-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: var(--soft-white);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
}

.icon-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
}

.notification-badge {
  position: absolute;
  top: -5px;
  right: -5px;
  background: var(--error-color);
  color: white;
  font-size: 10px;
  font-weight: bold;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid var(--deep-black);
}

.profile-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
  border: 2px solid rgba(255, 255, 255, 0.2);
  cursor: pointer;
  overflow: hidden;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 600;
  font-size: 14px;
}

.profile-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(29, 78, 216, 0.3);
}

.profile-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.profile-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
  color: white;
  font-size: 16px;
}

/* Page Header */
.page-header {
  margin: 20px 0 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.page-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 32px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--soft-white), var(--warm-gold));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 8px;
}

.page-subtitle {
  font-size: 14px;
  color: var(--slate-grey);
}

.refresh-btn {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  color: var(--bantu-blue);
  font-size: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.refresh-btn:hover {
  transform: rotate(180deg);
  border-color: var(--warm-gold);
  color: var(--warm-gold);
}

/* Search and Filter Section */
.search-filter-section {
  margin-bottom: 30px;
}

.search-container {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 4px 16px;
  display: flex;
  align-items: center;
  margin-bottom: 20px;
  backdrop-filter: blur(10px);
}

.search-icon {
  color: var(--slate-grey);
  font-size: 18px;
  margin-right: 12px;
}

.search-input {
  flex: 1;
  background: transparent;
  border: none;
  padding: 16px 0;
  color: var(--soft-white);
  font-size: 16px;
  outline: none;
}

.search-input::placeholder {
  color: var(--slate-grey);
}

.clear-search {
  background: transparent;
  border: none;
  color: var(--slate-grey);
  cursor: pointer;
  font-size: 18px;
  padding: 8px;
  transition: color 0.3s ease;
}

.clear-search:hover {
  color: var(--soft-white);
}

.filter-chips {
  display: flex;
  gap: 12px;
  overflow-x: auto;
  padding-bottom: 8px;
  scrollbar-width: thin;
  scrollbar-color: var(--warm-gold) var(--deep-navy);
}

.filter-chips::-webkit-scrollbar {
  height: 4px;
}

.filter-chips::-webkit-scrollbar-track {
  background: var(--deep-navy);
}

.filter-chips::-webkit-scrollbar-thumb {
  background: var(--warm-gold);
  border-radius: 4px;
}

.filter-chip {
  padding: 10px 20px;
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 30px;
  color: var(--slate-grey);
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.filter-chip:hover {
  border-color: var(--warm-gold);
  color: var(--soft-white);
}

.filter-chip.active {
  background: var(--warm-gold);
  border-color: var(--warm-gold);
  color: var(--deep-black);
}

/* Content Grid */
.content-grid {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.content-card {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 20px;
  overflow: hidden;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.content-card:hover {
  transform: translateY(-5px);
  border-color: var(--warm-gold);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
}

.card-header {
  display: flex;
  gap: 20px;
  padding: 20px;
}

.thumbnail-container {
  width: 200px;
  height: 200px;
  border-radius: 12px;
  overflow: hidden;
  background: var(--deep-black);
  flex-shrink: 0;
}

.thumbnail-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.thumbnail-placeholder {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, var(--deep-navy), var(--deep-black));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  color: var(--slate-grey);
}

.content-info {
  flex: 1;
}

.title-row {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 16px;
  margin-bottom: 16px;
}

.content-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 24px;
  font-weight: 700;
  color: var(--soft-white);
  flex: 1;
  line-height: 1.4;
}

.status-badge {
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  white-space: nowrap;
}

.status-badge.published {
  background: rgba(245, 158, 11, 0.2);
  color: var(--warm-gold);
}

.status-badge.draft {
  background: rgba(148, 163, 184, 0.2);
  color: var(--slate-grey);
}

.content-description {
  color: var(--slate-grey);
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: 16px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.metadata-row {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  margin-bottom: 16px;
}

.metadata-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(148, 163, 184, 0.2);
  border-radius: 8px;
  color: var(--slate-grey);
  font-size: 12px;
}

.metadata-chip i {
  font-size: 14px;
  color: var(--warm-gold);
}

.stats-row {
  display: flex;
  gap: 24px;
}

.stat-item {
  display: flex;
  align-items: center;
  gap: 8px;
}

.stat-icon {
  font-size: 18px;
}

.stat-icon.views { color: var(--bantu-blue); }
.stat-icon.likes { color: var(--error-color); }
.stat-icon.comments { color: var(--warm-gold); }

.stat-value {
  font-weight: 600;
  color: var(--soft-white);
}

/* Action Buttons */
.action-buttons {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  padding: 16px 20px;
  background: rgba(0, 0, 0, 0.2);
  border-top: 1px solid var(--card-border);
}

.action-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  padding: 12px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  color: var(--slate-grey);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
}

.action-btn i {
  font-size: 18px;
}

.action-btn:hover {
  transform: translateY(-3px);
  background: rgba(255, 255, 255, 0.1);
}

.action-btn.edit:hover {
  border-color: var(--bantu-blue);
  color: var(--bantu-blue);
  box-shadow: 0 5px 15px rgba(29, 78, 216, 0.3);
}

.action-btn.insights:hover {
  border-color: var(--warm-gold);
  color: var(--warm-gold);
  box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
}

.action-btn.view:hover {
  border-color: var(--soft-white);
  color: var(--soft-white);
  box-shadow: 0 5px 15px rgba(255, 255, 255, 0.1);
}

.action-btn.delete:hover {
  border-color: var(--error-color);
  color: var(--error-color);
  box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 80px 20px;
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 20px;
  backdrop-filter: blur(10px);
}

.empty-icon {
  font-size: 80px;
  color: var(--slate-grey);
  margin-bottom: 24px;
  opacity: 0.5;
}

.empty-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 16px;
  color: var(--soft-white);
}

.empty-text {
  color: var(--slate-grey);
  font-size: 16px;
  line-height: 1.6;
  margin-bottom: 32px;
  max-width: 400px;
  margin-left: auto;
  margin-right: auto;
}

.upload-now-btn {
  background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
  color: var(--soft-white);
  border: none;
  padding: 14px 32px;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 12px;
}

.upload-now-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(29, 78, 216, 0.4);
}

/* Error State */
.error-state {
  text-align: center;
  padding: 60px 20px;
  max-width: 600px;
  margin: 0 auto;
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 20px;
  backdrop-filter: blur(10px);
}

.error-icon {
  font-size: 60px;
  color: var(--error-color);
  margin-bottom: 20px;
}

.error-title {
  font-size: 24px;
  font-weight: 600;
  color: var(--soft-white);
  margin-bottom: 10px;
}

.error-message {
  color: var(--slate-grey);
  margin-bottom: 30px;
  line-height: 1.6;
}

.error-actions {
  display: flex;
  gap: 15px;
  justify-content: center;
}

/* Modal Styles */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
}

.modal-content {
  background: var(--card-bg);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  padding: 30px;
  width: 100%;
  max-width: 500px;
  border: 1px solid var(--card-border);
}

.modal-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
}

.modal-icon {
  font-size: 24px;
  color: var(--warm-gold);
}

.modal-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 20px;
  font-weight: 700;
  color: var(--soft-white);
  flex: 1;
}

.modal-close {
  background: transparent;
  border: none;
  color: rgba(255, 255, 255, 0.5);
  font-size: 20px;
  cursor: pointer;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-close:hover {
  background: rgba(255, 255, 255, 0.1);
}

.modal-body {
  margin-bottom: 25px;
}

.modal-note {
  font-size: 14px;
  color: var(--slate-grey);
  line-height: 1.5;
  margin-top: 15px;
  padding: 15px;
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: 12px;
  color: var(--error-color);
}

.modal-actions {
  display: flex;
  gap: 15px;
}

.modal-btn {
  flex: 1;
  padding: 15px;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  font-size: 16px;
}

.modal-btn.primary {
  background: var(--error-color);
  color: white;
}

.modal-btn.primary:hover {
  background: #dc2626;
  transform: translateY(-2px);
}

.modal-btn.secondary {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.modal-btn.secondary:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
}

/* Insights Modal Specific */
.insights-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  margin-bottom: 24px;
}

.insight-card {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid var(--card-border);
  border-radius: 16px;
  padding: 20px;
  text-align: center;
}

.insight-icon {
  font-size: 32px;
  margin-bottom: 12px;
}

.insight-icon.views { color: var(--bantu-blue); }
.insight-icon.likes { color: var(--error-color); }
.insight-icon.comments { color: var(--warm-gold); }
.insight-icon.earnings { color: var(--success-color); }

.insight-value {
  font-family: 'Orbitron', sans-serif;
  font-size: 28px;
  font-weight: 700;
  color: var(--soft-white);
  margin-bottom: 4px;
}

.insight-label {
  font-size: 12px;
  color: var(--slate-grey);
}

.performance-bar {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid var(--card-border);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 24px;
}

.performance-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
  font-size: 14px;
  color: var(--slate-grey);
}

.performance-progress {
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 16px;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--bantu-blue), var(--warm-gold));
  border-radius: 4px;
  transition: width 0.3s ease;
}

/* Edit Modal Specific */
.edit-form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-label {
  font-size: 14px;
  font-weight: 600;
  color: var(--soft-white);
}

.form-input,
.form-select,
.form-textarea {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 12px 16px;
  color: var(--soft-white);
  font-size: 14px;
  outline: none;
  transition: all 0.3s ease;
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
  border-color: var(--warm-gold);
}

.form-textarea {
  min-height: 100px;
  resize: vertical;
}

.save-btn {
  background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
  color: white;
  border: none;
  padding: 15px;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.save-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(29, 78, 216, 0.4);
}

/* Toast Container */
#toast-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.toast {
  padding: 15px 25px;
  border-radius: 12px;
  color: var(--soft-white);
  font-weight: 500;
  max-width: 300px;
  backdrop-filter: blur(10px);
  border: 1px solid var(--card-border);
  display: flex;
  align-items: center;
  gap: 10px;
  animation: slideIn 0.3s ease;
}

.toast.error { background: rgba(239, 68, 68, 0.9); }
.toast.success { background: rgba(16, 185, 129, 0.9); }
.toast.warning { background: rgba(245, 158, 11, 0.9); }
.toast.info { background: var(--card-bg); }

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* Navigation */
.global-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: rgba(10, 14, 18, 0.95);
  backdrop-filter: blur(20px);
  display: flex;
  justify-content: space-around;
  padding: 15px 0;
  z-index: 100;
  border-top: 1px solid var(--card-border);
}

.nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  color: var(--slate-grey);
  text-decoration: none;
  font-size: 12px;
  transition: all 0.3s ease;
  gap: 4px;
}

.nav-item i {
  font-size: 18px;
}

.nav-item:hover {
  color: var(--soft-white);
}

.nav-item.active {
  color: var(--warm-gold);
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--deep-navy);
}

::-webkit-scrollbar-thumb {
  background: var(--bantu-blue);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--warm-gold);
}

/* Responsive */
@media (max-width: 768px) {
  .container {
    padding: 16px;
  }

  .page-title {
    font-size: 28px;
  }

  .card-header {
    flex-direction: column;
    padding: 16px;
  }

  .thumbnail-container {
    width: 100%;
    height: 180px;
  }

  .content-title {
    font-size: 20px;
  }

  .action-buttons {
    grid-template-columns: repeat(2, 1fr);
  }

  .insights-grid {
    grid-template-columns: 1fr;
  }

  .error-actions {
    flex-direction: column;
  }

  .modal-actions {
    flex-direction: column;
  }
}

@media (max-width: 480px) {
  .filter-chips {
    gap: 8px;
  }

  .filter-chip {
    padding: 8px 16px;
    font-size: 12px;
  }

  .stats-row {
    flex-wrap: wrap;
    gap: 12px;
  }
}
</style>
</head>
<body>
<!-- Loading Screen -->
<div id="loading" class="loading-screen">
  <div class="spinner"></div>
  <div id="loading-text">Loading My Uploads...</div>
</div>

<!-- Animated Background -->
<div class="animated-bg">
  <div class="glow-cycle glow-1"></div>
  <div class="glow-cycle glow-2"></div>
  <div class="glow-cycle glow-3"></div>
  <div class="glow-cycle glow-4"></div>
</div>

<!-- Main App (hidden until loaded) -->
<div id="app" style="display: none;">
  <!-- Header -->
  <header class="header">
    <div class="logo" onclick="window.location.href='index.html'">
      <div class="logo-icon">
        <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="40" height="40" rx="8" fill="#0F172A"/>
          <path d="M8 20 L12 16 L16 22 L20 18 L24 24 L28 20 L32 26" stroke="url(#pulse-gradient)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="32" cy="26" r="3" fill="#F59E0B"/>
          <defs>
            <linearGradient id="pulse-gradient" x1="8" y1="20" x2="32" y2="26" gradientUnits="userSpaceOnUse">
              <stop stop-color="#1D4ED8"/>
              <stop offset="1" stop-color="#F59E0B"/>
            </linearGradient>
          </defs>
        </svg>
      </div>
      <div class="logo-text">BANTU STREAM CONNECT</div>
    </div>
    <div class="header-actions">
      <button id="search-btn" class="icon-btn search-btn" title="Search">
        <i class="fas fa-search"></i>
      </button>
      <button id="notifications-btn" class="icon-btn" title="Notifications">
        <i class="fas fa-bell"></i>
        <span class="notification-badge" id="notification-count" style="display: none;">0</span>
      </button>
      <button id="profile-btn" class="profile-btn" title="Profile">
        <div class="profile-placeholder" id="userProfilePlaceholder">
          <i class="fas fa-user"></i>
        </div>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Page Header -->
    <div class="page-header">
      <div>
        <h1 class="page-title">My Uploads</h1>
        <div class="page-subtitle" id="contentStats">Loading...</div>
      </div>
      <button id="refreshBtn" class="refresh-btn" title="Refresh">
        <i class="fas fa-sync-alt"></i>
      </button>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-filter-section">
      <div class="search-container">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="searchInput" class="search-input" placeholder="Search your content..." autocomplete="off">
        <button id="clearSearch" class="clear-search" style="display: none;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="filter-chips" id="filterChips">
        <!-- Filter chips will be dynamically added -->
      </div>
    </div>

    <!-- Content Grid -->
    <div id="contentGrid" class="content-grid">
      <!-- Content will be loaded here -->
    </div>
  </main>

  <!-- Global Navigation -->
  <nav class="global-nav">
    <a href="index.html" class="nav-item">
      <i class="fas fa-home"></i>
      Home
    </a>
    <a href="trending_screen.html" class="nav-item">
      <i class="fas fa-fire"></i>
      Trending
    </a>
    <a href="content-library.html" class="nav-item">
      <i class="fas fa-th-large"></i>
      Library
    </a>
    <a href="creator-dashboard.html" class="nav-item">
      <i class="fas fa-user"></i>
      Creator
    </a>
  </nav>
</div>

<!-- Error State -->
<div id="errorState" class="error-state" style="display: none;">
  <div class="error-icon">
    <i class="fas fa-exclamation-triangle"></i>
  </div>
  <h2 class="error-title" id="errorTitle">Loading Error</h2>
  <p class="error-message" id="errorMessage">Failed to load your content. Please try again.</p>
  <div class="error-actions">
    <button id="retryBtn" class="action-btn retry-btn">
      <i class="fas fa-redo-alt"></i>
      Retry
    </button>
    <button id="backToDashboardBtn" class="action-btn login-btn">
      <i class="fas fa-arrow-left"></i>
      Back to Dashboard
    </button>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-icon">
        <i class="fas fa-exclamation-triangle" style="color: var(--error-color);"></i>
      </div>
      <div class="modal-title">Delete Content</div>
      <button class="modal-close" id="closeDeleteModal">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <p style="color: var(--slate-grey); margin-bottom: 20px;" id="deleteConfirmText">
        Are you sure you want to permanently delete "<span id="deleteContentTitle"></span>"?
      </p>
      <div class="modal-note">
        <i class="fas fa-info-circle"></i>
        This action cannot be undone. The content will be removed from all feeds and your dashboard.
      </div>
    </div>
    <div class="modal-actions">
      <button class="modal-btn secondary" id="cancelDelete">Cancel</button>
      <button class="modal-btn primary" id="confirmDelete">Delete</button>
    </div>
  </div>
</div>

<!-- Insights Modal -->
<div id="insightsModal" class="modal-overlay">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <div class="modal-icon">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="modal-title" id="insightsModalTitle">Content Insights</div>
      <button class="modal-close" id="closeInsightsModal">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="insights-grid">
        <div class="insight-card">
          <div class="insight-icon views">
            <i class="fas fa-eye"></i>
          </div>
          <div class="insight-value" id="insightViews">0</div>
          <div class="insight-label">Views</div>
        </div>
        <div class="insight-card">
          <div class="insight-icon likes">
            <i class="fas fa-heart"></i>
          </div>
          <div class="insight-value" id="insightLikes">0</div>
          <div class="insight-label">Likes</div>
        </div>
        <div class="insight-card">
          <div class="insight-icon comments">
            <i class="fas fa-comment"></i>
          </div>
          <div class="insight-value" id="insightComments">0</div>
          <div class="insight-label">Comments</div>
        </div>
        <div class="insight-card">
          <div class="insight-icon earnings">
            <i class="fas fa-money-bill-wave"></i>
          </div>
          <div class="insight-value" id="insightEarnings">R0.00</div>
          <div class="insight-label">Earnings</div>
        </div>
      </div>

      <div class="performance-bar">
        <div class="performance-label">
          <span>Engagement Rate</span>
          <span id="engagementRate">0%</span>
        </div>
        <div class="performance-progress">
          <div class="progress-fill" id="engagementProgress" style="width: 0%"></div>
        </div>

        <div class="performance-label">
          <span>Retention Rate</span>
          <span id="retentionRate">0%</span>
        </div>
        <div class="performance-progress">
          <div class="progress-fill" id="retentionProgress" style="width: 0%"></div>
        </div>
      </div>

      <div style="background: rgba(0, 0, 0, 0.3); border: 1px solid var(--card-border); border-radius: 16px; padding: 20px;">
        <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--soft-white);">Performance Summary</h3>
        <p style="font-size: 14px; color: var(--slate-grey); line-height: 1.6;" id="performanceSummary">
          This content is performing well. Keep creating engaging content to grow your audience.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal-overlay">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <div class="modal-icon">
        <i class="fas fa-edit"></i>
      </div>
      <div class="modal-title" id="editModalTitle">Edit Content</div>
      <button class="modal-close" id="closeEditModal">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form id="editForm" class="edit-form">
        <input type="hidden" id="editContentId">
        
        <div class="form-group">
          <label class="form-label">Title</label>
          <input type="text" id="editTitle" class="form-input" required maxlength="200">
        </div>

        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea id="editDescription" class="form-textarea" rows="4" maxlength="1000"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Genre/Category</label>
          <select id="editGenre" class="form-select">
            <option value="">Select Genre</option>
            <option value="Music">Music</option>
            <option value="STEM">STEM</option>
            <option value="Culture">Culture</option>
            <option value="News">News</option>
            <option value="Sports">Sports</option>
            <option value="Movies">Movies</option>
            <option value="Documentaries">Documentaries</option>
            <option value="Podcasts">Podcasts</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Status</label>
          <select id="editStatus" class="form-select">
            <option value="published">Published</option>
            <option value="draft">Draft</option>
          </select>
        </div>
      </form>
    </div>
    <div class="modal-actions">
      <button class="modal-btn secondary" id="cancelEdit">Cancel</button>
      <button class="save-btn" id="saveEdit">Save Changes</button>
    </div>
  </div>
</div>

<!-- Search Modal -->
<div id="search-modal" class="modal-overlay">
  <div style="width:90%;max-width:800px;background:var(--card-bg);border-radius:20px;padding:30px;backdrop-filter:blur(10px);">
    <div class="search-modal-header">
      <div class="search-input-container" style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
        <i class="fas fa-search" style="color:var(--slate-grey);font-size:20px;"></i>
        <input type="text" id="modal-search-input" class="search-input" placeholder="Search content, creators, or categories..." autocomplete="off" style="background:transparent;border:none;flex:1;padding:12px 0;color:var(--soft-white);outline:none;">
        <button id="close-search-btn" class="modal-close">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <div class="search-filters" style="display:flex;gap:16px;margin-bottom:24px;">
      <div class="filter-group" style="flex:1;">
        <label style="display:block;margin-bottom:8px;color:var(--slate-grey);font-size:14px;">Category</label>
        <select id="category-filter" style="width:100%;padding:12px;background:rgba(0,0,0,0.3);border:1px solid var(--card-border);border-radius:12px;color:var(--soft-white);">
          <option value="">All Categories</option>
          <option value="Music">Music</option>
          <option value="STEM">STEM</option>
          <option value="Culture">Culture</option>
          <option value="News">News</option>
          <option value="Sports">Sports</option>
          <option value="Movies">Movies</option>
          <option value="Documentaries">Documentaries</option>
          <option value="Podcasts">Podcasts</option>
        </select>
      </div>
      <div class="filter-group" style="flex:1;">
        <label style="display:block;margin-bottom:8px;color:var(--slate-grey);font-size:14px;">Sort By</label>
        <select id="sort-filter" style="width:100%;padding:12px;background:rgba(0,0,0,0.3);border:1px solid var(--card-border);border-radius:12px;color:var(--soft-white);">
          <option value="newest">Newest First</option>
          <option value="popular">Most Popular</option>
          <option value="trending">Trending</option>
        </select>
      </div>
    </div>
    <div class="search-results">
      <div id="search-results-grid" class="search-results-grid" style="max-height:400px;overflow-y:auto;">
        <!-- Results loaded here -->
      </div>
    </div>
  </div>
</div>

<!-- Notifications Panel -->
<div id="notifications-panel" class="modal-overlay" style="display:none;justify-content:flex-end;">
  <div style="width:400px;height:100%;background:var(--card-bg);border-left:1px solid var(--card-border);box-shadow:-5px 0 25px rgba(0,0,0,0.3);backdrop-filter:blur(10px);">
    <div class="notifications-header" style="padding:20px;border-bottom:1px solid var(--card-border);display:flex;justify-content:space-between;align-items:center">
      <h2 style="font-family:'Orbitron',sans-serif;font-size:20px;margin:0;color:var(--soft-white)">Notifications</h2>
      <button id="close-notifications" class="modal-close">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="notifications-list" id="notifications-list" style="max-height:calc(100vh-150px);overflow-y:auto;padding:20px">
      <!-- Notifications loaded here -->
    </div>
    <div class="notifications-footer" style="padding:20px;border-top:1px solid var(--card-border);display:flex;gap:15px">
      <button id="mark-all-read" class="modal-btn secondary" style="flex:1">Mark all as read</button>
      <button id="notification-settings" class="modal-btn secondary" style="flex:1">Settings</button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

<!-- CRITICAL FIX: Initialize shared Supabase client BEFORE DOMContentLoaded -->
<script>
if (!window.supabaseClient) {
  window.supabaseClient = supabase.createClient(
    'https://ydnxqnbjoshvxteevemc.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U'
  );
  console.log('âœ… Global Supabase client initialized for my uploads');
}
</script>

<!-- My Uploads JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', async () => {
  console.log('ðŸ“¤ My Uploads Page Initializing...');
  
  // DOM Elements
  const loadingScreen = document.getElementById('loading');
  const loadingText = document.getElementById('loading-text');
  const app = document.getElementById('app');
  const errorState = document.getElementById('errorState');
  const errorTitle = document.getElementById('errorTitle');
  const errorMessage = document.getElementById('errorMessage');
  const profileBtn = document.getElementById('profile-btn');
  const notificationsBtn = document.getElementById('notifications-btn');
  const searchBtn = document.getElementById('search-btn');
  const refreshBtn = document.getElementById('refreshBtn');
  const searchInput = document.getElementById('searchInput');
  const clearSearch = document.getElementById('clearSearch');
  const filterChips = document.getElementById('filterChips');
  const contentGrid = document.getElementById('contentGrid');
  const contentStats = document.getElementById('contentStats');
  const retryBtn = document.getElementById('retryBtn');
  const backToDashboardBtn = document.getElementById('backToDashboardBtn');
  
  // Modal Elements
  const deleteModal = document.getElementById('deleteModal');
  const closeDeleteModal = document.getElementById('closeDeleteModal');
  const cancelDelete = document.getElementById('cancelDelete');
  const confirmDelete = document.getElementById('confirmDelete');
  const deleteContentTitle = document.getElementById('deleteContentTitle');
  
  const insightsModal = document.getElementById('insightsModal');
  const closeInsightsModal = document.getElementById('closeInsightsModal');
  
  const editModal = document.getElementById('editModal');
  const closeEditModal = document.getElementById('closeEditModal');
  const cancelEdit = document.getElementById('cancelEdit');
  const saveEdit = document.getElementById('saveEdit');
  
  // Search Modal Elements
  const searchModal = document.getElementById('search-modal');
  const closeSearchBtn = document.getElementById('close-search-btn');
  
  // Notifications Panel Elements
  const notificationsPanel = document.getElementById('notifications-panel');
  const closeNotifications = document.getElementById('close-notifications');
  const markAllReadBtn = document.getElementById('mark-all-read');
  const notificationsList = document.getElementById('notifications-list');
  
  // State variables
  let currentUser = null;
  let allContent = [];
  let filteredContent = [];
  let selectedFilter = 'all';
  let currentDeleteId = null;
  let currentInsightsContent = null;
  let currentEditContent = null;
  let isLoading = true;
  let notifications = [];
  
  // Filter options matching Flutter app
  const filterOptions = [
    { id: 'all', label: 'All Content', icon: 'fa-layer-group' },
    { id: 'published', label: 'Published', icon: 'fa-check-circle' },
    { id: 'draft', label: 'Drafts', icon: 'fa-pen' },
    { id: 'video', label: 'Videos', icon: 'fa-video' },
    { id: 'audio', label: 'Audio', icon: 'fa-headphones' },
    { id: 'image', label: 'Images', icon: 'fa-image' }
  ];
  
  // âœ… SHOW/HIDE LOADING
  function setLoading(loading, text = '') {
    isLoading = loading;
    if (text) loadingText.textContent = text;
    if (loading) {
      loadingScreen.style.display = 'flex';
      app.style.display = 'none';
      errorState.style.display = 'none';
    } else {
      setTimeout(() => {
        loadingScreen.style.display = 'none';
        app.style.display = 'block';
      }, 500);
    }
  }
  
  // âœ… SHOW TOAST MESSAGE
  function showToast(message, type = 'error') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    const icon = type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle';
    toast.innerHTML = `<i class="fas fa-${icon}"></i> ${message}`;
    document.getElementById('toast-container').appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
  }
  
  // âœ… FORMAT CURRENCY (ZAR)
  function formatCurrency(amount) {
    return 'R' + parseFloat(amount).toFixed(2);
  }
  
  // âœ… FORMAT NUMBER
  function formatNumber(num) {
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
    return num.toString();
  }
  
  // âœ… CONVERT USD TO ZAR
  function convertToZAR(usdAmount) {
    const usdToZarRate = 18.5;
    return formatCurrency(usdAmount * usdToZarRate);
  }
  
  // âœ… FORMAT DATE
  function formatDate(dateString) {
    try {
      const date = new Date(dateString);
      return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
    } catch (e) {
      return 'Unknown';
    }
  }
  
  // âœ… GET INITIALS FROM EMAIL
  function getInitials(email) {
    if (!email) return 'U';
    const parts = email.split('@')[0];
    return parts.substring(0, 2).toUpperCase();
  }
  
  // âœ… GET INITIALS FROM FULL NAME
  function getInitialsFromName(fullName) {
    if (!fullName) return 'U';
    const names = fullName.split(' ');
    if (names.length >= 2) {
      return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();
    }
    return fullName.charAt(0).toUpperCase();
  }
  
  // âœ… GET MEDIA TYPE ICON
  function getMediaTypeIcon(mediaType) {
    switch(mediaType) {
      case 'video': return 'fa-video';
      case 'audio': return 'fa-headphones';
      case 'image': return 'fa-image';
      default: return 'fa-file';
    }
  }
  
  // âœ… LOAD USER PROFILE PICTURE
  async function loadUserProfilePicture(user) {
    try {
      if (!user || !profileBtn) return;
      
      const placeholder = document.getElementById('userProfilePlaceholder');
      if (!placeholder) return;
      
      // Clear existing content
      while (placeholder.firstChild) {
        placeholder.removeChild(placeholder.firstChild);
      }
      
      const userInitials = getInitials(user.email);
      
      // Fetch user profile from database
      const profileResponse = await window.supabaseClient
        .from('user_profiles')
        .select('*')
        .eq('id', user.id)
        .maybeSingle();
      
      const profile = profileResponse.data;
      
      if (profile) {
        const displayName = profile.full_name || profile.username || user.email || 'User';
        
        // If avatar URL exists, display it
        if (profile.avatar_url) {
          let avatarUrl = profile.avatar_url;
          
          try {
            if (!avatarUrl.startsWith('http')) {
              if (avatarUrl.startsWith('avatars/')) {
                avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${avatarUrl}`;
              } else {
                avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/avatars/${avatarUrl}`;
              }
            }
            
            const img = document.createElement('img');
            img.className = 'profile-img';
            img.alt = displayName;
            img.style.cssText = 'width: 100%; height: 100%; border-radius: 50%; object-fit: cover;';
            img.src = avatarUrl;
            
            img.onerror = () => {
              const nameInitials = profile.full_name ? getInitialsFromName(profile.full_name) : userInitials;
              const fallback = document.createElement('div');
              fallback.className = 'profile-placeholder';
              fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px';
              fallback.textContent = nameInitials;
              placeholder.innerHTML = '';
              placeholder.appendChild(fallback);
            };
            
            placeholder.appendChild(img);
          } catch (e) {
            const fallback = document.createElement('div');
            fallback.className = 'profile-placeholder';
            fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px';
            fallback.textContent = userInitials;
            placeholder.appendChild(fallback);
          }
        } else {
          const nameInitials = profile.full_name ? getInitialsFromName(profile.full_name) : userInitials;
          const fallback = document.createElement('div');
          fallback.className = 'profile-placeholder';
          fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px';
          fallback.textContent = nameInitials;
          placeholder.appendChild(fallback);
        }
      } else {
        const fallback = document.createElement('div');
        fallback.className = 'profile-placeholder';
        fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px';
        fallback.textContent = userInitials;
        placeholder.appendChild(fallback);
      }
    } catch (error) {
      console.error('Error loading user profile picture:', error);
      const placeholder = document.getElementById('userProfilePlaceholder');
      if (placeholder) {
        const userInitials = getInitials(user.email);
        const fallback = document.createElement('div');
        fallback.className = 'profile-placeholder';
        fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px';
        fallback.textContent = userInitials;
        placeholder.innerHTML = '';
        placeholder.appendChild(fallback);
      }
    }
  }
  
  // âœ… CHECK AUTHENTICATION
  async function checkAuthentication() {
    try {
      setLoading(true, 'Checking authentication...');
      
      const sessionResponse = await window.supabaseClient.auth.getSession();
      const session = sessionResponse.data.session;
      
      if (!session?.user) {
        console.log('âš ï¸ User not authenticated');
        showToast('Please sign in to view your uploads', 'error');
        localStorage.setItem('redirectAfterLogin', 'my-uploads.html');
        window.location.href = 'login.html?redirect=my-uploads.html';
        return false;
      }
      
      currentUser = session.user;
      console.log('âœ… User authenticated:', currentUser.email);
      
      await loadUserProfilePicture(currentUser);
      
      return true;
    } catch (error) {
      console.error('âŒ Authentication error:', error);
      showError('Authentication Error', 'Failed to authenticate. Please try again.');
      return false;
    }
  }
  
  // âœ… SHOW ERROR STATE
  function showError(title, message) {
    errorTitle.textContent = title;
    errorMessage.textContent = message;
    loadingScreen.style.display = 'none';
    app.style.display = 'none';
    errorState.style.display = 'block';
  }
  
  // âœ… LOAD NOTIFICATIONS
  async function loadNotifications() {
    try {
      if (!currentUser) {
        updateNotificationBadge(0);
        return;
      }
      
      const { data, error } = await window.supabaseClient
        .from('notifications')
        .select('*')
        .eq('user_id', currentUser.id)
        .order('created_at', { ascending: false })
        .limit(20);
      
      if (error) throw error;
      
      notifications = data || [];
      const unreadCount = notifications.filter(n => !n.is_read).length;
      updateNotificationBadge(unreadCount);
      renderNotifications();
    } catch (error) {
      console.error('Error loading notifications:', error);
      updateNotificationBadge(0);
    }
  }
  
  // âœ… UPDATE NOTIFICATION BADGE
  function updateNotificationBadge(count) {
    const badge = document.getElementById('notification-count');
    if (badge) {
      badge.textContent = count > 99 ? '99+' : count;
      badge.style.display = count > 0 ? 'flex' : 'none';
    }
  }
  
  // âœ… RENDER NOTIFICATIONS
  function renderNotifications() {
    if (!notificationsList) return;
    
    if (!notifications || notifications.length === 0) {
      notificationsList.innerHTML = `
        <div style="text-align:center;padding:40px 20px;color:var(--slate-grey)">
          <i class="fas fa-bell" style="font-size:48px;margin-bottom:15px;opacity:0.3"></i>
          <p>No notifications yet</p>
        </div>
      `;
      return;
    }
    
    notificationsList.innerHTML = notifications.map(notification => {
      const isUnread = !notification.is_read;
      return `
        <div class="notification-item ${isUnread ? 'unread' : 'read'}" data-id="${notification.id}" data-content-id="${notification.content_id || ''}" style="padding:15px;border-bottom:1px solid var(--card-border);display:flex;gap:12px;position:relative;cursor:pointer">
          <div style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--bantu-blue),var(--warm-gold));display:flex;align-items:center;justify-content:center;flex-shrink:0">
            <i class="${getNotificationIcon(notification.type)}" style="color:white"></i>
          </div>
          <div style="flex:1">
            <h4 style="font-weight:600;margin-bottom:5px;color:var(--soft-white)">${escapeHtml(notification.title)}</h4>
            <p style="font-size:14px;color:var(--slate-grey);margin-bottom:8px;line-height:1.4">${escapeHtml(notification.message)}</p>
            <span style="font-size:12px;color:var(--warm-gold)">${formatNotificationTime(notification.created_at)}</span>
          </div>
          ${isUnread ? '<div style="width:10px;height:10px;border-radius:50%;background:var(--warm-gold);position:absolute;top:15px;right:15px"></div>' : ''}
        </div>
      `;
    }).join('');
    
    // Add click handlers
    notificationsList.querySelectorAll('.notification-item').forEach(item => {
      item.addEventListener('click', async () => {
        const id = item.dataset.id;
        await markNotificationAsRead(id);
        const contentId = item.dataset.contentId;
        if (contentId) {
          window.location.href = `content-detail.html?id=${contentId}`;
        }
        notificationsPanel.style.display = 'none';
      });
    });
  }
  
  // âœ… GET NOTIFICATION ICON
  function getNotificationIcon(type) {
    switch(type) {
      case 'like': return 'fas fa-heart';
      case 'comment': return 'fas fa-comment';
      case 'follow': return 'fas fa-user-plus';
      case 'view_milestone': return 'fas fa-trophy';
      case 'system': return 'fas fa-bell';
      default: return 'fas fa-bell';
    }
  }
  
  // âœ… FORMAT NOTIFICATION TIME
  function formatNotificationTime(timestamp) {
    if (!timestamp) return 'Just now';
    const diffMs = Date.now() - new Date(timestamp).getTime();
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 1) return 'Just now';
    if (diffMins < 60) return `${diffMins}m ago`;
    if (diffHours < 24) return `${diffHours}h ago`;
    if (diffDays < 7) return `${diffDays}d ago`;
    return new Date(timestamp).toLocaleDateString();
  }
  
  // âœ… ESCAPE HTML
  function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
  
  // âœ… MARK NOTIFICATION AS READ
  async function markNotificationAsRead(notificationId) {
    try {
      await window.supabaseClient
        .from('notifications')
        .update({ is_read: true })
        .eq('id', notificationId);
      
      await loadNotifications();
    } catch (error) {
      console.error('Error marking notification as read:', error);
    }
  }
  
  // âœ… MARK ALL NOTIFICATIONS AS READ
  async function markAllNotificationsAsRead() {
    try {
      if (!currentUser) return;
      
      await window.supabaseClient
        .from('notifications')
        .update({ is_read: true })
        .eq('user_id', currentUser.id)
        .eq('is_read', false);
      
      await loadNotifications();
      showToast('All notifications marked as read', 'success');
    } catch (error) {
      console.error('Error marking all notifications as read:', error);
      showToast('Failed to mark notifications as read', 'error');
    }
  }
  
  // âœ… LOAD USER CONTENT
  async function loadUserContent() {
    try {
      setLoading(true, 'Loading your content...');
      
      if (!currentUser) {
        throw new Error('No authenticated user');
      }
      
      const { data: content, error: contentError } = await window.supabaseClient
        .from('Content')
        .select('*, user_profiles!user_id(*)')
        .eq('user_id', currentUser.id)
        .order('created_at', { ascending: false });
      
      if (contentError) throw contentError;
      
      // Enrich content with real counts from source tables
      const enrichedContent = await Promise.all(
        (content || []).map(async (item) => {
          // Get real view count from content_views table
          const { count: viewsCount, error: viewsError } = await window.supabaseClient
            .from('content_views')
            .select('*', { count: 'exact', head: true })
            .eq('content_id', item.id);
          
          // Get real likes count from likes table
          const { count: likesCount, error: likesError } = await window.supabaseClient
            .from('likes')
            .select('*', { count: 'exact', head: true })
            .eq('content_id', item.id);
          
          // Get real comments count from comments table
          const { count: commentsCount, error: commentsError } = await window.supabaseClient
            .from('comments')
            .select('*', { count: 'exact', head: true })
            .eq('content_id', item.id);
          
          return {
            ...item,
            real_views: viewsCount || 0,
            real_likes: likesCount || 0,
            real_comments: commentsCount || 0,
            media_type: item.media_type || 'video',
            status: item.status || 'draft',
            genre: item.genre || ''
          };
        })
      );
      
      allContent = enrichedContent;
      filteredContent = [...allContent];
      
      console.log(`âœ… Loaded ${allContent.length} content items`);
      
      // Render UI
      renderFilterChips();
      filterContent(selectedFilter);
      updateStats();
      
      setLoading(false);
    } catch (error) {
      console.error('âŒ Error loading content:', error);
      showError('Loading Error', 'Failed to load your content. Please try again.');
    }
  }
  
  // âœ… RENDER FILTER CHIPS
  function renderFilterChips() {
    if (!filterChips) return;
    
    filterChips.innerHTML = filterOptions.map(filter => `
      <div class="filter-chip ${selectedFilter === filter.id ? 'active' : ''}" data-filter="${filter.id}">
        <i class="fas ${filter.icon}" style="margin-right: 8px;"></i>
        ${filter.label}
      </div>
    `).join('');
    
    // Add click handlers
    filterChips.querySelectorAll('.filter-chip').forEach(chip => {
      chip.addEventListener('click', () => {
        const filterId = chip.dataset.filter;
        filterContent(filterId);
        
        // Update active state
        filterChips.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
        chip.classList.add('active');
      });
    });
  }
  
  // âœ… FILTER CONTENT
  function filterContent(filter) {
    selectedFilter = filter;
    
    // Apply filter
    if (filter === 'all') {
      filteredContent = [...allContent];
    } else if (['published', 'draft'].includes(filter)) {
      filteredContent = allContent.filter(content => content.status === filter);
    } else {
      filteredContent = allContent.filter(content => content.media_type === filter);
    }
    
    // Apply search if there's text
    if (searchInput && searchInput.value.trim()) {
      performSearch(searchInput.value.trim());
    } else {
      renderContent();
    }
  }
  
  // âœ… PERFORM SEARCH
  function performSearch(query) {
    if (!query) {
      filterContent(selectedFilter);
      return;
    }
    
    const searchLower = query.toLowerCase();
    let results = allContent.filter(content => {
      const title = (content.title || '').toLowerCase();
      const description = (content.description || '').toLowerCase();
      const genre = (content.genre || '').toLowerCase();
      
      return title.includes(searchLower) || 
             description.includes(searchLower) || 
             genre.includes(searchLower);
    });
    
    // Apply current filter
    if (selectedFilter !== 'all') {
      if (['published', 'draft'].includes(selectedFilter)) {
        results = results.filter(content => content.status === selectedFilter);
      } else {
        results = results.filter(content => content.media_type === selectedFilter);
      }
    }
    
    filteredContent = results;
    renderContent();
  }
  
  // âœ… RENDER CONTENT
  function renderContent() {
    if (!contentGrid) return;
    
    if (filteredContent.length === 0) {
      renderEmptyState();
      return;
    }
    
    contentGrid.innerHTML = filteredContent.map(content => {
      const title = content.title || 'Untitled';
      const description = content.description || '';
      const status = content.status || 'draft';
      const mediaType = content.media_type || 'video';
      const thumbnailUrl = content.thumbnail_url;
      const createdAt = content.created_at;
      const viewsCount = content.real_views || 0;
      const likesCount = content.real_likes || 0;
      const commentsCount = content.real_comments || 0;
      const genre = content.genre || '';
      
      const statusClass = status === 'published' ? 'published' : 'draft';
      const statusText = status === 'published' ? 'LIVE' : 'DRAFT';
      const mediaIcon = getMediaTypeIcon(mediaType);
      
      return `
        <div class="content-card" data-content-id="${content.id}">
          <div class="card-header">
            <div class="thumbnail-container">
              ${thumbnailUrl ? `
                <img src="${thumbnailUrl.startsWith('http') ? thumbnailUrl : `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${thumbnailUrl}`}" 
                     alt="${escapeHtml(title)}"
                     class="thumbnail-img"
                     onerror="this.parentElement.innerHTML='<div class=\\'thumbnail-placeholder\\'><i class=\\'fas ${mediaIcon}\\'></i></div>'">
              ` : `
                <div class="thumbnail-placeholder">
                  <i class="fas ${mediaIcon}"></i>
                </div>
              `}
            </div>
            
            <div class="content-info">
              <div class="title-row">
                <h3 class="content-title" title="${escapeHtml(title)}">${escapeHtml(title)}</h3>
                <span class="status-badge ${statusClass}">${statusText}</span>
              </div>
              
              ${description ? `
                <p class="content-description">${escapeHtml(description)}</p>
              ` : ''}
              
              <div class="metadata-row">
                ${genre ? `
                  <span class="metadata-chip">
                    <i class="fas fa-tag"></i>
                    ${escapeHtml(genre)}
                  </span>
                ` : ''}
                
                <span class="metadata-chip">
                  <i class="fas ${mediaIcon}"></i>
                  ${mediaType.toUpperCase()}
                </span>
                
                ${createdAt ? `
                  <span class="metadata-chip">
                    <i class="fas fa-calendar"></i>
                    ${formatDate(createdAt)}
                  </span>
                ` : ''}
              </div>
              
              <div class="stats-row">
                <div class="stat-item">
                  <i class="fas fa-eye stat-icon views"></i>
                  <span class="stat-value">${formatNumber(viewsCount)}</span>
                </div>
                <div class="stat-item">
                  <i class="fas fa-heart stat-icon likes"></i>
                  <span class="stat-value">${formatNumber(likesCount)}</span>
                </div>
                <div class="stat-item">
                  <i class="fas fa-comment stat-icon comments"></i>
                  <span class="stat-value">${formatNumber(commentsCount)}</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="action-buttons">
            <div class="action-btn edit" onclick="window.editContent('${content.id}')">
              <i class="fas fa-edit"></i>
              <span>Edit</span>
            </div>
            <div class="action-btn insights" onclick="window.showContentInsights('${content.id}')">
              <i class="fas fa-chart-line"></i>
              <span>Insights</span>
            </div>
            <div class="action-btn view" onclick="window.viewContent('${content.id}')">
              <i class="fas fa-eye"></i>
              <span>View</span>
            </div>
            <div class="action-btn delete" onclick="window.deleteContent('${content.id}', '${escapeHtml(title).replace(/'/g, "\\'")}')">
              <i class="fas fa-trash"></i>
              <span>Delete</span>
            </div>
          </div>
        </div>
      `;
    }).join('');
    
    updateStats();
  }
  
  // âœ… RENDER EMPTY STATE
  function renderEmptyState() {
    const filterName = filterOptions.find(f => f.id === selectedFilter)?.label || 'Content';
    
    contentGrid.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-film"></i>
        </div>
        <h3 class="empty-title">No ${filterName} Found</h3>
        <p class="empty-text">
          ${selectedFilter === 'all' 
            ? "You haven't uploaded any content yet. Start sharing your stories today! ðŸŽ¬"
            : `No ${filterName.toLowerCase()} found. Try a different filter or upload new content.`
          }
        </p>
        ${selectedFilter !== 'all' ? `
          <button class="upload-now-btn" onclick="window.location.href='creator-upload.html'">
            <i class="fas fa-cloud-upload-alt"></i>
            Upload Content
          </button>
        ` : ''}
      </div>
    `;
  }
  
  // âœ… UPDATE STATS
  function updateStats() {
    if (!contentStats) return;
    
    const totalItems = allContent.length;
    const shownItems = filteredContent.length;
    contentStats.textContent = `${totalItems} items â€¢ ${shownItems} shown`;
  }
  
  // âœ… SHOW CONTENT INSIGHTS
  function showContentInsights(contentId) {
    const content = allContent.find(c => c.id === contentId);
    if (!content) return;
    
    currentInsightsContent = content;
    
    const views = content.real_views || 0;
    const likes = content.real_likes || 0;
    const comments = content.real_comments || 0;
    const earnings = views * 0.01; // R0.01 per view
    
    // Update insight values
    document.getElementById('insightViews').textContent = formatNumber(views);
    document.getElementById('insightLikes').textContent = formatNumber(likes);
    document.getElementById('insightComments').textContent = formatNumber(comments);
    document.getElementById('insightEarnings').textContent = convertToZAR(earnings);
    
    // Calculate engagement rate (likes + comments) / views * 100
    const engagementRate = views > 0 ? ((likes + comments) / views * 100).toFixed(1) : 0;
    document.getElementById('engagementRate').textContent = `${engagementRate}%`;
    document.getElementById('engagementProgress').style.width = `${Math.min(engagementRate, 100)}%`;
    
    // Calculate retention rate (simulated based on views)
    const retentionRate = views > 100 ? Math.min(85, 50 + (views / 1000)).toFixed(1) : 50;
    document.getElementById('retentionRate').textContent = `${retentionRate}%`;
    document.getElementById('retentionProgress').style.width = `${retentionRate}%`;
    
    // Generate performance summary
    let summary = '';
    if (views === 0) {
      summary = 'This content hasn\'t been viewed yet. Share it with your audience to start getting engagement.';
    } else if (views < 100) {
      summary = 'This content is gaining initial traction. Promote it on social media to reach more viewers.';
    } else if (views < 1000) {
      summary = 'Good performance! This content is resonating with your audience. Keep creating similar content.';
    } else if (views < 10000) {
      summary = 'Great performance! This content is becoming popular. Engage with commenters to build community.';
    } else {
      summary = 'Excellent performance! This content is going viral. Consider creating a follow-up or series.';
    }
    document.getElementById('performanceSummary').textContent = summary;
    
    document.getElementById('insightsModalTitle').textContent = `Insights: ${content.title || 'Content'}`;
    insightsModal.style.display = 'flex';
  }
  
  // âœ… EDIT CONTENT
  function editContent(contentId) {
    const content = allContent.find(c => c.id === contentId);
    if (!content) return;
    
    currentEditContent = content;
    
    document.getElementById('editContentId').value = content.id;
    document.getElementById('editTitle').value = content.title || '';
    document.getElementById('editDescription').value = content.description || '';
    document.getElementById('editGenre').value = content.genre || '';
    document.getElementById('editStatus').value = content.status || 'draft';
    
    document.getElementById('editModalTitle').textContent = `Edit: ${content.title || 'Content'}`;
    editModal.style.display = 'flex';
  }
  
  // âœ… SAVE EDIT HANDLER
  async function handleSaveEdit() {
    try {
      const contentId = document.getElementById('editContentId').value;
      const title = document.getElementById('editTitle').value.trim();
      const description = document.getElementById('editDescription').value.trim();
      const genre = document.getElementById('editGenre').value;
      const status = document.getElementById('editStatus').value;
      
      if (!title) {
        showToast('Title is required', 'error');
        return;
      }
      
      // Show loading toast
      showToast('Updating content...', 'info');
      
      const { error } = await window.supabaseClient
        .from('Content')
        .update({
          title: title,
          description: description,
          genre: genre,
          status: status,
          updated_at: new Date().toISOString()
        })
        .eq('id', contentId);
      
      if (error) throw error;
      
      // Update local data
      const contentIndex = allContent.findIndex(c => c.id === contentId);
      if (contentIndex !== -1) {
        allContent[contentIndex] = {
          ...allContent[contentIndex],
          title: title,
          description: description,
          genre: genre,
          status: status
        };
      }
      
      // Re-filter and render
      filterContent(selectedFilter);
      
      editModal.style.display = 'none';
      showToast('Content updated successfully!', 'success');
    } catch (error) {
      console.error('Error updating content:', error);
      showToast('Failed to update content', 'error');
    }
  }
  
  // âœ… DELETE CONTENT
  function deleteContent(contentId, contentTitle) {
    currentDeleteId = contentId;
    deleteContentTitle.textContent = contentTitle;
    deleteModal.style.display = 'flex';
  }
  
  // âœ… CONFIRM DELETE
  async function handleConfirmDelete() {
    if (!currentDeleteId) return;
    
    try {
      // Show loading toast
      showToast('Deleting content...', 'info');
      
      const { error } = await window.supabaseClient
        .from('Content')
        .delete()
        .eq('id', currentDeleteId);
      
      if (error) throw error;
      
      // Remove from local arrays
      allContent = allContent.filter(c => c.id !== currentDeleteId);
      filterContent(selectedFilter);
      
      deleteModal.style.display = 'none';
      currentDeleteId = null;
      
      showToast('Content deleted successfully', 'success');
    } catch (error) {
      console.error('Error deleting content:', error);
      showToast('Failed to delete content', 'error');
    }
  }
  
  // âœ… VIEW CONTENT
  function viewContent(contentId) {
    window.location.href = `content-detail.html?id=${contentId}`;
  }
  
  // âœ… SETUP SEARCH MODAL
  function setupSearchModal() {
    if (!searchBtn || !searchModal || !closeSearchBtn) return;
    
    searchBtn.addEventListener('click', () => {
      searchModal.style.display = 'flex';
      setTimeout(() => document.getElementById('modal-search-input')?.focus(), 300);
    });
    
    closeSearchBtn.addEventListener('click', () => {
      searchModal.style.display = 'none';
    });
    
    searchModal.addEventListener('click', (e) => {
      if (e.target === searchModal) {
        searchModal.style.display = 'none';
      }
    });
    
    // Setup search functionality
    const modalSearchInput = document.getElementById('modal-search-input');
    const categoryFilter = document.getElementById('category-filter');
    const sortFilter = document.getElementById('sort-filter');
    
    if (modalSearchInput) {
      modalSearchInput.addEventListener('input', debounce(async () => {
        const query = modalSearchInput.value.trim();
        const category = categoryFilter?.value;
        const sortBy = sortFilter?.value;
        
        if (query.length < 2) {
          document.getElementById('search-results-grid').innerHTML = '<div style="text-align:center;padding:40px;color:var(--slate-grey)">Start typing to search...</div>';
          return;
        }
        
        await performGlobalSearch(query, category, sortBy);
      }, 300));
    }
    
    [categoryFilter, sortFilter].forEach(filter => {
      if (filter) {
        filter.addEventListener('change', async () => {
          const query = modalSearchInput?.value.trim();
          if (query && query.length >= 2) {
            await performGlobalSearch(query, categoryFilter?.value, sortFilter?.value);
          }
        });
      }
    });
  }
  
  // âœ… PERFORM GLOBAL SEARCH
  async function performGlobalSearch(query, category = '', sortBy = 'newest') {
    const resultsGrid = document.getElementById('search-results-grid');
    if (!resultsGrid) return;
    
    resultsGrid.innerHTML = `
      <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;color:var(--slate-grey)">
        <div style="width:40px;height:40px;border:3px solid rgba(255,255,255,0.1);border-radius:50%;border-top-color:var(--warm-gold);animation:spin 1s linear infinite;margin-bottom:15px"></div>
        <div>Searching...</div>
      </div>
    `;
    
    try {
      let queryBuilder = window.supabaseClient
        .from('Content')
        .select('*, user_profiles!user_id(*)')
        .ilike('title', `%${query}%`)
        .eq('status', 'published');
      
      if (category) {
        queryBuilder = queryBuilder.eq('genre', category);
      }
      
      if (sortBy === 'newest') {
        queryBuilder = queryBuilder.order('created_at', { ascending: false });
      }
      
      const { data, error } = await queryBuilder.limit(50);
      
      if (error) throw error;
      
      // Enrich with real counts
      const enriched = await Promise.all(
        (data || []).map(async (item) => {
          const { count } = await window.supabaseClient
            .from('content_views')
            .select('*', { count: 'exact', head: true })
            .eq('content_id', item.id);
          
          return {
            ...item,
            real_views: count || 0
          };
        })
      );
      
      // Additional sorting
      if (sortBy === 'popular') {
        enriched.sort((a, b) => (b.real_views || 0) - (a.real_views || 0));
      } else if (sortBy === 'trending') {
        enriched.sort((a, b) => {
          const aScore = (a.real_views || 0) + ((a.likes_count || 0) * 2);
          const bScore = (b.real_views || 0) + ((b.likes_count || 0) * 2);
          return bScore - aScore;
        });
      }
      
      renderSearchResults(enriched);
    } catch (error) {
      console.error('Search error:', error);
      resultsGrid.innerHTML = '<div style="text-align:center;padding:40px;color:var(--slate-grey)">Error performing search. Please try again.</div>';
    }
  }
  
  // âœ… RENDER SEARCH RESULTS
  function renderSearchResults(results) {
    const grid = document.getElementById('search-results-grid');
    if (!grid) return;
    
    if (!results || results.length === 0) {
      grid.innerHTML = '<div style="text-align:center;padding:40px;color:var(--slate-grey)">No results found. Try different keywords.</div>';
      return;
    }
    
    grid.innerHTML = results.map(item => {
      const creator = item.user_profiles?.full_name || 
                      item.user_profiles?.username || 
                      item.creator || 
                      'Creator';
      const creatorId = item.user_profiles?.id || item.user_id;
      const thumbnailUrl = item.thumbnail_url 
        ? `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${item.thumbnail_url.replace(/^\/+/, '')}`
        : 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=400&h=225&fit=crop';
      
      return `
        <div class="content-card" data-content-id="${item.id}" style="margin-bottom:16px;cursor:pointer;">
          <div style="display:flex;gap:16px;padding:16px;">
            <div style="width:120px;height:80px;border-radius:8px;overflow:hidden;flex-shrink:0;">
              <img src="${thumbnailUrl}" alt="${escapeHtml(item.title)}" style="width:100%;height:100%;object-fit:cover;" onerror="this.src='https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=400&h=225&fit=crop'">
            </div>
            <div style="flex:1;">
              <h4 style="font-size:16px;font-weight:600;margin-bottom:8px;color:var(--soft-white);">${escapeHtml(item.title)}</h4>
              <button class="creator-btn" style="background:linear-gradient(135deg,var(--bantu-blue),var(--warm-gold));color:var(--soft-white);border:none;padding:5px 12px;border-radius:8px;font-size:12px;cursor:pointer;display:inline-flex;align-items:center;gap:5px;margin-bottom:8px;"
                      onclick="event.stopPropagation(); window.location.href='creator-channel.html?id=${creatorId}&name=${encodeURIComponent(creator)}'">
                <i class="fas fa-user"></i>
                ${escapeHtml(creator)}
              </button>
              <div style="display:flex;gap:16px;font-size:12px;color:var(--slate-grey);">
                <span><i class="fas fa-eye" style="color:var(--bantu-blue);margin-right:4px;"></i>${formatNumber(item.real_views || 0)}</span>
                <span><i class="fas fa-heart" style="color:var(--error-color);margin-right:4px;"></i>${formatNumber(item.likes_count || 0)}</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('');
    
    // Add click handlers
    grid.querySelectorAll('.content-card').forEach(card => {
      card.addEventListener('click', (e) => {
        if (e.target.closest('.creator-btn')) return;
        const id = card.dataset.contentId;
        if (id) window.location.href = `content-detail.html?id=${id}`;
      });
    });
  }
  
  // âœ… SETUP NOTIFICATIONS PANEL
  function setupNotificationsPanel() {
    if (!notificationsBtn || !notificationsPanel || !closeNotifications) return;
    
    notificationsBtn.addEventListener('click', () => {
      notificationsPanel.style.display = 'flex';
      loadNotifications();
    });
    
    closeNotifications.addEventListener('click', () => {
      notificationsPanel.style.display = 'none';
    });
    
    document.addEventListener('click', (e) => {
      if (notificationsPanel.style.display === 'flex' &&
          !notificationsPanel.contains(e.target) &&
          !notificationsBtn.contains(e.target)) {
        notificationsPanel.style.display = 'none';
      }
    });
    
    if (markAllReadBtn) {
      markAllReadBtn.addEventListener('click', markAllNotificationsAsRead);
    }
  }
  
  // âœ… DEBOUNCE FUNCTION
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }
  
  // âœ… SETUP EVENT LISTENERS
  function setupEventListeners() {
    // Profile button
    profileBtn.addEventListener('click', async () => {
      const { data: { session } } = await window.supabaseClient.auth.getSession();
      if (session) {
        window.location.href = 'profile.html';
      } else {
        window.location.href = 'login.html?redirect=my-uploads.html';
      }
    });
    
    // Refresh button
    refreshBtn.addEventListener('click', () => {
      loadUserContent();
    });
    
    // Search input
    if (searchInput) {
      searchInput.addEventListener('input', debounce((e) => {
        const query = e.target.value.trim();
        clearSearch.style.display = query ? 'block' : 'none';
        performSearch(query);
      }, 300));
    }
    
    // Clear search
    if (clearSearch) {
      clearSearch.addEventListener('click', () => {
        searchInput.value = '';
        clearSearch.style.display = 'none';
        filterContent(selectedFilter);
      });
    }
    
    // Error state buttons
    retryBtn.addEventListener('click', () => {
      errorState.style.display = 'none';
      initializePage();
    });
    
    backToDashboardBtn.addEventListener('click', () => {
      window.location.href = 'creator-dashboard.html';
    });
    
    // Modal close handlers
    closeDeleteModal.addEventListener('click', () => {
      deleteModal.style.display = 'none';
      currentDeleteId = null;
    });
    
    cancelDelete.addEventListener('click', () => {
      deleteModal.style.display = 'none';
      currentDeleteId = null;
    });
    
    confirmDelete.addEventListener('click', handleConfirmDelete);
    
    closeInsightsModal.addEventListener('click', () => {
      insightsModal.style.display = 'none';
    });
    
    closeEditModal.addEventListener('click', () => {
      editModal.style.display = 'none';
    });
    
    cancelEdit.addEventListener('click', () => {
      editModal.style.display = 'none';
    });
    
    saveEdit.addEventListener('click', handleSaveEdit);
    
    // Close modals when clicking outside
    deleteModal.addEventListener('click', (e) => {
      if (e.target === deleteModal) {
        deleteModal.style.display = 'none';
        currentDeleteId = null;
      }
    });
    
    insightsModal.addEventListener('click', (e) => {
      if (e.target === insightsModal) {
        insightsModal.style.display = 'none';
      }
    });
    
    editModal.addEventListener('click', (e) => {
      if (e.target === editModal) {
        editModal.style.display = 'none';
      }
    });
    
    // Navigation items
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', (e) => {
        if (item.classList.contains('active')) {
          e.preventDefault();
        }
      });
    });
  }
  
  // âœ… INITIALIZE PAGE
  async function initializePage() {
    console.log('ðŸ“¤ Initializing My Uploads Page...');
    
    // Check authentication
    const isAuthenticated = await checkAuthentication();
    if (!isAuthenticated) {
      return;
    }
    
    // Load user content
    await loadUserContent();
    
    // Load notifications
    await loadNotifications();
    
    // Setup modals and panels
    setupSearchModal();
    setupNotificationsPanel();
    
    // Setup event listeners
    setupEventListeners();
    
    console.log('âœ… My Uploads Page initialized successfully');
  }
  
  // Make handlers globally accessible (with unique names)
  window.editContent = editContent;
  window.showContentInsights = showContentInsights;
  window.viewContent = viewContent;
  window.deleteContent = deleteContent;
  
  // Start initialization
  await initializePage();
  
  // Auth state change listener
  window.supabaseClient.auth.onAuthStateChange((event, session) => {
    console.log('Auth state changed:', event);
    
    if (event === 'SIGNED_IN' && session?.user) {
      currentUser = session.user;
      loadUserProfilePicture(currentUser);
      loadUserContent();
      loadNotifications();
      showToast('Welcome back!', 'success');
    } else if (event === 'SIGNED_OUT') {
      currentUser = null;
      document.getElementById('userProfilePlaceholder').innerHTML = `
        <div class="profile-placeholder">
          <i class="fas fa-user"></i>
        </div>
      `;
      updateNotificationBadge(0);
      allContent = [];
      filteredContent = [];
      renderContent();
      showToast('Signed out successfully', 'info');
    }
  });
});
</script>
</body>
</html>
