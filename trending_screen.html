<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trending Now - Bantu Stream Connect</title>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Supabase JS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
/* Color Theme */
:root {
--deep-black: #0A0E12;
--deep-navy: #0F172A;
--soft-white: #F8FAFC;
--slate-grey: #94A3B8;
--bantu-blue: #1D4ED8;
--warm-gold: #F59E0B;
--error-color: #EF4444;
--success-color: #10B981;
}
/* Reset & Base */
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, #001F54 0%, #0A0E3F 50%, #000000 100%);
color: var(--soft-white);
min-height: 100vh;
overflow-x: hidden;
}

/* ‚≠ê NEW: SKELETON LOADERS */
.skeleton {
background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
background-size: 200% 100%;
animation: skeleton-loading 1.5s infinite;
border-radius: 8px;
}
.skeleton-text { height: 16px; margin-bottom: 8px; }
.skeleton-title { height: 20px; margin-bottom: 10px; }
.skeleton-thumbnail { height: 180px; border-radius: 15px; }
.skeleton-avatar { width: 40px; height: 40px; border-radius: 50%; }
@keyframes skeleton-loading {
0% { background-position: 200% 0; }
100% { background-position: -200% 0; }
}

/* Loading Screen */
.loading-screen {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(135deg, #001F54 0%, #0A0E3F 50%, #000000 100%);
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
z-index: 9999;
}
.spinner {
width: 60px;
height: 60px;
border: 4px solid rgba(255, 255, 255, 0.1);
border-radius: 50%;
border-top-color: var(--warm-gold);
animation: spin 1s linear infinite;
margin-bottom: 20px;
}
@keyframes spin { to { transform: rotate(360deg); } }
/* Glassmorphism */
.glassmorphism {
background: rgba(255, 255, 255, 0.05);
backdrop-filter: blur(10px);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 16px;
}
/* Header */
.header-container {
position: relative;
min-height: 30vh;
overflow: hidden;
}
.header-bg {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: radial-gradient(circle at 20% 80%, var(--bantu-blue) 0%, transparent 50%),
radial-gradient(circle at 80% 20%, #8B5CF6 0%, transparent 50%);
opacity: 0.3;
}
.grid-pattern {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
background-size: 30px 30px;
}
.main-header {
position: relative;
padding: 20px;
z-index: 10;
}
.header-content {
display: flex;
justify-content: space-between;
align-items: flex-start;
max-width: 1200px;
margin: 0 auto;
}
.trending-title {
display: flex;
align-items: center;
gap: 15px;
}
.fire-icon {
font-size: 2.5rem;
color: var(--warm-gold);
animation: pulse 2s infinite;
}
@keyframes pulse {
0%, 100% { transform: scale(1); }
50% { transform: scale(1.1); }
}
.title-text {
font-family: 'Orbitron', sans-serif;
font-size: 2.5rem;
font-weight: 900;
background: linear-gradient(135deg, var(--soft-white) 0%, var(--warm-gold) 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
letter-spacing: 2px;
}
.header-actions {
display: flex;
gap: 10px;
}
.icon-btn {
width: 50px;
height: 50px;
border-radius: 50%;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
color: white;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s ease;
font-size: 1.2rem;
}
.icon-btn:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-2px);
}
.refresh-btn {
color: var(--bantu-blue);
animation: rotate 20s linear infinite;
animation-play-state: paused;
}
.refresh-btn:hover { animation-play-state: running; }
@keyframes rotate { to { transform: rotate(360deg); } }

/* ‚≠ê NEW: LOCATION FILTER */
.location-filter {
padding: 10px 20px;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 25px;
color: var(--soft-white);
font-family: 'Inter', sans-serif;
font-size: 0.9rem;
cursor: pointer;
margin-left: 10px;
}
.location-filter:focus {
outline: none;
border-color: var(--warm-gold);
}

/* Filter Chips */
.filter-section {
position: relative;
padding: 20px;
max-width: 1200px;
margin: 0 auto;
}
.filter-container {
display: flex;
gap: 10px;
overflow-x: auto;
padding-bottom: 10px;
scrollbar-width: thin;
scrollbar-color: var(--bantu-blue) transparent;
}
.filter-chip {
padding: 10px 20px;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 25px;
color: var(--soft-white);
font-family: 'Inter', sans-serif;
font-size: 0.9rem;
font-weight: 500;
cursor: pointer;
transition: all 0.3s ease;
white-space: nowrap;
}
.filter-chip:hover {
background: rgba(255, 255, 255, 0.1);
transform: translateY(-2px);
}
.filter-chip.active {
background: var(--warm-gold);
border-color: transparent;
color: var(--deep-black);
font-weight: 600;
}
/* Main Content */
.main-content {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}
.section { margin-bottom: 40px; }
.section-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}
.section-title {
font-family: 'Orbitron', sans-serif;
font-size: 1.8rem;
font-weight: 700;
color: var(--soft-white);
display: flex;
align-items: center;
gap: 10px;
}
.section-icon {
color: var(--warm-gold);
font-size: 1.5rem;
}
.see-all-btn {
padding: 8px 20px;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 10px;
color: var(--bantu-blue);
font-family: 'Orbitron', sans-serif;
font-size: 0.9rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}
.see-all-btn:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateX(5px);
}
/* Featured Card */
.featured-trend-card {
position: relative;
border-radius: 20px;
overflow: hidden;
height: 400px;
margin-bottom: 30px;
}
.featured-bg {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-size: cover;
background-position: center;
transition: transform 0.5s ease;
}
.featured-trend-card:hover .featured-bg { transform: scale(1.05); }
.featured-overlay {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.8) 100%);
display: flex;
flex-direction: column;
justify-content: flex-end;
padding: 30px;
}
.live-badge {
display: inline-block;
padding: 8px 20px;
background: rgba(239, 68, 68, 0.9);
border-radius: 20px;
color: white;
font-weight: 700;
font-size: 0.9rem;
margin-bottom: 20px;
align-self: flex-start;
}
.featured-title {
font-family: 'Orbitron', sans-serif;
font-size: 2.5rem;
font-weight: 800;
color: white;
margin-bottom: 10px;
line-height: 1.2;
}
.featured-creator {
font-size: 1.2rem;
color: var(--warm-gold);
margin-bottom: 10px;
display: flex;
align-items: center;
gap: 8px;
}

/* ‚≠ê NEW: VERIFIED BADGE */
.verified-badge {
color: var(--bantu-blue);
font-size: 1rem;
}

.featured-stats {
display: flex;
gap: 20px;
margin-bottom: 25px;
color: rgba(255, 255, 255, 0.8);
}

/* ‚≠ê NEW: RECENCY TEXT */
.recency-text {
font-size: 0.85rem;
color: var(--slate-grey);
margin-left: 10px;
}

.watch-now-btn {
padding: 15px 40px;
background: linear-gradient(135deg, var(--warm-gold) 0%, #f97316 100%);
border: none;
border-radius: 12px;
color: var(--deep-black);
font-family: 'Inter', sans-serif;
font-size: 1.1rem;
font-weight: 700;
cursor: pointer;
transition: all 0.3s ease;
align-self: flex-start;
}
.watch-now-btn:hover {
transform: translateY(-3px);
box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
}
/* Content Cards */
.content-horizontal-scroll {
display: flex;
gap: 20px;
overflow-x: auto;
padding-bottom: 20px;
scrollbar-width: thin;
scrollbar-color: var(--bantu-blue) transparent;
}
.content-card {
flex: 0 0 300px;
border-radius: 15px;
overflow: hidden;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
transition: all 0.3s ease;
cursor: pointer;
position: relative;
}
.content-card:hover {
transform: translateY(-10px);
box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}
.card-thumbnail {
position: relative;
height: 180px;
overflow: hidden;
background: linear-gradient(135deg, #1D4ED8, #8B5CF6);
}
.card-thumbnail img {
width: 100%;
height: 100%;
object-fit: cover;
transition: transform 0.3s ease;
}
.content-card:hover .card-thumbnail img { transform: scale(1.1); }

/* ‚≠ê NEW: HOVER PREVIEW */
.card-thumbnail video {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
object-fit: cover;
opacity: 0;
transition: opacity 0.3s ease;
pointer-events: none;
}
.content-card:hover .card-thumbnail video {
opacity: 1;
}
.content-card:hover .card-thumbnail img {
opacity: 0;
}

.thumbnail-overlay {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.5) 100%);
}
.card-badges {
position: absolute;
top: 15px;
left: 15px;
display: flex;
gap: 10px;
}

/* ‚≠ê NEW: DURATION BADGE */
.duration-badge {
position: absolute;
bottom: 10px;
right: 10px;
padding: 4px 10px;
background: rgba(0, 0, 0, 0.85);
border-radius: 6px;
color: white;
font-size: 0.75rem;
font-weight: 600;
z-index: 2;
}

.badge {
padding: 5px 12px;
border-radius: 15px;
font-size: 0.8rem;
font-weight: 600;
}
.badge.live { background: rgba(239, 68, 68, 0.9); color: white; }
.badge.upcoming { background: rgba(29, 78, 216, 0.9); color: white; }
.badge.viewers { background: rgba(0, 0, 0, 0.7); color: white; }
.card-content { padding: 20px; }
.card-title {
font-size: 1.1rem;
font-weight: 600;
margin-bottom: 10px;
line-height: 1.3;
display: -webkit-box;
-webkit-line-clamp: 2;
-webkit-box-orient: vertical;
overflow: hidden;
}
.card-creator {
font-size: 0.9rem;
color: var(--slate-grey);
margin-bottom: 10px;
display: flex;
align-items: center;
gap: 6px;
}
.card-stats {
display: flex;
gap: 15px;
font-size: 0.8rem;
color: rgba(255, 255, 255, 0.6);
align-items: center;
}

/* ‚≠ê NEW: CARD ACTION MENU */
.card-actions {
position: absolute;
top: 10px;
right: 10px;
z-index: 10;
}
.action-menu-btn {
width: 36px;
height: 36px;
border-radius: 50%;
background: rgba(0, 0, 0, 0.7);
border: none;
color: white;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.2s ease;
opacity: 0;
}
.content-card:hover .action-menu-btn {
opacity: 1;
}
.action-menu-btn:hover {
background: rgba(255, 255, 255, 0.2);
}
.action-menu-dropdown {
position: absolute;
top: 40px;
right: 0;
background: rgba(15, 23, 42, 0.95);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 12px;
padding: 8px 0;
min-width: 180px;
display: none;
z-index: 100;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
}
.action-menu-dropdown.active {
display: block;
}
.action-menu-item {
padding: 10px 16px;
display: flex;
align-items: center;
gap: 10px;
color: var(--soft-white);
font-size: 0.9rem;
cursor: pointer;
transition: all 0.2s ease;
}
.action-menu-item:hover {
background: rgba(255, 255, 255, 0.1);
}
.action-menu-item i {
width: 20px;
text-align: center;
color: var(--warm-gold);
}

.reminder-btn {
width: 100%;
padding: 10px;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 8px;
color: white;
font-size: 0.9rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin-top: 10px;
}
.reminder-btn:hover { background: rgba(255, 255, 255, 0.2); }
/* Hashtags */
.hashtags-container {
display: flex;
flex-wrap: wrap;
gap: 10px;
margin-top: 15px;
}
.hashtag {
padding: 10px 20px;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 20px;
color: var(--warm-gold);
font-size: 0.9rem;
cursor: pointer;
transition: all 0.3s ease;
}
.hashtag:hover {
background: rgba(245, 158, 11, 0.1);
transform: translateY(-2px);
}
/* Community Gems */
.community-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
gap: 20px;
}
.gem-card {
border-radius: 15px;
overflow: hidden;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
transition: all 0.3s ease;
cursor: pointer;
position: relative;
}
.gem-card:hover {
transform: translateY(-5px);
box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
}
.gem-thumbnail {
height: 160px;
overflow: hidden;
background: linear-gradient(135deg, #1D4ED8, #8B5CF6);
position: relative;
}
.gem-thumbnail img {
width: 100%;
height: 100%;
object-fit: cover;
transition: transform 0.3s ease;
}
.gem-card:hover .gem-thumbnail img { transform: scale(1.1); }
.gem-content { padding: 15px; }

/* ‚≠ê NEW: SHORTS SHELF */
.shorts-section {
margin-bottom: 40px;
}
.shorts-scroll {
display: flex;
gap: 15px;
overflow-x: auto;
padding-bottom: 20px;
scrollbar-width: thin;
scrollbar-color: var(--bantu-blue) transparent;
}
.shorts-card {
flex: 0 0 180px;
border-radius: 15px;
overflow: hidden;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
transition: all 0.3s ease;
cursor: pointer;
position: relative;
}
.shorts-card:hover {
transform: translateY(-5px);
box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
}
.shorts-thumbnail {
height: 320px;
overflow: hidden;
background: linear-gradient(135deg, #1D4ED8, #8B5CF6);
position: relative;
}
.shorts-thumbnail img {
width: 100%;
height: 100%;
object-fit: cover;
transition: transform 0.3s ease;
}
.shorts-card:hover .shorts-thumbnail img { transform: scale(1.1); }
.shorts-overlay {
position: absolute;
bottom: 0;
left: 0;
width: 100%;
padding: 15px;
background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
}
.shorts-title {
font-size: 0.9rem;
font-weight: 600;
margin-bottom: 5px;
display: -webkit-box;
-webkit-line-clamp: 2;
-webkit-box-orient: vertical;
overflow: hidden;
}
.shorts-stats {
font-size: 0.75rem;
color: rgba(255, 255, 255, 0.7);
}
.shorts-badge {
position: absolute;
top: 10px;
left: 10px;
padding: 5px 12px;
background: rgba(239, 68, 68, 0.9);
border-radius: 8px;
color: white;
font-size: 0.7rem;
font-weight: 700;
}

/* Explore All */
.explore-all-section {
text-align: center;
padding: 40px 20px;
}
.explore-btn {
padding: 20px 50px;
background: linear-gradient(135deg, var(--bantu-blue) 0%, #3730a3 100%);
border: none;
border-radius: 15px;
color: white;
font-family: 'Orbitron', sans-serif;
font-size: 1.2rem;
font-weight: 700;
cursor: pointer;
transition: all 0.3s ease;
display: inline-flex;
align-items: center;
gap: 15px;
}
.explore-btn:hover {
transform: translateY(-5px);
box-shadow: 0 15px 30px rgba(29, 78, 216, 0.4);
}

/* ‚≠ê NEW: INFINITE SCROLL LOADER */
.infinite-scroll-loader {
text-align: center;
padding: 40px 20px;
display: none;
}
.infinite-scroll-loader.active {
display: block;
}
.infinite-spinner {
width: 40px;
height: 40px;
border: 3px solid rgba(255, 255, 255, 0.1);
border-radius: 50%;
border-top-color: var(--warm-gold);
animation: spin 1s linear infinite;
margin: 0 auto 15px;
}

/* Toast */
.toast {
position: fixed;
bottom: 20px;
right: 20px;
padding: 15px 25px;
border-radius: 10px;
color: white;
font-weight: 500;
z-index: 1000;
animation: slideIn 0.3s ease;
max-width: 300px;
}
.toast.success { background: linear-gradient(135deg, #51cf66 0%, #2b8a3e 100%); }
.toast.info { background: linear-gradient(135deg, #4dabf7 0%, #748ffc 100%); }
.toast.error { background: linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%); }
@keyframes slideIn {
from { transform: translateX(100%); opacity: 0; }
to { transform: translateX(0); opacity: 1; }
}
/* Navigation */
.global-nav {
position: fixed;
bottom: 0;
left: 0;
width: 100%;
background: rgba(15, 23, 42, 0.95);
backdrop-filter: blur(10px);
display: flex;
justify-content: space-around;
padding: 15px 0;
z-index: 100;
border-top: 1px solid rgba(255, 255, 255, 0.1);
}
.nav-item {
display: flex;
flex-direction: column;
align-items: center;
color: var(--slate-grey);
text-decoration: none;
font-size: 0.8rem;
transition: all 0.3s ease;
}
.nav-item i { font-size: 1.2rem; margin-bottom: 5px; }
.nav-item:hover { color: var(--soft-white); }
.nav-item.active { color: var(--warm-gold); }
/* Auth Modal */
.auth-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
display: none;
align-items: center;
justify-content: center;
z-index: 2000;
backdrop-filter: blur(5px);
}
.auth-modal.active { display: flex; }
.auth-content {
background: rgba(15, 23, 42, 0.9);
border-radius: 20px;
padding: 40px;
max-width: 400px;
width: 90%;
text-align: center;
border: 1px solid rgba(255, 255, 255, 0.1);
}
.auth-icon { font-size: 64px; color: var(--warm-gold); margin-bottom: 20px; }
.auth-title { font-family: 'Orbitron', sans-serif; font-size: 24px; margin-bottom: 15px; }
.auth-message { color: var(--slate-grey); margin-bottom: 30px; line-height: 1.6; }
.auth-buttons { display: flex; gap: 15px; }
.auth-btn {
flex: 1;
padding: 15px;
border-radius: 12px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
border: none;
}
.auth-btn.login {
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
color: var(--soft-white);
}
.auth-btn.login:hover {
transform: translateY(-2px);
box-shadow: 0 4px 15px rgba(29, 78, 216, 0.4);
}
.auth-btn.cancel {
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
color: var(--soft-white);
}
/* Search Modal */
.search-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.9);
display: none;
align-items: center;
justify-content: center;
z-index: 2000;
backdrop-filter: blur(5px);
}
.search-modal.active { display: flex; }
.search-modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
padding-bottom: 15px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
width: 100%;
}
.search-input-container { position: relative; width: 100%; max-width: 600px; }
.search-icon {
position: absolute;
left: 15px;
top: 50%;
transform: translateY(-50%);
color: var(--slate-grey);
font-size: 18px;
}
.search-input {
width: 100%;
padding: 15px 15px 15px 45px;
border-radius: 12px;
border: 1px solid rgba(255, 255, 255, 0.1);
background: rgba(15, 23, 42, 0.7);
color: var(--soft-white);
font-size: 16px;
}
.search-input:focus {
outline: none;
border-color: var(--warm-gold);
box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
}
.close-search-btn {
background: none;
border: none;
color: var(--soft-white);
font-size: 24px;
cursor: pointer;
width: 40px;
height: 40px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.3s ease;
}
.close-search-btn:hover {
background: rgba(255, 255, 255, 0.1);
transform: rotate(90deg);
}
.search-filters {
display: flex;
gap: 15px;
margin-bottom: 20px;
width: 100%;
max-width: 600px;
}
.filter-group { flex: 1; }
.filter-label { display: block; margin-bottom: 8px; font-size: 14px; color: var(--slate-grey); }
.filter-select {
width: 100%;
padding: 12px;
border-radius: 10px;
border: 1px solid rgba(255, 255, 255, 0.1);
background: rgba(15, 23, 42, 0.7);
color: var(--soft-white);
font-size: 14px;
}
.search-results { width: 100%; max-width: 800px; max-height: 70vh; overflow-y: auto; }
.search-results-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
gap: 15px;
}

/* ‚≠ê NEW: SEARCH SUGGESTIONS */
.search-suggestions {
position: absolute;
top: 100%;
left: 0;
width: 100%;
background: rgba(15, 23, 42, 0.95);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 12px;
margin-top: 5px;
max-height: 300px;
overflow-y: auto;
display: none;
z-index: 100;
}
.search-suggestions.active {
display: block;
}
.suggestion-item {
padding: 12px 15px;
display: flex;
align-items: center;
gap: 10px;
color: var(--soft-white);
cursor: pointer;
transition: all 0.2s ease;
}
.suggestion-item:hover {
background: rgba(255, 255, 255, 0.1);
}
.suggestion-item i {
color: var(--warm-gold);
width: 20px;
}

/* Notifications Panel */
.notifications-panel {
position: fixed;
top: 0;
right: -100%;
width: 400px;
height: 100%;
background: rgba(15, 23, 42, 0.9);
border-left: 1px solid rgba(255, 255, 255, 0.1);
box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
z-index: 1000;
transition: right 0.3s ease;
backdrop-filter: blur(10px);
}
.notifications-panel.active { right: 0; }
.notifications-header {
padding: 20px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
display: flex;
justify-content: space-between;
align-items: center;
}
.notifications-list { max-height: calc(100vh - 150px); overflow-y: auto; padding: 20px; }
.notification-item {
padding: 15px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
display: flex;
gap: 12px;
}
.notification-item.read { opacity: 0.7; }
.notification-icon {
width: 40px;
height: 40px;
border-radius: 50%;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
display: flex;
align-items: center;
justify-content: center;
flex-shrink: 0;
}
.notification-content { flex: 1; }
.notification-content h4 { font-weight: 600; margin-bottom: 5px; }
.notification-content p { font-size: 14px; color: var(--slate-grey); margin-bottom: 8px; }
.notification-time { font-size: 12px; color: var(--warm-gold); }
.notification-dot {
width: 10px;
height: 10px;
border-radius: 50%;
background: var(--warm-gold);
position: absolute;
top: 15px;
right: 15px;
}
.notifications-footer {
padding: 20px;
border-top: 1px solid rgba(255, 255, 255, 0.1);
display: flex;
gap: 15px;
}
.text-btn {
flex: 1;
padding: 12px;
border-radius: 10px;
border: 1px solid rgba(255, 255, 255, 0.1);
background: rgba(255, 255, 255, 0.05);
color: var(--soft-white);
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}
.text-btn:hover {
background: rgba(245, 158, 11, 0.1);
border-color: var(--warm-gold);
}
/* Profile Button */
.profile-btn {
width: 50px;
height: 50px;
border-radius: 50%;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
border: 2px solid rgba(255, 255, 255, 0.2);
cursor: pointer;
overflow: hidden;
transition: all 0.3s ease;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-weight: 600;
font-size: 18px;
}
.profile-btn:hover {
transform: translateY(-2px);
box-shadow: 0 8px 20px rgba(29, 78, 216, 0.3);
}
.profile-img { width: 100%; height: 100%; object-fit: cover; }
.profile-placeholder {
width: 100%;
height: 100%;
display: flex;
align-items: center;
justify-content: center;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
color: white;
font-size: 20px;
font-weight: bold;
}
/* Responsive */
@media (max-width: 768px) {
.title-text { font-size: 1.8rem; }
.fire-icon { font-size: 2rem; }
.featured-trend-card { height: 300px; }
.featured-title { font-size: 1.8rem; }
.content-card { flex: 0 0 250px; }
.community-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
.shorts-card { flex: 0 0 140px; }
.shorts-thumbnail { height: 250px; }
}
@media (max-width: 480px) {
.title-text { font-size: 1.5rem; }
.featured-trend-card { height: 250px; }
.featured-title { font-size: 1.5rem; }
.content-card { flex: 0 0 200px; }
.community-grid { grid-template-columns: 1fr; }
.shorts-card { flex: 0 0 120px; }
.shorts-thumbnail { height: 215px; }
.header-actions { gap: 5px; }
.icon-btn { width: 45px; height: 45px; font-size: 1rem; }
}
</style>
</head>
<body>
<!-- Loading Screen -->
<div id="loading" class="loading-screen">
<div class="spinner"></div>
<div id="loading-text">Loading Trending Content...</div>
</div>
<!-- Auth Modal -->
<div id="auth-modal" class="auth-modal">
<div class="auth-content">
<div class="auth-icon"><i class="fas fa-lock"></i></div>
<h2 class="auth-title">Authentication Required</h2>
<p class="auth-message">You need to be logged in to view trending content.</p>
<div class="auth-buttons">
<button id="auth-login-btn" class="auth-btn login">Log In</button>
<button id="auth-cancel-btn" class="auth-btn cancel">Cancel</button>
</div>
</div>
</div>
<!-- Search Modal -->
<div id="search-modal" class="search-modal">
<div style="width: 90%; max-width: 800px; background: rgba(15, 23, 42, 0.9); border-radius: 20px; padding: 30px;">
<div class="search-modal-header">
<div class="search-input-container">
<i class="search-icon fas fa-search"></i>
<input type="text" id="search-input" class="search-input" placeholder="Search content..." autocomplete="off">
<div id="search-suggestions" class="search-suggestions"></div>
</div>
<button id="close-search-btn" class="close-search-btn"><i class="fas fa-times"></i></button>
</div>
<div class="search-filters">
<div class="filter-group">
<label class="filter-label">Category</label>
<select id="category-filter" class="filter-select">
<option value="">All Categories</option>
<option value="Music">Music</option>
<option value="STEM">STEM</option>
<option value="Culture">Culture</option>
<option value="News">News</option>
<option value="Sports">Sports</option>
<option value="Movies">Movies</option>
<option value="Documentaries">Documentaries</option>
<option value="Podcasts">Podcasts</option>
</select>
</div>
<div class="filter-group">
<label class="filter-label">Sort By</label>
<select id="sort-filter" class="filter-select">
<option value="newest">Newest First</option>
<option value="popular">Most Popular</option>
<option value="trending">Trending</option>
</select>
</div>
</div>
<div class="search-results">
<div id="search-results-grid" class="search-results-grid"></div>
</div>
</div>
</div>
<!-- Notifications Panel -->
<div id="notifications-panel" class="notifications-panel">
<div class="notifications-header">
<h2 style="font-family: 'Orbitron', sans-serif; font-size: 20px; margin: 0;">Notifications</h2>
<button id="close-notifications" class="close-search-btn"><i class="fas fa-times"></i></button>
</div>
<div class="notifications-list" id="notifications-list"></div>
<div class="notifications-footer">
<button id="mark-all-read" class="text-btn">Mark all as read</button>
<button id="notification-settings" class="text-btn">Settings</button>
</div>
</div>
<!-- Main App -->
<div id="app" style="display: none;">
<div class="header-container">
<div class="header-bg"></div>
<div class="grid-pattern"></div>
<header class="main-header">
<div class="header-content">
<div class="trending-title">
<div class="fire-icon">üî•</div>
<h1 class="title-text">TRENDING NOW</h1>
</div>
<div class="header-actions">
<!-- ‚≠ê NEW: LOCATION FILTER -->
<select id="location-filter" class="location-filter">
<option value="global">üåç Global</option>
<option value="ZA">üáøüá¶ South Africa</option>
<option value="NG">üá≥üá¨ Nigeria</option>
<option value="KE">üá∞üá™ Kenya</option>
<option value="GH">üá¨üá≠ Ghana</option>
<option value="US">üá∫üá∏ USA</option>
<option value="UK">üá¨üáß UK</option>
</select>
<button id="search-btn" class="icon-btn" title="Search"><i class="fas fa-search"></i></button>
<button id="refresh-btn" class="icon-btn refresh-btn" title="Refresh"><i class="fas fa-sync-alt"></i></button>
<button id="notifications-btn" class="icon-btn" title="Notifications">
<i class="fas fa-bell"></i>
<span class="notification-badge" id="notification-count" style="display: none; position: absolute; top: -5px; right: -5px; background: var(--error-color); color: white; font-size: 10px; font-weight: bold; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid var(--deep-black);">0</span>
</button>
<button id="profile-btn" class="profile-btn" title="Profile">
<div class="profile-placeholder" id="userProfilePlaceholder"><i class="fas fa-user"></i></div>
</button>
</div>
</div>
</header>
<div class="filter-section">
<div id="filter-container" class="filter-container"></div>
</div>
</div>
<main class="main-content">
<div id="trending-sections"></div>

<!-- ‚≠ê NEW: SHORTS SECTION -->
<div id="shorts-section" class="shorts-section" style="display: none;">
<div class="section-header">
<h2 class="section-title"><i class="fas fa-bolt section-icon"></i>BANTU SHORTS</h2>
<button class="see-all-btn" onclick="viewAllShorts()">SEE ALL</button>
</div>
<div class="shorts-scroll" id="shorts-scroll"></div>
</div>

<div class="explore-all-section">
<button id="explore-all-btn" class="explore-btn">
EXPLORE ALL TRENDING CONTENT
<i class="fas fa-arrow-right"></i>
</button>
</div>

<!-- ‚≠ê NEW: INFINITE SCROLL LOADER -->
<div id="infinite-scroll-loader" class="infinite-scroll-loader">
<div class="infinite-spinner"></div>
<p style="color: var(--slate-grey);">Loading more content...</p>
</div>

</main>
<nav class="global-nav">
<a href="index.html" class="nav-item"><i class="fas fa-home"></i>Home</a>
<a href="trending_screen.html" class="nav-item active"><i class="fas fa-fire"></i>Trending</a>
<a href="content-library.html" class="nav-item"><i class="fas fa-th-large"></i>Library</a>
<a href="creator-dashboard.html" class="nav-item"><i class="fas fa-user"></i>Creator</a>
</nav>
</div>
<!-- Toast Container -->
<div id="toast-container"></div>
<!-- Initialize Supabase -->
<script>
if (!window.supabaseClient) {
window.supabaseClient = supabase.createClient(
'https://ydnxqnbjoshvxteevemc.supabase.co',
'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U'
);
console.log('‚úÖ Supabase client initialized');
}
</script>
<!-- Main JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
console.log('üî• Trending Screen Initializing...');
// DOM Elements
var loadingScreen = document.getElementById('loading');
var loadingText = document.getElementById('loading-text');
var app = document.getElementById('app');
var authModal = document.getElementById('auth-modal');
var filterContainer = document.getElementById('filter-container');
var trendingSections = document.getElementById('trending-sections');
var shortsSection = document.getElementById('shorts-section');
var shortsScroll = document.getElementById('shorts-scroll');
var searchBtn = document.getElementById('search-btn');
var refreshBtn = document.getElementById('refresh-btn');
var notificationsBtn = document.getElementById('notifications-btn');
var profileBtn = document.getElementById('profile-btn');
var exploreAllBtn = document.getElementById('explore-all-btn');
var authLoginBtn = document.getElementById('auth-login-btn');
var authCancelBtn = document.getElementById('auth-cancel-btn');
var locationFilter = document.getElementById('location-filter');
var infiniteScrollLoader = document.getElementById('infinite-scroll-loader');
// State
var currentUser = null;
var allContentData = [];
var featuredTrend = [];
var liveStreams = [];
var communityGems = [];
var shortsContent = [];
var trendingHashtags = [];
var selectedFilter = 'All';
var notifications = [];
var filters = ['All', 'Music', 'Film & Series', 'Podcasts', 'Gaming', 'Comedy', 'Live', 'Top 24 Hrs', 'Rising Creators'];

// ‚≠ê NEW: INFINITE SCROLL STATE
var isLoadingMore = false;
var contentOffset = 100;
var hasMoreContent = true;
var contentLimit = 50;

// ‚≠ê NEW: SEARCH DEBOUNCE
var searchDebounceTimer = null;

// ‚úÖ LOADING STATE
function setLoading(loading, text) {
if (text && loadingText) loadingText.textContent = text;
if (loading) {
if (loadingScreen) loadingScreen.style.display = 'flex';
if (app) app.style.display = 'none';
} else {
setTimeout(function() {
if (loadingScreen) loadingScreen.style.display = 'none';
if (app) app.style.display = 'block';
}, 500);
}
}
// ‚úÖ TOAST
function showToast(message, type) {
type = type || 'info';
var toast = document.createElement('div');
toast.className = 'toast ' + type;
toast.textContent = message;
var container = document.getElementById('toast-container');
if (container) {
container.appendChild(toast);
setTimeout(function() {
toast.style.opacity = '0';
toast.style.transform = 'translateX(100%)';
setTimeout(function() { toast.remove(); }, 300);
}, 3000);
}
}
// ‚úÖ FORMAT NUMBERS
function formatNumber(num) {
if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
return num.toString();
}
// ‚úÖ FORMAT DURATION
function formatDuration(seconds) {
if (!seconds) return '0:00';
var hrs = Math.floor(seconds / 3600);
var mins = Math.floor((seconds % 3600) / 60);
var secs = Math.floor(seconds % 60);
if (hrs > 0) {
return hrs + ':' + (mins < 10 ? '0' : '') + mins + ':' + (secs < 10 ? '0' : '') + secs;
}
return mins + ':' + (secs < 10 ? '0' : '') + secs;
}
// ‚úÖ GET INITIALS
function getInitials(email) {
if (!email) return 'U';
return email.split('@')[0].substring(0, 2).toUpperCase();
}
function getInitialsFromName(fullName) {
if (!fullName) return 'U';
var names = fullName.split(' ');
return names.length >= 2
? (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase()
: fullName.charAt(0).toUpperCase();
}
// ‚úÖ BUILD THUMBNAIL URL WITH FALLBACKS
function buildThumbnailUrl(thumbnailPath) {
var fallbackImages = [
'https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&h=450&fit=crop',
'https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?w=800&h=450&fit=crop',
'https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=800&h=450&fit=crop',
'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=800&h=450&fit=crop'
];
if (!thumbnailPath || thumbnailPath.trim() === '') {
return fallbackImages[0];
}
var cleanPath = thumbnailPath.replace(/^\/+/, '');
if (thumbnailPath.startsWith('http')) {
return thumbnailPath;
}
return 'https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/' + cleanPath;
}
// ‚úÖ LOAD PROFILE PICTURE
function loadUserProfilePicture(user) {
return window.supabaseClient
.from('user_profiles')
.select('*')
.eq('id', user.id)
.maybeSingle()
.then(function(response) {
var profile = response.data;
var profileError = response.error;
var placeholder = document.getElementById('userProfilePlaceholder');
if (!placeholder) return;
while (placeholder.firstChild) {
placeholder.removeChild(placeholder.firstChild);
}
var userInitials = getInitials(user.email);
if (profileError || !profile) {
var fallback = document.createElement('div');
fallback.className = 'profile-placeholder';
fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
fallback.textContent = userInitials;
placeholder.appendChild(fallback);
return;
}
var displayName = profile.full_name || profile.username || user.email || 'User';
var initial = getInitialsFromName(displayName);
if (profile.avatar_url) {
var avatarUrl = buildThumbnailUrl(profile.avatar_url);
var img = document.createElement('img');
img.className = 'profile-img';
img.alt = displayName;
img.style.cssText = 'width: 100%; height: 100%; border-radius: 50%; object-fit: cover;';
img.src = avatarUrl;
img.onerror = function() {
var fallback = document.createElement('div');
fallback.className = 'profile-placeholder';
fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
fallback.textContent = initial;
placeholder.innerHTML = '';
placeholder.appendChild(fallback);
};
placeholder.appendChild(img);
} else {
var fallback = document.createElement('div');
fallback.className = 'profile-placeholder';
fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
fallback.textContent = initial;
placeholder.appendChild(fallback);
}
})
.catch(function(error) {
console.error('Error loading profile:', error);
});
}
// ‚úÖ CHECK AUTHENTICATION
function checkAuthentication() {
setLoading(true, 'Checking authentication...');
return window.supabaseClient.auth.getSession()
.then(function(sessionResponse) {
var session = sessionResponse.data.session;
var error = sessionResponse.error;
if (error || !session || !session.user) {
console.log('‚ö†Ô∏è User not authenticated');
showToast('Please sign in to access trending content', 'error');
if (authModal) authModal.classList.add('active');
setLoading(false);
return false;
}
currentUser = session.user;
console.log('‚úÖ User authenticated:', currentUser.email);
return loadUserProfilePicture(currentUser)
.then(function() {
return loadNotifications();
})
.then(function() {
return true;
});
})
.catch(function(error) {
console.error('‚ùå Authentication error:', error);
setLoading(false);
return false;
});
}
// ‚úÖ LOAD NOTIFICATIONS
function loadNotifications() {
if (!currentUser) {
updateNotificationBadge(0);
return Promise.resolve();
}
return window.supabaseClient
.from('notifications')
.select('*')
.eq('user_id', currentUser.id)
.order('created_at', { ascending: false })
.limit(20)
.then(function(response) {
var data = response.data;
var error = response.error;
if (error) throw error;
notifications = data || [];
var unreadCount = notifications.filter(function(n) { return !n.is_read; }).length;
updateNotificationBadge(unreadCount);
renderNotifications();
})
.catch(function(error) {
console.error('Error loading notifications:', error);
updateNotificationBadge(0);
});
}
// ‚úÖ UPDATE NOTIFICATION BADGE
function updateNotificationBadge(count) {
if (count === null || count === undefined) {
count = notifications.filter(function(n) { return !n.is_read; }).length;
}
var badge = document.getElementById('notification-count');
if (badge) {
badge.textContent = count > 99 ? '99+' : count;
badge.style.display = count > 0 ? 'flex' : 'none';
}
}
// ‚úÖ RENDER NOTIFICATIONS
function renderNotifications() {
var notificationsList = document.getElementById('notifications-list');
if (!notificationsList) return;
if (!currentUser) {
notificationsList.innerHTML = '<div style="text-align:center;padding:40px 20px;color:var(--slate-grey)"><i class="fas fa-bell-slash" style="font-size:48px;margin-bottom:15px;opacity:0.5"></i><p>Sign in to see notifications</p></div>';
return;
}
if (!notifications || notifications.length === 0) {
notificationsList.innerHTML = '<div style="text-align:center;padding:40px 20px;color:var(--slate-grey)"><i class="fas fa-bell" style="font-size:48px;margin-bottom:15px;opacity:0.3"></i><p>No notifications yet</p></div>';
return;
}
var html = notifications.map(function(notification) {
return '<div class="notification-item ' + (notification.is_read ? 'read' : 'unread') + '" data-id="' + notification.id + '">' +
'<div class="notification-icon"><i class="' + getNotificationIcon(notification.type) + '" style="color:white"></i></div>' +
'<div class="notification-content">' +
'<h4>' + escapeHtml(notification.title) + '</h4>' +
'<p>' + escapeHtml(notification.message) + '</p>' +
'<span class="notification-time">' + formatNotificationTime(notification.created_at) + '</span>' +
'</div>' +
(!notification.is_read ? '<div class="notification-dot"></div>' : '') +
'</div>';
}).join('');
notificationsList.innerHTML = html;
var items = notificationsList.querySelectorAll('.notification-item');
items.forEach(function(item) {
item.addEventListener('click', function() {
var id = item.dataset.id;
markNotificationAsRead(id)
.then(function() {
var panel = document.getElementById('notifications-panel');
if (panel) panel.classList.remove('active');
});
});
});
}
function getNotificationIcon(type) {
switch(type) {
case 'like': return 'fas fa-heart';
case 'comment': return 'fas fa-comment';
case 'follow': return 'fas fa-user-plus';
case 'view_milestone': return 'fas fa-trophy';
case 'system': return 'fas fa-bell';
default: return 'fas fa-bell';
}
}
function formatNotificationTime(timestamp) {
if (!timestamp) return 'Just now';
var diffMs = Date.now() - new Date(timestamp).getTime();
var diffMins = Math.floor(diffMs / 60000);
var diffHours = Math.floor(diffMs / 3600000);
var diffDays = Math.floor(diffMs / 86400000);
if (diffMins < 1) return 'Just now';
if (diffMins < 60) return diffMins + 'm ago';
if (diffHours < 24) return diffHours + 'h ago';
if (diffDays < 7) return diffDays + 'd ago';
return new Date(timestamp).toLocaleDateString();
}
function escapeHtml(text) {
if (!text) return '';
var div = document.createElement('div');
div.textContent = text;
return div.innerHTML;
}
function markNotificationAsRead(notificationId) {
return window.supabaseClient
.from('notifications')
.update({ is_read: true })
.eq('id', notificationId)
.then(function() {
var item = document.querySelector('.notification-item[data-id="' + notificationId + '"]');
if (item) {
item.classList.remove('unread');
item.classList.add('read');
var dot = item.querySelector('.notification-dot');
if (dot) dot.remove();
}
return loadNotifications();
})
.catch(function(error) {
console.error('Error marking notification as read:', error);
});
}
function markAllNotificationsAsRead() {
if (!currentUser) return Promise.resolve();
return window.supabaseClient
.from('notifications')
.update({ is_read: true })
.eq('user_id', currentUser.id)
.eq('is_read', false)
.then(function() {
var items = document.querySelectorAll('.notification-item.unread');
items.forEach(function(item) {
item.classList.remove('unread');
item.classList.add('read');
var dot = item.querySelector('.notification-dot');
if (dot) dot.remove();
});
updateNotificationBadge(0);
showToast('All notifications marked as read', 'success');
})
.catch(function(error) {
console.error('Error marking all as read:', error);
});
}

// ‚≠ê NEW: SKELETON CARDS
function renderSkeletonCards(count, type) {
var html = '';
if (type === 'horizontal') {
for (var i = 0; i < count; i++) {
html += '<div class="content-card">' +
'<div class="card-thumbnail skeleton skeleton-thumbnail"></div>' +
'<div class="card-content">' +
'<div class="skeleton skeleton-title"></div>' +
'<div class="skeleton skeleton-text" style="width: 60%"></div>' +
'<div class="skeleton skeleton-text" style="width: 40%"></div>' +
'</div>' +
'</div>';
}
} else if (type === 'grid') {
for (var i = 0; i < count; i++) {
html += '<div class="gem-card">' +
'<div class="gem-thumbnail skeleton skeleton-thumbnail"></div>' +
'<div class="gem-content">' +
'<div class="skeleton skeleton-title"></div>' +
'<div class="skeleton skeleton-text" style="width: 60%"></div>' +
'<div class="skeleton skeleton-text" style="width: 40%"></div>' +
'</div>' +
'</div>';
}
} else if (type === 'shorts') {
for (var i = 0; i < count; i++) {
html += '<div class="shorts-card">' +
'<div class="shorts-thumbnail skeleton skeleton-thumbnail"></div>' +
'</div>';
}
}
return html;
}

// ‚úÖ FETCH CONTENT
function fetchContent(offset = 0, limit = 100) {
console.log('üîÑ Fetching trending content...', offset, limit);
return window.supabaseClient
.from('Content')
.select('*, user_profiles!user_id(*)')
.eq('status', 'published')
.order('created_at', { ascending: false })
.range(offset, offset + limit - 1)
.then(function(response) {
var contentData = response.data;
var error = response.error;
if (error) {
console.log('‚ö†Ô∏è Trying lowercase content table...');
return window.supabaseClient
.from('content')
.select('*, user_profiles!user_id(*)')
.eq('status', 'published')
.order('created_at', { ascending: false })
.range(offset, offset + limit - 1);
}
return response;
})
.then(function(response) {
var contentData = response.data || [];
console.log('‚úÖ Fetched content:', contentData.length, 'items');
// Enrich with view counts
var enrichPromises = contentData.map(function(item) {
return window.supabaseClient
.from('content_views')
.select('*', { count: 'exact', head: true })
.eq('content_id', item.id)
.then(function(viewsResponse) {
var viewsCount = viewsResponse.count || 0;
return {
...item,
real_views: viewsCount,
is_live: item.is_live || false,
viewer_count: item.viewer_count || viewsCount,
is_new: isContentNew(item.created_at),
duration: item.duration || 0
};
});
});
return Promise.all(enrichPromises);
})
.catch(function(error) {
console.error('‚ùå Error fetching content:', error);
showToast('Failed to load content. Please refresh.', 'error');
return [];
});
}
function isContentNew(createdAt) {
if (!createdAt) return false;
try {
var createdDate = new Date(createdAt);
var daysAgo = (Date.now() - createdDate.getTime()) / (1000 * 60 * 60 * 24);
return daysAgo < 7;
} catch (e) {
return false;
}
}
// ‚úÖ PROCESS SECTIONS
function processTrendingSections(contentData) {
allContentData = contentData;
featuredTrend = contentData.slice().sort(function(a, b) {
return (b.real_views || 0) - (a.real_views || 0);
}).slice(0, 1);
liveStreams = contentData.filter(function(item) { return item.is_live; }).slice(0, 10);

// ‚≠ê NEW: SHORTS CONTENT (duration < 60 seconds)
shortsContent = contentData.filter(function(item) {
return (item.duration || 0) < 60 && !item.is_live;
}).slice(0, 15);

communityGems = contentData.slice().sort(function(a, b) {
var aScore = (a.real_views || 0) + ((a.likes_count || 0) * 2);
var bScore = (b.real_views || 0) + ((b.likes_count || 0) * 2);
return bScore - aScore;
}).slice(0, 20);
trendingHashtags = ['#OwnYourStage', '#BantuFuture', '#1MinComedy', '#SofaTalks', '#JoburgVibes', '#AfricanTalent', '#StreamConnect', '#RisingStars'];
console.log('‚úÖ Processed sections:', { featured: featuredTrend.length, live: liveStreams.length, gems: communityGems.length, shorts: shortsContent.length });
}
// ‚úÖ RENDER FILTER CHIPS
function renderFilterChips() {
if (!filterContainer) return;
var html = filters.map(function(filter) {
return '<button class="filter-chip ' + (filter === selectedFilter ? 'active' : '') + '" data-filter="' + filter + '">' + filter.toUpperCase() + '</button>';
}).join('');
filterContainer.innerHTML = html;
var buttons = filterContainer.querySelectorAll('.filter-chip');
buttons.forEach(function(button) {
button.addEventListener('click', function() {
var filter = button.dataset.filter;
onFilterSelected(filter);
});
});
}
// ‚úÖ RENDER SECTIONS
function renderTrendingSections() {
if (!trendingSections) return;
var html = '';
if (featuredTrend.length > 0) {
html += '<section class="section">' +
'<div class="section-header">' +
'<h2 class="section-title"><i class="fas fa-rocket section-icon"></i>THE PULSE</h2>' +
'<button class="see-all-btn" onclick="viewAllTrending()">SEE ALL</button>' +
'</div>' +
renderFeaturedTrend() +
'</section>';
}
if (liveStreams.length > 0) {
html += '<section class="section">' +
'<div class="section-header">' +
'<h2 class="section-title"><i class="fas fa-tv section-icon"></i>LIVE STREAMS</h2>' +
'<button class="see-all-btn" onclick="viewAllLiveStreams()">SEE ALL</button>' +
'</div>' +
'<div class="content-horizontal-scroll">' + renderLiveStreams() + '</div>' +
'</section>';
}
if (trendingHashtags.length > 0) {
html += '<section class="section">' +
'<div class="section-header">' +
'<h2 class="section-title"><i class="fas fa-fire section-icon"></i>TRENDING TOPICS</h2>' +
'</div>' +
'<div class="hashtags-container">' + renderTrendingHashtags() + '</div>' +
'</section>';
}
if (communityGems.length > 0) {
html += '<section class="section">' +
'<div class="section-header">' +
'<h2 class="section-title"><i class="fas fa-gem section-icon"></i>COMMUNITY GEMS</h2>' +
'<button class="see-all-btn" onclick="viewAllCommunityGems()">SEE ALL</button>' +
'</div>' +
'<div class="community-grid">' + renderCommunityGems() + '</div>' +
'</section>';
}
trendingSections.innerHTML = html;

// ‚≠ê NEW: RENDER SHORTS
if (shortsContent.length > 0) {
shortsScroll.innerHTML = renderShorts();
shortsSection.style.display = 'block';
} else {
shortsSection.style.display = 'none';
}

setupContentCardListeners();
}
// ‚úÖ RENDER FEATURED (WITH FIXED IMAGES)
function renderFeaturedTrend() {
if (featuredTrend.length === 0) return '';
var content = featuredTrend[0];
var thumbnailUrl = buildThumbnailUrl(content.thumbnail_url);
var creatorName = content.user_profiles ? content.user_profiles.username : 'Creator';
var isVerified = content.user_profiles && content.user_profiles.is_verified;
var verifiedBadge = isVerified ? '<i class="fas fa-check-circle verified-badge"></i>' : '';
var recencyText = '<span class="recency-text">' + formatNotificationTime(content.created_at) + '</span>';
return '<div class="featured-trend-card" data-content-id="' + content.id + '">' +
'<div class="featured-bg" style="background-image: url(\'' + thumbnailUrl + '\')"></div>' +
'<div class="featured-overlay">' +
(content.is_live ? '<div class="live-badge">LIVE NOW</div>' : '') +
'<h2 class="featured-title">' + escapeHtml(content.title) + '</h2>' +
'<div class="featured-creator">@' + escapeHtml(creatorName) + verifiedBadge + recencyText + '</div>' +
'<div class="featured-stats">' +
'<span><i class="fas fa-eye"></i> ' + formatNumber(content.real_views || 0) + ' views</span>' +
'</div>' +
'<button class="watch-now-btn" onclick="playContent(\'' + content.id + '\')">' + (content.is_live ? 'WATCH LIVE' : 'WATCH NOW') + '</button>' +
'</div>' +
'</div>';
}
// ‚úÖ RENDER LIVE STREAMS (WITH FIXED IMAGES)
function renderLiveStreams() {
return liveStreams.map(function(content) {
var thumbnailUrl = buildThumbnailUrl(content.thumbnail_url);
var isUpcoming = content.scheduled_time && new Date(content.scheduled_time) > new Date();
var creatorName = content.user_profiles ? content.user_profiles.username : 'Creator';
var isVerified = content.user_profiles && content.user_profiles.is_verified;
var verifiedBadge = isVerified ? '<i class="fas fa-check-circle verified-badge"></i>' : '';
var fallbackImg = 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&h=450&fit=crop';
var duration = content.duration ? formatDuration(content.duration) : 'LIVE';
var recencyText = formatNotificationTime(content.created_at);
return '<div class="content-card" data-content-id="' + content.id + '">' +
'<div class="card-thumbnail">' +
'<img src="' + thumbnailUrl + '" alt="' + escapeHtml(content.title) + '" loading="lazy" onerror="this.src=\'' + fallbackImg + '\'">' +
'<div class="thumbnail-overlay"></div>' +
'<div class="card-badges">' +
(isUpcoming ? '<div class="badge upcoming">UPCOMING</div>' : '<div class="badge live">LIVE</div>') +
'<div class="badge viewers"><i class="fas fa-eye"></i> ' + formatNumber(content.viewer_count || 0) + '</div>' +
'</div>' +
'<div class="duration-badge">' + duration + '</div>' +
'<!-- ‚≠ê NEW: CARD ACTION MENU -->' +
'<div class="card-actions">' +
'<button class="action-menu-btn" onclick="toggleActionMenu(event, \'' + content.id + '\')"><i class="fas fa-ellipsis-vertical"></i></button>' +
'<div class="action-menu-dropdown" id="action-menu-' + content.id + '">' +
'<div class="action-menu-item" onclick="saveToWatchLater(\'' + content.id + '\')"><i class="fas fa-clock"></i> Save to Watch Later</div>' +
'<div class="action-menu-item" onclick="shareContent(\'' + content.id + '\')"><i class="fas fa-share"></i> Share</div>' +
'<div class="action-menu-item" onclick="notInterested(\'' + content.id + '\')"><i class="fas fa-thumbs-down"></i> Not Interested</div>' +
'</div>' +
'</div>' +
'</div>' +
'<div class="card-content">' +
'<h3 class="card-title">' + escapeHtml(content.title) + '</h3>' +
'<div class="card-creator">@' + escapeHtml(creatorName) + verifiedBadge + ' <span class="recency-text">‚Ä¢ ' + recencyText + '</span></div>' +
'<div class="card-stats">' +
'<span><i class="fas fa-heart"></i> ' + formatNumber(content.likes_count || 0) + '</span>' +
'</div>' +
(isUpcoming ? '<button class="reminder-btn" onclick="setReminder(\'' + content.id + '\')"><i class="fas fa-bell"></i> REMIND ME</button>' : '') +
'</div>' +
'</div>';
}).join('');
}
// ‚úÖ RENDER COMMUNITY GEMS (WITH FIXED IMAGES)
function renderCommunityGems() {
return communityGems.map(function(content) {
var thumbnailUrl = buildThumbnailUrl(content.thumbnail_url);
var creatorName = content.user_profiles ? content.user_profiles.username : 'Creator';
var isVerified = content.user_profiles && content.user_profiles.is_verified;
var verifiedBadge = isVerified ? '<i class="fas fa-check-circle verified-badge"></i>' : '';
var fallbackImg = 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&h=450&fit=crop';
var duration = content.duration ? formatDuration(content.duration) : '';
var recencyText = formatNotificationTime(content.created_at);
return '<div class="gem-card" data-content-id="' + content.id + '">' +
'<div class="gem-thumbnail">' +
'<img src="' + thumbnailUrl + '" alt="' + escapeHtml(content.title) + '" loading="lazy" onerror="this.src=\'' + fallbackImg + '\'">' +
(duration ? '<div class="duration-badge">' + duration + '</div>' : '') +
'<!-- ‚≠ê NEW: CARD ACTION MENU -->' +
'<div class="card-actions">' +
'<button class="action-menu-btn" onclick="toggleActionMenu(event, \'' + content.id + '\')"><i class="fas fa-ellipsis-vertical"></i></button>' +
'<div class="action-menu-dropdown" id="action-menu-' + content.id + '">' +
'<div class="action-menu-item" onclick="saveToWatchLater(\'' + content.id + '\')"><i class="fas fa-clock"></i> Save to Watch Later</div>' +
'<div class="action-menu-item" onclick="shareContent(\'' + content.id + '\')"><i class="fas fa-share"></i> Share</div>' +
'<div class="action-menu-item" onclick="notInterested(\'' + content.id + '\')"><i class="fas fa-thumbs-down"></i> Not Interested</div>' +
'</div>' +
'</div>' +
'</div>' +
'<div class="gem-content">' +
'<h3 class="card-title">' + escapeHtml(content.title) + '</h3>' +
'<div class="card-creator">@' + escapeHtml(creatorName) + verifiedBadge + ' <span class="recency-text">‚Ä¢ ' + recencyText + '</span></div>' +
'<div class="card-stats">' +
'<span><i class="fas fa-eye"></i> ' + formatNumber(content.real_views || 0) + '</span>' +
'<span><i class="fas fa-heart"></i> ' + formatNumber(content.likes_count || 0) + '</span>' +
'</div>' +
'</div>' +
'</div>';
}).join('');
}

// ‚≠ê NEW: RENDER SHORTS
function renderShorts() {
return shortsContent.map(function(content) {
var thumbnailUrl = buildThumbnailUrl(content.thumbnail_url);
var fallbackImg = 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&h=450&fit=crop';
var duration = content.duration ? formatDuration(content.duration) : '0:59';
return '<div class="shorts-card" data-content-id="' + content.id + '">' +
'<div class="shorts-thumbnail">' +
'<img src="' + thumbnailUrl + '" alt="' + escapeHtml(content.title) + '" loading="lazy" onerror="this.src=\'' + fallbackImg + '\'">' +
'<div class="shorts-badge">SHORTS</div>' +
'<div class="duration-badge">' + duration + '</div>' +
'<div class="shorts-overlay">' +
'<div class="shorts-title">' + escapeHtml(content.title) + '</div>' +
'<div class="shorts-stats"><i class="fas fa-eye"></i> ' + formatNumber(content.real_views || 0) + ' views</div>' +
'</div>' +
'</div>' +
'</div>';
}).join('');
}

// ‚úÖ RENDER HASHTAGS
function renderTrendingHashtags() {
return trendingHashtags.map(function(hashtag) {
return '<div class="hashtag" data-hashtag="' + hashtag + '">' + hashtag + '</div>';
}).join('');
}

// ‚≠ê NEW: CARD ACTION MENU FUNCTIONS
window.toggleActionMenu = function(event, contentId) {
event.stopPropagation();
var dropdown = document.getElementById('action-menu-' + contentId);
var allDropdowns = document.querySelectorAll('.action-menu-dropdown');
allDropdowns.forEach(function(d) {
if (d.id !== 'action-menu-' + contentId) {
d.classList.remove('active');
}
});
if (dropdown) {
dropdown.classList.toggle('active');
}
};

window.saveToWatchLater = function(contentId) {
showToast('Saved to Watch Later', 'success');
closeAllActionMenus();
};

window.shareContent = function(contentId) {
var url = window.location.origin + '/content-detail.html?id=' + contentId;
if (navigator.share) {
navigator.share({
title: 'Check out this content on Bantu Stream Connect',
url: url
});
} else {
navigator.clipboard.writeText(url);
showToast('Link copied to clipboard', 'success');
}
closeAllActionMenus();
};

window.notInterested = function(contentId) {
showToast('We\'ll show less of this', 'info');
closeAllActionMenus();
};

function closeAllActionMenus() {
var allDropdowns = document.querySelectorAll('.action-menu-dropdown');
allDropdowns.forEach(function(d) {
d.classList.remove('active');
});
}

// Close action menus when clicking outside
document.addEventListener('click', function(e) {
if (!e.target.closest('.card-actions')) {
closeAllActionMenus();
}
});

// ‚úÖ SETUP LISTENERS
function setupContentCardListeners() {
var cards = document.querySelectorAll('[data-content-id]');
cards.forEach(function(card) {
card.addEventListener('click', function(e) {
if (e.target.closest('button') || e.target.closest('.action-menu-btn')) return;
playContent(card.dataset.contentId);
});
});
var hashtags = document.querySelectorAll('[data-hashtag]');
hashtags.forEach(function(hashtag) {
hashtag.addEventListener('click', function() {
window.location.href = 'content-library.html?search=' + encodeURIComponent(hashtag.dataset.hashtag);
});
});
}
function onFilterSelected(filter) {
selectedFilter = filter;
var buttons = document.querySelectorAll('.filter-chip');
buttons.forEach(function(button) {
button.classList.toggle('active', button.dataset.filter === filter);
});
if (filter !== 'All') {
window.location.href = 'content-library.html?genre=' + encodeURIComponent(filter);
}
}
// ‚úÖ PLAY CONTENT
function playContent(contentId) {
if (!contentId) {
console.error('No content ID provided');
return;
}
var viewerId = currentUser ? currentUser.id : null;
window.supabaseClient
.from('content_views')
.insert({
content_id: contentId,
viewer_id: viewerId,
view_duration: 0,
device_type: /Mobile|Android|iPhone/i.test(navigator.userAgent) ? 'mobile' : 'desktop',
created_at: new Date().toISOString()
})
.then(function() {
console.log('‚úÖ View recorded');
window.location.href = 'content-detail.html?id=' + contentId;
})
.catch(function(error) {
console.warn('View recording failed:', error);
window.location.href = 'content-detail.html?id=' + contentId;
});
}
function setReminder(contentId) {
showToast('Reminder set successfully', 'success');
}

// ‚≠ê NEW: INFINITE SCROLL
function setupInfiniteScroll() {
window.addEventListener('scroll', function() {
if (isLoadingMore || !hasMoreContent) return;
var scrollPosition = window.innerHeight + window.scrollY;
var threshold = document.body.offsetHeight - 500;
if (scrollPosition >= threshold) {
loadMoreContent();
}
});
}

function loadMoreContent() {
isLoadingMore = true;
infiniteScrollLoader.classList.add('active');
fetchContent(contentOffset, contentLimit)
.then(function(newContent) {
if (newContent.length === 0) {
hasMoreContent = false;
} else {
allContentData = allContentData.concat(newContent);
processTrendingSections(allContentData);
renderTrendingSections();
contentOffset += contentLimit;
}
})
.catch(function(error) {
console.error('Error loading more content:', error);
})
.finally(function() {
isLoadingMore = false;
infiniteScrollLoader.classList.remove('active');
});
}

// ‚≠ê NEW: SEARCH AS YOU TYPE
function setupSearchAsYouType() {
var searchInput = document.getElementById('search-input');
var suggestionsContainer = document.getElementById('search-suggestions');
if (searchInput) {
searchInput.addEventListener('input', function(e) {
var query = e.target.value.trim();
clearTimeout(searchDebounceTimer);
if (query.length < 2) {
suggestionsContainer.classList.remove('active');
suggestionsContainer.innerHTML = '';
return;
}
searchDebounceTimer = setTimeout(function() {
performSearch(query);
}, 300);
});
}
}

function performSearch(query) {
var suggestionsContainer = document.getElementById('search-suggestions');
if (!suggestionsContainer) return;
// Search in existing content data
var suggestions = allContentData.filter(function(item) {
return item.title && item.title.toLowerCase().includes(query.toLowerCase());
}).slice(0, 5);
if (suggestions.length === 0) {
suggestionsContainer.classList.remove('active');
suggestionsContainer.innerHTML = '';
return;
}
var html = suggestions.map(function(item) {
return '<div class="suggestion-item" data-content-id="' + item.id + '">' +
'<i class="fas fa-search"></i>' +
'<span>' + escapeHtml(item.title) + '</span>' +
'</div>';
}).join('');
suggestionsContainer.innerHTML = html;
suggestionsContainer.classList.add('active');
// Add click listeners
suggestionsContainer.querySelectorAll('.suggestion-item').forEach(function(item) {
item.addEventListener('click', function() {
var contentId = item.dataset.contentId;
document.getElementById('search-modal').classList.remove('active');
playContent(contentId);
});
});
}

// ‚úÖ GLOBAL FUNCTIONS FOR HTML ONCLICK
window.viewAllTrending = function() {
window.location.href = 'content-library.html?sort=trending';
};
window.viewAllLiveStreams = function() {
window.location.href = 'content-library.html?genre=Live';
};
window.viewAllCommunityGems = function() {
window.location.href = 'content-library.html?sort=popular';
};
window.viewAllShorts = function() {
window.location.href = 'content-library.html?type=shorts';
};
window.playContent = playContent;
window.setReminder = setReminder;
// ‚úÖ LOAD CONTENT
function loadContent() {
setLoading(true, 'Loading trending content...');
contentOffset = 100;
hasMoreContent = true;
return fetchContent(0, 100)
.then(function(contentData) {
processTrendingSections(contentData);
renderFilterChips();
renderTrendingSections();
})
.catch(function(error) {
console.error('‚ùå Error loading content:', error);
showToast('Failed to load content', 'error');
})
.finally(function() {
setLoading(false);
});
}
// ‚úÖ SETUP EVENT LISTENERS
function setupEventListeners() {
if (searchBtn) {
searchBtn.addEventListener('click', function() {
document.getElementById('search-modal').classList.add('active');
setTimeout(function() {
var input = document.getElementById('search-input');
if (input) input.focus();
}, 300);
});
}
var closeSearchBtn = document.getElementById('close-search-btn');
if (closeSearchBtn) {
closeSearchBtn.addEventListener('click', function() {
document.getElementById('search-modal').classList.remove('active');
var input = document.getElementById('search-input');
if (input) input.value = '';
var grid = document.getElementById('search-results-grid');
if (grid) grid.innerHTML = '';
var suggestions = document.getElementById('search-suggestions');
if (suggestions) {
suggestions.classList.remove('active');
suggestions.innerHTML = '';
}
});
}
var searchModal = document.getElementById('search-modal');
if (searchModal) {
searchModal.addEventListener('click', function(e) {
if (e.target === searchModal) {
searchModal.classList.remove('active');
var input = document.getElementById('search-input');
if (input) input.value = '';
var grid = document.getElementById('search-results-grid');
if (grid) grid.innerHTML = '';
var suggestions = document.getElementById('search-suggestions');
if (suggestions) {
suggestions.classList.remove('active');
suggestions.innerHTML = '';
}
}
});
}
if (refreshBtn) {
refreshBtn.addEventListener('click', function() {
setLoading(true, 'Refreshing...');
loadContent();
showToast('Content refreshed', 'success');
});
}
if (notificationsBtn) {
notificationsBtn.addEventListener('click', function() {
var panel = document.getElementById('notifications-panel');
if (panel) {
panel.classList.add('active');
renderNotifications();
}
});
}
var closeNotif = document.getElementById('close-notifications');
if (closeNotif) {
closeNotif.addEventListener('click', function() {
document.getElementById('notifications-panel').classList.remove('active');
});
}
var notifPanel = document.getElementById('notifications-panel');
if (notifPanel) {
notifPanel.addEventListener('click', function(e) {
if (e.target === notifPanel) {
notifPanel.classList.remove('active');
}
});
}
var markAllBtn = document.getElementById('mark-all-read');
if (markAllBtn) {
markAllBtn.addEventListener('click', markAllNotificationsAsRead);
}
if (profileBtn) {
profileBtn.addEventListener('click', function() {
window.supabaseClient.auth.getSession()
.then(function(response) {
var session = response.data.session;
window.location.href = session ? 'profile.html' : 'login.html';
});
});
}
if (exploreAllBtn) {
exploreAllBtn.addEventListener('click', function() {
window.location.href = 'content-library.html?sort=trending';
});
}
if (authLoginBtn) {
authLoginBtn.addEventListener('click', function() {
localStorage.setItem('redirectAfterLogin', 'trending_screen.html');
window.location.href = 'login.html?redirect=trending_screen.html';
});
}
if (authCancelBtn) {
authCancelBtn.addEventListener('click', function() {
authModal.classList.remove('active');
});
}

// ‚≠ê NEW: LOCATION FILTER
if (locationFilter) {
locationFilter.addEventListener('change', function() {
var location = this.value;
showToast('Filtering by: ' + this.options[this.selectedIndex].text, 'info');
// You can add location-based filtering logic here
loadContent();
});
}

// ‚≠ê NEW: INFINITE SCROLL
setupInfiniteScroll();

// ‚≠ê NEW: SEARCH AS YOU TYPE
setupSearchAsYouType();
}
// ‚úÖ INITIALIZE
function initializeTrendingScreen() {
console.log('üî• Initializing Trending Screen...');
var searchModal = document.getElementById('search-modal');
var notificationsPanel = document.getElementById('notifications-panel');
var authModalEl = document.getElementById('auth-modal');
if (searchModal) searchModal.classList.remove('active');
if (notificationsPanel) notificationsPanel.classList.remove('active');
if (authModalEl) authModalEl.classList.remove('active');
return checkAuthentication()
.then(function(isAuthenticated) {
if (!isAuthenticated) {
setLoading(false);
return;
}
setupEventListeners();
return loadContent();
})
.then(function() {
console.log('‚úÖ Trending Screen initialized');
})
.catch(function(error) {
console.error('‚ùå Initialization error:', error);
setLoading(false);
});
}
// Start initialization
initializeTrendingScreen();
// Auth state change listener
window.supabaseClient.auth.onAuthStateChange(function(event, session) {
console.log('Auth state changed:', event);
if (event === 'SIGNED_IN' && session && session.user) {
currentUser = session.user;
loadUserProfilePicture(currentUser);
loadNotifications();
showToast('Welcome back!', 'success');
} else if (event === 'SIGNED_OUT') {
currentUser = null;
var placeholder = document.getElementById('userProfilePlaceholder');
if (placeholder) {
placeholder.innerHTML = '<div class="profile-placeholder"><i class="fas fa-user"></i></div>';
}
updateNotificationBadge(0);
notifications = [];
renderNotifications();
showToast('Signed out successfully', 'info');
if (authModal) authModal.classList.add('active');
}
});
});
</script>
</body>
</html>
