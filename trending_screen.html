<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trending Now - Bantu Stream Connect</title>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Supabase JS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
/* Color Theme */
:root {
--deep-black: #0A0E12;
--deep-navy: #0F172A;
--soft-white: #F8FAFC;
--slate-grey: #94A3B8;
--bantu-blue: #1D4ED8;
--warm-gold: #F59E0B;
--error-color: #EF4444;
--success-color: #10B981;
--glow-blue-1: #00A3FF;
--glow-blue-2: #0066FF;
--glow-purple: #8B5CF6;
--glow-pink: #EC4899;
}
/* Reset & Base */
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, #001F54 0%, #0A0E3F 50%, #000000 100%);
color: var(--soft-white);
min-height: 100vh;
overflow-x: hidden;
}
/* Loading Screen */
.loading-screen {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(135deg, #001F54 0%, #0A0E3F 50%, #000000 100%);
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
z-index: 9999;
}
.spinner {
width: 60px;
height: 60px;
border: 4px solid rgba(255, 255, 255, 0.1);
border-radius: 50%;
border-top-color: var(--warm-gold);
animation: spin 1s linear infinite;
margin-bottom: 20px;
}
@keyframes spin { to { transform: rotate(360deg); } }
/* Glassmorphism */
.glassmorphism {
background: rgba(255, 255, 255, 0.05);
backdrop-filter: blur(10px);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 16px;
}
/* Header */
.header-container {
position: relative;
min-height: 30vh;
overflow: hidden;
}
.header-bg {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: radial-gradient(circle at 20% 80%, var(--bantu-blue) 0%, transparent 50%),
radial-gradient(circle at 80% 20%, var(--glow-purple) 0%, transparent 50%);
opacity: 0.3;
}
.grid-pattern {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
background-size: 30px 30px;
}
.main-header {
position: relative;
padding: 20px;
z-index: 10;
}
.header-content {
display: flex;
justify-content: space-between;
align-items: flex-start;
max-width: 1200px;
margin: 0 auto;
}
.trending-title {
display: flex;
align-items: center;
gap: 15px;
}
.fire-icon {
font-size: 2.5rem;
color: var(--warm-gold);
animation: pulse 2s infinite;
}
@keyframes pulse {
0%, 100% { transform: scale(1); }
50% { transform: scale(1.1); }
}
.title-text {
font-family: 'Orbitron', sans-serif;
font-size: 2.5rem;
font-weight: 900;
background: linear-gradient(135deg, var(--soft-white) 0%, var(--warm-gold) 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
letter-spacing: 2px;
}
.header-actions {
display: flex;
gap: 10px;
}
.icon-btn {
width: 50px;
height: 50px;
border-radius: 50%;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
color: white;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s ease;
font-size: 1.2rem;
}
.icon-btn:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-2px);
}
.refresh-btn {
color: var(--bantu-blue);
animation: rotate 20s linear infinite;
animation-play-state: paused;
}
.refresh-btn:hover { animation-play-state: running; }
@keyframes rotate { to { transform: rotate(360deg); } }
/* Filter Chips */
.filter-section {
position: relative;
padding: 20px;
max-width: 1200px;
margin: 0 auto;
}
.filter-container {
display: flex;
gap: 10px;
overflow-x: auto;
padding-bottom: 10px;
scrollbar-width: thin;
scrollbar-color: var(--bantu-blue) transparent;
}
.filter-chip {
padding: 10px 20px;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 25px;
color: var(--soft-white);
font-family: 'Inter', sans-serif;
font-size: 0.9rem;
font-weight: 500;
cursor: pointer;
transition: all 0.3s ease;
white-space: nowrap;
}
.filter-chip:hover {
background: rgba(255, 255, 255, 0.1);
transform: translateY(-2px);
}
.filter-chip.active {
background: var(--warm-gold);
border-color: transparent;
color: var(--deep-black);
font-weight: 600;
}
/* Main Content */
.main-content {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}
.section { margin-bottom: 40px; }
.section-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}
.section-title {
font-family: 'Orbitron', sans-serif;
font-size: 1.8rem;
font-weight: 700;
color: var(--soft-white);
display: flex;
align-items: center;
gap: 10px;
}
.section-icon {
color: var(--warm-gold);
font-size: 1.5rem;
}
.see-all-btn {
padding: 8px 20px;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 10px;
color: var(--bantu-blue);
font-family: 'Orbitron', sans-serif;
font-size: 0.9rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}
.see-all-btn:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateX(5px);
}
/* Featured Card */
.featured-trend-card {
position: relative;
border-radius: 20px;
overflow: hidden;
height: 400px;
margin-bottom: 30px;
}
.featured-bg {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-size: cover;
background-position: center;
transition: transform 0.5s ease;
}
.featured-trend-card:hover .featured-bg { transform: scale(1.05); }
.featured-overlay {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.8) 100%);
display: flex;
flex-direction: column;
justify-content: flex-end;
padding: 30px;
}
.live-badge {
display: inline-block;
padding: 8px 20px;
background: rgba(239, 68, 68, 0.9);
border-radius: 20px;
color: white;
font-weight: 700;
font-size: 0.9rem;
margin-bottom: 20px;
align-self: flex-start;
}
.featured-title {
font-family: 'Orbitron', sans-serif;
font-size: 2.5rem;
font-weight: 800;
color: white;
margin-bottom: 10px;
line-height: 1.2;
}
.featured-creator {
font-size: 1.2rem;
color: var(--warm-gold);
margin-bottom: 10px;
}
.featured-stats {
display: flex;
gap: 20px;
margin-bottom: 25px;
color: rgba(255, 255, 255, 0.8);
}
.watch-now-btn {
padding: 15px 40px;
background: linear-gradient(135deg, var(--warm-gold) 0%, #f97316 100%);
border: none;
border-radius: 12px;
color: var(--deep-black);
font-family: 'Inter', sans-serif;
font-size: 1.1rem;
font-weight: 700;
cursor: pointer;
transition: all 0.3s ease;
align-self: flex-start;
}
.watch-now-btn:hover {
transform: translateY(-3px);
box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
}
/* Content Cards */
.content-horizontal-scroll {
display: flex;
gap: 20px;
overflow-x: auto;
padding-bottom: 20px;
scrollbar-width: thin;
scrollbar-color: var(--bantu-blue) transparent;
}
.content-card {
flex: 0 0 300px;
border-radius: 15px;
overflow: hidden;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
transition: all 0.3s ease;
cursor: pointer;
}
.content-card:hover {
transform: translateY(-10px);
box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}
.card-thumbnail {
position: relative;
height: 180px;
overflow: hidden;
background: linear-gradient(135deg, #1D4ED8, #8B5CF6);
}
.card-thumbnail img {
width: 100%;
height: 100%;
object-fit: cover;
transition: transform 0.3s ease;
}
.content-card:hover .card-thumbnail img { transform: scale(1.1); }
.thumbnail-overlay {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.5) 100%);
}
.card-badges {
position: absolute;
top: 15px;
left: 15px;
display: flex;
gap: 10px;
}
.badge {
padding: 5px 12px;
border-radius: 15px;
font-size: 0.8rem;
font-weight: 600;
}
.badge.live { background: rgba(239, 68, 68, 0.9); color: white; }
.badge.upcoming { background: rgba(29, 78, 216, 0.9); color: white; }
.badge.viewers { background: rgba(0, 0, 0, 0.7); color: white; }
.card-content { padding: 20px; }
.card-title {
font-size: 1.1rem;
font-weight: 600;
margin-bottom: 10px;
line-height: 1.3;
display: -webkit-box;
-webkit-line-clamp: 2;
-webkit-box-orient: vertical;
overflow: hidden;
}
.card-creator {
font-size: 0.9rem;
color: var(--slate-grey);
margin-bottom: 10px;
}
.card-stats {
display: flex;
gap: 15px;
font-size: 0.8rem;
color: rgba(255, 255, 255, 0.6);
}
.reminder-btn {
width: 100%;
padding: 10px;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 8px;
color: white;
font-size: 0.9rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin-top: 10px;
}
.reminder-btn:hover { background: rgba(255, 255, 255, 0.2); }
/* Hashtags */
.hashtags-container {
display: flex;
flex-wrap: wrap;
gap: 10px;
margin-top: 15px;
}
.hashtag {
padding: 10px 20px;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 20px;
color: var(--warm-gold);
font-size: 0.9rem;
cursor: pointer;
transition: all 0.3s ease;
}
.hashtag:hover {
background: rgba(245, 158, 11, 0.1);
transform: translateY(-2px);
}
/* Community Gems */
.community-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
gap: 20px;
}
.gem-card {
border-radius: 15px;
overflow: hidden;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
transition: all 0.3s ease;
cursor: pointer;
}
.gem-card:hover {
transform: translateY(-5px);
box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
}
.gem-thumbnail {
height: 160px;
overflow: hidden;
background: linear-gradient(135deg, #1D4ED8, #8B5CF6);
}
.gem-thumbnail img {
width: 100%;
height: 100%;
object-fit: cover;
transition: transform 0.3s ease;
}
.gem-card:hover .gem-thumbnail img { transform: scale(1.1); }
.gem-content { padding: 15px; }
/* Explore All */
.explore-all-section {
text-align: center;
padding: 40px 20px;
}
.explore-btn {
padding: 20px 50px;
background: linear-gradient(135deg, var(--bantu-blue) 0%, #3730a3 100%);
border: none;
border-radius: 15px;
color: white;
font-family: 'Orbitron', sans-serif;
font-size: 1.2rem;
font-weight: 700;
cursor: pointer;
transition: all 0.3s ease;
display: inline-flex;
align-items: center;
gap: 15px;
}
.explore-btn:hover {
transform: translateY(-5px);
box-shadow: 0 15px 30px rgba(29, 78, 216, 0.4);
}
/* Toast */
.toast {
position: fixed;
bottom: 20px;
right: 20px;
padding: 15px 25px;
border-radius: 10px;
color: white;
font-weight: 500;
z-index: 1000;
animation: slideIn 0.3s ease;
max-width: 300px;
}
.toast.success { background: linear-gradient(135deg, #51cf66 0%, #2b8a3e 100%); }
.toast.info { background: linear-gradient(135deg, #4dabf7 0%, #748ffc 100%); }
.toast.error { background: linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%); }
@keyframes slideIn {
from { transform: translateX(100%); opacity: 0; }
to { transform: translateX(0); opacity: 1; }
}
/* Navigation */
.global-nav {
position: fixed;
bottom: 0;
left: 0;
width: 100%;
background: rgba(15, 23, 42, 0.95);
backdrop-filter: blur(10px);
display: flex;
justify-content: space-around;
padding: 15px 0;
z-index: 100;
border-top: 1px solid rgba(255, 255, 255, 0.1);
}
.nav-item {
display: flex;
flex-direction: column;
align-items: center;
color: var(--slate-grey);
text-decoration: none;
font-size: 0.8rem;
transition: all 0.3s ease;
}
.nav-item i { font-size: 1.2rem; margin-bottom: 5px; }
.nav-item:hover { color: var(--soft-white); }
.nav-item.active { color: var(--warm-gold); }
/* Auth Modal */
.auth-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
display: none;
align-items: center;
justify-content: center;
z-index: 2000;
backdrop-filter: blur(5px);
}
.auth-modal.active { display: flex; }
.auth-content {
background: rgba(15, 23, 42, 0.9);
border-radius: 20px;
padding: 40px;
max-width: 400px;
width: 90%;
text-align: center;
border: 1px solid rgba(255, 255, 255, 0.1);
}
.auth-icon { font-size: 64px; color: var(--warm-gold); margin-bottom: 20px; }
.auth-title { font-family: 'Orbitron', sans-serif; font-size: 24px; margin-bottom: 15px; }
.auth-message { color: var(--slate-grey); margin-bottom: 30px; line-height: 1.6; }
.auth-buttons { display: flex; gap: 15px; }
.auth-btn {
flex: 1;
padding: 15px;
border-radius: 12px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
border: none;
}
.auth-btn.login {
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
color: var(--soft-white);
}
.auth-btn.login:hover {
transform: translateY(-2px);
box-shadow: 0 4px 15px rgba(29, 78, 216, 0.4);
}
.auth-btn.cancel {
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
color: var(--soft-white);
}
/* Search Modal */
.search-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.9);
display: none;
align-items: center;
justify-content: center;
z-index: 2000;
backdrop-filter: blur(5px);
}
.search-modal.active { display: flex; }
.search-modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
padding-bottom: 15px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
width: 100%;
}
.search-input-container { position: relative; width: 100%; max-width: 600px; }
.search-icon {
position: absolute;
left: 15px;
top: 50%;
transform: translateY(-50%);
color: var(--slate-grey);
font-size: 18px;
}
.search-input {
width: 100%;
padding: 15px 15px 15px 45px;
border-radius: 12px;
border: 1px solid rgba(255, 255, 255, 0.1);
background: rgba(15, 23, 42, 0.7);
color: var(--soft-white);
font-size: 16px;
}
.search-input:focus {
outline: none;
border-color: var(--warm-gold);
box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
}
.close-search-btn {
background: none;
border: none;
color: var(--soft-white);
font-size: 24px;
cursor: pointer;
width: 40px;
height: 40px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.3s ease;
}
.close-search-btn:hover {
background: rgba(255, 255, 255, 0.1);
transform: rotate(90deg);
}
.search-filters {
display: flex;
gap: 15px;
margin-bottom: 20px;
width: 100%;
max-width: 600px;
}
.filter-group { flex: 1; }
.filter-label { display: block; margin-bottom: 8px; font-size: 14px; color: var(--slate-grey); }
.filter-select {
width: 100%;
padding: 12px;
border-radius: 10px;
border: 1px solid rgba(255, 255, 255, 0.1);
background: rgba(15, 23, 42, 0.7);
color: var(--soft-white);
font-size: 14px;
}
.search-results { width: 100%; max-width: 800px; max-height: 70vh; overflow-y: auto; }
.search-results-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
gap: 15px;
}
/* Notifications Panel */
.notifications-panel {
position: fixed;
top: 0;
right: -100%;
width: 400px;
height: 100%;
background: rgba(15, 23, 42, 0.9);
border-left: 1px solid rgba(255, 255, 255, 0.1);
box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
z-index: 1000;
transition: right 0.3s ease;
backdrop-filter: blur(10px);
}
.notifications-panel.active { right: 0; }
.notifications-header {
padding: 20px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
display: flex;
justify-content: space-between;
align-items: center;
}
.notifications-list { max-height: calc(100vh - 150px); overflow-y: auto; padding: 20px; }
.notification-item {
padding: 15px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
display: flex;
gap: 12px;
}
.notification-item.read { opacity: 0.7; }
.notification-icon {
width: 40px;
height: 40px;
border-radius: 50%;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
display: flex;
align-items: center;
justify-content: center;
flex-shrink: 0;
}
.notification-content { flex: 1; }
.notification-content h4 { font-weight: 600; margin-bottom: 5px; }
.notification-content p { font-size: 14px; color: var(--slate-grey); margin-bottom: 8px; }
.notification-time { font-size: 12px; color: var(--warm-gold); }
.notification-dot {
width: 10px;
height: 10px;
border-radius: 50%;
background: var(--warm-gold);
position: absolute;
top: 15px;
right: 15px;
}
.notifications-footer {
padding: 20px;
border-top: 1px solid rgba(255, 255, 255, 0.1);
display: flex;
gap: 15px;
}
.text-btn {
flex: 1;
padding: 12px;
border-radius: 10px;
border: 1px solid rgba(255, 255, 255, 0.1);
background: rgba(255, 255, 255, 0.05);
color: var(--soft-white);
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}
.text-btn:hover {
background: rgba(245, 158, 11, 0.1);
border-color: var(--warm-gold);
}
/* Profile Button */
.profile-btn {
width: 50px;
height: 50px;
border-radius: 50%;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
border: 2px solid rgba(255, 255, 255, 0.2);
cursor: pointer;
overflow: hidden;
transition: all 0.3s ease;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-weight: 600;
font-size: 18px;
}
.profile-btn:hover {
transform: translateY(-2px);
box-shadow: 0 8px 20px rgba(29, 78, 216, 0.3);
}
.profile-img { width: 100%; height: 100%; object-fit: cover; }
.profile-placeholder {
width: 100%;
height: 100%;
display: flex;
align-items: center;
justify-content: center;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
color: white;
font-size: 20px;
font-weight: bold;
}
/* Responsive */
@media (max-width: 768px) {
.title-text { font-size: 1.8rem; }
.fire-icon { font-size: 2rem; }
.featured-trend-card { height: 300px; }
.featured-title { font-size: 1.8rem; }
.content-card { flex: 0 0 250px; }
.community-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
}
@media (max-width: 480px) {
.title-text { font-size: 1.5rem; }
.featured-trend-card { height: 250px; }
.featured-title { font-size: 1.5rem; }
.content-card { flex: 0 0 200px; }
.community-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
<!-- Loading Screen -->
<div id="loading" class="loading-screen">
<div class="spinner"></div>
<div id="loading-text">Loading Trending Content...</div>
</div>

<!-- Auth Modal -->
<div id="auth-modal" class="auth-modal">
<div class="auth-content">
<div class="auth-icon"><i class="fas fa-lock"></i></div>
<h2 class="auth-title">Authentication Required</h2>
<p class="auth-message">You need to be logged in to view trending content.</p>
<div class="auth-buttons">
<button id="auth-login-btn" class="auth-btn login">Log In</button>
<button id="auth-cancel-btn" class="auth-btn cancel">Cancel</button>
</div>
</div>
</div>

<!-- Search Modal -->
<div id="search-modal" class="search-modal">
<div style="width: 90%; max-width: 800px; background: rgba(15, 23, 42, 0.9); border-radius: 20px; padding: 30px;">
<div class="search-modal-header">
<div class="search-input-container">
<i class="search-icon fas fa-search"></i>
<input type="text" id="search-input" class="search-input" placeholder="Search content..." autocomplete="off">
</div>
<button id="close-search-btn" class="close-search-btn"><i class="fas fa-times"></i></button>
</div>
<div class="search-filters">
<div class="filter-group">
<label class="filter-label">Category</label>
<select id="category-filter" class="filter-select">
<option value="">All Categories</option>
<option value="Music">Music</option>
<option value="STEM">STEM</option>
<option value="Culture">Culture</option>
<option value="News">News</option>
<option value="Sports">Sports</option>
<option value="Movies">Movies</option>
<option value="Documentaries">Documentaries</option>
<option value="Podcasts">Podcasts</option>
</select>
</div>
<div class="filter-group">
<label class="filter-label">Sort By</label>
<select id="sort-filter" class="filter-select">
<option value="newest">Newest First</option>
<option value="popular">Most Popular</option>
<option value="trending">Trending</option>
</select>
</div>
</div>
<div class="search-results">
<div id="search-results-grid" class="search-results-grid"></div>
</div>
</div>
</div>

<!-- Notifications Panel -->
<div id="notifications-panel" class="notifications-panel">
<div class="notifications-header">
<h2 style="font-family: 'Orbitron', sans-serif; font-size: 20px; margin: 0;">Notifications</h2>
<button id="close-notifications" class="close-search-btn"><i class="fas fa-times"></i></button>
</div>
<div class="notifications-list" id="notifications-list"></div>
<div class="notifications-footer">
<button id="mark-all-read" class="text-btn">Mark all as read</button>
<button id="notification-settings" class="text-btn">Settings</button>
</div>
</div>

<!-- Main App -->
<div id="app" style="display: none;">
<div class="header-container">
<div class="header-bg"></div>
<div class="grid-pattern"></div>
<header class="main-header">
<div class="header-content">
<div class="trending-title">
<div class="fire-icon">üî•</div>
<h1 class="title-text">TRENDING NOW</h1>
</div>
<div class="header-actions">
<button id="search-btn" class="icon-btn" title="Search"><i class="fas fa-search"></i></button>
<button id="refresh-btn" class="icon-btn refresh-btn" title="Refresh"><i class="fas fa-sync-alt"></i></button>
<button id="notifications-btn" class="icon-btn" title="Notifications">
<i class="fas fa-bell"></i>
<span class="notification-badge" id="notification-count" style="display: none; position: absolute; top: -5px; right: -5px; background: var(--error-color); color: white; font-size: 10px; font-weight: bold; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid var(--deep-black);">0</span>
</button>
<button id="profile-btn" class="profile-btn" title="Profile">
<div class="profile-placeholder" id="userProfilePlaceholder"><i class="fas fa-user"></i></div>
</button>
</div>
</div>
</header>
<div class="filter-section">
<div id="filter-container" class="filter-container"></div>
</div>
</div>

<main class="main-content">
<div id="trending-sections"></div>
<div class="explore-all-section">
<button id="explore-all-btn" class="explore-btn">
EXPLORE ALL TRENDING CONTENT
<i class="fas fa-arrow-right"></i>
</button>
</div>
</main>

<nav class="global-nav">
<a href="index.html" class="nav-item"><i class="fas fa-home"></i>Home</a>
<a href="trending_screen.html" class="nav-item active"><i class="fas fa-fire"></i>Trending</a>
<a href="content-library.html" class="nav-item"><i class="fas fa-th-large"></i>Library</a>
<a href="creator-dashboard.html" class="nav-item"><i class="fas fa-user"></i>Creator</a>
</nav>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

<!-- Initialize Supabase -->
<script>
if (!window.supabaseClient) {
window.supabaseClient = supabase.createClient(
'https://ydnxqnbjoshvxteevemc.supabase.co',
'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U'
);
console.log('‚úÖ Supabase client initialized');
}
</script>

<!-- Main JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', async () => {
console.log('üî• Trending Screen Initializing...');

// DOM Elements
const loadingScreen = document.getElementById('loading');
const loadingText = document.getElementById('loading-text');
const app = document.getElementById('app');
const authModal = document.getElementById('auth-modal');
const filterContainer = document.getElementById('filter-container');
const trendingSections = document.getElementById('trending-sections');
const searchBtn = document.getElementById('search-btn');
const refreshBtn = document.getElementById('refresh-btn');
const notificationsBtn = document.getElementById('notifications-btn');
const profileBtn = document.getElementById('profile-btn');
const exploreAllBtn = document.getElementById('explore-all-btn');
const authLoginBtn = document.getElementById('auth-login-btn');
const authCancelBtn = document.getElementById('auth-cancel-btn');

// State
let currentUser = null;
let allContentData = [];
let featuredTrend = [];
let liveStreams = [];
let communityGems = [];
let trendingHashtags = [];
let selectedFilter = 'All';
let notifications = [];

const filters = ['All', 'Music', 'Film & Series', 'Podcasts', 'Gaming', 'Comedy', 'Live', 'Top 24 Hrs', 'Rising Creators'];

// ‚úÖ LOADING STATE
function setLoading(loading, text = '') {
if (text && loadingText) loadingText.textContent = text;
if (loading) {
if (loadingScreen) loadingScreen.style.display = 'flex';
if (app) app.style.display = 'none';
} else {
setTimeout(() => {
if (loadingScreen) loadingScreen.style.display = 'none';
if (app) app.style.display = 'block';
}, 500);
}
}

// ‚úÖ TOAST
function showToast(message, type = 'info') {
const toast = document.createElement('div');
toast.className = `toast ${type}`;
toast.textContent = message;
const container = document.getElementById('toast-container');
if (container) {
container.appendChild(toast);
setTimeout(() => {
toast.style.opacity = '0';
toast.style.transform = 'translateX(100%)';
setTimeout(() => toast.remove(), 300);
}, 3000);
}
}

// ‚úÖ FORMAT NUMBERS
function formatNumber(num) {
if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
return num.toString();
}

// ‚úÖ GET INITIALS
function getInitials(email) {
if (!email) return 'U';
return email.split('@')[0].substring(0, 2).toUpperCase();
}

function getInitialsFromName(fullName) {
if (!fullName) return 'U';
const names = fullName.split(' ');
return names.length >= 2 
? (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase()
: fullName.charAt(0).toUpperCase();
}

// ‚úÖ FIXED: BUILD THUMBNAIL URL WITH MULTIPLE FALLBACKS
function buildThumbnailUrl(thumbnailPath, fallbackIndex = 0) {
// Professional fallback images from Unsplash
const fallbackImages = [
'https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&h=450&fit=crop',
'https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?w=800&h=450&fit=crop',
'https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=800&h=450&fit=crop',
'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=800&h=450&fit=crop'
];

// If no thumbnail path, return fallback
if (!thumbnailPath || thumbnailPath.trim() === '') {
console.log('üñºÔ∏è No thumbnail path, using fallback');
return fallbackImages[fallbackIndex % fallbackImages.length];
}

// Clean the path
const cleanPath = thumbnailPath.replace(/^\/+/, '');

// Try different URL constructions
const possibleUrls = [
// Direct path (if already full URL)
thumbnailPath.startsWith('http') ? thumbnailPath : null,
// Public bucket with clean path
`https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${cleanPath}`,
// Content bucket
`https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/content/${cleanPath}`,
// Thumbnails bucket
`https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/thumbnails/${cleanPath}`,
// Media bucket
`https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/media/${cleanPath}`
];

const validUrl = possibleUrls.find(url => url !== null);
console.log('üñºÔ∏è Building thumbnail URL:', validUrl);
return validUrl || fallbackImages[fallbackIndex % fallbackImages.length];
}

// ‚úÖ FIXED: CREATE IMAGE WITH ERROR FALLBACK
function createImageElement(src, alt, fallbackIndex = 0) {
const img = document.createElement('img');
img.src = src;
img.alt = alt || 'Content thumbnail';
img.loading = 'lazy';
img.style.cssText = 'width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;';

img.onerror = () => {
console.log('üñºÔ∏è Image failed to load, trying fallback:', fallbackIndex);
const fallbackImages = [
'https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&h=450&fit=crop',
'https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?w=800&h=450&fit=crop',
'https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=800&h=450&fit=crop',
'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=800&h=450&fit=crop'
];
if (fallbackIndex < fallbackImages.length - 1) {
img.src = fallbackImages[fallbackIndex + 1];
img.dataset.fallbackIndex = fallbackIndex + 1;
} else {
// Final fallback - gradient background
img.style.display = 'none';
img.parentElement.style.background = 'linear-gradient(135deg, #1D4ED8, #8B5CF6)';
img.parentElement.innerHTML = `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:white;font-size:48px;"><i class="fas fa-image"></i></div>`;
}
};

return img;
}

// ‚úÖ LOAD PROFILE PICTURE
async function loadUserProfilePicture(user) {
try {
if (!user || !profileBtn) return;
const placeholder = document.getElementById('userProfilePlaceholder');
if (!placeholder) return;

while (placeholder.firstChild) {
placeholder.removeChild(placeholder.firstChild);
}

const userInitials = getInitials(user.email);

const profileResponse = await window.supabaseClient
.from('user_profiles')
.select('*')
.eq('id', user.id)
.maybeSingle();

const profile = profileResponse.data;
const profileError = profileResponse.error;

if (profileError || !profile) {
const fallback = document.createElement('div');
fallback.className = 'profile-placeholder';
fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
fallback.textContent = userInitials;
placeholder.appendChild(fallback);
return;
}

const displayName = profile.full_name || profile.username || user.email || 'User';
const initial = getInitialsFromName(displayName);

if (profile.avatar_url) {
const avatarUrl = buildThumbnailUrl(profile.avatar_url);
const img = document.createElement('img');
img.className = 'profile-img';
img.alt = displayName;
img.style.cssText = 'width: 100%; height: 100%; border-radius: 50%; object-fit: cover;';
img.src = avatarUrl;

img.onerror = () => {
const fallback = document.createElement('div');
fallback.className = 'profile-placeholder';
fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
fallback.textContent = initial;
placeholder.innerHTML = '';
placeholder.appendChild(fallback);
};

placeholder.appendChild(img);
} else {
const fallback = document.createElement('div');
fallback.className = 'profile-placeholder';
fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
fallback.textContent = initial;
placeholder.appendChild(fallback);
}
} catch (error) {
console.error('Error loading profile:', error);
}
}

// ‚úÖ CHECK AUTHENTICATION
async function checkAuthentication() {
try {
setLoading(true, 'Checking authentication...');
const sessionResponse = await window.supabaseClient.auth.getSession();
const session = sessionResponse.data?.session;
const error = sessionResponse.error;

if (error || !session?.user) {
console.log('‚ö†Ô∏è User not authenticated');
showToast('Please sign in to access trending content', 'error');
if (authModal) authModal.classList.add('active');
setLoading(false);
return false;
}

currentUser = session.user;
console.log('‚úÖ User authenticated:', currentUser.email);

await loadUserProfilePicture(currentUser);
await loadNotifications();
return true;
} catch (error) {
console.error('‚ùå Authentication error:', error);
setLoading(false);
return false;
}
}

// ‚úÖ LOAD NOTIFICATIONS
async function loadNotifications() {
try {
if (!currentUser) {
updateNotificationBadge(0);
return;
}

const notificationsResponse = await window.supabaseClient
.from('notifications')
.select('*')
.eq('user_id', currentUser.id)
.order('created_at', { ascending: false })
.limit(20);

const data = notificationsResponse.data;
const error = notificationsResponse.error;

if (error) throw error;

notifications = data || [];
const unreadCount = notifications.filter(n => !n.is_read).length;
updateNotificationBadge(unreadCount);
renderNotifications();
} catch (error) {
console.error('Error loading notifications:', error);
updateNotificationBadge(0);
}
}

// ‚úÖ UPDATE NOTIFICATION BADGE
function updateNotificationBadge(count = null) {
if (count === null) {
count = notifications.filter(n => !n.is_read).length;
}
const badge = document.getElementById('notification-count');
if (badge) {
badge.textContent = count > 99 ? '99+' : count;
badge.style.display = count > 0 ? 'flex' : 'none';
}
}

// ‚úÖ RENDER NOTIFICATIONS
function renderNotifications() {
const notificationsList = document.getElementById('notifications-list');
if (!notificationsList) return;

if (!currentUser) {
notificationsList.innerHTML = `<div style="text-align:center;padding:40px 20px;color:var(--slate-grey)"><i class="fas fa-bell-slash" style="font-size:48px;margin-bottom:15px;opacity:0.5"></i><p>Sign in to see notifications</p></div>`;
return;
}

if (!notifications || notifications.length === 0) {
notificationsList.innerHTML = `<div style="text-align:center;padding:40px 20px;color:var(--slate-grey)"><i class="fas fa-bell" style="font-size:48px;margin-bottom:15px;opacity:0.3"></i><p>No notifications yet</p></div>`;
return;
}

notificationsList.innerHTML = notifications.map(notification => `
<div class="notification-item ${notification.is_read ? 'read' : 'unread'}" data-id="${notification.id}">
<div class="notification-icon"><i class="${getNotificationIcon(notification.type)}" style="color:white"></i></div>
<div class="notification-content">
<h4>${escapeHtml(notification.title)}</h4>
<p>${escapeHtml(notification.message)}</p>
<span class="notification-time">${formatNotificationTime(notification.created_at)}</span>
</div>
${!notification.is_read ? '<div class="notification-dot"></div>' : ''}
</div>
`).join('');

notificationsList.querySelectorAll('.notification-item').forEach(item => {
item.addEventListener('click', async () => {
const id = item.dataset.id;
await markNotificationAsRead(id);
if (notificationsPanel) notificationsPanel.classList.remove('active');
});
});
}

function getNotificationIcon(type) {
switch(type) {
case 'like': return 'fas fa-heart';
case 'comment': return 'fas fa-comment';
case 'follow': return 'fas fa-user-plus';
case 'view_milestone': return 'fas fa-trophy';
case 'system': return 'fas fa-bell';
default: return 'fas fa-bell';
}
}

function formatNotificationTime(timestamp) {
if (!timestamp) return 'Just now';
const diffMs = Date.now() - new Date(timestamp).getTime();
const diffMins = Math.floor(diffMs / 60000);
const diffHours = Math.floor(diffMs / 3600000);
const diffDays = Math.floor(diffMs / 86400000);
if (diffMins < 1) return 'Just now';
if (diffMins < 60) return `${diffMins}m ago`;
if (diffHours < 24) return `${diffHours}h ago`;
if (diffDays < 7) return `${diffDays}d ago`;
return new Date(timestamp).toLocaleDateString();
}

function escapeHtml(text) {
if (!text) return '';
const div = document.createElement('div');
div.textContent = text;
return div.innerHTML;
}

async function markNotificationAsRead(notificationId) {
try {
await window.supabaseClient
.from('notifications')
.update({ is_read: true })
.eq('id', notificationId);
await loadNotifications();
} catch (error) {
console.error('Error marking notification as read:', error);
}
}

async function markAllNotificationsAsRead() {
try {
if (!currentUser) return;
await window.supabaseClient
.from('notifications')
.update({ is_read: true })
.eq('user_id', currentUser.id)
.eq('is_read', false);
await loadNotifications();
showToast('All notifications marked as read', 'success');
} catch (error) {
console.error('Error marking all as read:', error);
}
}

// ‚úÖ FETCH CONTENT
async function fetchContent() {
try {
console.log('üîÑ Fetching trending content...');
setLoading(true, 'Loading trending content...');

let contentData = [];
try {
const contentResponse = await window.supabaseClient
.from('Content')
.select('*, user_profiles!user_id(*)')
.eq('status', 'published')
.order('created_at', { ascending: false })
.limit(100);
if (contentResponse.error) throw contentResponse.error;
contentData = contentResponse.data;
console.log('‚úÖ Fetched from Content table:', contentData.length, 'items');
} catch (error) {
console.log('‚ö†Ô∏è Trying lowercase content table...');
const contentResponse = await window.supabaseClient
.from('content')
.select('*, user_profiles!user_id(*)')
.eq('status', 'published')
.order('created_at', { ascending: false })
.limit(100);
if (contentResponse.error) throw contentResponse.error;
contentData = contentResponse.data;
console.log('‚úÖ Fetched from content table:', contentData.length, 'items');
}

const enrichedContent = await Promise.all(
(contentData || []).map(async (item) => {
const viewsResponse = await window.supabaseClient
.from('content_views')
.select('*', { count: 'exact', head: true })
.eq('content_id', item.id);
const viewsCount = viewsResponse.count || 0;
return {
...item,
real_views: viewsCount,
is_live: item.is_live || false,
viewer_count: item.viewer_count || viewsCount,
is_new: isContentNew(item.created_at)
};
})
);

console.log('‚úÖ Processed content:', enrichedContent.length, 'items');
return enrichedContent;
} catch (error) {
console.error('‚ùå Error fetching content:', error);
showToast('Failed to load content. Please refresh.', 'error');
return [];
} finally {
setLoading(false);
}
}

function isContentNew(createdAt) {
if (!createdAt) return false;
const daysAgo = (Date.now() - new Date(createdAt).getTime()) / (1000 * 60 * 60 * 24);
return daysAgo < 7;
}

// ‚úÖ PROCESS SECTIONS
function processTrendingSections(contentData) {
allContentData = contentData;
featuredTrend = [...contentData].sort((a, b) => (b.real_views || 0) - (a.real_views || 0)).slice(0, 1);
liveStreams = contentData.filter(item => item.is_live).slice(0, 10);
communityGems = [...contentData].sort((a, b) => {
const aScore = (a.real_views || 0) + ((a.likes_count || 0) * 2);
const bScore = (b.real_views || 0) + ((b.likes_count || 0) * 2);
return bScore - aScore;
}).slice(0, 20);
trendingHashtags = ['#OwnYourStage', '#BantuFuture', '#1MinComedy', '#SofaTalks', '#JoburgVibes', '#AfricanTalent', '#StreamConnect', '#RisingStars'];
console.log('‚úÖ Processed sections:', { featured: featuredTrend.length, live: liveStreams.length, gems: communityGems.length });
}

// ‚úÖ RENDER FILTER CHIPS
function renderFilterChips() {
if (!filterContainer) return;
filterContainer.innerHTML = filters.map(filter => `
<button class="filter-chip ${filter === selectedFilter ? 'active' : ''}" data-filter="${filter}">${filter.toUpperCase()}</button>
`).join('');
document.querySelectorAll('.filter-chip').forEach(button => {
button.addEventListener('click', () => onFilterSelected(button.dataset.filter));
});
}

// ‚úÖ RENDER SECTIONS
function renderTrendingSections() {
if (!trendingSections) return;
trendingSections.innerHTML = `
${featuredTrend.length > 0 ? `
<section class="section">
<div class="section-header">
<h2 class="section-title"><i class="fas fa-rocket section-icon"></i>THE PULSE</h2>
<button class="see-all-btn" onclick="viewAllTrending()">SEE ALL</button>
</div>
${renderFeaturedTrend()}
</section>
` : ''}
${liveStreams.length > 0 ? `
<section class="section">
<div class="section-header">
<h2 class="section-title"><i class="fas fa-tv section-icon"></i>LIVE STREAMS</h2>
<button class="see-all-btn" onclick="viewAllLiveStreams()">SEE ALL</button>
</div>
<div class="content-horizontal-scroll">${renderLiveStreams()}</div>
</section>
` : ''}
${trendingHashtags.length > 0 ? `
<section class="section">
<div class="section-header">
<h2 class="section-title"><i class="fas fa-fire section-icon"></i>TRENDING TOPICS</h2>
</div>
<div class="hashtags-container">${renderTrendingHashtags()}</div>
</section>
` : ''}
${communityGems.length > 0 ? `
<section class="section">
<div class="section-header">
<h2 class="section-title"><i class="fas fa-gem section-icon"></i>COMMUNITY GEMS</h2>
</div>
<div class="community-grid">${renderCommunityGems()}</div>
</section>
` : ''}
`;
setupContentCardListeners();
}

// ‚úÖ RENDER FEATURED (WITH FIXED IMAGES)
function renderFeaturedTrend() {
if (featuredTrend.length === 0) return '';
const content = featuredTrend[0];
const thumbnailUrl = buildThumbnailUrl(content.thumbnail_url);
return `
<div class="featured-trend-card" data-content-id="${content.id}">
<div class="featured-bg" style="background-image: url('${thumbnailUrl}')"></div>
<div class="featured-overlay">
${content.is_live ? '<div class="live-badge">LIVE NOW</div>' : ''}
<h2 class="featured-title">${escapeHtml(content.title)}</h2>
<div class="featured-creator">@${escapeHtml(content.user_profiles?.username || 'Creator')}</div>
<div class="featured-stats">
<span><i class="fas fa-eye"></i> ${formatNumber(content.real_views || 0)} views</span>
</div>
<button class="watch-now-btn" onclick="playContent('${content.id}')">${content.is_live ? 'WATCH LIVE' : 'WATCH NOW'}</button>
</div>
</div>
`;
}

// ‚úÖ RENDER LIVE STREAMS (WITH FIXED IMAGES)
function renderLiveStreams() {
return liveStreams.map(content => {
const thumbnailUrl = buildThumbnailUrl(content.thumbnail_url);
const isUpcoming = content.scheduled_time && new Date(content.scheduled_time) > new Date();
const creatorName = content.user_profiles?.username || 'Creator';
return `
<div class="content-card" data-content-id="${content.id}">
<div class="card-thumbnail">
${createImageElementHTML(thumbnailUrl, escapeHtml(content.title))}
<div class="thumbnail-overlay"></div>
<div class="card-badges">
${isUpcoming ? '<div class="badge upcoming">UPCOMING</div>' : '<div class="badge live">LIVE</div>'}
<div class="badge viewers"><i class="fas fa-eye"></i> ${formatNumber(content.viewer_count || 0)}</div>
</div>
</div>
<div class="card-content">
<h3 class="card-title">${escapeHtml(content.title)}</h3>
<div class="card-creator">@${escapeHtml(creatorName)}</div>
<div class="card-stats">
<span><i class="fas fa-heart"></i> ${formatNumber(content.likes_count || 0)}</span>
</div>
${isUpcoming ? `<button class="reminder-btn" onclick="setReminder('${content.id}')"><i class="fas fa-bell"></i> REMIND ME</button>` : ''}
</div>
</div>
`;
}).join('');
}

// ‚úÖ HELPER: CREATE IMAGE ELEMENT HTML
function createImageElementHTML(src, alt) {
const fallbackImages = [
'https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&h=450&fit=crop',
'https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?w=800&h=450&fit=crop',
'https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=800&h=450&fit=crop'
];
return `<img src="${src}" alt="${alt}" loading="lazy" onerror="this.onerror=null;this.src='${fallbackImages[0]}';this.parentElement.style.background='linear-gradient(135deg, #1D4ED8, #8B5CF6)';">`;
}

// ‚úÖ RENDER HASHTAGS
function renderTrendingHashtags() {
return trendingHashtags.map(hashtag => `<div class="hashtag" data-hashtag="${hashtag}">${hashtag}</div>`).join('');
}

// ‚úÖ RENDER COMMUNITY GEMS (WITH FIXED IMAGES)
function renderCommunityGems() {
return communityGems.map(content => {
const thumbnailUrl = buildThumbnailUrl(content.thumbnail_url);
const creatorName = content.user_profiles?.username || 'Creator';
return `
<div class="gem-card" data-content-id="${content.id}">
<div class="gem-thumbnail">
${createImageElementHTML(thumbnailUrl, escapeHtml(content.title))}
</div>
<div class="gem-content">
<h3 class="card-title">${escapeHtml(content.title)}</h3>
<div class="card-creator">@${escapeHtml(creatorName)}</div>
<div class="card-stats">
<span><i class="fas fa-eye"></i> ${formatNumber(content.real_views || 0)}</span>
<span><i class="fas fa-heart"></i> ${formatNumber(content.likes_count || 0)}</span>
</div>
</div>
</div>
`;
}).join('');
}

// ‚úÖ SETUP LISTENERS
function setupContentCardListeners() {
document.querySelectorAll('[data-content-id]').forEach(card => {
card.addEventListener('click', (e) => {
if (e.target.closest('button')) return;
playContent(card.dataset.contentId);
});
});
document.querySelectorAll('[data-hashtag]').forEach(hashtag => {
hashtag.addEventListener('click', () => {
window.location.href = `content-library.html?search=${encodeURIComponent(hashtag.dataset.hashtag)}`;
});
});
}

function onFilterSelected(filter) {
selectedFilter = filter;
document.querySelectorAll('.filter-chip').forEach(button => {
button.classList.toggle('active', button.dataset.filter === filter);
});
if (filter !== 'All') {
window.location.href = `content-library.html?genre=${encodeURIComponent(filter)}`;
}
}

// ‚úÖ PLAY CONTENT
async function playContent(contentId) {
try {
await window.supabaseClient
.from('content_views')
.insert({
content_id: contentId,
viewer_id: currentUser?.id || null,
view_duration: 0,
device_type: /Mobile|Android|iPhone/i.test(navigator.userAgent) ? 'mobile' : 'desktop',
created_at: new Date().toISOString()
});
} catch (error) {
console.warn('View recording failed:', error);
}
window.location.href = `content-detail.html?id=${contentId}`;
}

function setReminder(contentId) {
showToast('Reminder set successfully', 'success');
}

window.viewAllTrending = () => window.location.href = 'content-library.html?sort=trending';
window.viewAllLiveStreams = () => window.location.href = 'content-library.html?genre=Live';

// ‚úÖ LOAD CONTENT
async function loadContent() {
try {
setLoading(true, 'Loading trending content...');
const contentData = await fetchContent();
processTrendingSections(contentData);
renderFilterChips();
renderTrendingSections();
} catch (error) {
console.error('‚ùå Error loading content:', error);
showToast('Failed to load content', 'error');
} finally {
setLoading(false);
}
}

// ‚úÖ SETUP EVENT LISTENERS
function setupEventListeners() {
if (searchBtn) {
searchBtn.addEventListener('click', () => {
document.getElementById('search-modal').classList.add('active');
setTimeout(() => document.getElementById('search-input')?.focus(), 300);
});
}
document.getElementById('close-search-btn')?.addEventListener('click', () => {
document.getElementById('search-modal').classList.remove('active');
});
if (refreshBtn) refreshBtn.addEventListener('click', loadContent);
if (notificationsBtn) {
notificationsBtn.addEventListener('click', () => {
document.getElementById('notifications-panel').classList.add('active');
renderNotifications();
});
}
document.getElementById('close-notifications')?.addEventListener('click', () => {
document.getElementById('notifications-panel').classList.remove('active');
});
document.getElementById('mark-all-read')?.addEventListener('click', markAllNotificationsAsRead);
if (profileBtn) {
profileBtn.addEventListener('click', async () => {
const {  { session } } = await window.supabaseClient.auth.getSession();
window.location.href = session ? 'profile.html' : 'login.html';
});
}
if (exploreAllBtn) {
exploreAllBtn.addEventListener('click', () => {
window.location.href = 'content-library.html?sort=trending';
});
}
if (authLoginBtn) {
authLoginBtn.addEventListener('click', () => {
window.location.href = 'login.html?redirect=trending_screen.html';
});
}
if (authCancelBtn) {
authCancelBtn.addEventListener('click', () => {
authModal.classList.remove('active');
});
}
}

// ‚úÖ INITIALIZE
async function initializeTrendingScreen() {
console.log('üî• Initializing Trending Screen...');
if (searchModal) searchModal.classList.remove('active');
if (notificationsPanel) notificationsPanel.classList.remove('active');
if (authModal) authModal.classList.remove('active');

const isAuthenticated = await checkAuthentication();
if (!isAuthenticated) return;

setupEventListeners();
await loadContent();
console.log('‚úÖ Trending Screen initialized');
}

initializeTrendingScreen();

window.supabaseClient.auth.onAuthStateChange((event, session) => {
if (event === 'SIGNED_IN' && session?.user) {
currentUser = session.user;
loadUserProfilePicture(currentUser);
loadNotifications();
} else if (event === 'SIGNED_OUT') {
currentUser = null;
const placeholder = document.getElementById('userProfilePlaceholder');
if (placeholder) placeholder.innerHTML = '<div class="profile-placeholder"><i class="fas fa-user"></i></div>';
updateNotificationBadge(0);
if (authModal) authModal.classList.add('active');
}
});
});
</script>
</body>
</html>
