<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trending Now - Bantu Stream Connect</title>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Supabase JS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
/* Color Theme (from Flutter app) */
:root {
--deep-black: #0A0E12;
--deep-navy: #0F172A;
--soft-white: #F8FAFC;
--slate-grey: #94A3B8;
--bantu-blue: #1D4ED8;
--warm-gold: #F59E0B;
--error-color: #EF4444;
--success-color: #10B981;
--glow-blue-1: #00A3FF;
--glow-blue-2: #0066FF;
--glow-purple: #8B5CF6;
--glow-pink: #EC4899;
}
/* Reset & Base */
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, #001F54 0%, #0A0E3F 50%, #000000 100%);
color: var(--soft-white);
min-height: 100vh;
overflow-x: hidden;
}
/* Loading Screen */
.loading-screen {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(135deg, #001F54 0%, #0A0E3F 50%, #000000 100%);
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
z-index: 9999;
}
.spinner {
width: 60px;
height: 60px;
border: 4px solid rgba(255, 255, 255, 0.1);
border-radius: 50%;
border-top-color: var(--warm-gold);
animation: spin 1s linear infinite;
margin-bottom: 20px;
}
@keyframes spin {
to { transform: rotate(360deg); }
}
/* Glassmorphism Effects */
.glassmorphism {
background: rgba(255, 255, 255, 0.05);
backdrop-filter: blur(10px);
-webkit-backdrop-filter: blur(10px);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 16px;
box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
}
.glassmorphism-light {
background: rgba(255, 255, 255, 0.1);
backdrop-filter: blur(15px);
-webkit-backdrop-filter: blur(15px);
border: 1px solid rgba(255, 255, 255, 0.2);
}
/* Header with Background Animation */
.header-container {
position: relative;
min-height: 30vh;
overflow: hidden;
}
.header-bg {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: radial-gradient(circle at 20% 80%, var(--bantu-blue) 0%, transparent 50%),
radial-gradient(circle at 80% 20%, var(--glow-purple) 0%, transparent 50%);
opacity: 0.3;
}
.grid-pattern {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
background-size: 30px 30px;
}
/* Main Header */
.main-header {
position: relative;
padding: 20px;
z-index: 10;
}
.header-content {
display: flex;
justify-content: space-between;
align-items: flex-start;
max-width: 1200px;
margin: 0 auto;
}
.trending-title {
display: flex;
align-items: center;
gap: 15px;
}
.fire-icon {
font-size: 2.5rem;
color: var(--warm-gold);
animation: pulse 2s infinite;
}
@keyframes pulse {
0%, 100% { transform: scale(1); }
50% { transform: scale(1.1); }
}
.title-text {
font-family: 'Orbitron', sans-serif;
font-size: 2.5rem;
font-weight: 900;
background: linear-gradient(135deg, var(--soft-white) 0%, var(--warm-gold) 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
letter-spacing: 2px;
text-shadow: 0 0 30px rgba(245, 158, 11, 0.3);
}
.header-actions {
display: flex;
gap: 10px;
}
.icon-btn {
width: 50px;
height: 50px;
border-radius: 50%;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
color: white;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s ease;
font-size: 1.2rem;
}
.icon-btn:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-2px);
box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
}
.refresh-btn {
color: var(--bantu-blue);
animation: rotate 20s linear infinite;
animation-play-state: paused;
}
.refresh-btn:hover {
animation-play-state: running;
}
@keyframes rotate {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
/* Filter Chips */
.filter-section {
position: relative;
padding: 20px;
max-width: 1200px;
margin: 0 auto;
}
.filter-container {
display: flex;
gap: 10px;
overflow-x: auto;
padding-bottom: 10px;
scrollbar-width: thin;
scrollbar-color: var(--bantu-blue) transparent;
}
.filter-container::-webkit-scrollbar {
height: 6px;
}
.filter-container::-webkit-scrollbar-track {
background: rgba(255, 255, 255, 0.1);
border-radius: 3px;
}
.filter-container::-webkit-scrollbar-thumb {
background: var(--bantu-blue);
border-radius: 3px;
}
.filter-chip {
padding: 10px 20px;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 25px;
color: var(--soft-white);
font-family: 'Inter', sans-serif;
font-size: 0.9rem;
font-weight: 500;
cursor: pointer;
transition: all 0.3s ease;
white-space: nowrap;
}
.filter-chip:hover {
background: rgba(255, 255, 255, 0.1);
transform: translateY(-2px);
}
.filter-chip.active {
background: var(--warm-gold);
border-color: transparent;
color: var(--deep-black);
font-weight: 600;
box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
}
/* Main Content */
.main-content {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}
/* Sections */
.section {
margin-bottom: 40px;
}
.section-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}
.section-title {
font-family: 'Orbitron', sans-serif;
font-size: 1.8rem;
font-weight: 700;
color: var(--soft-white);
display: flex;
align-items: center;
gap: 10px;
}
.section-icon {
color: var(--warm-gold);
font-size: 1.5rem;
}
.see-all-btn {
padding: 8px 20px;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 10px;
color: var(--bantu-blue);
font-family: 'Orbitron', sans-serif;
font-size: 0.9rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}
.see-all-btn:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateX(5px);
}
/* Featured Trend Card */
.featured-trend-card {
position: relative;
border-radius: 20px;
overflow: hidden;
height: 400px;
margin-bottom: 30px;
}
.featured-bg {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-size: cover;
background-position: center;
transition: transform 0.5s ease;
}
.featured-trend-card:hover .featured-bg {
transform: scale(1.05);
}
.featured-overlay {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.8) 100%);
display: flex;
flex-direction: column;
justify-content: flex-end;
padding: 30px;
}
.live-badge {
display: inline-block;
padding: 8px 20px;
background: rgba(239, 68, 68, 0.9);
border-radius: 20px;
color: white;
font-weight: 700;
font-size: 0.9rem;
margin-bottom: 20px;
align-self: flex-start;
}
.featured-title {
font-family: 'Orbitron', sans-serif;
font-size: 2.5rem;
font-weight: 800;
color: white;
margin-bottom: 10px;
line-height: 1.2;
}
.featured-creator {
font-size: 1.2rem;
color: var(--warm-gold);
margin-bottom: 10px;
}
.featured-stats {
display: flex;
gap: 20px;
margin-bottom: 25px;
color: rgba(255, 255, 255, 0.8);
}
.watch-now-btn {
padding: 15px 40px;
background: linear-gradient(135deg, var(--warm-gold) 0%, #f97316 100%);
border: none;
border-radius: 12px;
color: var(--deep-black);
font-family: 'Inter', sans-serif;
font-size: 1.1rem;
font-weight: 700;
cursor: pointer;
transition: all 0.3s ease;
align-self: flex-start;
}
.watch-now-btn:hover {
transform: translateY(-3px);
box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
}
/* Content Grids */
.content-horizontal-scroll {
display: flex;
gap: 20px;
overflow-x: auto;
padding-bottom: 20px;
scrollbar-width: thin;
scrollbar-color: var(--bantu-blue) transparent;
}
.content-horizontal-scroll::-webkit-scrollbar {
height: 6px;
}
.content-horizontal-scroll::-webkit-scrollbar-track {
background: rgba(255, 255, 255, 0.1);
border-radius: 3px;
}
.content-horizontal-scroll::-webkit-scrollbar-thumb {
background: var(--bantu-blue);
border-radius: 3px;
}
.content-card {
flex: 0 0 300px;
border-radius: 15px;
overflow: hidden;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
transition: all 0.3s ease;
cursor: pointer;
}
.content-card:hover {
transform: translateY(-10px);
box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
border-color: rgba(255, 255, 255, 0.3);
}
.card-thumbnail {
position: relative;
height: 180px;
overflow: hidden;
}
.card-thumbnail img {
width: 100%;
height: 100%;
object-fit: cover;
transition: transform 0.3s ease;
}
.content-card:hover .card-thumbnail img {
transform: scale(1.1);
}
.thumbnail-overlay {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.5) 100%);
}
.card-badges {
position: absolute;
top: 15px;
left: 15px;
display: flex;
gap: 10px;
}
.badge {
padding: 5px 12px;
border-radius: 15px;
font-size: 0.8rem;
font-weight: 600;
}
.badge.live {
background: rgba(239, 68, 68, 0.9);
color: white;
}
.badge.upcoming {
background: rgba(29, 78, 216, 0.9);
color: white;
}
.badge.viewers {
background: rgba(0, 0, 0, 0.7);
color: white;
}
.card-content {
padding: 20px;
}
.card-title {
font-size: 1.1rem;
font-weight: 600;
margin-bottom: 10px;
line-height: 1.3;
display: -webkit-box;
-webkit-line-clamp: 2;
-webkit-box-orient: vertical;
overflow: hidden;
}
.card-creator {
font-size: 0.9rem;
color: var(--slate-grey);
margin-bottom: 10px;
}
.card-stats {
display: flex;
gap: 15px;
font-size: 0.8rem;
color: rgba(255, 255, 255, 0.6);
}
.reminder-btn {
width: 100%;
padding: 10px;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 8px;
color: white;
font-size: 0.9rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin-top: 10px;
}
.reminder-btn:hover {
background: rgba(255, 255, 255, 0.2);
}
/* Hashtags */
.hashtags-container {
display: flex;
flex-wrap: wrap;
gap: 10px;
margin-top: 15px;
}
.hashtag {
padding: 10px 20px;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 20px;
color: var(--warm-gold);
font-size: 0.9rem;
cursor: pointer;
transition: all 0.3s ease;
}
.hashtag:hover {
background: rgba(245, 158, 11, 0.1);
transform: translateY(-2px);
}
/* Community Gems Grid */
.community-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
gap: 20px;
}
.gem-card {
border-radius: 15px;
overflow: hidden;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.1);
transition: all 0.3s ease;
cursor: pointer;
}
.gem-card:hover {
transform: translateY(-5px);
box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
}
.gem-thumbnail {
height: 160px;
overflow: hidden;
}
.gem-thumbnail img {
width: 100%;
height: 100%;
object-fit: cover;
transition: transform 0.3s ease;
}
.gem-card:hover .gem-thumbnail img {
transform: scale(1.1);
}
.gem-content {
padding: 15px;
}
/* Explore All Section */
.explore-all-section {
text-align: center;
padding: 40px 20px;
}
.explore-btn {
padding: 20px 50px;
background: linear-gradient(135deg, var(--bantu-blue) 0%, #3730a3 100%);
border: none;
border-radius: 15px;
color: white;
font-family: 'Orbitron', sans-serif;
font-size: 1.2rem;
font-weight: 700;
cursor: pointer;
transition: all 0.3s ease;
display: inline-flex;
align-items: center;
gap: 15px;
}
.explore-btn:hover {
transform: translateY(-5px);
box-shadow: 0 15px 30px rgba(29, 78, 216, 0.4);
}
/* Toast */
.toast {
position: fixed;
bottom: 20px;
right: 20px;
padding: 15px 25px;
border-radius: 10px;
color: white;
font-weight: 500;
z-index: 1000;
animation: slideIn 0.3s ease;
max-width: 300px;
}
.toast.success {
background: linear-gradient(135deg, #51cf66 0%, #2b8a3e 100%);
}
.toast.info {
background: linear-gradient(135deg, #4dabf7 0%, #748ffc 100%);
}
@keyframes slideIn {
from {
transform: translateX(100%);
opacity: 0;
}
to {
transform: translateX(0);
opacity: 1;
}
}
/* Navigation */
.global-nav {
position: fixed;
bottom: 0;
left: 0;
width: 100%;
background: rgba(15, 23, 42, 0.95);
backdrop-filter: blur(10px);
display: flex;
justify-content: space-around;
padding: 15px 0;
z-index: 100;
border-top: 1px solid rgba(255, 255, 255, 0.1);
}
.nav-item {
display: flex;
flex-direction: column;
align-items: center;
color: var(--slate-grey);
text-decoration: none;
font-size: 0.8rem;
transition: all 0.3s ease;
}
.nav-item i {
font-size: 1.2rem;
margin-bottom: 5px;
}
.nav-item:hover {
color: var(--soft-white);
}
.nav-item.active {
color: var(--warm-gold);
}
/* Auth Modal */
.auth-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
display: none;
align-items: center;
justify-content: center;
z-index: 2000;
backdrop-filter: blur(5px);
}
.auth-modal.active {
display: flex;
}
.auth-content {
background: rgba(15, 23, 42, 0.9);
border-radius: 20px;
padding: 40px;
max-width: 400px;
width: 90%;
text-align: center;
border: 1px solid rgba(255, 255, 255, 0.1);
backdrop-filter: blur(20px);
}
.auth-icon {
font-size: 64px;
color: var(--warm-gold);
margin-bottom: 20px;
}
.auth-title {
font-family: 'Orbitron', sans-serif;
font-size: 24px;
margin-bottom: 15px;
color: var(--soft-white);
}
.auth-message {
color: var(--slate-grey);
margin-bottom: 30px;
line-height: 1.6;
}
.auth-buttons {
display: flex;
gap: 15px;
}
.auth-btn {
flex: 1;
padding: 15px;
border-radius: 12px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
border: none;
}
.auth-btn.login {
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
color: var(--soft-white);
border: 1px solid rgba(255, 255, 255, 0.1);
}
.auth-btn.login:hover {
transform: translateY(-2px);
box-shadow: 0 4px 15px rgba(29, 78, 216, 0.4);
}
.auth-btn.cancel {
background: rgba(255, 255, 255, 0.05);
border: 1px solid var(--card-border);
color: var(--soft-white);
}
.auth-btn.cancel:hover {
background: rgba(255, 255, 255, 0.1);
}
/* Search Modal */
.search-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.9);
display: none;
align-items: center;
justify-content: center;
z-index: 2000;
backdrop-filter: blur(5px);
}
.search-modal.active {
display: flex;
}
.search-modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
padding-bottom: 15px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
width: 100%;
}
.search-input-container {
position: relative;
width: 100%;
max-width: 600px;
}
.search-icon {
position: absolute;
left: 15px;
top: 50%;
transform: translateY(-50%);
color: var(--slate-grey);
font-size: 18px;
}
.search-input {
width: 100%;
padding: 15px 15px 15px 45px;
border-radius: 12px;
border: 1px solid rgba(255, 255, 255, 0.1);
background: rgba(15, 23, 42, 0.7);
color: var(--soft-white);
font-size: 16px;
backdrop-filter: blur(10px);
}
.search-input::placeholder {
color: var(--slate-grey);
}
.search-input:focus {
outline: none;
border-color: var(--warm-gold);
box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
}
.close-search-btn {
background: none;
border: none;
color: var(--soft-white);
font-size: 24px;
cursor: pointer;
width: 40px;
height: 40px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.3s ease;
}
.close-search-btn:hover {
background: rgba(255, 255, 255, 0.1);
transform: rotate(90deg);
}
.search-filters {
display: flex;
gap: 15px;
margin-bottom: 20px;
width: 100%;
max-width: 600px;
}
.filter-group {
flex: 1;
}
.filter-label {
display: block;
margin-bottom: 8px;
font-size: 14px;
color: var(--slate-grey);
}
.filter-select {
width: 100%;
padding: 12px;
border-radius: 10px;
border: 1px solid rgba(255, 255, 255, 0.1);
background: rgba(15, 23, 42, 0.7);
color: var(--soft-white);
font-size: 14px;
backdrop-filter: blur(10px);
}
.search-results {
width: 100%;
max-width: 800px;
max-height: 70vh;
overflow-y: auto;
}
.search-results-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
gap: 15px;
}
/* Notifications Panel */
.notifications-panel {
position: fixed;
top: 0;
right: -100%;
width: 400px;
height: 100%;
background: rgba(15, 23, 42, 0.9);
border-left: 1px solid rgba(255, 255, 255, 0.1);
box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
z-index: 1000;
transition: right 0.3s ease;
backdrop-filter: blur(10px);
}
.notifications-panel.active {
right: 0;
}
.notifications-header {
padding: 20px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
display: flex;
justify-content: space-between;
align-items: center;
}
.notifications-list {
max-height: calc(100vh - 150px);
overflow-y: auto;
padding: 20px;
}
.notification-item {
padding: 15px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
display: flex;
gap: 12px;
}
.notification-item.read {
opacity: 0.7;
}
.notification-icon {
width: 40px;
height: 40px;
border-radius: 50%;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
display: flex;
align-items: center;
justify-content: center;
flex-shrink: 0;
}
.notification-content {
flex: 1;
}
.notification-content h4 {
font-weight: 600;
margin-bottom: 5px;
color: var(--soft-white);
}
.notification-content p {
font-size: 14px;
color: var(--slate-grey);
margin-bottom: 8px;
}
.notification-time {
font-size: 12px;
color: var(--warm-gold);
}
.notification-dot {
width: 10px;
height: 10px;
border-radius: 50%;
background: var(--warm-gold);
position: absolute;
top: 15px;
right: 15px;
}
.notifications-footer {
padding: 20px;
border-top: 1px solid rgba(255, 255, 255, 0.1);
display: flex;
gap: 15px;
}
.text-btn {
flex: 1;
padding: 12px;
border-radius: 10px;
border: 1px solid rgba(255, 255, 255, 0.1);
background: rgba(255, 255, 255, 0.05);
color: var(--soft-white);
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}
.text-btn:hover {
background: rgba(245, 158, 11, 0.1);
border-color: var(--warm-gold);
}
/* Profile Button Styles */
.profile-btn {
width: 50px;
height: 50px;
border-radius: 50%;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
border: 2px solid rgba(255, 255, 255, 0.2);
cursor: pointer;
overflow: hidden;
transition: all 0.3s ease;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-weight: 600;
font-size: 18px;
}
.profile-btn:hover {
transform: translateY(-2px);
box-shadow: 0 8px 20px rgba(29, 78, 216, 0.3);
}
.profile-img {
width: 100%;
height: 100%;
object-fit: cover;
}
.profile-placeholder {
width: 100%;
height: 100%;
display: flex;
align-items: center;
justify-content: center;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
color: white;
font-size: 20px;
font-weight: bold;
}
/* Responsive */
@media (max-width: 768px) {
.title-text {
font-size: 1.8rem;
}
.fire-icon {
font-size: 2rem;
}
.featured-trend-card {
height: 300px;
}
.featured-title {
font-size: 1.8rem;
}
.content-card {
flex: 0 0 250px;
}
.community-grid {
grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
}
}
@media (max-width: 480px) {
.title-text {
font-size: 1.5rem;
}
.featured-trend-card {
height: 250px;
}
.featured-title {
font-size: 1.5rem;
}
.content-card {
flex: 0 0 200px;
}
.community-grid {
grid-template-columns: 1fr;
}
}
</style>
</head>
<body>
<!-- Loading Screen -->
<div id="loading" class="loading-screen">
<div class="spinner"></div>
<div id="loading-text">Loading Trending Content...</div>
</div>
<!-- Auth Modal -->
<div id="auth-modal" class="auth-modal">
<div class="auth-content">
<div class="auth-icon">
<i class="fas fa-lock"></i>
</div>
<h2 class="auth-title">Authentication Required</h2>
<p class="auth-message">You need to be logged in to view trending content and interact with the platform. Please sign in to continue.</p>
<div class="auth-buttons">
<button id="auth-login-btn" class="auth-btn login">Log In</button>
<button id="auth-cancel-btn" class="auth-btn cancel">Cancel</button>
</div>
</div>
</div>
<!-- Search Modal -->
<div id="search-modal" class="search-modal">
<div style="width: 90%; max-width: 800px; background: rgba(15, 23, 42, 0.9); border-radius: 20px; padding: 30px; backdrop-filter: blur(10px);">
<div class="search-modal-header">
<div class="search-input-container">
<i class="search-icon fas fa-search"></i>
<input type="text" id="search-input" class="search-input" placeholder="Search content, creators, or categories..." autocomplete="off">
</div>
<button id="close-search-btn" class="close-search-btn">
<i class="fas fa-times"></i>
</button>
</div>
<div class="search-filters">
<div class="filter-group">
<label class="filter-label">Category</label>
<select id="category-filter" class="filter-select">
<option value="">All Categories</option>
<option value="Music">Music</option>
<option value="STEM">STEM</option>
<option value="Culture">Culture</option>
<option value="News">News</option>
<option value="Sports">Sports</option>
<option value="Movies">Movies</option>
<option value="Documentaries">Documentaries</option>
<option value="Podcasts">Podcasts</option>
</select>
</div>
<div class="filter-group">
<label class="filter-label">Sort By</label>
<select id="sort-filter" class="filter-select">
<option value="newest">Newest First</option>
<option value="popular">Most Popular</option>
<option value="trending">Trending</option>
</select>
</div>
</div>
<div class="search-results">
<div id="search-results-grid" class="search-results-grid">
<!-- Results loaded here -->
</div>
</div>
</div>
</div>
<!-- Notifications Panel -->
<div id="notifications-panel" class="notifications-panel">
<div class="notifications-header">
<h2 style="font-family: 'Orbitron', sans-serif; font-size: 20px; margin: 0; color: var(--soft-white);">Notifications</h2>
<button id="close-notifications" class="close-search-btn">
<i class="fas fa-times"></i>
</button>
</div>
<div class="notifications-list" id="notifications-list">
<!-- Notifications loaded here -->
</div>
<div class="notifications-footer">
<button id="mark-all-read" class="text-btn">Mark all as read</button>
<button id="notification-settings" class="text-btn">Settings</button>
</div>
</div>
<!-- Main App (hidden until loaded) -->
<div id="app" style="display: none;">
<!-- Animated Header Background -->
<div class="header-container">
<div class="header-bg"></div>
<div class="grid-pattern"></div>
<!-- Main Header -->
<header class="main-header">
<div class="header-content">
<div class="trending-title">
<div class="fire-icon">üî•</div>
<h1 class="title-text">TRENDING NOW</h1>
</div>
<div class="header-actions">
<button id="search-btn" class="icon-btn" title="Search">
<i class="fas fa-search"></i>
</button>
<button id="refresh-btn" class="icon-btn refresh-btn" title="Refresh">
<i class="fas fa-sync-alt"></i>
</button>
<button id="notifications-btn" class="icon-btn" title="Notifications">
<i class="fas fa-bell"></i>
<span class="notification-badge" id="notification-count" style="display: none; position: absolute; top: -5px; right: -5px; background: var(--error-color); color: white; font-size: 10px; font-weight: bold; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid var(--deep-black);">0</span>
</button>
<button id="profile-btn" class="profile-btn" title="Profile">
<div class="profile-placeholder" id="userProfilePlaceholder">
<i class="fas fa-user"></i>
</div>
</button>
</div>
</div>
</header>
<!-- Filter Chips -->
<div class="filter-section">
<div id="filter-container" class="filter-container">
<!-- Filter chips will be loaded here -->
</div>
</div>
</div>
<!-- Main Content -->
<main class="main-content">
<!-- Trending Sections will be loaded here -->
<div id="trending-sections">
<!-- Content will be loaded dynamically -->
</div>
<!-- Explore All Section -->
<div class="explore-all-section">
<button id="explore-all-btn" class="explore-btn">
EXPLORE ALL TRENDING CONTENT
<i class="fas fa-arrow-right"></i>
</button>
</div>
</main>
<!-- Global Navigation -->
<nav class="global-nav">
<a href="index.html" class="nav-item">
<i class="fas fa-home"></i>
Home
</a>
<a href="trending_screen.html" class="nav-item active">
<i class="fas fa-fire"></i>
Trending
</a>
<a href="content-library.html" class="nav-item">
<i class="fas fa-th-large"></i>
Library
</a>
<a href="creator-dashboard.html" class="nav-item">
<i class="fas fa-user"></i>
Creator
</a>
</nav>
</div>
<!-- Toast Container -->
<div id="toast-container"></div>

<!-- CRITICAL FIX: Initialize shared Supabase client BEFORE DOMContentLoaded -->
<script>
if (!window.supabaseClient) {
  window.supabaseClient = supabase.createClient(
    'https://ydnxqnbjoshvxteevemc.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U'
  );
  console.log('‚úÖ Global Supabase client initialized for trending screen');
}
</script>

<!-- TRENDING SCREEN JAVASCRIPT - FULLY UPGRADED -->
<script>
document.addEventListener('DOMContentLoaded', async () => {
  console.log('üî• Trending Screen Initializing with authentication and profile fixes...');
  
  // DOM Elements
  const loadingScreen = document.getElementById('loading');
  const loadingText = document.getElementById('loading-text');
  const app = document.getElementById('app');
  const authModal = document.getElementById('auth-modal');
  const filterContainer = document.getElementById('filter-container');
  const trendingSections = document.getElementById('trending-sections');
  const searchBtn = document.getElementById('search-btn');
  const refreshBtn = document.getElementById('refresh-btn');
  const notificationsBtn = document.getElementById('notifications-btn');
  const profileBtn = document.getElementById('profile-btn');
  const exploreAllBtn = document.getElementById('explore-all-btn');
  const authLoginBtn = document.getElementById('auth-login-btn');
  const authCancelBtn = document.getElementById('auth-cancel-btn');
  
  // State variables
  let currentUser = null;
  let allContentData = [];
  let featuredTrend = [];
  let liveStreams = [];
  let communityGems = [];
  let trendingHashtags = [];
  let selectedFilter = 'All';
  let notifications = [];
  
  // Filters
  const filters = [
    'All', 'Music', 'Film & Series', 'Podcasts',
    'Gaming', 'Comedy', 'Live', 'Top 24 Hrs', 'Rising Creators'
  ];
  
  // ‚úÖ SHOW/HIDE LOADING
  function setLoading(loading, text = '') {
    if (text) loadingText.textContent = text;
    if (loading) {
      loadingScreen.style.display = 'flex';
      app.style.display = 'none';
    } else {
      setTimeout(() => {
        loadingScreen.style.display = 'none';
        app.style.display = 'block';
      }, 500);
    }
  }
  
  // ‚úÖ SHOW TOAST MESSAGE
  function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    const container = document.getElementById('toast-container');
    container.appendChild(toast);
    setTimeout(() => {
      toast.style.opacity = '0';
      toast.style.transform = 'translateX(100%)';
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }
  
  // ‚úÖ FORMAT NUMBERS
  function formatNumber(num) {
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
    return num.toString();
  }
  
  // ‚úÖ GET INITIALS FROM EMAIL
  function getInitials(email) {
    if (!email) return 'U';
    const parts = email.split('@')[0];
    return parts.substring(0, 2).toUpperCase();
  }
  
  // ‚úÖ GET INITIALS FROM FULL NAME
  function getInitialsFromName(fullName) {
    if (!fullName) return 'U';
    const names = fullName.split(' ');
    if (names.length >= 2) {
      return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();
    }
    return fullName.charAt(0).toUpperCase();
  }
  
  // üîë CRITICAL FIX: Load profile picture with SAFE PROPERTY ACCESS (NO DESTRUCTURING)
  async function loadUserProfilePicture(user) {
    try {
      if (!user || !profileBtn) return;
      
      const placeholder = document.getElementById('userProfilePlaceholder');
      if (!placeholder) return;
      
      // Clear existing content safely
      while (placeholder.firstChild) {
        placeholder.removeChild(placeholder.firstChild);
      }
      
      const userInitials = getInitials(user.email);
      
      // Fetch user profile from database
      const profileResponse = await window.supabaseClient
        .from('user_profiles')
        .select('*')
        .eq('id', user.id)
        .maybeSingle();
      
      const profile = profileResponse.data;
      const profileError = profileResponse.error;
      
      if (profileError) {
        console.log('Profile query error:', profileError);
        // Fallback to email initials
        const fallback = document.createElement('div');
        fallback.className = 'profile-placeholder';
        fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
        fallback.textContent = userInitials;
        placeholder.appendChild(fallback);
        return;
      }
      
      if (profile) {
        const displayName = profile.full_name || profile.username || user.email || 'User';
        const initial = getInitials(displayName);
        
        // If avatar URL exists, display it
        if (profile.avatar_url) {
          let avatarUrl = profile.avatar_url;
          
          // Construct full URL safely
          try {
            if (!avatarUrl.startsWith('http')) {
              if (avatarUrl.startsWith('avatars/')) {
                avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${avatarUrl}`;
              } else {
                avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/avatars/${avatarUrl}`;
              }
            }
            
            // Create image element with proper styling
            const img = document.createElement('img');
            img.className = 'profile-img';
            img.alt = displayName;
            img.style.cssText = 'width: 100%; height: 100%; border-radius: 50%; object-fit: cover;';
            img.src = avatarUrl;
            
            // Fallback to initials if image fails to load
            img.onerror = () => {
              console.log('Avatar image failed to load, falling back to initials');
              const fallbackInitials = profile.full_name ? getInitialsFromName(profile.full_name) : userInitials;
              const fallback = document.createElement('div');
              fallback.className = 'profile-placeholder';
              fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
              fallback.textContent = fallbackInitials;
              placeholder.innerHTML = '';
              placeholder.appendChild(fallback);
            };
            
            placeholder.appendChild(img);
          } catch (e) {
            console.error('Error constructing avatar URL:', e);
            // Fallback to initials
            const fallback = document.createElement('div');
            fallback.className = 'profile-placeholder';
            fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
            fallback.textContent = initial;
            placeholder.appendChild(fallback);
          }
        } else {
          // If no avatar but full name exists, use name initials
          const nameInitials = profile.full_name ? getInitialsFromName(profile.full_name) : userInitials;
          const fallback = document.createElement('div');
          fallback.className = 'profile-placeholder';
          fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
          fallback.textContent = nameInitials;
          placeholder.appendChild(fallback);
        }
      } else {
        // No profile found, use email initials
        const fallback = document.createElement('div');
        fallback.className = 'profile-placeholder';
        fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
        fallback.textContent = userInitials;
        placeholder.appendChild(fallback);
      }
    } catch (error) {
      console.error('Error loading user profile picture:', error);
      // Fallback to email initials
      const placeholder = document.getElementById('userProfilePlaceholder');
      if (placeholder) {
        const userInitials = getInitials(user.email);
        const fallback = document.createElement('div');
        fallback.className = 'profile-placeholder';
        fallback.style.cssText = 'width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#1D4ED8,#F59E0B);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:20px';
        fallback.textContent = userInitials;
        placeholder.innerHTML = '';
        placeholder.appendChild(fallback);
      }
    }
  }
  
  // üîë CRITICAL FIX: Check authentication with SAFE PROPERTY ACCESS
  async function checkAuthentication() {
    try {
      setLoading(true, 'Checking authentication...');
      
      // SAFE PROPERTY ACCESS - NO DESTRUCTURING
      const sessionResponse = await window.supabaseClient.auth.getSession();
      const session = sessionResponse.data.session;
      const error = sessionResponse.error;
      
      if (error || !session?.user) {
        console.log('‚ö†Ô∏è User not authenticated');
        showToast('Please sign in to access trending content', 'error');
        authModal.classList.add('active');
        return false;
      }
      
      currentUser = session.user;
      console.log('‚úÖ User authenticated:', currentUser.email);
      
      // Load user profile picture
      await loadUserProfilePicture(currentUser);
      
      // Load notifications
      await loadNotifications();
      
      return true;
    } catch (error) {
      console.error('‚ùå Authentication error:', error);
      return false;
    }
  }
  
  // üîë CRITICAL FIX: Load notifications with SAFE PROPERTY ACCESS
  async function loadNotifications() {
    try {
      if (!currentUser) {
        updateNotificationBadge(0);
        return;
      }
      
      // SAFE PROPERTY ACCESS
      const notificationsResponse = await window.supabaseClient
        .from('notifications')
        .select('*')
        .eq('user_id', currentUser.id)
        .order('created_at', { ascending: false })
        .limit(20);
      
      const data = notificationsResponse.data;
      const error = notificationsResponse.error;
      
      if (error) throw error;
      
      notifications = data || [];
      const unreadCount = notifications.filter(n => !n.is_read).length;
      updateNotificationBadge(unreadCount);
      renderNotifications();
    } catch (error) {
      console.error('Error loading notifications:', error);
      updateNotificationBadge(0);
    }
  }
  
  // üîë CRITICAL FIX: Update notification badge
  function updateNotificationBadge(count = null) {
    if (count === null) {
      count = notifications.filter(n => !n.is_read).length;
    }
    
    const badge = document.getElementById('notification-count');
    if (badge) {
      badge.textContent = count > 99 ? '99+' : count;
      badge.style.display = count > 0 ? 'flex' : 'none';
    }
  }
  
  // üîë CRITICAL FIX: Render notifications
  function renderNotifications() {
    const notificationsList = document.getElementById('notifications-list');
    if (!notificationsList) return;
    
    if (!currentUser) {
      notificationsList.innerHTML = `
        <div style="text-align:center;padding:40px 20px;color:var(--slate-grey)">
          <i class="fas fa-bell-slash" style="font-size:48px;margin-bottom:15px;opacity:0.5"></i>
          <p>Sign in to see notifications</p>
        </div>
      `;
      return;
    }
    
    if (!notifications || notifications.length === 0) {
      notificationsList.innerHTML = `
        <div style="text-align:center;padding:40px 20px;color:var(--slate-grey)">
          <i class="fas fa-bell" style="font-size:48px;margin-bottom:15px;opacity:0.3"></i>
          <p>No notifications yet</p>
        </div>
      `;
      return;
    }
    
    notificationsList.innerHTML = notifications.map(notification => `
      <div class="notification-item ${notification.is_read ? 'read' : 'unread'}" data-id="${notification.id}">
        <div class="notification-icon">
          <i class="${getNotificationIcon(notification.type)}" style="color:white"></i>
        </div>
        <div class="notification-content">
          <h4>${escapeHtml(notification.title)}</h4>
          <p>${escapeHtml(notification.message)}</p>
          <span class="notification-time">${formatNotificationTime(notification.created_at)}</span>
        </div>
        ${!notification.is_read ? '<div class="notification-dot"></div>' : ''}
      </div>
    `).join('');
    
    // Add click handlers
    notificationsList.querySelectorAll('.notification-item').forEach(item => {
      item.addEventListener('click', async () => {
        const id = item.dataset.id;
        await markNotificationAsRead(id);
        if (item.dataset.contentId) {
          window.location.href = `content-detail.html?id=${item.dataset.contentId}`;
        }
        document.getElementById('notifications-panel').classList.remove('active');
      });
    });
  }
  
  // üîë CRITICAL FIX: Get notification icon
  function getNotificationIcon(type) {
    switch(type) {
      case 'like': return 'fas fa-heart';
      case 'comment': return 'fas fa-comment';
      case 'follow': return 'fas fa-user-plus';
      case 'view_milestone': return 'fas fa-trophy';
      case 'system': return 'fas fa-bell';
      default: return 'fas fa-bell';
    }
  }
  
  // üîë CRITICAL FIX: Format notification time
  function formatNotificationTime(timestamp) {
    if (!timestamp) return 'Just now';
    const diffMs = Date.now() - new Date(timestamp).getTime();
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 1) return 'Just now';
    if (diffMins < 60) return `${diffMins}m ago`;
    if (diffHours < 24) return `${diffHours}h ago`;
    if (diffDays < 7) return `${diffDays}d ago`;
    return new Date(timestamp).toLocaleDateString();
  }
  
  // üîë CRITICAL FIX: Escape HTML
  function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
  
  // üîë CRITICAL FIX: Mark notification as read
  async function markNotificationAsRead(notificationId) {
    try {
      const { error } = await window.supabaseClient
        .from('notifications')
        .update({ is_read: true })
        .eq('id', notificationId);
      
      if (error) throw error;
      
      // Update UI
      const item = document.querySelector(`.notification-item[data-id="${notificationId}"]`);
      if (item) {
        item.classList.remove('unread');
        item.classList.add('read');
        const dot = item.querySelector('.notification-dot');
        if (dot) dot.remove();
      }
      
      await loadNotifications();
    } catch (error) {
      console.error('Error marking notification as read:', error);
    }
  }
  
  // üîë CRITICAL FIX: Mark all notifications as read
  async function markAllNotificationsAsRead() {
    try {
      if (!currentUser) return;
      
      const { error } = await window.supabaseClient
        .from('notifications')
        .update({ is_read: true })
        .eq('user_id', currentUser.id)
        .eq('is_read', false);
      
      if (error) throw error;
      
      // Update UI
      document.querySelectorAll('.notification-item.unread').forEach(item => {
        item.classList.remove('unread');
        item.classList.add('read');
        const dot = item.querySelector('.notification-dot');
        if (dot) dot.remove();
      });
      
      updateNotificationBadge(0);
      showToast('All notifications marked as read', 'success');
    } catch (error) {
      console.error('Error marking all notifications as read:', error);
      showToast('Failed to mark notifications as read', 'error');
    }
  }
  
  // üîë CRITICAL FIX: Fetch content with SAFE PROPERTY ACCESS and RLS compliance
  async function fetchContent() {
    try {
      console.log('üîÑ Fetching trending content from Supabase...');
      setLoading(true, 'Loading trending content...');
      
      // Try Content table first (capital C)
      let contentData = [];
      try {
        const contentResponse = await window.supabaseClient
          .from('Content')
          .select('*, user_profiles!user_id(*)')
          .eq('status', 'published')
          .order('created_at', { ascending: false })
          .limit(100);
        
        if (contentResponse.error) throw contentResponse.error;
        contentData = contentResponse.data;
        console.log('‚úÖ Fetched from Content table:', contentData.length, 'items');
      } catch (error) {
        console.log('‚ö†Ô∏è Content table failed, trying content table (lowercase)...');
        // Try lowercase table name
        try {
          const contentResponse = await window.supabaseClient
            .from('content')
            .select('*, user_profiles!user_id(*)')
            .eq('status', 'published')
            .order('created_at', { ascending: false })
            .limit(100);
          
          if (contentResponse.error) throw contentResponse.error;
          contentData = contentResponse.data;
          console.log('‚úÖ Fetched from content table:', contentData.length, 'items');
        } catch (error2) {
          console.error('‚ùå Both table names failed:', error2);
          showToast('Failed to load content. Please refresh.', 'error');
          return [];
        }
      }
      
      // Enrich with real view counts from content_views table
      const enrichedContent = await Promise.all(
        (contentData || []).map(async (item) => {
          // Get real view count from content_views table
          const viewsResponse = await window.supabaseClient
            .from('content_views')
            .select('*', { count: 'exact', head: true })
            .eq('content_id', item.id);
          
          const viewsCount = viewsResponse.count || 0;
          
          return {
            ...item,
            real_views: viewsCount,
            is_live: item.is_live || false,
            viewer_count: item.viewer_count || viewsCount,
            is_new: isContentNew(item.created_at)
          };
        })
      );
      
      console.log('‚úÖ Processed content:', enrichedContent.length, 'items');
      return enrichedContent;
    } catch (error) {
      console.error('‚ùå Error fetching content:', error);
      showToast('Failed to load trending content. Please refresh.', 'error');
      return [];
    } finally {
      setLoading(false);
    }
  }
  
  // ‚úÖ CHECK IF CONTENT IS NEW (less than 7 days old)
  function isContentNew(createdAt) {
    if (!createdAt) return false;
    try {
      const createdDate = new Date(createdAt);
      const daysAgo = (Date.now() - createdDate.getTime()) / (1000 * 60 * 60 * 24);
      return daysAgo < 7;
    } catch {
      return false;
    }
  }
  
  // ‚úÖ PROCESS TRENDING SECTIONS
  function processTrendingSections(contentData) {
    allContentData = contentData;
    
    // Featured Trend - Top content by views
    featuredTrend = [...contentData]
      .sort((a, b) => (b.real_views || b.views_count || 0) - (a.real_views || a.views_count || 0))
      .slice(0, 1);
    
    // Live Streams - Content that is live
    liveStreams = contentData
      .filter(item => item.is_live)
      .slice(0, 10);
    
    // Community Gems - Content with good engagement
    communityGems = [...contentData]
      .sort((a, b) => {
        const aScore = (a.real_views || a.views_count || 0) + 
                      ((a.likes_count || a.likes || 0) * 2) + 
                      ((a.comments_count || 0) * 3);
        const bScore = (b.real_views || b.views_count || 0) + 
                      ((b.likes_count || b.likes || 0) * 2) + 
                      ((b.comments_count || 0) * 3);
        return bScore - aScore;
      })
      .slice(0, 20);
    
    // Trending Hashtags
    trendingHashtags = [
      '#OwnYourStage',
      '#BantuFuture',
      '#1MinComedy',
      '#SofaTalks',
      '#JoburgVibes',
      '#AfricanTalent',
      '#StreamConnect',
      '#RisingStars'
    ];
    
    console.log('‚úÖ Processed sections:', {
      featured: featuredTrend.length,
      live: liveStreams.length,
      gems: communityGems.length,
      hashtags: trendingHashtags.length
    });
  }
  
  // ‚úÖ RENDER FILTER CHIPS
  function renderFilterChips() {
    if (!filterContainer) return;
    filterContainer.innerHTML = filters.map(filter => `
      <button class="filter-chip ${filter === selectedFilter ? 'active' : ''}"
              data-filter="${filter}">
        ${filter.toUpperCase()}
      </button>
    `).join('');
    
    // Add click handlers
    document.querySelectorAll('.filter-chip').forEach(button => {
      button.addEventListener('click', () => {
        const filter = button.dataset.filter;
        onFilterSelected(filter);
      });
    });
  }
  
  // ‚úÖ RENDER TRENDING SECTIONS
  function renderTrendingSections() {
    if (!trendingSections) return;
    trendingSections.innerHTML = `
      <!-- Featured Trend Section -->
      ${featuredTrend.length > 0 ? `
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-rocket section-icon"></i>
            THE PULSE
          </h2>
          <button class="see-all-btn" onclick="viewAllTrending()">
            SEE ALL
          </button>
        </div>
        ${renderFeaturedTrend()}
      </section>
      ` : ''}
      
      <!-- Live Streams Section -->
      ${liveStreams.length > 0 ? `
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-tv section-icon"></i>
            LIVE STREAMS
          </h2>
          <button class="see-all-btn" onclick="viewAllLiveStreams()">
            SEE ALL
          </button>
        </div>
        <div class="content-horizontal-scroll">
          ${renderLiveStreams()}
        </div>
      </section>
      ` : ''}
      
      <!-- Trending Hashtags Section -->
      ${trendingHashtags.length > 0 ? `
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-fire section-icon"></i>
            TRENDING TOPICS
          </h2>
        </div>
        <div class="hashtags-container">
          ${renderTrendingHashtags()}
        </div>
      </section>
      ` : ''}
      
      <!-- Community Gems Section -->
      ${communityGems.length > 0 ? `
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-gem section-icon"></i>
            COMMUNITY GEMS
          </h2>
        </div>
        <div class="community-grid">
          ${renderCommunityGems()}
        </div>
      </section>
      ` : ''}
    `;
    
    // Setup event listeners for content cards
    setupContentCardListeners();
  }
  
  // ‚úÖ RENDER FEATURED TREND
  function renderFeaturedTrend() {
    if (featuredTrend.length === 0) return '';
    const content = featuredTrend[0];
    const thumbnailUrl = content.thumbnail_url ?
      `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${content.thumbnail_url.replace(/^\/+/, '')}` :
      'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=1200&h=675&fit=crop';
    return `
      <div class="featured-trend-card" data-content-id="${content.id}">
        <div class="featured-bg" style="background-image: url('${thumbnailUrl}')"></div>
        <div class="featured-overlay">
          ${content.is_live ? '<div class="live-badge">LIVE NOW</div>' : ''}
          <h2 class="featured-title">${content.title}</h2>
          <div class="featured-creator">@${content.user_profiles?.username || content.creator || 'Creator'}</div>
          <div class="featured-stats">
            <span><i class="fas fa-eye"></i> ${formatNumber(content.real_views || content.views_count || 0)} views</span>
            <span><i class="fas fa-heart"></i> ${formatNumber(content.likes_count || content.likes || 0)} likes</span>
            <span><i class="fas fa-comment"></i> ${formatNumber(content.comments_count || 0)} comments</span>
          </div>
          <button class="watch-now-btn" onclick="playContent(${content.id})">
            ${content.is_live ? 'WATCH LIVE' : 'WATCH NOW'}
          </button>
        </div>
      </div>
    `;
  }
  
  // ‚úÖ RENDER LIVE STREAMS
  function renderLiveStreams() {
    return liveStreams.map(content => {
      const thumbnailUrl = content.thumbnail_url ?
        `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${content.thumbnail_url.replace(/^\/+/, '')}` :
        'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=400&h=225&fit=crop';
      const isUpcoming = content.scheduled_time && new Date(content.scheduled_time) > new Date();
      const creatorName = content.user_profiles?.username || content.creator || 'Creator';
      return `
        <div class="content-card" data-content-id="${content.id}">
          <div class="card-thumbnail">
            <img src="${thumbnailUrl}" alt="${content.title}">
            <div class="thumbnail-overlay"></div>
            <div class="card-badges">
              ${isUpcoming ?
                '<div class="badge upcoming">UPCOMING</div>' :
                '<div class="badge live">LIVE</div>'
              }
              <div class="badge viewers">
                <i class="fas fa-eye"></i> ${formatNumber(content.viewer_count || content.real_views || content.views_count || 0)}
              </div>
            </div>
          </div>
          <div class="card-content">
            <h3 class="card-title">${content.title}</h3>
            <div class="card-creator">@${creatorName}</div>
            <div class="card-stats">
              <span><i class="fas fa-heart"></i> ${formatNumber(content.likes_count || content.likes || 0)}</span>
              <span><i class="fas fa-comment"></i> ${formatNumber(content.comments_count || 0)}</span>
            </div>
            ${isUpcoming ? `
              <button class="reminder-btn" onclick="setReminder(${content.id})">
                <i class="fas fa-bell"></i> REMIND ME
              </button>
            ` : ''}
          </div>
        </div>
      `;
    }).join('');
  }
  
  // ‚úÖ RENDER TRENDING HASHTAGS
  function renderTrendingHashtags() {
    return trendingHashtags.map(hashtag => `
      <div class="hashtag" data-hashtag="${hashtag}">
        ${hashtag}
      </div>
    `).join('');
  }
  
  // ‚úÖ RENDER COMMUNITY GEMS
  function renderCommunityGems() {
    return communityGems.map(content => {
      const thumbnailUrl = content.thumbnail_url ?
        `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${content.thumbnail_url.replace(/^\/+/, '')}` :
        'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=400&h=225&fit=crop';
      const creatorName = content.user_profiles?.username || content.creator || 'Creator';
      return `
        <div class="gem-card" data-content-id="${content.id}">
          <div class="gem-thumbnail">
            <img src="${thumbnailUrl}" alt="${content.title}">
          </div>
          <div class="gem-content">
            <h3 class="card-title">${content.title}</h3>
            <div class="card-creator">@${creatorName}</div>
            <div class="card-stats">
              <span><i class="fas fa-eye"></i> ${formatNumber(content.real_views || content.views_count || 0)}</span>
              <span><i class="fas fa-heart"></i> ${formatNumber(content.likes_count || content.likes || 0)}</span>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }
  
  // ‚úÖ SETUP CONTENT CARD LISTENERS
  function setupContentCardListeners() {
    // Content card clicks
    document.querySelectorAll('[data-content-id]').forEach(card => {
      card.addEventListener('click', (e) => {
        // Don't trigger if clicking a button inside the card
        if (e.target.closest('button')) return;
        const contentId = card.dataset.contentId;
        playContent(contentId);
      });
    });
    
    // Hashtag clicks
    document.querySelectorAll('[data-hashtag]').forEach(hashtag => {
      hashtag.addEventListener('click', () => {
        const tag = hashtag.dataset.hashtag;
        window.location.href = `content-library.html?search=${encodeURIComponent(tag)}`;
      });
    });
  }
  
  // ‚úÖ FILTER SELECTION HANDLER
  function onFilterSelected(filter) {
    selectedFilter = filter;
    // Update active filter chip
    document.querySelectorAll('.filter-chip').forEach(button => {
      button.classList.toggle('active', button.dataset.filter === filter);
    });
    if (filter !== 'All') {
      const genreMap = {
        'Music': 'Music',
        'Film & Series': 'Films',
        'Podcasts': 'Podcasts',
        'Gaming': 'Gaming',
        'Comedy': 'Comedy',
        'Live': 'Live',
        'Top 24 Hrs': 'Recent',
        'Rising Creators': 'Rising'
      };
      const genre = genreMap[filter] || filter;
      window.location.href = `content-library.html?genre=${encodeURIComponent(genre)}`;
    }
  }
  
  // ‚úÖ PLAY CONTENT FUNCTION - RECORDS VIEW THEN NAVIGATES
  async function playContent(contentId) {
    // First record the view
    try {
      // Get viewer ID (only if authenticated)
      let viewerId = null;
      if (currentUser) {
        viewerId = currentUser.id;
      }
      
      // INSERT into content_views table
      const { error } = await window.supabaseClient
        .from('content_views')
        .insert({
          content_id: contentId,
          viewer_id: viewerId,
          view_duration: 0,
          device_type: /Mobile|Android|iP(hone|od)|IEMobile|Windows Phone|BlackBerry/i.test(navigator.userAgent)
            ? 'mobile'
            : 'desktop',
          created_at: new Date().toISOString()
        });
      
      if (error) {
        console.error('‚ùå View recording failed:', error);
      } else {
        console.log('‚úÖ View recorded successfully');
      }
    } catch (error) {
      console.error('‚ùå View recording error:', error);
    }
    
    // Navigate to video player
    window.location.href = `content-detail.html?id=${contentId}`;
  }
  
  // ‚úÖ SET REMINDER FUNCTION
  function setReminder(contentId) {
    const content = liveStreams.find(item => item.id == contentId);
    if (content) {
      showToast(`Reminder set for "${content.title}"`, 'success');
    }
  }
  
  // ‚úÖ VIEW ALL TRENDING
  window.viewAllTrending = function() {
    window.location.href = 'content-library.html?sort=trending';
  };
  
  // ‚úÖ VIEW ALL LIVE STREAMS
  window.viewAllLiveStreams = function() {
    window.location.href = 'content-library.html?genre=Live';
  };
  
  // ‚úÖ REFRESH CONTENT
  async function refreshContent() {
    setLoading(true, 'Refreshing trending content...');
    await loadContent();
    showToast('Trending content refreshed!', 'success');
    setLoading(false);
  }
  
  // ‚úÖ LOAD ALL CONTENT AND RENDER
  async function loadContent() {
    try {
      setLoading(true, 'Loading trending content...');
      // Fetch content
      const contentData = await fetchContent();
      // Process into sections
      processTrendingSections(contentData);
      // Render UI
      renderFilterChips();
      renderTrendingSections();
      setLoading(false);
    } catch (error) {
      console.error('‚ùå Error loading content:', error);
      showToast('Failed to load trending content', 'error');
      setLoading(false);
    }
  }
  
  // ‚úÖ SETUP EVENT LISTENERS
  function setupEventListeners() {
    // Search button
    if (searchBtn) {
      searchBtn.addEventListener('click', () => {
        document.getElementById('search-modal').classList.add('active');
        setTimeout(() => document.getElementById('search-input')?.focus(), 300);
      });
    }
    
    // Close search modal
    document.getElementById('close-search-btn')?.addEventListener('click', () => {
      document.getElementById('search-modal').classList.remove('active');
      document.getElementById('search-input').value = '';
      document.getElementById('search-results-grid').innerHTML = '';
    });
    
    // Close search modal on background click
    document.getElementById('search-modal')?.addEventListener('click', (e) => {
      if (e.target === document.getElementById('search-modal')) {
        document.getElementById('search-modal').classList.remove('active');
        document.getElementById('search-input').value = '';
        document.getElementById('search-results-grid').innerHTML = '';
      }
    });
    
    // Refresh button
    if (refreshBtn) {
      refreshBtn.addEventListener('click', refreshContent);
    }
    
    // Notifications button
    if (notificationsBtn) {
      notificationsBtn.addEventListener('click', () => {
        document.getElementById('notifications-panel').classList.add('active');
        renderNotifications();
      });
    }
    
    // Close notifications panel
    document.getElementById('close-notifications')?.addEventListener('click', () => {
      document.getElementById('notifications-panel').classList.remove('active');
    });
    
    // Close notifications panel on background click
    document.getElementById('notifications-panel')?.addEventListener('click', (e) => {
      if (e.target === document.getElementById('notifications-panel')) {
        document.getElementById('notifications-panel').classList.remove('active');
      }
    });
    
    // Mark all notifications as read
    document.getElementById('mark-all-read')?.addEventListener('click', markAllNotificationsAsRead);
    
    // Profile button
    profileBtn.addEventListener('click', async () => {
      const { data: { session } } = await window.supabaseClient.auth.getSession();
      if (session) {
        window.location.href = 'profile.html';
      } else {
        window.location.href = `login.html?redirect=${encodeURIComponent(window.location.href)}`;
      }
    });
    
    // Explore all button
    if (exploreAllBtn) {
      exploreAllBtn.addEventListener('click', () => {
        window.location.href = 'content-library.html?sort=trending';
      });
    }
    
    // Auth modal buttons
    if (authLoginBtn) {
      authLoginBtn.addEventListener('click', () => {
        localStorage.setItem('redirectAfterLogin', 'trending_screen.html');
        window.location.href = 'login.html?redirect=trending_screen.html';
      });
    }
    
    if (authCancelBtn) {
      authCancelBtn.addEventListener('click', () => {
        authModal.classList.remove('active');
        window.history.back();
      });
    }
  }
  
  // ‚úÖ INITIALIZE TRENDING SCREEN
  async function initializeTrendingScreen() {
    console.log('üî• Initializing Trending Screen...');
    
    // Check authentication FIRST
    const isAuthenticated = await checkAuthentication();
    if (!isAuthenticated) {
      setLoading(false);
      return;
    }
    
    // Setup event listeners
    setupEventListeners();
    
    // Load and render content
    await loadContent();
    
    console.log('‚úÖ Trending Screen initialized successfully');
  }
  
  // Start initialization
  await initializeTrendingScreen();
  
  // Auth state change listener
  window.supabaseClient.auth.onAuthStateChange((event, session) => {
    console.log('Auth state changed:', event);
    
    if (event === 'SIGNED_IN' && session?.user) {
      currentUser = session.user;
      loadUserProfilePicture(currentUser);
      loadNotifications();
      showToast('Welcome back!', 'success');
    } else if (event === 'SIGNED_OUT') {
      currentUser = null;
      document.getElementById('userProfilePlaceholder').innerHTML = `
        <div class="profile-placeholder">
          <i class="fas fa-user"></i>
        </div>
      `;
      updateNotificationBadge(0);
      notifications = [];
      renderNotifications();
      showToast('Signed out successfully', 'info');
      authModal.classList.add('active');
    }
  });
});
</script>
</body>
</html>
