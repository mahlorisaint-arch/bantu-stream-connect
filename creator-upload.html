<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<title>Upload Content - Bantu Stream Connect</title>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Supabase JS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
/* Base styles merged from explore-screen and content-library */
:root {
--deep-black: #0A0E12;
--deep-navy: #0F172A;
--soft-white: #F8FAFC;
--slate-grey: #94A3B8;
--bantu-blue: #1D4ED8;
--warm-gold: #F59E0B;
--error-color: #EF4444;
--success-color: #10B981;
--glow-cycle-1: #00A3FF;
--glow-cycle-2: #0066FF;
--glow-cycle-3: #8B5CF6;
--glow-cycle-4: #EC4899;
--card-bg: rgba(15, 23, 42, 0.6);
--card-border: rgba(148, 163, 184, 0.2);
--hover-overlay: rgba(255, 255, 255, 0.05);
--active-overlay: rgba(245, 158, 11, 0.1);
--indigo: #4F46E5;
--gold-glow: rgba(245, 158, 11, 0.3);
--blue-glow: rgba(29, 78, 216, 0.3);
}

/* Theme Variables - Light Theme */
body.theme-light {
--deep-black: #F8FAFC;
--deep-navy: #FFFFFF;
--soft-white: #0F172A;
--slate-grey: #64748B;
--card-bg: rgba(255, 255, 255, 0.9);
--card-border: rgba(100, 116, 139, 0.2);
}

/* Theme Variables - High Contrast */
body.theme-high-contrast {
--deep-black: #000000;
--deep-navy: #111827;
--soft-white: #FFFFFF;
--slate-grey: #E5E7EB;
--card-bg: rgba(17, 24, 39, 0.95);
--card-border: #FFFFFF;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Inter', sans-serif;
background: var(--deep-black);
color: var(--soft-white);
min-height: 100vh;
overflow-x: hidden;
transition: background-color 0.3s ease, color 0.3s ease;
}

/* Loading Screen */
.loading-screen {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: var(--deep-black);
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
z-index: 1000;
}

.spinner {
width: 50px;
height: 50px;
border: 3px solid rgba(255, 255, 255, 0.1);
border-radius: 50%;
border-top-color: var(--bantu-blue);
animation: spin 1s linear infinite;
margin-bottom: 20px;
}

@keyframes spin {
to { transform: rotate(360deg); }
}

/* Animated Background */
.animated-bg {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: 1;
overflow: hidden;
}

.glow-cycle {
position: absolute;
border-radius: 50%;
filter: blur(60px);
opacity: 0.1;
animation: float 8s infinite ease-in-out;
}

.glow-1 {
width: 400px;
height: 400px;
background: var(--glow-cycle-1);
top: 10%;
left: 5%;
animation-delay: 0s;
}

.glow-2 {
width: 300px;
height: 300px;
background: var(--glow-cycle-2);
top: 60%;
right: 10%;
animation-delay: 2s;
}

.glow-3 {
width: 350px;
height: 350px;
background: var(--glow-cycle-3);
bottom: 10%;
left: 20%;
animation-delay: 4s;
}

.glow-4 {
width: 250px;
height: 250px;
background: var(--glow-cycle-4);
top: 20%;
right: 20%;
animation-delay: 6s;
}

@keyframes float {
0%, 100% { transform: translateY(0) scale(1); }
50% { transform: translateY(-20px) scale(1.05); }
}

/* Main Container */
.container {
max-width: 800px;
margin: 0 auto;
padding: 24px;
position: relative;
z-index: 2;
padding-bottom: 100px;
}

/* Header */
.header {
background: rgba(10, 14, 18, 0.9);
backdrop-filter: blur(20px);
padding: 12px 24px;
position: sticky;
top: 0;
z-index: 100;
border-bottom: 1px solid var(--card-border);
display: flex;
justify-content: space-between;
align-items: center;
min-height: 60px;
}

.logo {
display: flex;
align-items: center;
gap: 12px;
cursor: pointer;
text-decoration: none;
}

.logo-icon {
width: 40px;
height: 40px;
border-radius: 10px;
display: flex;
align-items: center;
justify-content: center;
box-shadow: 0 0 32px rgba(29, 78, 216, 0.3);
background: transparent;
border: 1px solid rgba(255, 255, 255, 0.1);
}

.logo-text {
font-family: 'Orbitron', sans-serif;
font-weight: 700;
font-size: 17px;
background: linear-gradient(to right, var(--soft-white), var(--bantu-blue));
-webkit-background-clip: text;
background-clip: text;
color: transparent;
letter-spacing: 0.5px;
}

.header-actions {
display: flex;
gap: 10px;
align-items: center;
}

.nav-icon {
width: 38px;
height: 38px;
border-radius: 50%;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
color: var(--soft-white);
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s ease;
position: relative;
}

.nav-icon:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-2px);
}

.icon-btn {
width: 38px;
height: 38px;
border-radius: 50%;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
color: var(--soft-white);
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s ease;
position: relative;
}

.icon-btn:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-2px);
}

.notification-badge {
position: absolute;
top: -5px;
right: -5px;
background: var(--error-color);
color: white;
font-size: 10px;
font-weight: bold;
width: 18px;
height: 18px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
border: 2px solid var(--deep-black);
}

.profile-btn {
width: 38px;
height: 38px;
border-radius: 50%;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
border: 2px solid rgba(255, 255, 255, 0.2);
cursor: pointer;
overflow: hidden;
transition: all 0.3s ease;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-weight: 600;
font-size: 14px;
}

.profile-btn:hover {
transform: translateY(-2px);
box-shadow: 0 8px 20px rgba(29, 78, 216, 0.3);
}

.profile-img {
width: 100%;
height: 100%;
object-fit: cover;
}

.profile-placeholder {
width: 100%;
height: 100%;
display: flex;
align-items: center;
justify-content: center;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
color: white;
font-size: 14px;
}

/* Theme Selector */
.theme-selector {
position: absolute;
top: 60px;
right: 120px;
width: 180px;
background: var(--card-bg);
border: 1px solid var(--card-border);
border-radius: 12px;
backdrop-filter: blur(20px);
z-index: 1000;
display: none;
flex-direction: column;
padding: 8px;
box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.theme-selector.active {
display: flex;
}

.theme-option {
padding: 12px 16px;
border-radius: 8px;
color: var(--soft-white);
cursor: pointer;
display: flex;
align-items: center;
gap: 12px;
transition: all 0.3s ease;
}

.theme-option:hover {
background: rgba(255, 255, 255, 0.1);
}

.theme-option.active {
background: linear-gradient(135deg, rgba(29, 78, 216, 0.2), rgba(245, 158, 11, 0.2));
border-left: 3px solid var(--warm-gold);
}

.theme-option i {
width: 20px;
color: var(--warm-gold);
}

/* Upload Card */
.upload-card {
background: var(--card-bg);
border: 1px solid var(--card-border);
border-radius: 24px;
padding: 40px;
margin-bottom: 30px;
backdrop-filter: blur(10px);
box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
position: relative;
overflow: hidden;
}

.upload-card::before {
content: '';
position: absolute;
top: -2px;
left: -2px;
right: -2px;
bottom: -2px;
background: linear-gradient(45deg, var(--bantu-blue), var(--warm-gold));
border-radius: 26px;
z-index: -1;
opacity: 0.1;
}

.upload-card h1 {
font-family: 'Orbitron', sans-serif;
font-size: 32px;
font-weight: 700;
background: linear-gradient(135deg, var(--soft-white), var(--warm-gold));
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
margin-bottom: 30px;
text-align: center;
}

/* Form Groups */
.form-group {
margin-bottom: 25px;
}

.form-label {
display: block;
margin-bottom: 10px;
font-weight: 600;
color: var(--soft-white);
font-size: 16px;
}

.form-label span {
color: var(--error-color);
margin-left: 4px;
}

.form-input {
width: 100%;
padding: 15px;
background: rgba(255, 255, 255, 0.05);
border: 1px solid var(--card-border);
border-radius: 12px;
color: var(--soft-white);
font-size: 16px;
transition: all 0.3s ease;
backdrop-filter: blur(10px);
}

.form-input:focus {
outline: none;
border-color: var(--warm-gold);
box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
}

textarea.form-input {
min-height: 120px;
resize: vertical;
}

/* Upload Zones */
.upload-zone {
border: 2px dashed rgba(255, 255, 255, 0.3);
border-radius: 16px;
padding: 40px 20px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
margin-bottom: 20px;
background: rgba(255, 255, 255, 0.05);
}

.upload-zone:hover {
border-color: var(--warm-gold);
background: rgba(245, 158, 11, 0.05);
}

.upload-zone-icon {
font-size: 48px;
color: var(--warm-gold);
margin-bottom: 15px;
}

.upload-zone-text {
font-size: 16px;
color: var(--slate-grey);
margin-bottom: 10px;
}

.upload-zone-hint {
font-size: 14px;
color: rgba(255, 255, 255, 0.5);
}

/* File Info */
.file-info {
display: flex;
align-items: center;
gap: 15px;
padding: 15px;
background: rgba(255, 255, 255, 0.05);
border-radius: 12px;
margin-top: 10px;
border: 1px solid var(--card-border);
}

.file-icon {
font-size: 24px;
color: var(--warm-gold);
}

.file-details {
flex: 1;
}

.file-name {
font-weight: 600;
margin-bottom: 5px;
color: var(--soft-white);
}

.file-size {
font-size: 14px;
color: var(--slate-grey);
}

.file-remove {
color: var(--error-color);
cursor: pointer;
font-size: 20px;
transition: all 0.3s ease;
}

.file-remove:hover {
transform: scale(1.1);
}

/* Thumbnail Section */
.thumbnail-section {
margin: 30px 0;
}

.thumbnail-preview {
width: 100%;
height: 200px;
border-radius: 12px;
overflow: hidden;
margin-top: 15px;
background: rgba(0, 0, 0, 0.3);
border: 1px solid var(--card-border);
}

.thumbnail-preview img {
width: 100%;
height: 100%;
object-fit: cover;
}

.thumbnail-actions {
display: flex;
gap: 15px;
margin-top: 15px;
}

.thumbnail-btn {
flex: 1;
padding: 12px;
border-radius: 10px;
border: 1px solid var(--card-border);
background: rgba(255, 255, 255, 0.05);
color: var(--soft-white);
font-size: 14px;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
gap: 8px;
transition: all 0.3s ease;
backdrop-filter: blur(10px);
}

.thumbnail-btn:hover {
background: rgba(255, 255, 255, 0.1);
border-color: var(--warm-gold);
}

.thumbnail-btn.primary {
background: linear-gradient(135deg, var(--warm-gold), #f97316);
color: var(--deep-black);
border: none;
font-weight: 600;
}

.thumbnail-btn.primary:hover {
transform: translateY(-2px);
box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
}

/* Genre Select */
.genre-select {
width: 100%;
padding: 15px;
background: rgba(255, 255, 255, 0.05);
border: 1px solid var(--card-border);
border-radius: 12px;
color: var(--soft-white);
font-size: 16px;
cursor: pointer;
backdrop-filter: blur(10px);
}

.genre-select option {
background: var(--deep-navy);
color: var(--soft-white);
}

/* Upload Progress */
.upload-progress {
margin: 30px 0;
padding: 20px;
background: rgba(255, 255, 255, 0.05);
border-radius: 12px;
display: none;
border: 1px solid var(--card-border);
}

.upload-progress.active {
display: block;
}

.progress-header {
display: flex;
justify-content: space-between;
margin-bottom: 15px;
}

.progress-bar {
height: 8px;
background: rgba(255, 255, 255, 0.1);
border-radius: 4px;
overflow: hidden;
margin-bottom: 10px;
}

.progress-fill {
height: 100%;
background: linear-gradient(90deg, var(--warm-gold), #f97316);
border-radius: 4px;
width: 0%;
transition: width 0.3s ease;
}

.progress-text {
font-size: 14px;
color: var(--slate-grey);
text-align: center;
}

/* Action Buttons */
.action-buttons {
display: flex;
gap: 20px;
margin-top: 40px;
}

.action-btn {
flex: 1;
padding: 18px;
border-radius: 12px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
gap: 10px;
transition: all 0.3s ease;
border: none;
}

.action-btn.publish {
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
color: var(--soft-white);
border: 1px solid rgba(255, 255, 255, 0.1);
}

.action-btn.publish:hover:not(:disabled) {
transform: translateY(-3px);
box-shadow: 0 10px 25px rgba(29, 78, 216, 0.4);
}

.action-btn.publish:disabled {
opacity: 0.5;
cursor: not-allowed;
}

.action-btn.draft {
background: rgba(255, 255, 255, 0.05);
border: 1px solid var(--card-border);
color: var(--soft-white);
}

.action-btn.draft:hover:not(:disabled) {
background: rgba(255, 255, 255, 0.1);
transform: translateY(-2px);
border-color: var(--warm-gold);
}

.action-btn.draft:disabled {
opacity: 0.5;
cursor: not-allowed;
}

/* Helper Text */
.helper-text {
margin-top: 30px;
padding: 20px;
background: rgba(255, 255, 255, 0.05);
border-radius: 12px;
font-size: 14px;
color: var(--slate-grey);
text-align: center;
line-height: 1.6;
border: 1px solid var(--card-border);
}

/* Toast Container */
#toast-container {
position: fixed;
bottom: 20px;
right: 20px;
z-index: 9999;
display: flex;
flex-direction: column;
gap: 10px;
}

.toast {
padding: 15px 25px;
border-radius: 12px;
color: var(--soft-white);
font-weight: 500;
animation: slideIn 0.3s ease;
max-width: 300px;
backdrop-filter: blur(10px);
border: 1px solid var(--card-border);
display: flex;
align-items: center;
gap: 10px;
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.toast i {
font-size: 18px;
}

.toast.error {
background: rgba(239, 68, 68, 0.9);
}

.toast.success {
background: rgba(16, 185, 129, 0.9);
}

.toast.warning {
background: rgba(245, 158, 11, 0.9);
}

.toast.info {
background: var(--card-bg);
border: 1px solid var(--card-border);
}

@keyframes slideIn {
from {
transform: translateX(100%);
opacity: 0;
}
to {
transform: translateX(0);
opacity: 1;
}
}

/* Auth Modal */
.auth-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
display: none;
align-items: center;
justify-content: center;
z-index: 2000;
backdrop-filter: blur(5px);
}

.auth-modal.active {
display: flex;
}

.auth-content {
background: var(--card-bg);
border-radius: 20px;
padding: 40px;
max-width: 400px;
width: 90%;
text-align: center;
border: 1px solid var(--card-border);
backdrop-filter: blur(20px);
}

.auth-icon {
font-size: 64px;
color: var(--warm-gold);
margin-bottom: 20px;
}

.auth-title {
font-family: 'Orbitron', sans-serif;
font-size: 24px;
margin-bottom: 15px;
color: var(--soft-white);
}

.auth-message {
color: var(--slate-grey);
margin-bottom: 30px;
line-height: 1.6;
}

.auth-buttons {
display: flex;
gap: 15px;
}

.auth-btn {
flex: 1;
padding: 15px;
border-radius: 12px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
border: none;
}

.auth-btn.login {
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
color: var(--soft-white);
border: 1px solid rgba(255, 255, 255, 0.1);
}

.auth-btn.login:hover {
transform: translateY(-2px);
box-shadow: 0 4px 15px rgba(29, 78, 216, 0.4);
}

.auth-btn.cancel {
background: rgba(255, 255, 255, 0.05);
border: 1px solid var(--card-border);
color: var(--soft-white);
}

.auth-btn.cancel:hover {
background: rgba(255, 255, 255, 0.1);
}

/* Search Modal */
.search-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.9);
display: none;
align-items: center;
justify-content: center;
z-index: 2000;
backdrop-filter: blur(5px);
}

.search-modal.active {
display: flex;
}

.search-modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
padding-bottom: 15px;
border-bottom: 1px solid var(--card-border);
width: 100%;
}

.search-input-container {
position: relative;
width: 100%;
max-width: 600px;
}

.search-icon {
position: absolute;
left: 15px;
top: 50%;
transform: translateY(-50%);
color: var(--slate-grey);
font-size: 18px;
}

.search-input {
width: 100%;
padding: 15px 15px 15px 45px;
border-radius: 12px;
border: 1px solid var(--card-border);
background: var(--card-bg);
color: var(--soft-white);
font-size: 16px;
backdrop-filter: blur(10px);
}

.search-input::placeholder {
color: var(--slate-grey);
}

.search-input:focus {
outline: none;
border-color: var(--warm-gold);
box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
}

.close-search-btn {
background: none;
border: none;
color: var(--soft-white);
font-size: 24px;
cursor: pointer;
width: 40px;
height: 40px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.3s ease;
}

.close-search-btn:hover {
background: rgba(255, 255, 255, 0.1);
transform: rotate(90deg);
}

.search-filters {
display: flex;
gap: 15px;
margin-bottom: 20px;
width: 100%;
max-width: 600px;
}

.filter-group {
flex: 1;
}

.filter-label {
display: block;
margin-bottom: 8px;
font-size: 14px;
color: var(--slate-grey);
}

.filter-select {
width: 100%;
padding: 12px;
border-radius: 10px;
border: 1px solid var(--card-border);
background: var(--card-bg);
color: var(--soft-white);
font-size: 14px;
backdrop-filter: blur(10px);
}

.search-results {
width: 100%;
max-width: 800px;
max-height: 70vh;
overflow-y: auto;
}

.search-results-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
gap: 15px;
}

/* Notifications Panel */
.notifications-panel {
position: fixed;
top: 0;
right: -100%;
width: 400px;
height: 100%;
background: var(--card-bg);
border-left: 1px solid var(--card-border);
box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
z-index: 1000;
transition: right 0.3s ease;
backdrop-filter: blur(10px);
}

.notifications-panel.active {
right: 0;
}

.notifications-header {
padding: 20px;
border-bottom: 1px solid var(--card-border);
display: flex;
justify-content: space-between;
align-items: center;
}

.notifications-list {
max-height: calc(100vh - 150px);
overflow-y: auto;
padding: 20px;
}

.notification-item {
padding: 15px;
border-bottom: 1px solid var(--card-border);
display: flex;
gap: 12px;
position: relative;
}

.notification-item.read {
opacity: 0.7;
}

.notification-icon {
width: 40px;
height: 40px;
border-radius: 50%;
background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
display: flex;
align-items: center;
justify-content: center;
flex-shrink: 0;
}

.notification-content {
flex: 1;
}

.notification-content h4 {
font-weight: 600;
margin-bottom: 5px;
color: var(--soft-white);
}

.notification-content p {
font-size: 14px;
color: var(--slate-grey);
margin-bottom: 8px;
}

.notification-time {
font-size: 12px;
color: var(--warm-gold);
}

.notification-dot {
width: 10px;
height: 10px;
border-radius: 50%;
background: var(--warm-gold);
position: absolute;
top: 15px;
right: 15px;
}

.notifications-footer {
padding: 20px;
border-top: 1px solid var(--card-border);
display: flex;
gap: 15px;
}

.text-btn {
flex: 1;
padding: 12px;
border-radius: 10px;
border: 1px solid var(--card-border);
background: rgba(255, 255, 255, 0.05);
color: var(--soft-white);
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}

.text-btn:hover {
background: rgba(245, 158, 11, 0.1);
border-color: var(--warm-gold);
}

/* Custom Scrollbar */
::-webkit-scrollbar {
width: 8px;
height: 8px;
}

::-webkit-scrollbar-track {
background: var(--deep-navy);
}

::-webkit-scrollbar-thumb {
background: var(--bantu-blue);
border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
background: var(--warm-gold);
}

/* Footer */
.footer {
background: var(--card-bg);
border-top: 1px solid var(--card-border);
padding: 30px 20px;
margin-top: 50px;
backdrop-filter: blur(10px);
position: relative;
z-index: 2;
}

.footer p {
text-align: center;
color: var(--slate-grey);
margin-bottom: 15px;
font-size: 14px;
}

.footer-links {
display: flex;
justify-content: center;
gap: 20px;
flex-wrap: wrap;
}

.footer-links a {
color: var(--slate-grey);
text-decoration: none;
transition: color 0.3s ease;
font-size: 14px;
}

.footer-links a:hover {
color: var(--warm-gold);
}

/* Responsive */
@media (max-width: 768px) {
.container {
padding: 16px;
max-width: 100%;
}
.upload-card {
padding: 30px 20px;
}
.upload-card h1 {
font-size: 24px;
}
.action-buttons {
flex-direction: column;
}
.thumbnail-actions {
flex-direction: column;
}
.auth-buttons {
flex-direction: column;
}
}

@media (max-width: 480px) {
.header {
padding: 8px 14px;
min-height: 48px;
}
.logo-icon {
width: 30px;
height: 30px;
}
.logo-text {
font-size: 14px;
max-width: 130px;
}
.nav-icon, .icon-btn, .profile-btn {
width: 34px;
height: 34px;
}
}

/* Accessibility & Touch Targets */
@media (hover: none) and (pointer: coarse) {
.nav-icon, .icon-btn, .profile-btn, .action-btn {
min-width: 44px !important;
min-height: 44px !important;
}
.header, .footer {
-webkit-tap-highlight-color: transparent;
user-select: none;
}
}
</style>
</head>
<body>
<!-- Loading Screen -->
<div id="loading" class="loading-screen">
<div class="spinner"></div>
<div id="loading-text">Loading Creator Upload...</div>
</div>

<!-- Animated Background -->
<div class="animated-bg">
<div class="glow-cycle glow-1"></div>
<div class="glow-cycle glow-2"></div>
<div class="glow-cycle glow-3"></div>
<div class="glow-cycle glow-4"></div>
</div>

<!-- Theme Selector -->
<div id="theme-selector" class="theme-selector">
<div class="theme-option" data-theme="dark">
<i class="fas fa-moon"></i>
<span>Dark</span>
</div>
<div class="theme-option" data-theme="light">
<i class="fas fa-sun"></i>
<span>Light</span>
</div>
<div class="theme-option" data-theme="high-contrast">
<i class="fas fa-circle"></i>
<span>High Contrast</span>
</div>
</div>

<!-- Auth Modal (shown when user is not logged in) -->
<div id="auth-modal" class="auth-modal">
<div class="auth-content">
<div class="auth-icon">
<i class="fas fa-lock"></i>
</div>
<h2 class="auth-title">Authentication Required</h2>
<p class="auth-message">You need to be logged in to upload content. Please sign in or create an account to share your content with the community.</p>
<div class="auth-buttons">
<button id="auth-login-btn" class="auth-btn login">Log In</button>
<button id="auth-cancel-btn" class="auth-btn cancel">Cancel</button>
</div>
</div>
</div>

<!-- Search Modal -->
<div id="search-modal" class="search-modal">
<div style="width: 90%; max-width: 800px; background: var(--card-bg); border-radius: 20px; padding: 30px; backdrop-filter: blur(10px);">
<div class="search-modal-header">
<div class="search-input-container">
<i class="search-icon fas fa-search"></i>
<input type="text" id="search-input" class="search-input" placeholder="Search content, creators, or categories..." autocomplete="off">
</div>
<button id="close-search-btn" class="close-search-btn">
<i class="fas fa-times"></i>
</button>
</div>
<div class="search-filters">
<div class="filter-group">
<label class="filter-label">Category</label>
<select id="category-filter" class="filter-select">
<option value="">All Categories</option>
<option value="Music">Music</option>
<option value="STEM">STEM</option>
<option value="Culture">Culture</option>
<option value="News">News</option>
<option value="Sports">Sports</option>
<option value="Movies">Movies</option>
<option value="Documentaries">Documentaries</option>
<option value="Podcasts">Podcasts</option>
</select>
</div>
<div class="filter-group">
<label class="filter-label">Sort By</label>
<select id="sort-filter" class="filter-select">
<option value="newest">Newest First</option>
<option value="popular">Most Popular</option>
<option value="trending">Trending</option>
</select>
</div>
</div>
<div class="search-results">
<div id="search-results-grid" class="search-results-grid">
<!-- Results loaded here -->
</div>
</div>
</div>
</div>

<!-- Notifications Panel -->
<div id="notifications-panel" class="notifications-panel">
<div class="notifications-header">
<h2 style="font-family: 'Orbitron', sans-serif; font-size: 20px; margin: 0; color: var(--soft-white);">Notifications</h2>
<button id="close-notifications" class="close-search-btn">
<i class="fas fa-times"></i>
</button>
</div>
<div class="notifications-list" id="notifications-list">
<!-- Notifications loaded here -->
</div>
<div class="notifications-footer">
<button id="mark-all-read" class="text-btn">Mark all as read</button>
<button id="notification-settings" class="text-btn">Settings</button>
</div>
</div>

<!-- Main Content (hidden until loaded) -->
<div id="app" style="display: none;">
<!-- Header with Navigation Icons (aligned like content-detail) -->
<header class="header">
<div class="logo" onclick="window.location.href='index.html'">
<div class="logo-icon">
<i class="fas fa-film" style="color: var(--warm-gold); font-size: 20px;"></i>
</div>
<div class="logo-text">BANTU STREAM CONNECT</div>
</div>
<div class="header-actions">
<!-- Navigation Icons (matching content-detail) -->
<button class="nav-icon" id="nav-home" title="Home">
<i class="fas fa-home"></i>
</button>
<button class="nav-icon" id="nav-theme-toggle" title="Theme">
<i class="fas fa-palette"></i>
</button>
<button class="nav-icon" id="nav-create" title="Create Content">
<i class="fas fa-plus-circle"></i>
</button>
<button class="nav-icon" id="nav-dashboard" title="Creator Dashboard">
<i class="fas fa-chart-line"></i>
</button>

<!-- Search Button -->
<button id="search-btn" class="icon-btn search-btn" title="Search">
<i class="fas fa-search"></i>
</button>

<!-- Notifications Button -->
<button id="notifications-btn" class="icon-btn" title="Notifications">
<i class="fas fa-bell"></i>
<span class="notification-badge" id="notification-count" style="display: none;">0</span>
</button>

<!-- Profile Button -->
<button id="profile-btn" class="profile-btn" title="Profile">
<div class="profile-placeholder" id="userProfilePlaceholder">
<i class="fas fa-user"></i>
</div>
</button>
</div>
</header>

<!-- Main Content -->
<main class="container">
<!-- Upload Card -->
<div class="upload-card">
<h1>UPLOAD YOUR CONTENT</h1>
<form id="upload-form">
<!-- Title -->
<div class="form-group">
<label for="content-title" class="form-label">
Title <span>*</span>
</label>
<input type="text"
id="content-title"
class="form-input"
placeholder="Enter content title (max 100 characters)"
maxlength="100"
required>
</div>

<!-- Description -->
<div class="form-group">
<label for="content-description" class="form-label">
Description <span>*</span>
</label>
<textarea id="content-description"
class="form-input"
placeholder="Describe your content (max 500 characters)"
maxlength="500"
rows="4"
required></textarea>
</div>

<!-- Genre -->
<div class="form-group">
<label for="content-genre" class="form-label">
Genre/Category <span>(Optional)</span>
</label>
<select id="content-genre" class="genre-select">
<option value="">Select a genre (optional)</option>
<option value="Music">Music</option>
<option value="STEM">STEM</option>
<option value="Culture">Culture</option>
<option value="News">News</option>
<option value="Sports">Sports</option>
<option value="Movies">Movies</option>
<option value="Documentaries">Documentaries</option>
<option value="Podcasts">Podcasts</option>
<option value="Skits">Skits</option>
<option value="Videos">Videos</option>
</select>
<div style="color: var(--slate-grey); font-size: 14px; margin-top: 5px;">
Selecting a genre helps users discover your content in category feeds
</div>
</div>

<!-- Media File Upload -->
<div class="form-group">
<label class="form-label">
Media File (Video/Audio) <span>*</span>
</label>
<div id="media-upload-zone" class="upload-zone">
<div class="upload-zone-icon">
<i class="fas fa-video"></i>
</div>
<div class="upload-zone-text" id="media-zone-text">
Click or drag video/audio files here
</div>
<div class="upload-zone-hint">
Supports MP4, MOV, AVI, MKV, WEBM, MP3, AAC, WAV (Max 800MB)
</div>
</div>
<div id="media-file-info" class="file-info" style="display: none;">
<div class="file-icon">
<i class="fas fa-video"></i>
</div>
<div class="file-details">
<div class="file-name" id="media-file-name"></div>
<div class="file-size" id="media-file-size"></div>
</div>
<div class="file-remove" onclick="window.removeMediaFile ? window.removeMediaFile() : null">
<i class="fas fa-times"></i>
</div>
</div>
<input type="file" id="media-file-input" accept="video/*,audio/*" style="display: none;">
</div>

<!-- Thumbnail Upload -->
<div class="form-group thumbnail-section">
<label class="form-label">
Thumbnail Image <span>(Optional)</span>
</label>
<div id="thumbnail-upload-zone" class="upload-zone" style="padding: 20px;">
<div class="upload-zone-icon">
<i class="fas fa-image"></i>
</div>
<div class="upload-zone-text">
Click or drag thumbnail image here
</div>
<div class="upload-zone-hint">
Supports JPG, PNG, GIF (Recommended: 1280x720)
</div>
</div>

<!-- Thumbnail Preview -->
<div id="thumbnail-preview" class="thumbnail-preview" style="display: none;">
<img id="thumbnail-image" src="" alt="Thumbnail Preview">
</div>

<!-- Thumbnail Actions -->
<div class="thumbnail-actions">
<button type="button" class="thumbnail-btn" onclick="window.openImagePicker ? window.openImagePicker() : null">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
<circle cx="8.5" cy="8.5" r="1.5"/>
<polyline points="21 15 16 10 5 21"/>
</svg>
Choose from Gallery
</button>
<button type="button" class="thumbnail-btn" onclick="window.captureCameraImage ? window.captureCameraImage() : null">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
<circle cx="12" cy="13" r="4"/>
</svg>
Take Photo
</button>
</div>
<input type="file" id="thumbnail-file-input" accept="image/*" style="display: none;">
<input type="file" id="camera-file-input" accept="image/*" capture="environment" style="display: none;">
</div>

<!-- Upload Progress -->
<div id="upload-progress" class="upload-progress">
<div class="progress-header">
<span>Uploading...</span>
<span id="progress-percentage">0%</span>
</div>
<div class="progress-bar">
<div id="progress-fill" class="progress-fill"></div>
</div>
<div id="progress-text" class="progress-text">Preparing upload...</div>
</div>

<!-- Action Buttons -->
<div class="action-buttons">
<button type="button" id="save-draft-btn" class="action-btn draft" disabled>
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
<polyline points="17 21 17 13 7 13 7 21"/>
<polyline points="7 3 7 8 15 8"/>
</svg>
Save Draft
</button>
<button type="submit" id="publish-btn" class="action-btn publish" disabled>
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
</svg>
Publish Content
</button>
</div>
</form>

<!-- Helper Text -->
<div class="helper-text">
Your content will be reviewed and published within 24 hours. Make sure to follow our community guidelines.
Please stay on this page until upload is complete.
</div>
</div>
</main>

<!-- Footer -->
<footer class="footer">
<p>Bantu Stream Connect ¬© 2025 ‚Ä¢ Built in South Africa ‚Ä¢ NO DNA, JUST RSA</p>
<div class="footer-links">
<a href="privacy-policy.html">Privacy Policy</a>
<a href="terms-of-service.html">Terms of Service</a>
<a href="support.html">Support</a>
</div>
</footer>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

<!-- SUPABASE CLIENT -->
<script>
// Supabase Configuration
const SUPABASE_URL = 'https://ydnxqnbjoshvxteevemc.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U';

// Initialize Supabase client
window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
console.log('‚úÖ Supabase client initialized for creator upload');
</script>

<!-- Load Helper Scripts (same as content-detail) -->
<script>
// Load helpers dynamically
(async function loadHelpers() {
try {
// Load Supabase Helper
await import('./js/supabase-helper.js');
console.log('‚úÖ SupabaseHelper loaded');
} catch (e) {
console.warn('‚ö†Ô∏è SupabaseHelper not found, using fallback');
}
try {
// Load Auth Helper
await import('./js/auth-helper.js');
console.log('‚úÖ AuthHelper loaded');
} catch (e) {
console.warn('‚ö†Ô∏è AuthHelper not found, using fallback');
}
})();
</script>

<!-- Creator Upload JavaScript - FIXED VERSION -->
<script>
// Wait for helpers and DOM to be ready
document.addEventListener('DOMContentLoaded', async () => {
console.log('üì§ Creator Upload Initializing with AuthHelper...');

// DOM Elements
const loadingScreen = document.getElementById('loading');
const loadingText = document.getElementById('loading-text');
const app = document.getElementById('app');
const authModal = document.getElementById('auth-modal');
const uploadForm = document.getElementById('upload-form');
const publishBtn = document.getElementById('publish-btn');
const saveDraftBtn = document.getElementById('save-draft-btn');
const progressSection = document.getElementById('upload-progress');
const progressFill = document.getElementById('progress-fill');
const progressPercentage = document.getElementById('progress-percentage');
const progressText = document.getElementById('progress-text');
const profileBtn = document.getElementById('profile-btn');
const profilePlaceholder = document.getElementById('userProfilePlaceholder');

// Navigation elements
const homeBtn = document.getElementById('nav-home');
const themeToggle = document.getElementById('nav-theme-toggle');
const createBtn = document.getElementById('nav-create');
const dashboardBtn = document.getElementById('nav-dashboard');
const notificationsBtn = document.getElementById('notifications-btn');
const searchBtn = document.getElementById('search-btn');

// State variables
let selectedMediaFile = null;
let selectedThumbnailFile = null;
let isUploading = false;
let currentUser = null;
let currentUserId = null;
let notifications = [];

// Wait for helpers to initialize
await waitForHelpers();

// Setup auth listeners
setupAuthListeners();

// Check authentication
await checkAuthentication();

// Initialize theme selector
initThemeSelector();

// Initialize navigation
initGlobalNavigation();

// Setup UI elements
setupMediaUpload();
setupThumbnailUpload();
setupEventListeners();

// Initial button state
updateButtonsState();

// Hide loading screen
setLoading(false);

console.log('‚úÖ Creator Upload initialized successfully');

// ============================================
// HELPER FUNCTIONS
// ============================================

async function waitForHelpers() {
return new Promise((resolve) => {
const check = setInterval(() => {
if ((window.SupabaseHelper?.isInitialized || true) && 
(window.AuthHelper?.isInitialized || true)) {
clearInterval(check);
resolve();
}
}, 100);
});
}

function setLoading(loading, text = '') {
if (text) loadingText.textContent = text;
if (loading) {
loadingScreen.style.display = 'flex';
app.style.display = 'none';
} else {
setTimeout(() => {
loadingScreen.style.display = 'none';
app.style.display = 'block';
}, 500);
}
}

// ============================================
// AUTHENTICATION - Matching content-detail.js
// ============================================

function setupAuthListeners() {
window.supabaseClient.auth.onAuthStateChange(async (event, session) => {
console.log('Auth state changed:', event);
if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {
await window.AuthHelper?.initialize();
const userProfile = window.AuthHelper?.getUserProfile?.();
currentUser = userProfile;
currentUserId = userProfile?.id || null;
updateProfileUI();
showToast('Welcome back!', 'success');
} else if (event === 'SIGNED_OUT') {
currentUser = null;
currentUserId = null;
resetProfileUI();
showToast('Signed out successfully', 'info');
}
});

// Initial update
if (window.AuthHelper?.isAuthenticated?.()) {
const userProfile = window.AuthHelper.getUserProfile();
currentUser = userProfile;
currentUserId = userProfile?.id || null;
updateProfileUI();

// Load notifications
loadNotifications();
} else {
resetProfileUI();
}
}

function updateProfileUI() {
if (!profileBtn || !profilePlaceholder) return;

if (window.AuthHelper?.isAuthenticated?.()) {
const userProfile = window.AuthHelper.getUserProfile();
const displayName = window.AuthHelper.getDisplayName();
const avatarUrl = window.AuthHelper.getAvatarUrl();
const initial = displayName.charAt(0).toUpperCase();

if (avatarUrl) {
profilePlaceholder.innerHTML = `
<img src="${avatarUrl}" alt="${displayName}"
class="profile-img"
style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">
`;
} else {
profilePlaceholder.innerHTML = `
<div class="profile-placeholder" style="
width: 32px;
height: 32px;
border-radius: 50%;
background: linear-gradient(135deg, #1D4ED8, #F59E0B);
display: flex;
align-items: center;
justify-content: center;
color: white;
font-weight: bold;
">${initial}</div>
`;
}

profileBtn.onclick = () => {
window.location.href = 'profile.html';
};
} else {
profilePlaceholder.innerHTML = `
<div class="profile-placeholder">
<i class="fas fa-user"></i>
</div>
`;

profileBtn.onclick = () => {
showAuthModal(true);
};
}
}

function resetProfileUI() {
if (!profileBtn || !profilePlaceholder) return;

profilePlaceholder.innerHTML = `
<div class="profile-placeholder">
<i class="fas fa-user"></i>
</div>
`;

profileBtn.onclick = () => {
showAuthModal(true);
};
}

// ============================================
// CHECK AUTHENTICATION
// ============================================

async function checkAuthentication() {
try {
const isAuthenticated = window.AuthHelper?.isAuthenticated?.() || false;

if (!isAuthenticated) {
console.log('‚ö†Ô∏è User not authenticated');
showAuthModal(true);
return false;
}

const userProfile = window.AuthHelper.getUserProfile();
currentUser = userProfile;
currentUserId = userProfile?.id || null;
console.log('‚úÖ User authenticated:', userProfile?.email);

updateProfileUI();
return true;
} catch (error) {
console.error('‚ùå Authentication error:', error);
showAuthModal(true);
return false;
}
}

function showAuthModal(show) {
if (show) {
authModal.classList.add('active');
} else {
authModal.classList.remove('active');
}
}

// ============================================
// THEME SELECTOR - FIXED (matching content-detail)
// ============================================

function initThemeSelector() {
console.log('üé® Initializing theme selector...');

const themeSelector = document.getElementById('theme-selector');
const themeOptions = document.querySelectorAll('.theme-option');

if (!themeToggle || !themeSelector) {
console.warn('Theme toggle or selector not found');
return;
}

console.log('‚úÖ Theme selector elements found');

// Remove any existing listeners
const newThemeToggle = themeToggle.cloneNode(true);
themeToggle.parentNode.replaceChild(newThemeToggle, themeToggle);

// Toggle theme selector on click
newThemeToggle.addEventListener('click', (e) => {
e.stopPropagation();
e.preventDefault();
console.log('üé® Theme toggle clicked');
themeSelector.classList.toggle('active');
});

// Close when clicking outside
document.addEventListener('click', (e) => {
if (themeSelector.classList.contains('active') && 
!themeSelector.contains(e.target) && 
!newThemeToggle.contains(e.target)) {
themeSelector.classList.remove('active');
}
});

// Set up theme options
themeOptions.forEach(option => {
// Remove existing listeners
const newOption = option.cloneNode(true);
option.parentNode.replaceChild(newOption, option);

newOption.addEventListener('click', (e) => {
e.stopPropagation();
e.preventDefault();
const theme = newOption.dataset.theme;
console.log('üé® Theme selected:', theme);
applyTheme(theme);
themeSelector.classList.remove('active');
});
});

// Initialize theme
initCurrentTheme();

// Listen for system theme changes
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
if (!localStorage.getItem('theme')) {
applyTheme(e.matches ? 'dark' : 'light');
}
});
}

function applyTheme(theme) {
console.log('üé® Applying theme:', theme);

// Validate theme
if (!theme || !['dark', 'light', 'high-contrast'].includes(theme)) {
console.warn('Invalid theme:', theme, 'defaulting to dark');
theme = 'dark';
}

// Remove ALL theme classes first
document.body.classList.remove('theme-dark', 'theme-light', 'theme-high-contrast');

// Add the new theme class
document.body.classList.add(`theme-${theme}`);

// Save to localStorage
localStorage.setItem('theme', theme);

// Update active state on theme options
document.querySelectorAll('.theme-option').forEach(option => {
const isActive = option.dataset.theme === theme;
option.classList.toggle('active', isActive);
});

// FORCE REPAINT
document.body.style.display = 'none';
document.body.offsetHeight; // Force reflow
document.body.style.display = '';

showToast(`Theme changed to ${theme}`, 'success');
console.log('‚úÖ Theme applied successfully:', theme);
}

function initCurrentTheme() {
console.log('üé® Initializing current theme...');

// Get saved theme from localStorage
let savedTheme = localStorage.getItem('theme');

// Check for system preference if no saved theme
if (!savedTheme) {
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
savedTheme = prefersDark ? 'dark' : 'light';
console.log('üé® Using system theme preference:', savedTheme);
}

// Validate theme
if (!['dark', 'light', 'high-contrast'].includes(savedTheme)) {
console.warn('Invalid saved theme:', savedTheme, 'defaulting to dark');
savedTheme = 'dark';
}

// Apply the theme
applyTheme(savedTheme);
}

// ============================================
// GLOBAL NAVIGATION - FIXED (matching content-detail)
// ============================================

function initGlobalNavigation() {
// Home button
if (homeBtn) {
const newHomeBtn = homeBtn.cloneNode(true);
homeBtn.parentNode.replaceChild(newHomeBtn, homeBtn);

newHomeBtn.addEventListener('click', (e) => {
e.stopPropagation();
e.preventDefault();
window.location.href = 'https://bantustreamconnect.com/';
});
}

// Create Content button
if (createBtn) {
const newCreateBtn = createBtn.cloneNode(true);
createBtn.parentNode.replaceChild(newCreateBtn, createBtn);

newCreateBtn.addEventListener('click', (e) => {
e.stopPropagation();
e.preventDefault();
// Already on creator-upload.html, just scroll to top
window.scrollTo({ top: 0, behavior: 'smooth' });
});
}

// Creator Dashboard button
if (dashboardBtn) {
const newDashboardBtn = dashboardBtn.cloneNode(true);
dashboardBtn.parentNode.replaceChild(newDashboardBtn, dashboardBtn);

newDashboardBtn.addEventListener('click', (e) => {
e.stopPropagation();
e.preventDefault();
if (window.AuthHelper?.isAuthenticated?.()) {
window.location.href = 'creator-dashboard.html';
} else {
showToast('Please sign in to access dashboard', 'warning');
showAuthModal(true);
}
});
}
}

// ============================================
// NOTIFICATIONS (matching content-detail pattern)
// ============================================

async function loadNotifications() {
if (!notificationsBtn || !currentUserId) {
updateNotificationBadge(0);
return;
}

try {
const { data, error } = await window.supabaseClient
.from('notifications')
.select('*')
.eq('user_id', currentUserId)
.order('created_at', { ascending: false })
.limit(20);

if (error) throw error;

notifications = data || [];
const unreadCount = notifications.filter(n => !n.is_read).length;
updateNotificationBadge(unreadCount);
renderNotifications();
} catch (error) {
console.error('Error loading notifications:', error);
updateNotificationBadge(0);
}
}

function renderNotifications() {
const notificationsList = document.getElementById('notifications-list');
if (!notificationsList) return;

if (!currentUser) {
notificationsList.innerHTML = `
<div style="text-align: center; padding: 40px; color: var(--slate-grey);">
<i class="fas fa-bell-slash" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
<p>Sign in to see notifications</p>
</div>
`;
return;
}

if (!notifications || notifications.length === 0) {
notificationsList.innerHTML = `
<div style="text-align: center; padding: 40px; color: var(--slate-grey);">
<i class="fas fa-bell" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
<p>No notifications yet</p>
</div>
`;
return;
}

notificationsList.innerHTML = notifications.map(notification => `
<div class="notification-item ${notification.is_read ? 'read' : 'unread'}" data-id="${notification.id}">
<div class="notification-icon">
<i class="${getNotificationIcon(notification.type)}"></i>
</div>
<div class="notification-content">
<h4>${escapeHtml(notification.title)}</h4>
<p>${escapeHtml(notification.message)}</p>
<span class="notification-time">${formatNotificationTime(notification.created_at)}</span>
</div>
${!notification.is_read ? '<div class="notification-dot"></div>' : ''}
</div>
`).join('');
}

function getNotificationIcon(type) {
switch(type) {
case 'like': return 'fas fa-heart';
case 'comment': return 'fas fa-comment';
case 'follow': return 'fas fa-user-plus';
default: return 'fas fa-bell';
}
}

function formatNotificationTime(timestamp) {
if (!timestamp) return 'Just now';
const diffMs = Date.now() - new Date(timestamp).getTime();
const diffMins = Math.floor(diffMs / 60000);
const diffHours = Math.floor(diffMs / 3600000);
const diffDays = Math.floor(diffMs / 86400000);

if (diffMins < 1) return 'Just now';
if (diffMins < 60) return `${diffMins}m ago`;
if (diffHours < 24) return `${diffHours}h ago`;
if (diffDays < 7) return `${diffDays}d ago`;
return new Date(timestamp).toLocaleDateString();
}

function updateNotificationBadge(count) {
const badge = document.getElementById('notification-count');
if (badge) {
badge.textContent = count > 99 ? '99+' : count;
badge.style.display = count > 0 ? 'flex' : 'none';
}
}

// ============================================
// MEDIA UPLOAD FUNCTIONS
// ============================================

function setupMediaUpload() {
const mediaZone = document.getElementById('media-upload-zone');
const mediaInput = document.getElementById('media-file-input');
const mediaFileInfo = document.getElementById('media-file-info');

// Click on zone
mediaZone.addEventListener('click', () => {
mediaInput.click();
});

// Drag and drop
mediaZone.addEventListener('dragover', (e) => {
e.preventDefault();
mediaZone.style.borderColor = 'var(--warm-gold)';
mediaZone.style.background = 'rgba(245, 158, 11, 0.05)';
});

mediaZone.addEventListener('dragleave', () => {
mediaZone.style.borderColor = 'rgba(255, 255, 255, 0.3)';
mediaZone.style.background = 'transparent';
});

mediaZone.addEventListener('drop', (e) => {
e.preventDefault();
mediaZone.style.borderColor = 'rgba(255, 255, 255, 0.3)';
mediaZone.style.background = 'transparent';
if (e.dataTransfer.files.length > 0) {
handleMediaFile(e.dataTransfer.files[0]);
}
});

// File input change
mediaInput.addEventListener('change', (e) => {
if (e.target.files.length > 0) {
handleMediaFile(e.target.files[0]);
}
});
}

function handleMediaFile(file) {
// Check file size (800MB limit)
const maxSize = 800 * 1024 * 1024;
if (file.size > maxSize) {
showToast('File size must be less than 800MB', 'error');
return;
}

// Check file type
const videoTypes = ['video/mp4', 'video/mov', 'video/avi', 'video/mkv', 'video/webm'];
const audioTypes = ['audio/mpeg', 'audio/mp3', 'audio/aac', 'audio/wav', 'audio/m4a', 'audio/flac', 'audio/ogg'];

if (!videoTypes.includes(file.type) && !audioTypes.includes(file.type)) {
showToast('Please select a valid video or audio file', 'error');
return;
}

selectedMediaFile = file;

// Update UI
document.getElementById('media-file-name').textContent = file.name;
document.getElementById('media-file-size').textContent = formatFileSize(file.size);
document.getElementById('media-file-info').style.display = 'flex';
document.getElementById('media-zone-text').textContent = 'Click to change file';
updateButtonsState();
showToast(`Selected: ${file.name}`, 'success');
}

function removeMediaFile() {
selectedMediaFile = null;
document.getElementById('media-file-info').style.display = 'none';
document.getElementById('media-zone-text').textContent = 'Click or drag video/audio files here';
document.getElementById('media-file-input').value = '';
updateButtonsState();
showToast('Media file removed', 'info');
}

// Make functions globally available
window.removeMediaFile = removeMediaFile;

function formatFileSize(bytes) {
if (bytes === 0) return '0 Bytes';
const k = 1024;
const sizes = ['Bytes', 'KB', 'MB', 'GB'];
const i = Math.floor(Math.log(bytes) / Math.log(k));
return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function setupThumbnailUpload() {
const thumbnailZone = document.getElementById('thumbnail-upload-zone');
const thumbnailInput = document.getElementById('thumbnail-file-input');
const thumbnailPreview = document.getElementById('thumbnail-preview');

// Click on zone
thumbnailZone.addEventListener('click', () => {
openImagePicker();
});

// Drag and drop
thumbnailZone.addEventListener('dragover', (e) => {
e.preventDefault();
thumbnailZone.style.borderColor = 'var(--warm-gold)';
thumbnailZone.style.background = 'rgba(245, 158, 11, 0.05)';
});

thumbnailZone.addEventListener('dragleave', () => {
thumbnailZone.style.borderColor = 'rgba(255, 255, 255, 0.3)';
thumbnailZone.style.background = 'transparent';
});

thumbnailZone.addEventListener('drop', (e) => {
e.preventDefault();
thumbnailZone.style.borderColor = 'rgba(255, 255, 255, 0.3)';
thumbnailZone.style.background = 'transparent';
if (e.dataTransfer.files.length > 0) {
handleThumbnailFile(e.dataTransfer.files[0]);
}
});

// File input change
thumbnailInput.addEventListener('change', (e) => {
if (e.target.files.length > 0) {
handleThumbnailFile(e.target.files[0]);
}
});

// Camera input
document.getElementById('camera-file-input').addEventListener('change', (e) => {
if (e.target.files.length > 0) {
handleThumbnailFile(e.target.files[0]);
}
});
}

function openImagePicker() {
document.getElementById('thumbnail-file-input').click();
}

function captureCameraImage() {
document.getElementById('camera-file-input').click();
}

// Make functions globally available
window.openImagePicker = openImagePicker;
window.captureCameraImage = captureCameraImage;

function handleThumbnailFile(file) {
// Check file type
const imageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
if (!imageTypes.includes(file.type)) {
showToast('Please select a valid image file (JPG, PNG, GIF)', 'error');
return;
}

selectedThumbnailFile = file;

// Create preview
const reader = new FileReader();
reader.onload = function(e) {
document.getElementById('thumbnail-image').src = e.target.result;
document.getElementById('thumbnail-preview').style.display = 'block';
};
reader.readAsDataURL(file);
showToast('Thumbnail image selected', 'success');
}

// ============================================
// UPLOAD PROGRESS
// ============================================

function updateProgress(percentage, text) {
if (!progressFill || !progressPercentage || !progressText || !progressSection) return;

progressFill.style.width = `${percentage}%`;
progressPercentage.textContent = `${Math.round(percentage)}%`;
progressText.textContent = text;

if (percentage > 0) {
progressSection.classList.add('active');
}
}

// ============================================
// FORM HANDLING
// ============================================

function updateButtonsState() {
const title = document.getElementById('content-title').value.trim();
const description = document.getElementById('content-description').value.trim();

// Enable save draft if there's a title
if (saveDraftBtn) {
saveDraftBtn.disabled = !title || isUploading;
}

// Enable publish if all required fields are filled
const canPublish = title && description && selectedMediaFile && !isUploading;
if (publishBtn) {
publishBtn.disabled = !canPublish;
}

// Update button text if uploading
if (isUploading) {
if (publishBtn) {
publishBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publishing...';
publishBtn.disabled = true;
}
if (saveDraftBtn) {
saveDraftBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
saveDraftBtn.disabled = true;
}
} else {
if (publishBtn) {
publishBtn.innerHTML = `
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
</svg>
Publish Content
`;
}
if (saveDraftBtn) {
saveDraftBtn.innerHTML = `
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
<polyline points="17 21 17 13 7 13 7 21"/>
<polyline points="7 3 7 8 15 8"/>
</svg>
Save Draft
`;
}
}
}

function getMediaType(file) {
const videoTypes = ['video/mp4', 'video/mov', 'video/avi', 'video/mkv', 'video/webm'];
const audioTypes = ['audio/mpeg', 'audio/mp3', 'audio/aac', 'audio/wav', 'audio/m4a', 'audio/flac', 'audio/ogg'];

if (videoTypes.includes(file.type)) return 'video';
if (audioTypes.includes(file.type)) return 'audio';
return 'video'; // Default
}

// ============================================
// UPLOAD TO SUPABASE STORAGE
// ============================================

async function uploadFileToStorage(file, bucket, path = '') {
const timestamp = Date.now();
const random = Math.random().toString(36).substring(7);
const fileName = `${timestamp}_${random}_${file.name}`;
const filePath = path ? `${path}/${fileName}` : fileName;

try {
const { data, error } = await window.supabaseClient.storage
.from(bucket)
.upload(filePath, file, {
cacheControl: '3600',
upsert: false
});

if (error) throw error;

// Get public URL
const { data: { publicUrl } } = window.supabaseClient.storage
.from(bucket)
.getPublicUrl(filePath);

return publicUrl;
} catch (error) {
console.error('Storage upload error:', error);
throw new Error(`Failed to upload file: ${error.message}`);
}
}

// ============================================
// CREATE CONTENT RECORD - FIXED RLS-COMPLIANT
// ============================================

async function createContentRecord(contentData) {
if (!currentUser || !currentUserId) {
throw new Error('User not authenticated');
}

try {
// Prepare content object matching schema
const content = {
title: contentData.title,
description: contentData.description,
file_url: contentData.media_url,
user_id: currentUserId,
thumbnail_url: contentData.thumbnail_url,
media_type: contentData.media_type,
genre: contentData.genre || null,
status: contentData.status,
created_at: new Date().toISOString(),
views_count: 0,
likes_count: 0,
favorites_count: 0,
comments_count: 0
};

// Try 'Content' table first (capital C)
try {
const { data, error } = await window.supabaseClient
.from('Content')
.insert([content])
.select();

if (error) throw error;
console.log('‚úÖ Content created in Content table:', data);
return data[0];
} catch (error) {
// Fallback to lowercase 'content' table
console.warn('Capital C Content table failed, trying lowercase:', error.message);
const { data, error: lowerError } = await window.supabaseClient
.from('content')
.insert([content])
.select();

if (lowerError) throw lowerError;
console.log('‚úÖ Content created in content table:', data);
return data[0];
}
} catch (error) {
console.error('Create content error:', error);
throw new Error(`Failed to create content: ${error.message}`);
}
}

// ============================================
// UPLOAD CONTENT
// ============================================

async function uploadContent(isDraft = false) {
// Check authentication
const isAuthenticated = await checkAuthentication();
if (!isAuthenticated) {
showAuthModal(true);
return;
}

// Validate form
const title = document.getElementById('content-title').value.trim();
const description = document.getElementById('content-description').value.trim();
const genre = document.getElementById('content-genre').value;

if (!title || !description || !selectedMediaFile) {
showToast('Please fill all required fields', 'error');
return;
}

// Start upload
isUploading = true;
updateButtonsState();
updateProgress(0, 'Preparing upload...');

try {
// Step 1: Upload media file
updateProgress(20, 'Uploading media file...');
const mediaType = getMediaType(selectedMediaFile);
const mediaUrl = await uploadFileToStorage(selectedMediaFile, 'media', 'videos');

// Step 2: Upload thumbnail (if provided)
let thumbnailUrl = null;
if (selectedThumbnailFile) {
updateProgress(60, 'Uploading thumbnail...');
thumbnailUrl = await uploadFileToStorage(selectedThumbnailFile, 'media', 'thumbnails');
} else {
// Use default thumbnail based on media type
thumbnailUrl = mediaType === 'video'
? 'https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?w=800&q=80'
: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800&q=80';
}

// Step 3: Create content record
updateProgress(80, 'Creating content record...');
const contentData = {
title: title,
description: description,
media_url: mediaUrl,
thumbnail_url: thumbnailUrl,
media_type: mediaType,
genre: genre || null,
status: isDraft ? 'draft' : 'published'
};

await createContentRecord(contentData);

// Step 4: Complete
updateProgress(100, 'Upload complete!');
showToast(isDraft ? 'Content saved as draft!' : 'Content published successfully!', 'success');

// Reset form after delay
setTimeout(() => {
resetForm();
if (!isDraft) {
// Redirect to content library after successful upload
window.location.href = 'https://bantustreamconnect.com/content-library';
}
}, 2000);
} catch (error) {
console.error('Upload error:', error);
showToast(`Upload failed: ${error.message}`, 'error');
updateProgress(0, 'Upload failed');
} finally {
isUploading = false;
updateButtonsState();
}
}

async function saveDraft() {
await uploadContent(true);
}

function resetForm() {
// Clear form fields
document.getElementById('content-title').value = '';
document.getElementById('content-description').value = '';
document.getElementById('content-genre').value = '';

// Clear file selections
selectedMediaFile = null;
selectedThumbnailFile = null;

// Reset UI
document.getElementById('media-file-info').style.display = 'none';
document.getElementById('media-zone-text').textContent = 'Click or drag video/audio files here';
document.getElementById('thumbnail-preview').style.display = 'none';
document.getElementById('media-file-input').value = '';
document.getElementById('thumbnail-file-input').value = '';

// Hide progress
progressSection.classList.remove('active');
updateProgress(0, '');
updateButtonsState();
}

// ============================================
// EVENT LISTENERS
// ============================================

function setupEventListeners() {
// Form submission
uploadForm.addEventListener('submit', async (e) => {
e.preventDefault();
await uploadContent(false);
});

// Save draft button
if (saveDraftBtn) {
saveDraftBtn.addEventListener('click', async (e) => {
e.preventDefault();
await saveDraft();
});
}

// Input listeners for button state
document.getElementById('content-title').addEventListener('input', updateButtonsState);
document.getElementById('content-description').addEventListener('input', updateButtonsState);

// Auth modal buttons
document.getElementById('auth-login-btn').addEventListener('click', () => {
showAuthModal(false);
localStorage.setItem('redirectAfterLogin', 'creator-upload.html');
window.location.href = 'login.html?redirect=creator-upload.html';
});

document.getElementById('auth-cancel-btn').addEventListener('click', () => {
showAuthModal(false);
window.history.back();
});

// Notifications button
if (notificationsBtn) {
notificationsBtn.addEventListener('click', () => {
document.getElementById('notifications-panel').classList.add('active');
renderNotifications();
});
}

// Close notifications panel
const closeNotifications = document.getElementById('close-notifications');
if (closeNotifications) {
closeNotifications.addEventListener('click', () => {
document.getElementById('notifications-panel').classList.remove('active');
});
}

// Close notifications panel on background click
document.getElementById('notifications-panel').addEventListener('click', (e) => {
if (e.target === document.getElementById('notifications-panel')) {
document.getElementById('notifications-panel').classList.remove('active');
}
});

// Mark all notifications as read
document.getElementById('mark-all-read').addEventListener('click', async () => {
if (!currentUser) return;

try {
const { error } = await window.supabaseClient
.from('notifications')
.update({ is_read: true })
.eq('user_id', currentUser.id)
.eq('is_read', false);

if (error) throw error;

notifications = notifications.map(n => ({ ...n, is_read: true }));
renderNotifications();
updateNotificationBadge(0);
showToast('All notifications marked as read', 'success');
} catch (error) {
console.error('Error marking all as read:', error);
showToast('Failed to mark notifications as read', 'error');
}
});

// Search button
if (searchBtn) {
searchBtn.addEventListener('click', () => {
document.getElementById('search-modal').classList.add('active');
setTimeout(() => document.getElementById('search-input')?.focus(), 300);
});
}

// Close search modal
const closeSearchBtn = document.getElementById('close-search-btn');
if (closeSearchBtn) {
closeSearchBtn.addEventListener('click', () => {
document.getElementById('search-modal').classList.remove('active');
document.getElementById('search-input').value = '';
document.getElementById('search-results-grid').innerHTML = '';
});
}

// Close search modal on background click
document.getElementById('search-modal').addEventListener('click', (e) => {
if (e.target === document.getElementById('search-modal')) {
document.getElementById('search-modal').classList.remove('active');
document.getElementById('search-input').value = '';
document.getElementById('search-results-grid').innerHTML = '';
}
});
}

// ============================================
// UTILITY FUNCTIONS
// ============================================

function showToast(message, type = 'info') {
let container = document.getElementById('toast-container');
if (!container) {
container = document.createElement('div');
container.id = 'toast-container';
document.body.appendChild(container);
}

const toast = document.createElement('div');
toast.className = `toast ${type}`;
const icons = {
error: 'fa-exclamation-triangle',
success: 'fa-check-circle',
warning: 'fa-exclamation-circle',
info: 'fa-info-circle'
};

toast.innerHTML = `
<i class="fas ${icons[type] || 'fa-info-circle'}"></i>
<span>${escapeHtml(message)}</span>
`;

container.appendChild(toast);

setTimeout(() => {
if (toast.parentNode) {
toast.remove();
}
}, 3000);
}

function escapeHtml(text) {
if (!text) return '';
const div = document.createElement('div');
div.textContent = text;
return div.innerHTML;
}
});
</script>
</body>
</html>
