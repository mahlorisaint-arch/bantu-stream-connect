<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Details - Bantu Stream Connect</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* All your existing CSS styles remain the same */
        /* ... CSS styles ... */
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading-screen">
        <div class="spinner"></div>
        <div id="loading-text">Loading Content...</div>
    </div>

    <!-- Animated Background -->
    <div class="animated-bg"></div>

    <!-- Navigation -->
    <nav class="main-nav glassmorphism">
        <a href="index.html" class="nav-brand">
            <i class="fas fa-stream"></i>
            <span>Bantu Stream</span>
        </a>
        
        <div class="nav-center">
            <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Home</a>
            <a href="explore.html" class="nav-link"><i class="fas fa-compass"></i> Explore</a>
            <a href="library.html" class="nav-link"><i class="fas fa-photo-video"></i> Library</a>
            <a href="subscriptions.html" class="nav-link"><i class="fas fa-users"></i> Subscriptions</a>
            <a href="content-detail.html" class="nav-link active"><i class="fas fa-play-circle"></i> Now Playing</a>
        </div>
        
        <div class="nav-right">
            <div class="search-box">
                <input type="text" placeholder="Search content...">
                <button><i class="fas fa-search"></i></button>
            </div>
            <a href="profile.html" class="user-avatar">
                <i class="fas fa-user-circle"></i>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="content-container">
        <!-- Content Detail Sections (Initially hidden) -->
        <div id="contentDetail" style="display: none;">
            <!-- Hero Section -->
            <section class="hero-section glassmorphism">
                <div class="hero-background" id="heroBackground"></div>
                <div class="hero-overlay"></div>
                <div class="hero-content">
                    <div class="hero-info">
                        <h1 id="contentTitle">Loading...</h1>
                        <div class="hero-meta">
                            <span class="meta-item" id="contentCreator">
                                <i class="fas fa-user"></i>
                                <span id="creatorName">Loading...</span>
                            </span>
                            <span class="meta-item" id="contentViews">
                                <i class="fas fa-eye"></i>
                                <span id="viewsCount">0 views</span>
                            </span>
                            <span class="meta-item" id="contentLikes">
                                <i class="fas fa-heart"></i>
                                <span id="likesCount">0 likes</span>
                            </span>
                            <span class="meta-item" id="contentDurationDisplay">
                                <i class="fas fa-clock"></i>
                                <span id="durationText">-</span>
                            </span>
                        </div>
                        <div class="hero-actions">
                            <button class="glass-btn play-btn" id="playBtn">
                                <i class="fas fa-play"></i>
                                <span>Play Now</span>
                            </button>
                            <button class="glass-btn" id="downloadBtn">
                                <i class="fas fa-download"></i>
                                <span>Download</span>
                            </button>
                            <button class="glass-btn" id="favoriteBtn">
                                <i class="far fa-heart"></i>
                                <span>Favorite</span>
                            </button>
                            <button class="glass-btn" id="shareBtn">
                                <i class="fas fa-share"></i>
                                <span>Share</span>
                            </button>
                        </div>
                    </div>
                    <div class="hero-poster glassmorphism-gold">
                        <div class="poster-placeholder" id="posterPlaceholder">
                            <i class="fas fa-play-circle"></i>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Content Info Section -->
            <section class="info-section glassmorphism">
                <div class="section-title">
                    <i class="fas fa-info-circle"></i>
                    <span>About this content</span>
                </div>
                
                <div class="creator-info" id="creatorInfo">
                    <div class="creator-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="creator-details">
                        <h3 id="creatorDisplayName">Creator Name</h3>
                        <p id="creatorSubscribers">0 subscribers</p>
                    </div>
                    <button class="subscribe-btn" id="subscribeBtn">
                        <i class="fas fa-user-plus"></i>
                        <span>Subscribe</span>
                    </button>
                </div>
                
                <div class="info-stats glassmorphism">
                    <div class="stat-item">
                        <i class="fas fa-calendar-alt"></i>
                        <div>
                            <div style="color: var(--slate-grey); font-size: 0.8rem;">Uploaded</div>
                            <div id="uploadDate">-</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-film"></i>
                        <div>
                            <div style="color: var(--slate-grey); font-size: 0.8rem;">Duration</div>
                            <div id="contentDuration">-</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-tag"></i>
                        <div>
                            <div style="color: var(--slate-grey); font-size: 0.8rem;">Genre</div>
                            <div id="contentGenre">-</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-flag"></i>
                        <div>
                            <div style="color: var(--slate-grey); font-size: 0.8rem;">Language</div>
                            <div id="contentLanguage">-</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Description Section -->
            <section class="description-section glassmorphism">
                <div class="section-title">
                    <i class="fas fa-align-left"></i>
                    <span>Description</span>
                </div>
                <div class="description-content">
                    <p id="contentDescription">Loading description...</p>
                    <button class="show-more-btn" id="showMoreBtn" style="display: none;">Show more</button>
                </div>
            </section>

            <!-- Comments Section -->
            <section class="comments-section glassmorphism">
                <div class="comments-header">
                    <div class="section-title">
                        <i class="fas fa-comments"></i>
                        <span>Comments</span>
                        <span id="commentsCount" style="font-size: 1rem; color: var(--slate-grey); margin-left: 0.5rem;">(0)</span>
                    </div>
                    <button class="refresh-btn" id="refreshCommentsBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh</span>
                    </button>
                </div>
                
                <!-- Add Comment Form -->
                <div class="add-comment glassmorphism">
                    <div class="comment-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="comment-input-container">
                        <textarea 
                            id="commentInput" 
                            placeholder="Add a comment..." 
                            rows="2"
                        ></textarea>
                        <button class="send-comment-btn" id="sendCommentBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>

                <!-- Comments List -->
                <div class="comments-list" id="commentsList">
                    <div class="no-comments" id="noComments">
                        <i class="far fa-comment-alt"></i>
                        <p>No comments yet. Be the first to comment!</p>
                    </div>
                    <!-- Comments will be dynamically inserted here -->
                </div>
            </section>

            <!-- Related Content Section -->
            <section class="related-section glassmorphism">
                <div class="section-title">
                    <i class="fas fa-video"></i>
                    <span>More Like This</span>
                </div>
                <div class="related-grid" id="relatedGrid">
                    <div class="related-placeholder">
                        <i class="fas fa-video"></i>
                        <p>Loading related content...</p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal for Edit Comment -->
    <div class="modal-overlay" id="editCommentModal">
        <div class="modal-container glassmorphism">
            <div class="modal-header">
                <h3>Edit Comment</h3>
                <button class="modal-close" id="closeEditModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <textarea 
                    id="editCommentInput" 
                    placeholder="Edit your comment..." 
                    rows="4"
                ></textarea>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel-btn" id="cancelEditBtn">Cancel</button>
                <button class="modal-btn save-btn" id="saveEditBtn">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Modal for Delete Confirmation -->
    <div class="modal-overlay" id="deleteCommentModal">
        <div class="modal-container glassmorphism">
            <div class="modal-header">
                <h3>Delete Comment</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this comment? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel-btn" id="cancelDeleteBtn">Cancel</button>
                <button class="modal-btn delete-btn" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Download Modal -->
    <div class="modal-overlay" id="downloadModal">
        <div class="modal-container glassmorphism">
            <div class="modal-header">
                <h3>Download Content</h3>
                <button class="modal-close" id="closeDownloadModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="downloadModalText">Would you like to download this content for offline viewing?</p>
                <div class="download-info">
                    <i class="fas fa-info-circle"></i>
                    <p>File will be downloaded to your device's downloads folder.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel-btn" id="cancelDownloadBtn">Cancel</button>
                <button class="modal-btn download-confirm-btn" id="confirmDownloadBtn">Download</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" style="display: none;">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- FIXED SUPABASE CLIENT - Based on working home-feed.html -->
    <script>
        // Simple Supabase REST client (matching home-feed.html)
        class SimpleSupabaseClient {
            constructor(url, key) {
                this.url = url;
                this.key = key;
            }
            
            async query(table, options = {}) {
                const {
                    select = '*',
                    where = {},
                    orderBy = 'created_at',
                    order = 'desc',
                    limit = 100,
                    offset = 0
                } = options;
                
                // Build query URL
                let queryUrl = `${this.url}/rest/v1/${table}?select=${select}`;
                
                // Add filters
                Object.keys(where).forEach(key => {
                    queryUrl += `&${key}=eq.${encodeURIComponent(where[key])}`;
                });
                
                // Add ordering
                if (orderBy) {
                    queryUrl += `&order=${orderBy}.${order}`;
                }
                
                // Add limit and offset
                queryUrl += `&limit=${limit}&offset=${offset}`;
                
                try {
                    const response = await fetch(queryUrl, {
                        headers: {
                            'apikey': this.key,
                            'Authorization': `Bearer ${this.key}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Supabase query error:', error);
                    throw error;
                }
            }
            
            async queryWithFilter(table, column, value, select = '*') {
                try {
                    const response = await fetch(
                        `${this.url}/rest/v1/${table}?${column}=eq.${encodeURIComponent(value)}&select=${select}`,
                        {
                            headers: {
                                'apikey': this.key,
                                'Authorization': `Bearer ${this.key}`,
                                'Content-Type': 'application/json'
                            }
                        }
                    );
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Supabase query error:', error);
                    throw error;
                }
            }
            
            fixMediaUrl(url) {
                if (!url) return '';
                if (url.startsWith('http')) return url;
                return `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${url.replace(/^\/+/, '')}`;
            }
        }
        
        // Initialize Supabase client
        const supabase = new SimpleSupabaseClient(
            'https://ydnxqnbjoshvxteevemc.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U'
        );
        
        console.log('‚úÖ Supabase client initialized');
    </script>

    <!-- FIXED Content Detail JavaScript -->
    <script>
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üé¨ Content Detail Screen Initializing...');
            
            // Global variables
            let currentUser = null;
            let contentData = null;
            let comments = [];
            let relatedContent = [];
            let editingCommentId = null;
            let deletingCommentId = null;
            let currentContentId = null;
            let isSubscribed = false;
            let isInFavorites = false;
            let isLiked = false;
            let isLoading = false;
            
            // DOM Elements
            const loading = document.getElementById('loading');
            const loadingText = document.getElementById('loading-text');
            const contentDetail = document.getElementById('contentDetail');
            
            // Hero Section Elements
            const heroBackground = document.getElementById('heroBackground');
            const posterPlaceholder = document.getElementById('posterPlaceholder');
            const contentTitle = document.getElementById('contentTitle');
            const creatorName = document.getElementById('creatorName');
            const viewsCount = document.getElementById('viewsCount');
            const likesCount = document.getElementById('likesCount');
            const durationText = document.getElementById('durationText');
            
            // Buttons
            const playBtn = document.getElementById('playBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const favoriteBtn = document.getElementById('favoriteBtn');
            const shareBtn = document.getElementById('shareBtn');
            
            // Content Info Elements
            const creatorDisplayName = document.getElementById('creatorDisplayName');
            const creatorSubscribers = document.getElementById('creatorSubscribers');
            const subscribeBtn = document.getElementById('subscribeBtn');
            const uploadDate = document.getElementById('uploadDate');
            const contentDuration = document.getElementById('contentDuration');
            const contentGenre = document.getElementById('contentGenre');
            const contentLanguage = document.getElementById('contentLanguage');
            const contentDescription = document.getElementById('contentDescription');
            const showMoreBtn = document.getElementById('showMoreBtn');
            
            // Comments Elements
            const refreshCommentsBtn = document.getElementById('refreshCommentsBtn');
            const commentInput = document.getElementById('commentInput');
            const sendCommentBtn = document.getElementById('sendCommentBtn');
            const commentsList = document.getElementById('commentsList');
            const noComments = document.getElementById('noComments');
            const commentsCount = document.getElementById('commentsCount');
            
            // Related Content
            const relatedGrid = document.getElementById('relatedGrid');
            
            // Modal Elements
            const editCommentModal = document.getElementById('editCommentModal');
            const editCommentInput = document.getElementById('editCommentInput');
            const closeEditModal = document.getElementById('closeEditModal');
            const cancelEditBtn = document.getElementById('cancelEditBtn');
            const saveEditBtn = document.getElementById('saveEditBtn');
            
            const deleteCommentModal = document.getElementById('deleteCommentModal');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            
            const downloadModal = document.getElementById('downloadModal');
            const closeDownloadModal = document.getElementById('closeDownloadModal');
            const cancelDownloadBtn = document.getElementById('cancelDownloadBtn');
            const confirmDownloadBtn = document.getElementById('confirmDownloadBtn');
            const downloadModalText = document.getElementById('downloadModalText');
            
            // Toast Container
            const toastContainer = document.getElementById('toast-container');
            
            // Back to Top Button
            const backToTopBtn = document.getElementById('backToTop');
            
            // ‚úÖ INITIALIZE
            async function init() {
                try {
                    // Get content ID from URL
                    const urlParams = new URLSearchParams(window.location.search);
                    currentContentId = urlParams.get('id');
                    
                    if (!currentContentId) {
                        showToast('No content ID provided', 'error');
                        setTimeout(() => window.location.href = 'index.html', 2000);
                        return;
                    }
                    
                    console.log('üì¶ Loading content ID:', currentContentId);
                    
                    // Load content data
                    await loadContentData();
                    
                    // Load additional data
                    await loadRelatedContent();
                    
                    // Show content detail
                    loading.style.display = 'none';
                    contentDetail.style.display = 'block';
                    
                    // Set up event listeners
                    setupEventListeners();
                    
                    // Initialize back to top button
                    initBackToTop();
                    
                    console.log('‚úÖ Content detail initialized successfully');
                    
                } catch (error) {
                    console.error('‚ùå Initialization error:', error);
                    showToast('Failed to load content. Loading sample data...', 'warning');
                    loadSampleData();
                }
            }
            
            // ‚úÖ LOAD CONTENT DATA
            async function loadContentData() {
                try {
                    loadingText.textContent = 'Loading content details...';
                    
                    // Try different table names (similar to home-feed.html)
                    let contentDataArray = [];
                    
                    try {
                        // Try 'Content' table first
                        contentDataArray = await supabase.queryWithFilter('Content', 'id', currentContentId);
                    } catch (error) {
                        console.log('‚ö†Ô∏è Content table failed, trying content table...');
                        try {
                            // Try lowercase 'content' table
                            contentDataArray = await supabase.queryWithFilter('content', 'id', currentContentId);
                        } catch (error2) {
                            console.log('‚ö†Ô∏è Both table queries failed');
                            throw new Error('Content not found');
                        }
                    }
                    
                    if (!contentDataArray || contentDataArray.length === 0) {
                        throw new Error('Content not found');
                    }
                    
                    contentData = contentDataArray[0];
                    console.log('‚úÖ Content loaded:', contentData.title);
                    
                    // Update UI with content data
                    updateContentUI();
                    
                } catch (error) {
                    console.error('‚ùå Error loading content:', error);
                    showToast('Content not found', 'error');
                    throw error;
                }
            }
            
            // ‚úÖ UPDATE CONTENT UI
            function updateContentUI() {
                if (!contentData) return;
                
                // Update hero section
                contentTitle.textContent = contentData.title || 'Untitled';
                
                const creator = contentData.creator || 
                               contentData.creator_display_name || 
                               contentData.user_profiles?.display_name ||
                               contentData.user_profiles?.username || 
                               'Unknown Creator';
                creatorName.textContent = creator;
                
                // Set background image
                if (contentData.thumbnail_url) {
                    const thumbnailUrl = supabase.fixMediaUrl(contentData.thumbnail_url);
                    heroBackground.style.backgroundImage = `url('${thumbnailUrl}')`;
                    
                    // Update poster
                    posterPlaceholder.innerHTML = `<img src="${thumbnailUrl}" alt="${contentData.title}" style="width: 100%; height: 100%; object-fit: cover;">`;
                }
                
                // Update content info
                creatorDisplayName.textContent = creator;
                creatorSubscribers.textContent = `${contentData.subscriber_count || 0} subscribers`;
                
                uploadDate.textContent = formatDate(contentData.created_at);
                
                if (contentData.duration) {
                    const durationFormatted = formatDuration(contentData.duration);
                    contentDuration.textContent = durationFormatted;
                    durationText.textContent = durationFormatted;
                }
                
                contentGenre.textContent = contentData.genre || 'Not specified';
                contentLanguage.textContent = contentData.language || 'Unknown';
                
                // Update views and likes
                viewsCount.textContent = `${contentData.views || contentData.views_count || 0} views`;
                likesCount.textContent = `${contentData.likes || contentData.likes_count || 0} likes`;
                
                // Update description
                const description = contentData.description || 'No description available.';
                contentDescription.textContent = description;
                
                // Show more/less button for long descriptions
                if (description.length > 300) {
                    showMoreBtn.style.display = 'block';
                    contentDescription.textContent = description.substring(0, 300) + '...';
                    showMoreBtn.textContent = 'Show more';
                }
            }
            
            // ‚úÖ LOAD RELATED CONTENT
            async function loadRelatedContent() {
                try {
                    const currentGenre = contentData?.genre;
                    
                    let similarContent = [];
                    
                    try {
                        similarContent = await supabase.query('Content', {
                            select: '*',
                            where: { status: 'published' },
                            limit: 6
                        });
                    } catch (error) {
                        console.log('‚ö†Ô∏è Content table failed, trying content table...');
                        similarContent = await supabase.query('content', {
                            select: '*',
                            where: { status: 'published' },
                            limit: 6
                        });
                    }
                    
                    // Filter out current content and limit to 6
                    relatedContent = similarContent
                        .filter(content => content.id !== currentContentId)
                        .slice(0, 6);
                    
                    renderRelatedContent();
                    
                } catch (error) {
                    console.error('‚ùå Error loading related content:', error);
                    relatedGrid.innerHTML = `
                        <div class="related-placeholder">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>Failed to load related content</p>
                        </div>
                    `;
                }
            }
            
            // ‚úÖ RENDER RELATED CONTENT
            function renderRelatedContent() {
                if (!relatedContent.length) {
                    relatedGrid.innerHTML = `
                        <div class="related-placeholder">
                            <i class="fas fa-video-slash"></i>
                            <p>No related content found</p>
                        </div>
                    `;
                    return;
                }
                
                relatedGrid.innerHTML = '';
                relatedContent.forEach(content => {
                    const card = document.createElement('a');
                    card.className = 'related-card glassmorphism';
                    card.href = `content-detail.html?id=${content.id}`;
                    card.innerHTML = `
                        <div class="related-thumbnail">
                            ${content.thumbnail_url ? 
                                `<img src="${supabase.fixMediaUrl(content.thumbnail_url)}" alt="${content.title}" loading="lazy">` :
                                `<i class="fas fa-play-circle"></i>`
                            }
                        </div>
                        <div class="related-info">
                            <h3>${content.title || 'Untitled'}</h3>
                            <div class="related-meta">
                                <i class="fas fa-eye"></i>
                                <span>${content.views || content.views_count || 0} views</span>
                            </div>
                        </div>
                    `;
                    
                    relatedGrid.appendChild(card);
                });
            }
            
            // ‚úÖ LOAD SAMPLE DATA (fallback)
            function loadSampleData() {
                // Sample content data similar to home-feed.html
                contentData = {
                    id: currentContentId || '1',
                    title: 'African Music Festival Highlights',
                    description: 'Highlights from the biggest African music festival featuring top artists from across the continent. Experience the vibrant culture, amazing performances, and unforgettable moments.',
                    thumbnail_url: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=800&h=450&fit=crop',
                    file_url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                    media_type: 'video',
                    genre: 'Music',
                    created_at: new Date().toISOString(),
                    creator: 'Music Africa',
                    creator_display_name: 'Music Africa',
                    duration: 3600, // 1 hour in seconds
                    language: 'English',
                    views: 12500,
                    likes: 890,
                    subscriber_count: 1500
                };
                
                // Update UI
                updateContentUI();
                
                // Load sample related content
                relatedContent = [
                    {
                        id: '2',
                        title: 'Tech Innovation in Africa',
                        thumbnail_url: 'https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=400&h=225&fit=crop',
                        views: 8900
                    },
                    {
                        id: '3',
                        title: 'Traditional Dance Performance',
                        thumbnail_url: 'https://images.unsplash.com/photo-1547153760-18fc86324498?w=400&h=225&fit=crop',
                        views: 15600
                    },
                    {
                        id: '4',
                        title: 'African Cuisine Cooking Show',
                        thumbnail_url: 'https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400&h=225&fit=crop',
                        views: 7800
                    },
                    {
                        id: '5',
                        title: 'Startup Success Stories',
                        thumbnail_url: 'https://images.unsplash.com/photo-1556761175-b413da4baf72?w=400&h=225&fit=crop',
                        views: 11200
                    }
                ];
                
                renderRelatedContent();
                
                // Show content detail
                loading.style.display = 'none';
                contentDetail.style.display = 'block';
                
                // Set up event listeners
                setupEventListeners();
                
                // Initialize back to top button
                initBackToTop();
                
                showToast('Using sample data. Supabase connection may be unavailable.', 'info');
            }
            
            // ‚úÖ SETUP EVENT LISTENERS
            function setupEventListeners() {
                // Play button
                playBtn.addEventListener('click', handlePlayPressed);
                
                // Download button
                downloadBtn.addEventListener('click', handleDownloadPressed);
                
                // Favorite button
                favoriteBtn.addEventListener('click', toggleFavorite);
                
                // Share button
                shareBtn.addEventListener('click', shareContent);
                
                // Subscribe button
                subscribeBtn.addEventListener('click', toggleSubscription);
                
                // Refresh comments button
                refreshCommentsBtn.addEventListener('click', () => {
                    showToast('Comments refreshed', 'success');
                });
                
                // Send comment button
                sendCommentBtn.addEventListener('click', addComment);
                
                // Comment input enter key
                commentInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        addComment();
                    }
                });
                
                // Show more button
                showMoreBtn.addEventListener('click', toggleDescription);
                
                // Edit comment modal
                closeEditModal.addEventListener('click', () => editCommentModal.style.display = 'none');
                cancelEditBtn.addEventListener('click', () => editCommentModal.style.display = 'none');
                saveEditBtn.addEventListener('click', saveEditedComment);
                
                // Delete comment modal
                cancelDeleteBtn.addEventListener('click', () => deleteCommentModal.style.display = 'none');
                confirmDeleteBtn.addEventListener('click', deleteComment);
                
                // Download modal
                closeDownloadModal.addEventListener('click', () => downloadModal.style.display = 'none');
                cancelDownloadBtn.addEventListener('click', () => downloadModal.style.display = 'none');
                confirmDownloadBtn.addEventListener('click', startDownload);
                
                // Close modals when clicking outside
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.style.display = 'none';
                        }
                    });
                });
            }
            
            // ‚úÖ HANDLE PLAY PRESSED
            function handlePlayPressed() {
                if (!contentData) return;
                
                showToast(`Playing "${contentData.title}"`, 'success');
                
                // In a real app, navigate to video player
                // For now, just show message
                console.log('Playing:', contentData.title);
            }
            
            // ‚úÖ HANDLE DOWNLOAD PRESSED
            function handleDownloadPressed() {
                if (!contentData) return;
                
                downloadModalText.textContent = `Download "${contentData.title}" for offline viewing?`;
                downloadModal.style.display = 'flex';
            }
            
            // ‚úÖ START DOWNLOAD
            function startDownload() {
                downloadModal.style.display = 'none';
                
                // Show download progress
                showToast('Download started...', 'info');
                
                // Simulate download
                setTimeout(() => {
                    showToast('Download completed successfully!', 'success');
                }, 3000);
            }
            
            // ‚úÖ TOGGLE FAVORITE
            function toggleFavorite() {
                isInFavorites = !isInFavorites;
                
                if (isInFavorites) {
                    favoriteBtn.querySelector('i').className = 'fas fa-heart';
                    favoriteBtn.querySelector('span').textContent = 'Favorited';
                    favoriteBtn.style.background = 'rgba(245, 158, 11, 0.2)';
                    showToast('Added to favorites', 'success');
                } else {
                    favoriteBtn.querySelector('i').className = 'far fa-heart';
                    favoriteBtn.querySelector('span').textContent = 'Favorite';
                    favoriteBtn.style.background = '';
                    showToast('Removed from favorites', 'info');
                }
            }
            
            // ‚úÖ SHARE CONTENT
            function shareContent() {
                if (!contentData) return;
                
                const shareData = {
                    title: contentData.title,
                    text: `Check out "${contentData.title}" on Bantu Stream Connect`,
                    url: window.location.href
                };
                
                if (navigator.share) {
                    navigator.share(shareData)
                        .then(() => showToast('Shared successfully!', 'success'))
                        .catch(err => {
                            if (err.name !== 'AbortError') {
                                copyToClipboard(window.location.href);
                            }
                        });
                } else {
                    copyToClipboard(window.location.href);
                }
            }
            
            // ‚úÖ TOGGLE SUBSCRIPTION
            function toggleSubscription() {
                isSubscribed = !isSubscribed;
                
                if (isSubscribed) {
                    subscribeBtn.innerHTML = '<i class="fas fa-user-check"></i><span>Subscribed</span>';
                    subscribeBtn.classList.add('subscribed');
                    showToast('Subscribed successfully!', 'success');
                } else {
                    subscribeBtn.innerHTML = '<i class="fas fa-user-plus"></i><span>Subscribe</span>';
                    subscribeBtn.classList.remove('subscribed');
                    showToast('Unsubscribed', 'info');
                }
            }
            
            // ‚úÖ ADD COMMENT
            function addComment() {
                const commentText = commentInput.value.trim();
                if (!commentText) {
                    showToast('Please enter a comment', 'warning');
                    return;
                }
                
                // Create a sample comment
                const newComment = {
                    id: Date.now().toString(),
                    comment_text: commentText,
                    author_name: 'You',
                    created_at: new Date().toISOString(),
                    like_count: 0
                };
                
                // Add to comments list
                comments.unshift(newComment);
                
                // Clear input
                commentInput.value = '';
                
                // Update UI
                renderComments();
                showToast('Comment added successfully!', 'success');
            }
            
            // ‚úÖ RENDER COMMENTS
            function renderComments() {
                if (!comments.length) {
                    noComments.style.display = 'block';
                    commentsCount.textContent = '(0)';
                    return;
                }
                
                noComments.style.display = 'none';
                commentsCount.textContent = `(${comments.length})`;
                
                // Clear existing comments except no-comments placeholder
                const existingComments = commentsList.querySelectorAll('.comment-item');
                existingComments.forEach(comment => comment.remove());
                
                comments.forEach(comment => {
                    const commentEl = document.createElement('div');
                    commentEl.className = 'comment-item glassmorphism';
                    commentEl.dataset.commentId = comment.id;
                    
                    const userName = comment.author_name || 'User';
                    const createdAt = comment.created_at ? formatCommentTime(comment.created_at) : 'Recently';
                    
                    commentEl.innerHTML = `
                        <div class="comment-header">
                            <div class="comment-avatar-sm">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="comment-user">
                                <strong>${userName}</strong>
                                <div class="comment-time">${createdAt}</div>
                            </div>
                            <div class="comment-actions">
                                <button class="comment-action-btn edit-btn" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="comment-action-btn delete-btn" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="comment-action-btn like-btn" title="Like">
                                    <i class="far fa-heart"></i>
                                </button>
                            </div>
                        </div>
                        <div class="comment-content">
                            ${comment.comment_text || comment.comment || ''}
                        </div>
                        <div class="comment-footer">
                            <div class="like-count">
                                <i class="fas fa-heart"></i>
                                <span>${comment.like_count || 0} likes</span>
                            </div>
                        </div>
                    `;
                    
                    // Add event listeners
                    const editBtn = commentEl.querySelector('.edit-btn');
                    const deleteBtn = commentEl.querySelector('.delete-btn');
                    const likeBtn = commentEl.querySelector('.like-btn');
                    
                    editBtn.addEventListener('click', () => editComment(comment.id, comment.comment_text || comment.comment));
                    deleteBtn.addEventListener('click', () => confirmDeleteComment(comment.id));
                    likeBtn.addEventListener('click', () => toggleCommentLike(comment.id, likeBtn));
                    
                    commentsList.appendChild(commentEl);
                });
            }
            
            // ‚úÖ EDIT COMMENT
            function editComment(commentId, currentText) {
                editingCommentId = commentId;
                editCommentInput.value = currentText;
                editCommentModal.style.display = 'flex';
            }
            
            // ‚úÖ SAVE EDITED COMMENT
            function saveEditedComment() {
                if (!editingCommentId || !editCommentInput.value.trim()) {
                    editCommentModal.style.display = 'none';
                    return;
                }
                
                // Find and update comment
                const commentIndex = comments.findIndex(c => c.id === editingCommentId);
                if (commentIndex !== -1) {
                    comments[commentIndex].comment_text = editCommentInput.value.trim();
                }
                
                editCommentModal.style.display = 'none';
                editCommentInput.value = '';
                editingCommentId = null;
                
                renderComments();
                showToast('Comment updated successfully!', 'success');
            }
            
            // ‚úÖ CONFIRM DELETE COMMENT
            function confirmDeleteComment(commentId) {
                deletingCommentId = commentId;
                deleteCommentModal.style.display = 'flex';
            }
            
            // ‚úÖ DELETE COMMENT
            function deleteComment() {
                if (!deletingCommentId) {
                    deleteCommentModal.style.display = 'none';
                    return;
                }
                
                // Remove comment
                comments = comments.filter(c => c.id !== deletingCommentId);
                
                deleteCommentModal.style.display = 'none';
                deletingCommentId = null;
                
                renderComments();
                showToast('Comment deleted successfully!', 'success');
            }
            
            // ‚úÖ TOGGLE COMMENT LIKE
            function toggleCommentLike(commentId, likeBtn) {
                const comment = comments.find(c => c.id === commentId);
                if (!comment) return;
                
                comment.like_count = (comment.like_count || 0) + 1;
                likeBtn.querySelector('i').className = 'fas fa-heart';
                likeBtn.classList.add('liked');
                
                renderComments();
                showToast('Liked comment!', 'success');
            }
            
            // ‚úÖ TOGGLE DESCRIPTION
            function toggleDescription() {
                const fullDescription = contentData.description;
                const currentText = contentDescription.textContent;
                
                if (currentText.includes('...')) {
                    // Show full description
                    contentDescription.textContent = fullDescription;
                    showMoreBtn.textContent = 'Show less';
                } else {
                    // Show truncated description
                    contentDescription.textContent = fullDescription.substring(0, 300) + '...';
                    showMoreBtn.textContent = 'Show more';
                }
            }
            
            // ‚úÖ INIT BACK TO TOP BUTTON
            function initBackToTop() {
                window.addEventListener('scroll', () => {
                    if (window.pageYOffset > 300) {
                        backToTopBtn.style.display = 'flex';
                    } else {
                        backToTopBtn.style.display = 'none';
                    }
                });
                
                backToTopBtn.addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }
            
            // ‚úÖ UTILITY FUNCTIONS
            
            function formatDate(dateString) {
                if (!dateString) return '-';
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            }
            
            function formatDuration(seconds) {
                if (!seconds) return '-';
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const remainingSeconds = seconds % 60;
                
                if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                } else if (minutes > 0) {
                    return `${minutes}m ${remainingSeconds}s`;
                } else {
                    return `${remainingSeconds}s`;
                }
            }
            
            function formatCommentTime(dateString) {
                if (!dateString) return 'Recently';
                
                try {
                    const date = new Date(dateString);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffSec = Math.floor(diffMs / 1000);
                    const diffMin = Math.floor(diffSec / 60);
                    const diffHour = Math.floor(diffMin / 60);
                    const diffDay = Math.floor(diffHour / 24);
                    
                    if (diffDay > 0) return `${diffDay}d ago`;
                    if (diffHour > 0) return `${diffHour}h ago`;
                    if (diffMin > 0) return `${diffMin}m ago`;
                    return 'Just now';
                } catch (e) {
                    return 'Recently';
                }
            }
            
            function showToast(message, type = 'info') {
                // Remove existing toast
                const existingToast = document.querySelector('.toast');
                if (existingToast) existingToast.remove();
                
                // Create new toast
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                let icon = 'info-circle';
                if (type === 'success') icon = 'check-circle';
                if (type === 'error') icon = 'exclamation-circle';
                if (type === 'warning') icon = 'exclamation-triangle';
                
                toast.innerHTML = `
                    <i class="fas fa-${icon}"></i>
                    <span>${message}</span>
                `;
                
                toastContainer.appendChild(toast);
                
                // Remove toast after 3 seconds
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.style.opacity = '0';
                        setTimeout(() => {
                            if (toast.parentNode) toast.remove();
                        }, 300);
                    }
                }, 3000);
            }
            
            function copyToClipboard(text) {
                navigator.clipboard.writeText(text)
                    .then(() => showToast('Link copied to clipboard!', 'success'))
                    .catch(err => {
                        console.error('Failed to copy:', err);
                        showToast('Failed to copy link', 'error');
                    });
            }
            
            // ‚úÖ START INITIALIZATION
            setTimeout(() => {
                init();
            }, 500);
            
            console.log('‚úÖ Content detail script loaded');
        });
    </script>
</body>
</html>
