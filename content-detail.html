<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Details - Bantu Stream Connect</title>
    
    <!-- Week 2: PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="css/base.css" as="style">
    <link rel="preload" href="css/components.css" as="style">
    
    <!-- Google Fonts (preconnect) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/content-detail.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Non-blocking Google Fonts -->
    <style>
        /* Critical font declarations */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap');
    </style>
    
    <!-- Preload key scripts -->
    <link rel="preload" href="js/security.js" as="script">
    <link rel="preload" href="js/error-handler.js" as="script">
</head>
<body>
    <!-- Week 2: Skip to Content Link (Accessibility) -->
    <a href="#contentHero" class="skip-to-content">Skip to Content</a>
    
    <!-- Loading Screen -->
    <div id="loading" class="loading-screen">
        <div class="spinner"></div>
        <div id="loading-text">Loading Content Details...</div>
    </div>

    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="glow-cycle glow-1"></div>
        <div class="glow-cycle glow-2"></div>
        <div class="glow-cycle glow-3"></div>
        <div class="glow-cycle glow-4"></div>
    </div>

    <!-- Main Content (hidden until loaded) -->
    <div id="app" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="logo" onclick="window.location.href='index.html'">
                <div class="logo-icon">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="40" height="40" rx="8" fill="#0F172A"/>
                        <path d="M8 20 L12 16 L16 22 L20 18 L24 24 L28 20 L32 26" stroke="url(#pulse-gradient)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="32" cy="26" r="3" fill="#F59E0B"/>
                        <defs>
                            <linearGradient id="pulse-gradient" x1="8" y1="20" x2="32" y2="26" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#1D4ED8"/>
                                <stop offset="1" stop-color="#F59E0B"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div class="logo-text">BANTU STREAM CONNECT</div>
            </div>
            <div class="header-actions">
                <button id="search-btn" class="icon-btn search-btn" title="Search">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </button>
                <button id="profile-btn" class="profile-btn" title="Profile">
                    <div class="profile-placeholder">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container">
            <!-- Content Hero Section -->
            <section class="content-hero" id="contentHero">
                <div class="hero-poster" id="heroPoster">
                    <div class="poster-placeholder" id="posterPlaceholder">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <div class="play-overlay">
                        <div class="play-icon-large">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                </div>
                <div class="hero-info">
                    <h1 id="contentTitle">Loading...</h1>
                    <div class="hero-meta">
                        <span class="meta-item" id="contentCreator">
                            <i class="fas fa-user"></i>
                            <span id="creatorName">Loading...</span>
                        </span>
                        <span class="meta-item" id="contentViews">
                            <i class="fas fa-eye"></i>
                            <span id="viewsCount">0 views</span>
                        </span>
                        <span class="meta-item" id="contentLikes">
                            <i class="fas fa-heart"></i>
                            <span id="likesCount">0 likes</span>
                        </span>
                        <span class="meta-item" id="contentDuration">
                            <i class="fas fa-clock"></i>
                            <span id="durationText">-</span>
                        </span>
                    </div>
                    <div class="hero-description">
                        <p id="contentDescriptionShort">Loading description...</p>
                    </div>
                    <div class="hero-actions">
                        <!-- Week 2: Resume button will be added dynamically here -->
                        <button class="btn btn-primary" id="playBtn">
                            <i class="fas fa-play"></i>
                            <span>Play Now</span>
                        </button>
                        <button class="btn btn-secondary" id="favoriteBtn">
                            <i class="far fa-heart"></i>
                            <span>Favorite</span>
                        </button>
                        <button class="btn btn-secondary" id="shareBtn">
                            <i class="fas fa-share"></i>
                            <span>Share</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Inline Video Player -->
            <div class="inline-player" id="inlinePlayer">
                <div class="player-header">
                    <h3 id="playerTitle">Now Playing</h3>
                    <button class="icon-btn close-player" id="closePlayerBtn" title="Close Player">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="video-container">
                    <!-- Week 2: Enhanced Video Player Elements -->
                    <video id="inlineVideoPlayer" controls playsinline>
                        Your browser does not support the video tag.
                    </video>
                    
                    <!-- Buffering Indicator (Week 2) -->
                    <div class="buffering-indicator">
                        <div class="spinner"></div>
                        <p>Buffering...</p>
                    </div>
                    
                    <!-- Video Error Overlay (Week 2) -->
                    <div class="video-error-overlay">
                        <div class="error-content">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Video Error</h3>
                            <p class="error-message" id="videoErrorMsg">Unable to play video. Please check your connection.</p>
                            <div>
                                <button class="retry-btn" id="retryVideoBtn">Retry</button>
                                <button class="cancel-btn" id="cancelVideoBtn">Cancel</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Custom Video Controls (Week 2) -->
                    <div class="video-controls">
                        <div class="controls-bar">
                            <button class="video-control-btn" id="playPauseBtn" title="Play/Pause">
                                <i class="fas fa-play"></i>
                            </button>
                            <div class="time-display">
                                <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                            </div>
                            <input type="range" class="progress-bar" id="progressBar" min="0" max="100" value="0">
                            <button class="video-control-btn" id="volumeBtn" title="Volume">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <input type="range" class="volume-bar" id="volumeBar" min="0" max="100" value="100">
                            <button class="video-control-btn" id="settingsBtn" title="Settings">
                                <i class="fas fa-cog"></i>
                            </button>
                            <button class="video-control-btn" id="fullscreenBtn" title="Fullscreen">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Settings Menu (Week 2) -->
                    <div class="settings-menu" id="settingsMenu">
                        <div class="playback-speed">
                            <h4>Playback Speed</h4>
                            <div class="speed-options">
                                <span class="speed-option" data-speed="0.5">0.5x</span>
                                <span class="speed-option" data-speed="0.75">0.75x</span>
                                <span class="speed-option active" data-speed="1">1x</span>
                                <span class="speed-option" data-speed="1.25">1.25x</span>
                                <span class="speed-option" data-speed="1.5">1.5x</span>
                                <span class="speed-option" data-speed="2">2x</span>
                            </div>
                        </div>
                        <div class="quality-selector">
                            <h4>Quality</h4>
                            <div class="quality-options">
                                <span class="quality-option" data-quality="auto">Auto</span>
                                <span class="quality-option active" data-quality="720">720p</span>
                                <span class="quality-option" data-quality="480">480p</span>
                                <span class="quality-option" data-quality="360">360p</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quality Suggestion (Week 2) -->
                    <div class="quality-suggestion" id="qualitySuggestion">
                        <p>Poor connection detected. Switch to lower quality?</p>
                        <button class="accept-btn" id="acceptQualityBtn">Switch to 360p</button>
                        <button class="dismiss-btn" id="dismissQualityBtn">Keep current</button>
                    </div>
                </div>
                <div class="player-actions">
                    <div class="player-controls">
                        <button class="control-btn" id="pictureInPictureBtn" title="Picture-in-Picture">
                            <i class="fas fa-clone"></i>
                        </button>
                        <button class="control-btn" id="playbackSpeedBtn" title="Playback Speed">
                            <i class="fas fa-tachometer-alt"></i>
                        </button>
                    </div>
                    <button class="btn btn-primary fullscreen-btn" id="fullPlayerBtn">
                        <i class="fas fa-expand"></i>
                        <span>Open Full Player</span>
                    </button>
                </div>
            </div>

            <!-- Creator Info Section -->
            <section class="creator-section" id="creatorSection">
                <div class="creator-info">
                    <div class="creator-avatar" id="creatorAvatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="creator-details">
                        <h3 id="creatorDisplayName">Creator Name</h3>
                        <p id="creatorConnectors">0 connectors</p>
                    </div>
                    <button class="btn btn-primary connect-btn" id="connectBtn">
                        <i class="fas fa-user-plus"></i>
                        <span>Connect</span>
                    </button>
                </div>
            </section>

            <!-- Stats Grid -->
            <div class="stats-grid" id="statsGrid">
                <div class="card stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Uploaded</h4>
                        <p id="uploadDate">-</p>
                    </div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-film"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Duration</h4>
                        <p id="contentDurationFull">-</p>
                    </div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tag"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Genre</h4>
                        <p id="contentGenre">-</p>
                    </div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-flag"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Language</h4>
                        <p id="contentLanguage">-</p>
                    </div>
                </div>
            </div>

            <!-- Description Section -->
            <section class="description-section card">
                <div class="section-header">
                    <h2 class="section-title">Description</h2>
                </div>
                <div class="description-content">
                    <p id="contentDescriptionFull">Loading full description...</p>
                    <button class="btn btn-secondary show-more-btn" id="showMoreBtn" style="display: none;">Show more</button>
                </div>
            </section>

            <!-- Comments Section -->
            <section class="comments-section card">
                <div class="section-header">
                    <h2 class="section-title">
                        Comments
                        <span id="commentsCount" style="font-size: 1rem; color: rgba(255, 255, 255, 0.6); margin-left: 0.5rem;">(0)</span>
                    </h2>
                    <button class="btn btn-secondary refresh-btn" id="refreshCommentsBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh</span>
                    </button>
                </div>
                
                <!-- Add Comment Form -->
                <div class="add-comment">
                    <div class="comment-avatar" id="userCommentAvatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="comment-input-container">
                        <textarea 
                            id="commentInput" 
                            placeholder="Add a comment..." 
                            rows="3"
                        ></textarea>
                        <button class="btn btn-primary send-comment-btn" id="sendCommentBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>

                <!-- Comments List -->
                <div class="comments-list" id="commentsList">
                    <div class="no-comments" id="noComments">
                        <i class="far fa-comment-alt"></i>
                        <p>No comments yet. Be the first to comment!</p>
                    </div>
                </div>
            </section>

            <!-- Related Content Section -->
            <section class="related-section">
                <div class="section-header">
                    <h2 class="section-title">More Like This</h2>
                </div>
                <div class="content-grid" id="relatedGrid">
                    <div class="related-placeholder card">
                        <i class="fas fa-video"></i>
                        <p>Loading related content...</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Bantu Stream Connect © 2025 • Built in South Africa</p>
        </footer>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <!-- Week 2: Offline/Online Toast Containers -->
    <div id="offline-toast" class="offline-toast" style="display: none;"></div>
    <div id="online-toast" class="online-toast" style="display: none;"></div>
    <div id="update-toast" class="update-toast" style="display: none;"></div>
    <div id="update-ready-toast" class="update-ready-toast" style="display: none;"></div>
    
    <!-- Week 2: Keyboard Shortcut Feedback -->
    <div id="shortcut-feedback" class="shortcut-feedback" style="display: none;"></div>
    
    <!-- Week 2: Keyboard Help Dialog -->
    <div id="keyboard-help-dialog" class="keyboard-help-dialog" style="display: none;">
        <button class="close-help-btn" id="closeHelpBtn">
            <i class="fas fa-times"></i>
        </button>
        <h2>Keyboard Shortcuts</h2>
        <div class="shortcuts-grid" id="shortcutsList">
            <!-- Shortcuts will be populated by JavaScript -->
        </div>
        <div class="help-footer">
            <p><i class="fas fa-info-circle"></i> Press '?' to show/hide this help</p>
            <p class="online-only"><i class="fas fa-wifi"></i> Online features available</p>
        </div>
    </div>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTopBtn" title="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Week 2: Enhanced Script Loading Order -->
    <!-- Fix script loading order -->
    <!-- Load Supabase from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    
    <!-- Load scripts in correct order -->
    <script src="js/security.js"></script>
    <script>
        // Initialize Supabase immediately
        if (typeof supabase !== 'undefined') {
            console.log('Supabase loaded globally');
            
            // Initialize Supabase client
            const SUPABASE_URL = 'https://ydnxqnbjoshvxteevemc.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U';
            
            // Create Supabase client
            window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('Supabase client created successfully');
            
            // Load scripts in correct order
            var errorScript = document.createElement('script');
            errorScript.src = 'js/error-handler.js';
            errorScript.onload = function() {
                console.log('Error handler loaded');
                
                // Load state manager
                var stateScript = document.createElement('script');
                stateScript.src = 'js/state-manager.js';
                stateScript.onload = function() {
                    console.log('State manager loaded');
                    
                    // Load video player
                    var videoScript = document.createElement('script');
                    videoScript.src = 'js/video-player.js';
                    videoScript.onload = function() {
                        console.log('Video player loaded');
                        
                        // Load keyboard navigation
                        var keyboardScript = document.createElement('script');
                        keyboardScript.src = 'js/keyboard-navigation.js';
                        keyboardScript.onload = function() {
                            console.log('Keyboard navigation loaded');
                            
                            // Load supabase-helper
                            var helperScript = document.createElement('script');
                            helperScript.src = 'js/supabase-helper.js';
                            helperScript.onload = function() {
                                console.log('Supabase helper loaded');
                                
                                // Load service worker register
                                var swScript = document.createElement('script');
                                swScript.src = 'js/sw-register.js';
                                swScript.onload = function() {
                                    console.log('Service worker registered');
                                    
                                    // Finally load the main content-detail script
                                    var mainScript = document.createElement('script');
                                    mainScript.src = 'js/content-detail.js';
                                    document.head.appendChild(mainScript);
                                };
                                document.head.appendChild(swScript);
                            };
                            document.head.appendChild(helperScript);
                        };
                        document.head.appendChild(keyboardScript);
                    };
                    document.head.appendChild(videoScript);
                };
                document.head.appendChild(stateScript);
            };
            document.head.appendChild(errorScript);
        } else {
            console.error('Supabase failed to load');
            
            // Load scripts in order anyway
            var scripts = [
                'js/error-handler.js',
                'js/state-manager.js',
                'js/video-player.js',
                'js/keyboard-navigation.js',
                'js/supabase-helper.js',
                'js/sw-register.js',
                'js/content-detail.js'
            ];
            
            function loadScripts(index) {
                if (index >= scripts.length) {
                    console.log('All scripts loaded');
                    return;
                }
                var script = document.createElement('script');
                script.src = scripts[index];
                script.onload = function() {
                    console.log(scripts[index] + ' loaded');
                    loadScripts(index + 1);
                };
                script.onerror = function() {
                    console.error('Failed to load: ' + scripts[index]);
                    loadScripts(index + 1);
                };
                document.head.appendChild(script);
            }
            loadScripts(0);
        }
    </script>

    <!-- After all scripts -->
    <script>
        // Fallback timeout to show app
        setTimeout(function() {
            var loadingScreen = document.getElementById('loading');
            var app = document.getElementById('app');
            
            if (loadingScreen && loadingScreen.style.display !== 'none') {
                console.log('Fallback timeout - showing app anyway');
                loadingScreen.style.display = 'none';
                if (app) {
                    app.style.display = 'block';
                }
            }
        }, 10000);
        
        // Week 2: Global error handler for PWA offline support
        window.addEventListener('offline', function() {
            console.log('Network offline');
            if (window.showOfflineToast) {
                window.showOfflineToast();
            }
        });
        
        window.addEventListener('online', function() {
            console.log('Network online');
            if (window.showOnlineToast) {
                window.showOnlineToast();
            }
        });
    </script>
</body>
</html>
