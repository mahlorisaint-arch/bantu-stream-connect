<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Details - Bantu Stream Connect</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Color Theme - Same as index.html and pulse-feed.html */
        :root {
            --deep-black: #0A0E12;
            --deep-navy: #0F172A;
            --soft-white: #F8FAFC;
            --slate-grey: #94A3B8;
            --bantu-blue: #1D4ED8;
            --warm-gold: #F59E0B;
            --error-color: #EF4444;
            --success-color: #10B981;
            --glow-cycle-1: #00A3FF;
            --glow-cycle-2: #0066FF;
            --glow-cycle-3: #8B5CF6;
            --glow-cycle-4: #EC4899;
            --card-bg: rgba(15, 23, 42, 0.6);
            --card-border: rgba(148, 163, 184, 0.2);
            --hover-overlay: rgba(255, 255, 255, 0.05);
            --active-overlay: rgba(245, 158, 11, 0.1);
            --indigo: #4F46E5;
            --gold-glow: rgba(245, 158, 11, 0.3);
            --blue-glow: rgba(29, 78, 216, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--deep-black);
            color: var(--soft-white);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--deep-black);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--bantu-blue);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Animated Background - Same as index.html */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            overflow: hidden;
        }
        
        .glow-cycle {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.1;
            animation: float 8s infinite ease-in-out;
        }
        
        .glow-1 {
            width: 400px;
            height: 400px;
            background: var(--glow-cycle-1);
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }
        
        .glow-2 {
            width: 300px;
            height: 300px;
            background: var(--glow-cycle-2);
            top: 60%;
            right: 10%;
            animation-delay: 2s;
        }
        
        .glow-3 {
            width: 350px;
            height: 350px;
            background: var(--glow-cycle-3);
            bottom: 10%;
            left: 20%;
            animation-delay: 4s;
        }
        
        .glow-4 {
            width: 250px;
            height: 250px;
            background: var(--glow-cycle-4);
            top: 20%;
            right: 20%;
            animation-delay: 6s;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.05); }
        }
        
        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
            position: relative;
            z-index: 2;
            padding-bottom: 100px;
        }
        
        /* Header - Same as index.html */
        .header {
            background: rgba(10, 14, 18, 0.9);
            backdrop-filter: blur(20px);
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 32px rgba(29, 78, 216, 0.3);
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo-text {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 18px;
            background: linear-gradient(to right, var(--soft-white), var(--bantu-blue));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 0.5px;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--soft-white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .search-btn {
            color: var(--warm-gold);
        }
        
        .profile-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
            border: 2px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
        
        .profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(29, 78, 216, 0.3);
        }
        
        .profile-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
            color: white;
            font-size: 16px;
        }
        
        /* Content Hero Section */
        .content-hero {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 24px;
            padding: 40px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            align-items: center;
        }
        
        .content-hero::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--bantu-blue), var(--warm-gold));
            border-radius: 26px;
            z-index: -1;
            opacity: 0.1;
        }
        
        @media (max-width: 768px) {
            .content-hero {
                grid-template-columns: 1fr;
                padding: 30px 20px;
            }
        }
        
        .hero-poster {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(245, 158, 11, 0.3);
            height: 300px;
            background: linear-gradient(45deg, #0A1128, #002855);
            position: relative;
        }
        
        .hero-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .poster-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bantu-blue);
            font-size: 4rem;
            background: var(--card-bg);
        }
        
        .hero-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .hero-info h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--soft-white), var(--warm-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .hero-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }
        
        .meta-item i {
            color: var(--bantu-blue);
        }
        
        .hero-description {
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .hero-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .play-btn {
            background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
            color: var(--soft-white);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .play-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(29, 78, 216, 0.4);
        }
        
        .secondary-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--card-border);
            color: var(--soft-white);
        }
        
        .secondary-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--warm-gold);
            transform: translateY(-3px);
        }
        
        /* Creator Info Section */
        .creator-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .creator-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .creator-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            overflow: hidden;
        }
        
        .creator-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .creator-details {
            flex: 1;
        }
        
        .creator-details h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--soft-white);
        }
        
        .creator-details p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .connect-btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
            color: var(--soft-white);
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(29, 78, 216, 0.4);
        }
        
        .connect-btn.connected {
            background: linear-gradient(135deg, var(--success-color), #2b8a3e);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--warm-gold);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: rgba(29, 78, 216, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bantu-blue);
            font-size: 1.5rem;
        }
        
        .stat-content h4 {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .stat-content p {
            font-size: 18px;
            font-weight: 600;
            color: var(--soft-white);
        }
        
        /* Description Section */
        .description-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--soft-white), var(--warm-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .description-content {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .show-more-btn {
            background: transparent;
            color: var(--bantu-blue);
            border: 1px solid var(--bantu-blue);
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .show-more-btn:hover {
            background: rgba(29, 78, 216, 0.1);
        }
        
        /* Comments Section */
        .comments-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .comments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .refresh-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            color: var(--bantu-blue);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--bantu-blue);
        }
        
        .add-comment {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .comment-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            overflow: hidden;
        }
        
        .comment-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .comment-input-container {
            flex: 1;
            display: flex;
            gap: 15px;
        }
        
        .comment-input-container textarea {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 15px;
            color: var(--soft-white);
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
            min-height: 60px;
            outline: none;
        }
        
        .comment-input-container textarea:focus {
            border-color: var(--bantu-blue);
        }
        
        .send-comment-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
            color: var(--soft-white);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .send-comment-btn:hover {
            transform: scale(1.1);
        }
        
        .comments-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .comments-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .comments-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .comments-list::-webkit-scrollbar-thumb {
            background: var(--bantu-blue);
            border-radius: 3px;
        }
        
        .no-comments {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .no-comments i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.3);
        }
        
        .comment-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .comment-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .comment-avatar-sm {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            overflow: hidden;
        }
        
        .comment-avatar-sm img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .comment-user {
            flex: 1;
        }
        
        .comment-user strong {
            font-size: 16px;
            display: block;
            margin-bottom: 3px;
            color: var(--soft-white);
        }
        
        .comment-time {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
        }
        
        .comment-actions {
            display: flex;
            gap: 10px;
        }
        
        .comment-action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--card-border);
            color: var(--soft-white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .comment-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .edit-btn {
            color: var(--bantu-blue);
        }
        
        .delete-btn {
            color: var(--error-color);
        }
        
        .like-btn {
            color: var(--error-color);
        }
        
        .like-btn.liked {
            color: var(--error-color);
        }
        
        .comment-content {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 15px;
            padding: 0 5px;
        }
        
        .comment-footer {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 0 5px;
        }
        
        .like-count {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }
        
        /* Related Content Section */
        .related-section {
            margin-bottom: 40px;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .content-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            backdrop-filter: blur(10px);
        }
        
        .content-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border-color: rgba(245, 158, 11, 0.3);
        }
        
        .card-thumbnail {
            position: relative;
            height: 140px;
            overflow: hidden;
        }
        
        .card-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .content-card:hover .card-thumbnail img {
            transform: scale(1.05);
        }
        
        .thumbnail-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 50%, rgba(0, 0, 0, 0.5) 100%);
        }
        
        .card-content {
            padding: 15px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 40px;
            color: var(--soft-white);
        }
        
        .related-meta {
            display: flex;
            align-items: center;
            gap: 5px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }
        
        .related-meta i {
            color: var(--bantu-blue);
        }
        
        .related-placeholder {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.5);
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }
        
        .related-placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.3);
        }
        
        /* Footer */
        .footer {
            border-top: 1px solid var(--card-border);
            padding: 30px 20px;
            text-align: center;
            color: var(--slate-grey);
            background: rgba(10, 14, 18, 0.9);
            backdrop-filter: blur(10px);
            margin-top: 50px;
        }
        
        /* Toast - Same as index.html */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 12px;
            color: var(--soft-white);
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 300px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
        }
        
        .toast.error {
            background: rgba(239, 68, 68, 0.9);
        }
        
        .toast.success {
            background: rgba(16, 185, 129, 0.9);
        }
        
        .toast.info {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
        }
        
        .toast.warning {
            background: rgba(245, 158, 11, 0.9);
            color: var(--soft-white);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .modal-container {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h3 {
            color: var(--soft-white);
            font-size: 22px;
            margin: 0;
            font-family: 'Orbitron', sans-serif;
        }
        
        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--card-border);
            color: var(--soft-white);
            font-size: 1.2rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            margin-bottom: 25px;
        }
        
        .modal-body textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 15px;
            color: var(--soft-white);
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
            min-height: 120px;
            outline: none;
        }
        
        .modal-body textarea:focus {
            border-color: var(--bantu-blue);
        }
        
        .modal-body p {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .modal-btn {
            padding: 12px 30px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
        }
        
        .cancel-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--card-border);
            color: var(--soft-white);
        }
        
        .cancel-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .save-btn {
            background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
            color: var(--soft-white);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .delete-btn {
            background: linear-gradient(135deg, var(--error-color), #c92a2a);
            color: var(--soft-white);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bantu-blue), var(--warm-gold));
            color: var(--soft-white);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            z-index: 100;
            transition: all 0.3s ease;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .back-to-top:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(29, 78, 216, 0.4);
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--deep-navy);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--bantu-blue);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--warm-gold);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
                max-width: 100%;
            }
            
            .content-hero {
                padding: 30px 20px;
                gap: 20px;
            }
            
            .hero-poster {
                height: 250px;
            }
            
            .hero-info h1 {
                font-size: 24px;
            }
            
            .hero-meta {
                gap: 15px;
            }
            
            .hero-actions {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
            
            .content-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 15px;
            }
            
            .creator-info {
                flex-direction: column;
                text-align: center;
            }
            
            .creator-avatar {
                width: 70px;
                height: 70px;
            }
            
            .connect-btn {
                width: 100%;
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .add-comment {
                flex-direction: column;
            }
            
            .comment-input-container {
                width: 100%;
            }
            
            .modal-container {
                width: 95%;
                padding: 20px;
            }
            
            .modal-footer {
                flex-direction: column;
            }
            
            .modal-btn {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .hero-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .content-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .card-thumbnail {
                height: 120px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading-screen">
        <div class="spinner"></div>
        <div id="loading-text">Loading Content Details...</div>
    </div>

    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="glow-cycle glow-1"></div>
        <div class="glow-cycle glow-2"></div>
        <div class="glow-cycle glow-3"></div>
        <div class="glow-cycle glow-4"></div>
    </div>

    <!-- Main Content (hidden until loaded) -->
    <div id="app" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="logo" onclick="window.location.href='index.html'">
                <div class="logo-icon">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="40" height="40" rx="8" fill="#0F172A"/>
                        <path d="M8 20 L12 16 L16 22 L20 18 L24 24 L28 20 L32 26" stroke="url(#pulse-gradient)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="32" cy="26" r="3" fill="#F59E0B"/>
                        <defs>
                            <linearGradient id="pulse-gradient" x1="8" y1="20" x2="32" y2="26" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#1D4ED8"/>
                                <stop offset="1" stop-color="#F59E0B"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div class="logo-text">BANTU STREAM CONNECT</div>
            </div>
            <div class="header-actions">
                <button id="search-btn" class="icon-btn search-btn" title="Search">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </button>
                <button id="profile-btn" class="profile-btn" title="Profile">
                    <!-- Profile picture will be loaded here -->
                    <div class="profile-placeholder">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container">
            <!-- Content Hero Section -->
            <section class="content-hero" id="contentHero">
                <div class="hero-poster" id="heroPoster">
                    <div class="poster-placeholder" id="posterPlaceholder">
                        <i class="fas fa-play-circle"></i>
                    </div>
                </div>
                <div class="hero-info">
                    <h1 id="contentTitle">Loading...</h1>
                    <div class="hero-meta">
                        <span class="meta-item" id="contentCreator">
                            <i class="fas fa-user"></i>
                            <span id="creatorName">Loading...</span>
                        </span>
                        <span class="meta-item" id="contentViews">
                            <i class="fas fa-eye"></i>
                            <span id="viewsCount">0 views</span>
                        </span>
                        <span class="meta-item" id="contentLikes">
                            <i class="fas fa-heart"></i>
                            <span id="likesCount">0 likes</span>
                        </span>
                        <span class="meta-item" id="contentDuration">
                            <i class="fas fa-clock"></i>
                            <span id="durationText">-</span>
                        </span>
                    </div>
                    <div class="hero-description">
                        <p id="contentDescriptionShort">Loading description...</p>
                    </div>
                    <div class="hero-actions">
                        <button class="action-btn play-btn" id="playBtn">
                            <i class="fas fa-play"></i>
                            <span>Play Now</span>
                        </button>
                        <button class="action-btn secondary-btn" id="favoriteBtn">
                            <i class="far fa-heart"></i>
                            <span>Favorite</span>
                        </button>
                        <button class="action-btn secondary-btn" id="shareBtn">
                            <i class="fas fa-share"></i>
                            <span>Share</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Creator Info Section -->
            <section class="creator-section" id="creatorSection">
                <div class="creator-info">
                    <div class="creator-avatar" id="creatorAvatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="creator-details">
                        <h3 id="creatorDisplayName">Creator Name</h3>
                        <p id="creatorConnectors">0 connectors</p>
                    </div>
                    <button class="connect-btn" id="connectBtn">
                        <i class="fas fa-user-plus"></i>
                        <span>Connect</span>
                    </button>
                </div>
            </section>

            <!-- Stats Grid -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Uploaded</h4>
                        <p id="uploadDate">-</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-film"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Duration</h4>
                        <p id="contentDurationFull">-</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tag"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Genre</h4>
                        <p id="contentGenre">-</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-flag"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Language</h4>
                        <p id="contentLanguage">-</p>
                    </div>
                </div>
            </div>

            <!-- Description Section -->
            <section class="description-section">
                <div class="section-header">
                    <h2 class="section-title">Description</h2>
                </div>
                <div class="description-content">
                    <p id="contentDescriptionFull">Loading full description...</p>
                    <button class="show-more-btn" id="showMoreBtn" style="display: none;">Show more</button>
                </div>
            </section>

            <!-- Comments Section -->
            <section class="comments-section">
                <div class="section-header">
                    <h2 class="section-title">
                        Comments
                        <span id="commentsCount" style="font-size: 1rem; color: rgba(255, 255, 255, 0.6); margin-left: 0.5rem;">(0)</span>
                    </h2>
                    <button class="refresh-btn" id="refreshCommentsBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh</span>
                    </button>
                </div>
                
                <!-- Add Comment Form -->
                <div class="add-comment">
                    <div class="comment-avatar" id="userCommentAvatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="comment-input-container">
                        <textarea 
                            id="commentInput" 
                            placeholder="Add a comment..." 
                            rows="3"
                        ></textarea>
                        <button class="send-comment-btn" id="sendCommentBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>

                <!-- Comments List -->
                <div class="comments-list" id="commentsList">
                    <div class="no-comments" id="noComments">
                        <i class="far fa-comment-alt"></i>
                        <p>No comments yet. Be the first to comment!</p>
                    </div>
                    <!-- Comments will be loaded here -->
                </div>
            </section>

            <!-- Related Content Section -->
            <section class="related-section">
                <div class="section-header">
                    <h2 class="section-title">More Like This</h2>
                </div>
                <div class="content-grid" id="relatedGrid">
                    <div class="related-placeholder">
                        <i class="fas fa-video"></i>
                        <p>Loading related content...</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Bantu Stream Connect © 2025 • Built in South Africa</p>
        </footer>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="editCommentModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Edit Comment</h3>
                <button class="modal-close" id="closeEditModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <textarea 
                    id="editCommentInput" 
                    placeholder="Edit your comment..." 
                    rows="4"
                ></textarea>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel-btn" id="cancelEditBtn">Cancel</button>
                <button class="modal-btn save-btn" id="saveEditBtn">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="deleteCommentModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Delete Comment</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this comment? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel-btn" id="cancelDeleteBtn">Cancel</button>
                <button class="modal-btn delete-btn" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- SIMPLE SUPABASE CLIENT FOR CONTENT QUERIES -->
    <script>
        // Simple Supabase REST client for content queries (not authentication)
        class ContentSupabaseClient {
            constructor(url, key) {
                this.url = url;
                this.key = key;
            }
            
            async query(table, options = {}) {
                const {
                    select = '*',
                    where = {},
                    orderBy = 'created_at',
                    order = 'desc',
                    limit = 100,
                    offset = 0
                } = options;
                
                // Build query URL
                let queryUrl = `${this.url}/rest/v1/${table}?select=${select}`;
                
                // Add filters
                Object.keys(where).forEach(key => {
                    queryUrl += `&${key}=eq.${encodeURIComponent(where[key])}`;
                });
                
                // Add ordering
                if (orderBy) {
                    queryUrl += `&order=${orderBy}.${order}`;
                }
                
                // Add limit and offset
                queryUrl += `&limit=${limit}&offset=${offset}`;
                
                try {
                    const response = await fetch(queryUrl, {
                        headers: {
                            'apikey': this.key,
                            'Authorization': `Bearer ${this.key}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Supabase query error:', error);
                    throw error;
                }
            }
            
            async queryWithFilter(table, column, value, select = '*') {
                try {
                    const response = await fetch(
                        `${this.url}/rest/v1/${table}?${column}=eq.${encodeURIComponent(value)}&select=${select}`,
                        {
                            headers: {
                                'apikey': this.key,
                                'Authorization': `Bearer ${this.key}`,
                                'Content-Type': 'application/json'
                            }
                        }
                    );
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Supabase query error:', error);
                    throw error;
                }
            }
            
            fixMediaUrl(url) {
                if (!url) return '';
                if (url.startsWith('http')) return url;
                return `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${url.replace(/^\/+/, '')}`;
            }
            
            // Check if user is connected to creator
            async checkConnection(connectorId, connectedId) {
                try {
                    const response = await fetch(
                        `${this.url}/rest/v1/connectors?connector_id=eq.${connectorId}&connected_id=eq.${connectedId}`,
                        {
                            headers: {
                                'apikey': this.key,
                                'Authorization': `Bearer ${this.key}`,
                                'Content-Type': 'application/json'
                            }
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return data.length > 0;
                    }
                    return false;
                } catch (error) {
                    console.error('Error checking connection:', error);
                    return false;
                }
            }
            
            // Create connection
            async createConnection(connectorId, connectedId) {
                try {
                    const response = await fetch(`${this.url}/rest/v1/connectors`, {
                        method: 'POST',
                        headers: {
                            'apikey': this.key,
                            'Authorization': `Bearer ${this.key}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=minimal'
                        },
                        body: JSON.stringify({
                            connector_id: connectorId,
                            connected_id: connectedId,
                            connection_type: 'creator'
                        })
                    });
                    
                    return response.ok;
                } catch (error) {
                    console.error('Error creating connection:', error);
                    return false;
                }
            }
            
            // Delete connection
            async deleteConnection(connectorId, connectedId) {
                try {
                    const response = await fetch(
                        `${this.url}/rest/v1/connectors?connector_id=eq.${connectorId}&connected_id=eq.${connectedId}`,
                        {
                            method: 'DELETE',
                            headers: {
                                'apikey': this.key,
                                'Authorization': `Bearer ${this.key}`,
                                'Content-Type': 'application/json'
                            }
                        }
                    );
                    
                    return response.ok;
                } catch (error) {
                    console.error('Error deleting connection:', error);
                    return false;
                }
            }
            
            // Get connector count for creator
            async getConnectorCount(connectedId) {
                try {
                    const response = await fetch(
                        `${this.url}/rest/v1/connectors?select=id&connected_id=eq.${connectedId}`,
                        {
                            headers: {
                                'apikey': this.key,
                                'Authorization': `Bearer ${this.key}`,
                                'Content-Type': 'application/json'
                            }
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return data.length;
                    }
                    return 0;
                } catch (error) {
                    console.error('Error getting connector count:', error);
                    return 0;
                }
            }
        }
        
        // Initialize content Supabase client
        const contentSupabase = new ContentSupabaseClient(
            'https://ydnxqnbjoshvxteevemc.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U'
        );
        
        console.log('✅ Content Supabase client initialized');
    </script>

    <!-- Authentication and Content Detail JavaScript -->
    <script>
        // Supabase Configuration (same as index.html)
        const SUPABASE_URL = 'https://ydnxqnbjoshvxteevemc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbnhxbmJqb3Nodnh0ZWV2ZW1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MzI0OTMsImV4cCI6MjA3MzIwODQ5M30.NlaCCnLPSz1mM7AFeSlfZQ78kYEKUMh_Fi-7P_ccs_U';

        // Initialize Supabase client for authentication
        const supabaseAuth = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        console.log('✅ Supabase Auth client initialized');
        
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('🎬 Content Detail Screen Initializing...');
            
            // DOM Elements - Define them FIRST to avoid ReferenceError
            const loadingScreen = document.getElementById('loading');
            const loadingText = document.getElementById('loading-text');
            const app = document.getElementById('app');
            const profileBtn = document.getElementById('profile-btn');
            
            // Initialize auth and check if user is logged in
            const { data: { session }, error } = await supabaseAuth.auth.getSession();
            const isAuthenticated = !!session;
            
            if (!isAuthenticated) {
                // User is not authenticated, show a toast
                console.log('⚠️ User not authenticated, showing public content');
                showToast('Sign in to connect with creators and comment', 'info');
                
                // Update profile button to redirect to login
                if (profileBtn) {
                    profileBtn.addEventListener('click', () => {
                        const currentUrl = encodeURIComponent(window.location.href);
                        window.location.href = `login.html?redirect=${currentUrl}`;
                    });
                }
            } else {
                // User is authenticated
                console.log('✅ User authenticated:', session.user.email);
                showToast(`Welcome back, ${session.user.email}!`, 'success');
                
                // Load user profile picture
                await loadUserProfilePicture(session.user);
            }
            
            // Global variables
            let contentData = null;
            let comments = [];
            let relatedContent = [];
            let editingCommentId = null;
            let deletingCommentId = null;
            let currentContentId = null;
            let creatorId = null;
            let isConnected = false;
            let isInFavorites = false;
            let isLoading = false;
            
            // Hero Section Elements
            const heroPoster = document.getElementById('heroPoster');
            const posterPlaceholder = document.getElementById('posterPlaceholder');
            const contentTitle = document.getElementById('contentTitle');
            const creatorName = document.getElementById('creatorName');
            const viewsCount = document.getElementById('viewsCount');
            const likesCount = document.getElementById('likesCount');
            const durationText = document.getElementById('durationText');
            const contentDescriptionShort = document.getElementById('contentDescriptionShort');
            
            // Buttons
            const playBtn = document.getElementById('playBtn');
            const favoriteBtn = document.getElementById('favoriteBtn');
            const shareBtn = document.getElementById('shareBtn');
            
            // Creator Info Elements
            const creatorAvatar = document.getElementById('creatorAvatar');
            const creatorDisplayName = document.getElementById('creatorDisplayName');
            const creatorConnectors = document.getElementById('creatorConnectors');
            const connectBtn = document.getElementById('connectBtn');
            
            // Stats Elements
            const uploadDate = document.getElementById('uploadDate');
            const contentDurationFull = document.getElementById('contentDurationFull');
            const contentGenre = document.getElementById('contentGenre');
            const contentLanguage = document.getElementById('contentLanguage');
            
            // Description Elements
            const contentDescriptionFull = document.getElementById('contentDescriptionFull');
            const showMoreBtn = document.getElementById('showMoreBtn');
            
            // Comments Elements
            const refreshCommentsBtn = document.getElementById('refreshCommentsBtn');
            const commentInput = document.getElementById('commentInput');
            const sendCommentBtn = document.getElementById('sendCommentBtn');
            const commentsList = document.getElementById('commentsList');
            const noComments = document.getElementById('noComments');
            const commentsCount = document.getElementById('commentsCount');
            const userCommentAvatar = document.getElementById('userCommentAvatar');
            
            // Related Content
            const relatedGrid = document.getElementById('relatedGrid');
            
            // Modal Elements
            const editCommentModal = document.getElementById('editCommentModal');
            const editCommentInput = document.getElementById('editCommentInput');
            const closeEditModal = document.getElementById('closeEditModal');
            const cancelEditBtn = document.getElementById('cancelEditBtn');
            const saveEditBtn = document.getElementById('saveEditBtn');
            
            const deleteCommentModal = document.getElementById('deleteCommentModal');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            
            // Toast Container
            const toastContainer = document.getElementById('toast-container');
            
            // Back to Top Button
            const backToTopBtn = document.getElementById('backToTop');
            
            // ✅ INITIALIZE
            async function init() {
                try {
                    // Get content ID from URL
                    const urlParams = new URLSearchParams(window.location.search);
                    currentContentId = urlParams.get('id');
                    
                    if (!currentContentId) {
                        showToast('No content ID provided', 'error');
                        setTimeout(() => window.location.href = 'index.html', 2000);
                        return;
                    }
                    
                    console.log('📦 Loading content ID:', currentContentId);
                    
                    // Load content data
                    await loadContentData();
                    
                    // Load related content
                    await loadRelatedContent();
                    
                    // Check connection status if authenticated
                    if (isAuthenticated && session?.user?.id && creatorId) {
                        await checkConnectionStatus(session.user.id, creatorId);
                    }
                    
                    // Load user avatar for comments if authenticated
                    if (isAuthenticated && session?.user) {
                        await loadUserCommentAvatar(session.user);
                    }
                    
                    // Show the app
                    loadingScreen.style.display = 'none';
                    app.style.display = 'block';
                    
                    // Set up event listeners
                    setupEventListeners();
                    
                    // Initialize back to top button
                    initBackToTop();
                    
                    console.log('✅ Content detail initialized successfully');
                    
                } catch (error) {
                    console.error('❌ Initialization error:', error);
                    showToast('Failed to load content. Loading sample data...', 'warning');
                    loadSampleData();
                }
            }
            
            // ✅ LOAD USER PROFILE PICTURE
            async function loadUserProfilePicture(user) {
                try {
                    if (!user || !profileBtn) return;
                    
                    // First, update the profile button with email initials as fallback
                    const userInitials = getInitials(user.email);
                    profileBtn.innerHTML = `
                        <div class="profile-placeholder">
                            ${userInitials}
                        </div>
                    `;
                    
                    // Then try to get user profile from user_profiles table
                    try {
                        // Query the user_profiles table using id (which matches auth.users.id)
                        const { data: profile, error: profileError } = await supabaseAuth
                            .from('user_profiles')
                            .select('*')
                            .eq('id', user.id)
                            .maybeSingle();
                        
                        if (profileError) {
                            console.log('Profile query error:', profileError);
                            return; // Keep using initials
                        }
                        
                        if (profile && profile.avatar_url) {
                            // Fix avatar URL
                            let avatarUrl = profile.avatar_url;
                            if (!avatarUrl.startsWith('http')) {
                                // Try to construct the proper URL
                                if (avatarUrl.startsWith('avatars/')) {
                                    avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${avatarUrl}`;
                                } else {
                                    avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/avatars/${avatarUrl}`;
                                }
                            }
                            
                            // Create img element for profile picture
                            const profileImg = document.createElement('img');
                            profileImg.className = 'profile-img';
                            profileImg.src = avatarUrl;
                            profileImg.alt = 'Profile Picture';
                            profileImg.onerror = function() {
                                // If image fails to load, keep using initials
                                this.parentElement.innerHTML = `
                                    <div class="profile-placeholder">
                                        ${userInitials}
                                    </div>
                                `;
                            };
                            
                            profileImg.onload = function() {
                                // Image loaded successfully
                                console.log('Profile image loaded successfully');
                            };
                            
                            // Clear placeholder and add image
                            profileBtn.innerHTML = '';
                            profileBtn.appendChild(profileImg);
                        } else {
                            // Profile exists but no avatar_url, check full_name for better initials
                            if (profile && profile.full_name) {
                                const nameInitials = getInitialsFromName(profile.full_name);
                                profileBtn.innerHTML = `
                                    <div class="profile-placeholder">
                                        ${nameInitials}
                                    </div>
                                `;
                            }
                        }
                        
                    } catch (error) {
                        console.log('No user profile found or error fetching profile:', error);
                        // Keep using initials if profile fetch fails
                    }
                    
                } catch (error) {
                    console.error('Error loading user profile picture:', error);
                }
            }
            
            // ✅ LOAD USER COMMENT AVATAR
            async function loadUserCommentAvatar(user) {
                try {
                    if (!user || !userCommentAvatar) return;
                    
                    // Try to get user profile from user_profiles table
                    try {
                        const { data: profile, error: profileError } = await supabaseAuth
                            .from('user_profiles')
                            .select('*')
                            .eq('id', user.id)
                            .maybeSingle();
                        
                        if (profileError) {
                            console.log('Profile query error:', profileError);
                            return;
                        }
                        
                        if (profile && profile.avatar_url) {
                            // Fix avatar URL
                            let avatarUrl = profile.avatar_url;
                            if (!avatarUrl.startsWith('http')) {
                                if (avatarUrl.startsWith('avatars/')) {
                                    avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/${avatarUrl}`;
                                } else {
                                    avatarUrl = `https://ydnxqnbjoshvxteevemc.supabase.co/storage/v1/object/public/avatars/${avatarUrl}`;
                                }
                            }
                            
                            // Create img element for avatar
                            const avatarImg = document.createElement('img');
                            avatarImg.src = avatarUrl;
                            avatarImg.alt = 'Profile Picture';
                            avatarImg.onerror = function() {
                                // If image fails to load, keep using icon
                                this.parentElement.innerHTML = '<i class="fas fa-user-circle"></i>';
                            };
                            
                            // Clear icon and add image
                            userCommentAvatar.innerHTML = '';
                            userCommentAvatar.appendChild(avatarImg);
                        }
                        
                    } catch (error) {
                        console.log('No user profile found for comment avatar:', error);
                    }
                    
                } catch (error) {
                    console.error('Error loading user comment avatar:', error);
                }
            }
            
            // Helper function to get initials from email
            function getInitials(email) {
                if (!email) return 'U';
                const parts = email.split('@')[0];
                if (parts.length >= 2) {
                    return parts.substring(0, 2).toUpperCase();
                }
                return email.charAt(0).toUpperCase();
            }
            
            // Helper function to get initials from full name
            function getInitialsFromName(fullName) {
                if (!fullName) return 'U';
                const names = fullName.split(' ');
                if (names.length >= 2) {
                    return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();
                }
                return fullName.charAt(0).toUpperCase();
            }
            
            // ✅ LOAD CONTENT DATA
            async function loadContentData() {
                try {
                    loadingText.textContent = 'Loading content details...';
                    
                    // Try different table names
                    let contentDataArray = [];
                    
                    try {
                        // Try 'Content' table first
                        contentDataArray = await contentSupabase.queryWithFilter('Content', 'id', currentContentId, '*,user_profiles!user_id(*)');
                    } catch (error) {
                        console.log('⚠️ Content table failed, trying content table...');
                        try {
                            // Try lowercase 'content' table
                            contentDataArray = await contentSupabase.queryWithFilter('content', 'id', currentContentId);
                        } catch (error2) {
                            console.log('⚠️ Both table queries failed');
                            throw new Error('Content not found');
                        }
                    }
                    
                    if (!contentDataArray || contentDataArray.length === 0) {
                        throw new Error('Content not found');
                    }
                    
                    contentData = contentDataArray[0];
                    console.log('✅ Content loaded:', contentData.title);
                    
                    // Get creator ID
                    creatorId = contentData.creator_id || contentData.user_id;
                    
                    // Get connector count for creator
                    if (creatorId) {
                        const connectorCount = await contentSupabase.getConnectorCount(creatorId);
                        creatorConnectors.textContent = `${connectorCount} connectors`;
                    }
                    
                    // Update UI with content data
                    updateContentUI();
                    
                } catch (error) {
                    console.error('❌ Error loading content:', error);
                    showToast('Content not found', 'error');
                    throw error;
                }
            }
            
            // ✅ CHECK CONNECTION STATUS
            async function checkConnectionStatus(userId, creatorId) {
                try {
                    isConnected = await contentSupabase.checkConnection(userId, creatorId);
                    
                    // Update connect button
                    if (isConnected) {
                        connectBtn.innerHTML = '<i class="fas fa-user-check"></i><span>Connected</span>';
                        connectBtn.classList.add('connected');
                    } else {
                        connectBtn.innerHTML = '<i class="fas fa-user-plus"></i><span>Connect</span>';
                        connectBtn.classList.remove('connected');
                    }
                    
                } catch (error) {
                    console.error('Error checking connection status:', error);
                }
            }
            
            // ✅ UPDATE CONTENT UI
            function updateContentUI() {
                if (!contentData) return;
                
                // Update hero section
                contentTitle.textContent = contentData.title || 'Untitled';
                
                const creator = contentData.creator || 
                               contentData.creator_display_name || 
                               contentData.user_profiles?.full_name ||
                               contentData.user_profiles?.username || 
                               'Unknown Creator';
                creatorName.textContent = creator;
                creatorDisplayName.textContent = creator;
                
                // Set poster image
                if (contentData.thumbnail_url) {
                    const thumbnailUrl = contentSupabase.fixMediaUrl(contentData.thumbnail_url);
                    posterPlaceholder.innerHTML = `<img src="${thumbnailUrl}" alt="${contentData.title}" style="width: 100%; height: 100%; object-fit: cover;">`;
                }
                
                // Set creator avatar
                if (contentData.user_profiles && contentData.user_profiles.avatar_url) {
                    const avatarUrl = contentSupabase.fixMediaUrl(contentData.user_profiles.avatar_url);
                    creatorAvatar.innerHTML = `<img src="${avatarUrl}" alt="${creator}" style="width: 100%; height: 100%; object-fit: cover;">`;
                }
                
                // Update stats
                uploadDate.textContent = formatDate(contentData.created_at);
                
                if (contentData.duration) {
                    const durationFormatted = formatDuration(contentData.duration);
                    contentDurationFull.textContent = durationFormatted;
                    durationText.textContent = durationFormatted;
                }
                
                contentGenre.textContent = contentData.genre || 'Not specified';
                contentLanguage.textContent = contentData.language || 'Unknown';
                
                // Update views and likes
                viewsCount.textContent = `${contentData.views || contentData.views_count || 0} views`;
                likesCount.textContent = `${contentData.likes || contentData.likes_count || 0} likes`;
                
                // Update description
                const description = contentData.description || 'No description available.';
                const shortDescription = description.length > 150 ? description.substring(0, 150) + '...' : description;
                contentDescriptionShort.textContent = shortDescription;
                contentDescriptionFull.textContent = description;
                
                // Show more/less button for long descriptions
                if (description.length > 300) {
                    showMoreBtn.style.display = 'block';
                    contentDescriptionFull.textContent = description.substring(0, 300) + '...';
                    showMoreBtn.textContent = 'Show more';
                }
            }
            
            // ✅ LOAD RELATED CONTENT
            async function loadRelatedContent() {
                try {
                    let similarContent = [];
                    
                    try {
                        similarContent = await contentSupabase.query('Content', {
                            select: '*',
                            where: { status: 'published' },
                            limit: 8
                        });
                    } catch (error) {
                        console.log('⚠️ Content table failed, trying content table...');
                        similarContent = await contentSupabase.query('content', {
                            select: '*',
                            where: { status: 'published' },
                            limit: 8
                        });
                    }
                    
                    // Filter out current content and limit to 8
                    relatedContent = similarContent
                        .filter(content => content.id !== currentContentId)
                        .slice(0, 8);
                    
                    renderRelatedContent();
                    
                } catch (error) {
                    console.error('❌ Error loading related content:', error);
                    relatedGrid.innerHTML = `
                        <div class="related-placeholder">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>Failed to load related content</p>
                        </div>
                    `;
                }
            }
            
            // ✅ RENDER RELATED CONTENT
            function renderRelatedContent() {
                if (!relatedContent.length) {
                    relatedGrid.innerHTML = `
                        <div class="related-placeholder">
                            <i class="fas fa-video-slash"></i>
                            <p>No related content found</p>
                        </div>
                    `;
                    return;
                }
                
                relatedGrid.innerHTML = '';
                relatedContent.forEach(content => {
                    const card = document.createElement('a');
                    card.className = 'content-card';
                    card.href = `content-detail.html?id=${content.id}`;
                    card.dataset.contentId = content.id;
                    card.innerHTML = `
                        <div class="card-thumbnail">
                            <img src="${content.thumbnail_url ? contentSupabase.fixMediaUrl(content.thumbnail_url) : 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=400&h=225&fit=crop'}" 
                                 alt="${content.title}"
                                 onerror="this.src='https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=400&h=225&fit=crop'">
                            <div class="thumbnail-overlay"></div>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title" title="${content.title}">
                                ${content.title.length > 50 ? content.title.substring(0, 50) + '...' : content.title}
                            </h3>
                            <div class="related-meta">
                                <i class="fas fa-eye"></i>
                                <span>${content.views || content.views_count || 0} views</span>
                            </div>
                        </div>
                    `;
                    
                    relatedGrid.appendChild(card);
                });
            }
            
            // ✅ LOAD SAMPLE DATA (fallback)
            function loadSampleData() {
                // Sample content data
                contentData = {
                    id: currentContentId || '1',
                    title: 'African Music Festival Highlights',
                    description: 'Highlights from the biggest African music festival featuring top artists from across the continent. Experience the vibrant culture, amazing performances, and unforgettable moments. This festival brings together the best of African music in a celebration of culture and talent.',
                    thumbnail_url: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=800&h=450&fit=crop',
                    file_url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                    media_type: 'video',
                    genre: 'Music',
                    created_at: new Date().toISOString(),
                    creator: 'Music Africa',
                    creator_display_name: 'Music Africa',
                    duration: 3600,
                    language: 'English',
                    views: 12500,
                    likes: 890,
                    creator_id: 'creator123'
                };
                
                creatorId = 'creator123';
                
                // Update UI
                updateContentUI();
                
                // Update connector count
                creatorConnectors.textContent = '245 connectors';
                
                // Load sample related content
                relatedContent = [
                    {
                        id: '2',
                        title: 'Tech Innovation in Africa',
                        thumbnail_url: 'https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=400&h=225&fit=crop',
                        views: 8900,
                        views_count: 8900
                    },
                    {
                        id: '3',
                        title: 'Traditional Dance Performance',
                        thumbnail_url: 'https://images.unsplash.com/photo-1547153760-18fc86324498?w=400&h=225&fit=crop',
                        views: 15600,
                        views_count: 15600
                    },
                    {
                        id: '4',
                        title: 'African Cuisine Cooking Show',
                        thumbnail_url: 'https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400&h=225&fit=crop',
                        views: 7800,
                        views_count: 7800
                    },
                    {
                        id: '5',
                        title: 'Startup Success Stories',
                        thumbnail_url: 'https://images.unsplash.com/photo-1556761175-b413da4baf72?w=400&h=225&fit=crop',
                        views: 11200,
                        views_count: 11200
                    },
                    {
                        id: '6',
                        title: 'African Wildlife Documentary',
                        thumbnail_url: 'https://images.unsplash.com/photo-1575550959106-5a7defe08b56?w=400&h=225&fit=crop',
                        views: 9400,
                        views_count: 9400
                    },
                    {
                        id: '7',
                        title: 'African Fashion Week',
                        thumbnail_url: 'https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=400&h=225&fit=crop',
                        views: 6700,
                        views_count: 6700
                    }
                ];
                
                renderRelatedContent();
                
                // Show the app
                loadingScreen.style.display = 'none';
                app.style.display = 'block';
                
                // Set up event listeners
                setupEventListeners();
                
                // Initialize back to top button
                initBackToTop();
                
                showToast('Using sample data. Supabase connection may be unavailable.', 'info');
            }
            
            // ✅ SETUP EVENT LISTENERS
            function setupEventListeners() {
                // Play button
                playBtn.addEventListener('click', handlePlayPressed);
                
                // Favorite button
                favoriteBtn.addEventListener('click', toggleFavorite);
                
                // Share button
                shareBtn.addEventListener('click', shareContent);
                
                // Connect button
                connectBtn.addEventListener('click', toggleConnection);
                
                // Refresh comments button
                refreshCommentsBtn.addEventListener('click', () => {
                    showToast('Comments refreshed', 'success');
                });
                
                // Send comment button
                sendCommentBtn.addEventListener('click', addComment);
                
                // Comment input enter key
                commentInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        addComment();
                    }
                });
                
                // Show more button
                showMoreBtn.addEventListener('click', toggleDescription);
                
                // Edit comment modal
                closeEditModal.addEventListener('click', () => editCommentModal.style.display = 'none');
                cancelEditBtn.addEventListener('click', () => editCommentModal.style.display = 'none');
                saveEditBtn.addEventListener('click', saveEditedComment);
                
                // Delete comment modal
                cancelDeleteBtn.addEventListener('click', () => deleteCommentModal.style.display = 'none');
                confirmDeleteBtn.addEventListener('click', deleteComment);
                
                // Close modals when clicking outside
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.style.display = 'none';
                        }
                    });
                });
                
                // Header buttons
                document.getElementById('search-btn').addEventListener('click', () => {
                    window.location.href = 'content-library.html';
                });
                
                // Profile button behavior depends on authentication
                if (profileBtn) {
                    // Remove any existing click listeners and add new one
                    profileBtn.addEventListener('click', async () => {
                        const { data: { session } } = await supabaseAuth.auth.getSession();
                        if (session) {
                            window.location.href = 'profile.html';
                        } else {
                            const currentUrl = encodeURIComponent(window.location.href);
                            window.location.href = `login.html?redirect=${currentUrl}`;
                        }
                    });
                }
                
                // Logo click
                document.querySelector('.logo').addEventListener('click', () => {
                    window.location.href = 'index.html';
                });
            }
            
            // ✅ HANDLE PLAY PRESSED
            function handlePlayPressed() {
                if (!contentData) return;
                
                showToast(`Playing "${contentData.title}"`, 'success');
                
                // In a real app, navigate to video player
                console.log('Playing:', contentData.title);
            }
            
            // ✅ TOGGLE FAVORITE
            function toggleFavorite() {
                isInFavorites = !isInFavorites;
                
                if (isInFavorites) {
                    favoriteBtn.querySelector('i').className = 'fas fa-heart';
                    favoriteBtn.querySelector('span').textContent = 'Favorited';
                    showToast('Added to favorites', 'success');
                } else {
                    favoriteBtn.querySelector('i').className = 'far fa-heart';
                    favoriteBtn.querySelector('span').textContent = 'Favorite';
                    showToast('Removed from favorites', 'info');
                }
            }
            
            // ✅ SHARE CONTENT
            function shareContent() {
                if (!contentData) return;
                
                const shareData = {
                    title: contentData.title,
                    text: `Check out "${contentData.title}" on Bantu Stream Connect`,
                    url: window.location.href
                };
                
                if (navigator.share) {
                    navigator.share(shareData)
                        .then(() => showToast('Shared successfully!', 'success'))
                        .catch(err => {
                            if (err.name !== 'AbortError') {
                                copyToClipboard(window.location.href);
                            }
                        });
                } else {
                    copyToClipboard(window.location.href);
                }
            }
            
            // ✅ TOGGLE CONNECTION
            async function toggleConnection() {
                const { data: { session } } = await supabaseAuth.auth.getSession();
                
                if (!session) {
                    showToast('Please sign in to connect with creators', 'warning');
                    const currentUrl = encodeURIComponent(window.location.href);
                    window.location.href = `login.html?redirect=${currentUrl}`;
                    return;
                }
                
                if (!creatorId) {
                    showToast('Creator information not available', 'error');
                    return;
                }
                
                try {
                    if (isConnected) {
                        // Delete connection
                        const success = await contentSupabase.deleteConnection(session.user.id, creatorId);
                        if (success) {
                            isConnected = false;
                            connectBtn.innerHTML = '<i class="fas fa-user-plus"></i><span>Connect</span>';
                            connectBtn.classList.remove('connected');
                            showToast('Disconnected from creator', 'success');
                            
                            // Update connector count
                            const connectorCount = await contentSupabase.getConnectorCount(creatorId);
                            creatorConnectors.textContent = `${connectorCount} connectors`;
                        } else {
                            showToast('Failed to disconnect', 'error');
                        }
                    } else {
                        // Create connection
                        const success = await contentSupabase.createConnection(session.user.id, creatorId);
                        if (success) {
                            isConnected = true;
                            connectBtn.innerHTML = '<i class="fas fa-user-check"></i><span>Connected</span>';
                            connectBtn.classList.add('connected');
                            showToast('Connected with creator!', 'success');
                            
                            // Update connector count
                            const connectorCount = await contentSupabase.getConnectorCount(creatorId);
                            creatorConnectors.textContent = `${connectorCount} connectors`;
                        } else {
                            showToast('Failed to connect', 'error');
                        }
                    }
                } catch (error) {
                    console.error('Error toggling connection:', error);
                    showToast('Error processing connection', 'error');
                }
            }
            
            // ✅ ADD COMMENT
            async function addComment() {
                const { data: { session } } = await supabaseAuth.auth.getSession();
                
                if (!session) {
                    showToast('Please sign in to comment', 'warning');
                    const currentUrl = encodeURIComponent(window.location.href);
                    window.location.href = `login.html?redirect=${currentUrl}`;
                    return;
                }
                
                const commentText = commentInput.value.trim();
                if (!commentText) {
                    showToast('Please enter a comment', 'warning');
                    return;
                }
                
                // Get user profile for comment
                let userName = 'You';
                let userAvatar = null;
                
                try {
                    const { data: profile, error } = await supabaseAuth
                        .from('user_profiles')
                        .select('full_name, username, avatar_url')
                        .eq('id', session.user.id)
                        .maybeSingle();
                    
                    if (!error && profile) {
                        userName = profile.full_name || profile.username || 'You';
                        userAvatar = profile.avatar_url;
                    }
                } catch (error) {
                    console.log('Error getting user profile for comment:', error);
                }
                
                // Create a sample comment
                const newComment = {
                    id: Date.now().toString(),
                    comment_text: commentText,
                    author_name: userName,
                    author_avatar: userAvatar,
                    created_at: new Date().toISOString(),
                    like_count: 0
                };
                
                // Add to comments list
                comments.unshift(newComment);
                
                // Clear input
                commentInput.value = '';
                
                // Update UI
                renderComments();
                showToast('Comment added successfully!', 'success');
            }
            
            // ✅ RENDER COMMENTS
            function renderComments() {
                if (!comments.length) {
                    noComments.style.display = 'block';
                    commentsCount.textContent = '(0)';
                    return;
                }
                
                noComments.style.display = 'none';
                commentsCount.textContent = `(${comments.length})`;
                
                // Clear existing comments except no-comments placeholder
                const existingComments = commentsList.querySelectorAll('.comment-item');
                existingComments.forEach(comment => comment.remove());
                
                comments.forEach(comment => {
                    const commentEl = document.createElement('div');
                    commentEl.className = 'comment-item';
                    commentEl.dataset.commentId = comment.id;
                    
                    const userName = comment.author_name || 'User';
                    const createdAt = comment.created_at ? formatCommentTime(comment.created_at) : 'Recently';
                    
                    // Create avatar HTML
                    let avatarHtml = '<i class="fas fa-user-circle"></i>';
                    if (comment.author_avatar) {
                        const avatarUrl = contentSupabase.fixMediaUrl(comment.author_avatar);
                        avatarHtml = `<img src="${avatarUrl}" alt="${userName}" style="width: 100%; height: 100%; object-fit: cover;">`;
                    }
                    
                    commentEl.innerHTML = `
                        <div class="comment-header">
                            <div class="comment-avatar-sm">
                                ${avatarHtml}
                            </div>
                            <div class="comment-user">
                                <strong>${userName}</strong>
                                <div class="comment-time">${createdAt}</div>
                            </div>
                            <div class="comment-actions">
                                <button class="comment-action-btn edit-btn" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="comment-action-btn delete-btn" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="comment-action-btn like-btn" title="Like">
                                    <i class="far fa-heart"></i>
                                </button>
                            </div>
                        </div>
                        <div class="comment-content">
                            ${comment.comment_text || comment.comment || ''}
                        </div>
                        <div class="comment-footer">
                            <div class="like-count">
                                <i class="fas fa-heart"></i>
                                <span>${comment.like_count || 0} likes</span>
                            </div>
                        </div>
                    `;
                    
                    // Add event listeners
                    const editBtn = commentEl.querySelector('.edit-btn');
                    const deleteBtn = commentEl.querySelector('.delete-btn');
                    const likeBtn = commentEl.querySelector('.like-btn');
                    
                    editBtn.addEventListener('click', () => editComment(comment.id, comment.comment_text || comment.comment));
                    deleteBtn.addEventListener('click', () => confirmDeleteComment(comment.id));
                    likeBtn.addEventListener('click', () => toggleCommentLike(comment.id, likeBtn));
                    
                    commentsList.appendChild(commentEl);
                });
            }
            
            // ✅ EDIT COMMENT
            function editComment(commentId, currentText) {
                editingCommentId = commentId;
                editCommentInput.value = currentText;
                editCommentModal.style.display = 'flex';
            }
            
            // ✅ SAVE EDITED COMMENT
            function saveEditedComment() {
                if (!editingCommentId || !editCommentInput.value.trim()) {
                    editCommentModal.style.display = 'none';
                    return;
                }
                
                // Find and update comment
                const commentIndex = comments.findIndex(c => c.id === editingCommentId);
                if (commentIndex !== -1) {
                    comments[commentIndex].comment_text = editCommentInput.value.trim();
                }
                
                editCommentModal.style.display = 'none';
                editCommentInput.value = '';
                editingCommentId = null;
                
                renderComments();
                showToast('Comment updated successfully!', 'success');
            }
            
            // ✅ CONFIRM DELETE COMMENT
            function confirmDeleteComment(commentId) {
                deletingCommentId = commentId;
                deleteCommentModal.style.display = 'flex';
            }
            
            // ✅ DELETE COMMENT
            function deleteComment() {
                if (!deletingCommentId) {
                    deleteCommentModal.style.display = 'none';
                    return;
                }
                
                // Remove comment
                comments = comments.filter(c => c.id !== deletingCommentId);
                
                deleteCommentModal.style.display = 'none';
                deletingCommentId = null;
                
                renderComments();
                showToast('Comment deleted successfully!', 'success');
            }
            
            // ✅ TOGGLE COMMENT LIKE
            function toggleCommentLike(commentId, likeBtn) {
                const comment = comments.find(c => c.id === commentId);
                if (!comment) return;
                
                comment.like_count = (comment.like_count || 0) + 1;
                likeBtn.querySelector('i').className = 'fas fa-heart';
                likeBtn.classList.add('liked');
                
                renderComments();
                showToast('Liked comment!', 'success');
            }
            
            // ✅ TOGGLE DESCRIPTION
            function toggleDescription() {
                const fullDescription = contentData.description;
                const currentText = contentDescriptionFull.textContent;
                
                if (currentText.includes('...')) {
                    // Show full description
                    contentDescriptionFull.textContent = fullDescription;
                    showMoreBtn.textContent = 'Show less';
                } else {
                    // Show truncated description
                    contentDescriptionFull.textContent = fullDescription.substring(0, 300) + '...';
                    showMoreBtn.textContent = 'Show more';
                }
            }
            
            // ✅ INIT BACK TO TOP BUTTON
            function initBackToTop() {
                window.addEventListener('scroll', () => {
                    if (window.pageYOffset > 300) {
                        backToTopBtn.style.display = 'flex';
                    } else {
                        backToTopBtn.style.display = 'none';
                    }
                });
                
                backToTopBtn.addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }
            
            // ✅ UTILITY FUNCTIONS
            
            function formatDate(dateString) {
                if (!dateString) return '-';
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            }
            
            function formatDuration(seconds) {
                if (!seconds) return '-';
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const remainingSeconds = seconds % 60;
                
                if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                } else if (minutes > 0) {
                    return `${minutes}m ${remainingSeconds}s`;
                } else {
                    return `${remainingSeconds}s`;
                }
            }
            
            function formatCommentTime(dateString) {
                if (!dateString) return 'Recently';
                
                try {
                    const date = new Date(dateString);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffSec = Math.floor(diffMs / 1000);
                    const diffMin = Math.floor(diffSec / 60);
                    const diffHour = Math.floor(diffMin / 60);
                    const diffDay = Math.floor(diffHour / 24);
                    
                    if (diffDay > 0) return `${diffDay}d ago`;
                    if (diffHour > 0) return `${diffHour}h ago`;
                    if (diffMin > 0) return `${diffMin}m ago`;
                    return 'Just now';
                } catch (e) {
                    return 'Recently';
                }
            }
            
            function showToast(message, type = 'info') {
                // Remove existing toast
                const existingToast = document.querySelector('.toast');
                if (existingToast) existingToast.remove();
                
                // Create new toast
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                let icon = 'info-circle';
                if (type === 'success') icon = 'check-circle';
                if (type === 'error') icon = 'exclamation-circle';
                if (type === 'warning') icon = 'exclamation-triangle';
                
                toast.innerHTML = `
                    <i class="fas fa-${icon}"></i>
                    <span>${message}</span>
                `;
                
                if (!toastContainer) {
                    // Create toast container if it doesn't exist
                    const newContainer = document.createElement('div');
                    newContainer.id = 'toast-container';
                    document.body.appendChild(newContainer);
                    newContainer.appendChild(toast);
                } else {
                    toastContainer.appendChild(toast);
                }
                
                // Remove toast after 3 seconds
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.style.opacity = '0';
                        setTimeout(() => {
                            if (toast.parentNode) toast.remove();
                        }, 300);
                    }
                }, 3000);
            }
            
            function copyToClipboard(text) {
                navigator.clipboard.writeText(text)
                    .then(() => showToast('Link copied to clipboard!', 'success'))
                    .catch(err => {
                        console.error('Failed to copy:', err);
                        showToast('Failed to copy link', 'error');
                    });
            }
            
            // ✅ START INITIALIZATION
            setTimeout(() => {
                init();
            }, 500);
            
            console.log('✅ Content detail script loaded');
            
            // Listen for auth state changes
            supabaseAuth.auth.onAuthStateChange((event, session) => {
                console.log('Auth state changed:', event);
                
                if (event === 'SIGNED_IN') {
                    console.log('User signed in');
                    // Reload profile picture
                    if (session?.user) {
                        loadUserProfilePicture(session.user);
                        loadUserCommentAvatar(session.user);
                        
                        // Check connection status
                        if (creatorId) {
                            checkConnectionStatus(session.user.id, creatorId);
                        }
                    }
                } else if (event === 'SIGNED_OUT') {
                    console.log('User signed out');
                    // Reset profile button to placeholder
                    if (profileBtn) {
                        profileBtn.innerHTML = `
                            <div class="profile-placeholder">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                            </div>
                        `;
                    }
                    
                    // Reset user comment avatar
                    if (userCommentAvatar) {
                        userCommentAvatar.innerHTML = '<i class="fas fa-user-circle"></i>';
                    }
                    
                    // Reset connection status
                    isConnected = false;
                    connectBtn.innerHTML = '<i class="fas fa-user-plus"></i><span>Connect</span>';
                    connectBtn.classList.remove('connected');
                }
            });
        });
    </script>
</body>
</html>
