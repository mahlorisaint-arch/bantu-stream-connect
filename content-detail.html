<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Details - Bantu Stream Connect</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="css/base.css" as="style">
    <link rel="preload" href="css/components.css" as="style">
    
    <!-- Google Fonts (preconnect) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/content-detail.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Non-blocking Google Fonts -->
    <style>
        /* Critical font declarations */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap');
    </style>
    
    <!-- Preload key scripts -->
    <link rel="preload" href="js/security.js" as="script">
    <link rel="preload" href="js/error-handler.js" as="script">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading-screen">
        <div class="spinner"></div>
        <div id="loading-text">Loading Content Details...</div>
    </div>

    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="glow-cycle glow-1"></div>
        <div class="glow-cycle glow-2"></div>
        <div class="glow-cycle glow-3"></div>
        <div class="glow-cycle glow-4"></div>
    </div>

    <!-- Main Content (hidden until loaded) -->
    <div id="app" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="logo" onclick="window.location.href='index.html'">
                <div class="logo-icon">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="40" height="40" rx="8" fill="#0F172A"/>
                        <path d="M8 20 L12 16 L16 22 L20 18 L24 24 L28 20 L32 26" stroke="url(#pulse-gradient)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="32" cy="26" r="3" fill="#F59E0B"/>
                        <defs>
                            <linearGradient id="pulse-gradient" x1="8" y1="20" x2="32" y2="26" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#1D4ED8"/>
                                <stop offset="1" stop-color="#F59E0B"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div class="logo-text">BANTU STREAM CONNECT</div>
            </div>
            <div class="header-actions">
                <button id="search-btn" class="icon-btn search-btn" title="Search">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </button>
                <button id="profile-btn" class="profile-btn" title="Profile">
                    <div class="profile-placeholder">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container">
            <!-- Content Hero Section -->
            <section class="content-hero" id="contentHero">
                <div class="hero-poster" id="heroPoster">
                    <div class="poster-placeholder" id="posterPlaceholder">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <div class="play-overlay">
                        <div class="play-icon-large">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                </div>
                <div class="hero-info">
                    <h1 id="contentTitle">Loading...</h1>
                    <div class="hero-meta">
                        <span class="meta-item" id="contentCreator">
                            <i class="fas fa-user"></i>
                            <span id="creatorName">Loading...</span>
                        </span>
                        <span class="meta-item" id="contentViews">
                            <i class="fas fa-eye"></i>
                            <span id="viewsCount">0 views</span>
                        </span>
                        <span class="meta-item" id="contentLikes">
                            <i class="fas fa-heart"></i>
                            <span id="likesCount">0 likes</span>
                        </span>
                        <span class="meta-item" id="contentDuration">
                            <i class="fas fa-clock"></i>
                            <span id="durationText">-</span>
                        </span>
                    </div>
                    <div class="hero-description">
                        <p id="contentDescriptionShort">Loading description...</p>
                    </div>
                    <div class="hero-actions">
                        <button class="btn btn-primary" id="playBtn">
                            <i class="fas fa-play"></i>
                            <span>Play Now</span>
                        </button>
                        <button class="btn btn-secondary" id="favoriteBtn">
                            <i class="far fa-heart"></i>
                            <span>Favorite</span>
                        </button>
                        <button class="btn btn-secondary" id="shareBtn">
                            <i class="fas fa-share"></i>
                            <span>Share</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Inline Video Player -->
            <div class="inline-player" id="inlinePlayer">
                <div class="player-header">
                    <h3 id="playerTitle">Now Playing</h3>
                    <button class="icon-btn close-player" id="closePlayerBtn" title="Close Player">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="video-container">
                    <video id="inlineVideoPlayer" controls playsinline>
                        Your browser does not support the video tag.
                    </video>
                </div>
                <div class="player-actions">
                    <div class="player-controls">
                        <button class="control-btn" id="pictureInPictureBtn" title="Picture-in-Picture">
                            <i class="fas fa-clone"></i>
                        </button>
                        <button class="control-btn" id="playbackSpeedBtn" title="Playback Speed">
                            <i class="fas fa-tachometer-alt"></i>
                        </button>
                    </div>
                    <button class="btn btn-primary fullscreen-btn" id="fullPlayerBtn">
                        <i class="fas fa-expand"></i>
                        <span>Open Full Player</span>
                    </button>
                </div>
            </div>

            <!-- Creator Info Section -->
            <section class="creator-section" id="creatorSection">
                <div class="creator-info">
                    <div class="creator-avatar" id="creatorAvatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="creator-details">
                        <h3 id="creatorDisplayName">Creator Name</h3>
                        <p id="creatorConnectors">0 connectors</p>
                    </div>
                    <button class="btn btn-primary connect-btn" id="connectBtn">
                        <i class="fas fa-user-plus"></i>
                        <span>Connect</span>
                    </button>
                </div>
            </section>

            <!-- Stats Grid -->
            <div class="stats-grid" id="statsGrid">
                <div class="card stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Uploaded</h4>
                        <p id="uploadDate">-</p>
                    </div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-film"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Duration</h4>
                        <p id="contentDurationFull">-</p>
                    </div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tag"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Genre</h4>
                        <p id="contentGenre">-</p>
                    </div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-flag"></i>
                    </div>
                    <div class="stat-content">
                        <h4>Language</h4>
                        <p id="contentLanguage">-</p>
                    </div>
                </div>
            </div>

            <!-- Description Section -->
            <section class="description-section card">
                <div class="section-header">
                    <h2 class="section-title">Description</h2>
                </div>
                <div class="description-content">
                    <p id="contentDescriptionFull">Loading full description...</p>
                    <button class="btn btn-secondary show-more-btn" id="showMoreBtn" style="display: none;">Show more</button>
                </div>
            </section>

            <!-- Comments Section -->
            <section class="comments-section card">
                <div class="section-header">
                    <h2 class="section-title">
                        Comments
                        <span id="commentsCount" style="font-size: 1rem; color: rgba(255, 255, 255, 0.6); margin-left: 0.5rem;">(0)</span>
                    </h2>
                    <button class="btn btn-secondary refresh-btn" id="refreshCommentsBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh</span>
                    </button>
                </div>
                
                <!-- Add Comment Form -->
                <div class="add-comment">
                    <div class="comment-avatar" id="userCommentAvatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="comment-input-container">
                        <textarea 
                            id="commentInput" 
                            placeholder="Add a comment..." 
                            rows="3"
                        ></textarea>
                        <button class="btn btn-primary send-comment-btn" id="sendCommentBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>

                <!-- Comments List -->
                <div class="comments-list" id="commentsList">
                    <div class="no-comments" id="noComments">
                        <i class="far fa-comment-alt"></i>
                        <p>No comments yet. Be the first to comment!</p>
                    </div>
                </div>
            </section>

            <!-- Related Content Section -->
            <section class="related-section">
                <div class="section-header">
                    <h2 class="section-title">More Like This</h2>
                </div>
                <div class="content-grid" id="relatedGrid">
                    <div class="related-placeholder card">
                        <i class="fas fa-video"></i>
                        <p>Loading related content...</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Bantu Stream Connect © 2025 • Built in South Africa</p>
        </footer>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTopBtn" title="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Fix script loading order -->
    <script src="js/security.js"></script>
    <script>
        // Wait for security to load, then load others
        if (typeof security !== 'undefined') {
            console.log('Security loaded successfully');
            // Load error handler
            var errorScript = document.createElement('script');
            errorScript.src = 'js/error-handler.js';
            errorScript.onload = function() {
                console.log('Error handler loaded');
                // Load analytics
                var analyticsScript = document.createElement('script');
                analyticsScript.src = 'js/analytics.js';
                analyticsScript.onload = function() {
                    console.log('Analytics loaded');
                    // Load main script
                    var mainScript = document.createElement('script');
                    mainScript.src = 'js/content-detail.js';
                    mainScript.defer = true;
                    document.head.appendChild(mainScript);
                };
                document.head.appendChild(analyticsScript);
            };
            document.head.appendChild(errorScript);
        } else {
            console.error('Security.js failed to load');
            // Fallback: load all scripts sequentially
            var scripts = ['js/error-handler.js', 'js/analytics.js', 'js/content-detail.js'];
            function loadScripts(index) {
                if (index >= scripts.length) return;
                var script = document.createElement('script');
                script.src = scripts[index];
                script.onload = function() {
                    console.log(scripts[index] + ' loaded');
                    loadScripts(index + 1);
                };
                script.onerror = function() {
                    console.error('Failed to load: ' + scripts[index]);
                    loadScripts(index + 1);
                };
                document.head.appendChild(script);
            }
            loadScripts(0);
        }
    </script>

    <!-- After all scripts -->
    <script>
        // Debug: Temporarily bypass error handler
        window.onerror = null;
        console.log('Debug mode enabled - Page fully loaded');
        
        // Add a fallback in case everything else fails
        setTimeout(function() {
            var loadingScreen = document.getElementById('loading');
            var app = document.getElementById('app');
            
            if (loadingScreen && app && app.style.display === 'none') {
                console.log('Fallback: Forcing app to show after timeout');
                loadingScreen.style.display = 'none';
                app.style.display = 'block';
                
                // Create a simple fallback toast
                var toastContainer = document.getElementById('toast-container');
                if (toastContainer) {
                    var toast = document.createElement('div');
                    toast.className = 'toast warning';
                    toast.innerHTML = '<i class="fas fa-exclamation-circle"></i><span>App loaded in fallback mode</span>';
                    toastContainer.appendChild(toast);
                    setTimeout(function() {
                        if (toast.parentNode) toast.remove();
                    }, 3000);
                }
            }
        }, 5000); // 5 second timeout
    </script>
</body>
</html>
